<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overriding JDO Annotations :: Apache Isis</title>
    <link rel="canonical" href="https://isis.apache.org/odn/hints-and-tips/overriding-jdo-annotations.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isis.apache.org">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="odn" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">DataNucleus ObjectStore</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../about.html">About</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../configuring.html">Configuring</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuring/properties.html">Properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuring/bulk-load.html">Bulk Load</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuring/disabling-persistence-by-reachability.html">Disabling Persistence by Reachability</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuring/persistence-xml.html">Persistence XML</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../configuring/using-jndi-data-source.html">Using JNDI Data Source</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../jdo-mappings.html">JDO Mappings</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jdo-mappings/1-to-m-bidirectional-relationships.html">1-to-m bidirectional relationships</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jdo-mappings/mandatory-properties-in-subtypes.html">Mandatory properties in subtypes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../jdo-mappings/mapping-to-a-view.html">Mapping to a View</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../db-schemas.html">DB Schemas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hints-and-tips.html">Hints-n-Tips</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="3">
    <a class="nav-link" href="overriding-jdo-annotations.html">Overriding JDO Annotations</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="subtype-entity-not-fully-populated.html">Subtype entity not fully populated</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="java8.html">Java 8</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="diagnosing-n-plus-1.html">Diagnosing n-plus-1</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="typesafe-queries-and-fetchgroups.html">Typesafe Queries and Fetchgroups</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="jdoql-and-timestamps.html">JDOQL and Timestamps</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">DataNucleus ObjectStore</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Architecture & Design</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../archdesign/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Hello World</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../helloworld/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - SimpleApp</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../simpleapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions - SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ext-secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Fundamentals & Beyond</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ug/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Guides - Reference Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rg/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Maven Dependencies</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mavendeps/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mignotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../relnotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Runtime Services</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../runtime-services/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SmokeTest App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../smoketests/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Table of Contents</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">DataNucleus ObjectStore</a></li>
    <li><a href="../about.html">About</a></li>
    <li><a href="../hints-and-tips.html">Hints-n-Tips</a></li>
    <li><a href="overriding-jdo-annotations.html">Overriding JDO Annotations</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/hobrom/antora/isis/core/plugins/jdo/_adoc/modules/ROOT/pages/hints-and-tips/overriding-jdo-annotations.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Overriding JDO Annotations</h1>
<div class="paragraph">
<p>The JDO Objectstore (or rather, the underlying DataNucleus implementation) builds its own persistence metamodel by reading both annotations on the class and also by searching for metadata in XML files.
The metadata in the XML files takes precedence over the annotations, and so can be used to override metadata that is "hard-coded" in annotations.</p>
</div>
<div class="paragraph">
<p>In fact, JDO/DataNucleus provides two different XML files that have slightly different purposes and capabilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, a <code>.jdo</code> file can be provided which - if found - completely replaces the annotations.<br></p>
<div class="paragraph">
<p>The idea here is simply to use XML as the means by which metadata is specified.</p>
</div>
</li>
<li>
<p>second, an <code>.orm</code> file can be provided which - if found - provides individual overrides for a particular database vendor.<br></p>
<div class="paragraph">
<p>The idea here is to accommodate for subtle differences in support for SQL between vendors.
A good example is the default schema for a table: <code>dbo</code> for SQL Server, <code>public</code> for HSQLDB, <code>sys</code> for Oracle, and so on.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want to use the first approach (the <code>.jdo</code> file), you&#8217;ll find that you can download the effective XML representation of domain entities using the <a href="../../rg/cms/rgcms.html#__rgcms_classes_mixins_Persistable_downloadJdoMetadata" class="page">downloadJdoMetadata</a> mixin action available in prototyping mode.
This then needs to be renamed and placed in the appropriate location on the classpath; see the <a href="http://www.datanucleus.org">DataNucleus documentation</a> for details.</p>
</div>
<div class="paragraph">
<p>However, using this first approach does create a maintenance effort; if the domain entity&#8217;s class structure changes over time, then the XML metadata file will need to be updated.</p>
</div>
<div class="paragraph">
<p>The second approach (using an <code>.orm</code> file) is therefore often more useful than the first, because the metadata provided overrides rather than replaces the annotations (and annotations not overridden continue to be honoured).</p>
</div>
<div class="paragraph">
<p>A typical use case is to change the database schema for an entity.
For example, the various (non-ASF) <a href="https://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a> modules use schemas for each entity. For example, the <code>AuditEntry</code> entity in the (non-ASF) <a href="https://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s audit module is annotated as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@javax.jdo.annotations.PersistenceCapable(
        identityType=IdentityType.DATASTORE,
        schema = "IsisAddonsAudit",
        table="AuditEntry")
public class AuditEntry {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will map the <code>AuditEntry</code> class to a table <code>&quot;IsisAddonsAudit&quot;.&quot;AuditEntry&quot;</code>; that is using a custom schema to own the object.</p>
</div>
<div class="paragraph">
<p>Suppose though that for whatever reason we didn&#8217;t want to use a custom schema but would rather use the default.
Also suppose we are using SQL Server as our target database.</p>
</div>
<div class="paragraph">
<p>We can override the above annotation using a <code>AuditEntry-sqlserver.orm</code> file, placed in the same package as the <code>AuditEntry</code> entity.
For example:</p>
</div>
<div class="listingblock">
<div class="title">AuditEntry-sqlserver.orm</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;orm xmlns="http://xmlns.jcp.org/xml/ns/jdo/orm"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/jdo/orm
        http://xmlns.jcp.org/xml/ns/jdo/orm_3_0.xsd"&gt;

    &lt;package name="org.isisaddons.module.audit.dom"&gt;
        &lt;class name="AuditEntry"
               schema="isisaudit"
               table="AuditEntry"&gt;
        &lt;/class&gt;
    &lt;/package&gt;
&lt;/orm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also necessary to tell JDO/DataNucleus about which vendor is being used (<code>sqlserver</code> in the example above).
This is done using a configuration property:</p>
</div>
<div class="listingblock">
<div class="title">isis.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">isis.persistor.datanucleus.impl.datanucleus.Mapping=sqlserver</code></pre>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
