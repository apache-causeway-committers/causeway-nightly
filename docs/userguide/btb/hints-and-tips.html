<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hints and Tips :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../helloworld/about.html">Hello World</a>
            <a class="navbar-item" href="../../simpleapp/about.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../demoapp/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">User Guide</span>
            <a class="navbar-item" href="../../userguide/about.html">Fundamentals &amp; Beyond</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Reference</span>
            <a class="navbar-item" href="../../refguide/about.html">Reference Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/about.html">Security Guide</a>
            <a class="navbar-item" href="../../ext-secman/about.html">SecMan (extension)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Testing</span>
            <a class="navbar-item" href="../../testing/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../vro/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../odn/about.html">DataNucleus Object Store</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../extensions/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../toc/devguide/about.html">Developers' Guide</a>
            <a class="navbar-item" href="../../toc/mavendeps/about.html">Maven dependencies</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Mailing Lists</span>
            <a class="navbar-item" href="../../toc/mailing-list/how-to-subscribe.html">How to subscribe</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">ASF JIRA</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../toc/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/about.html">Release Notes</a>
            <a class="navbar-item" href="../../mignotes/about.html">Migration Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Internal</span>
            <a class="navbar-item" href="../../toc/comguide/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../core/about.html">Core Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">@ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../toc/about.html">
          <span class="icon">
            <img src="../../_/img/isis-logo-48x48.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="userguide" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../fun/about.html">Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/core-concepts.html">Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/building-blocks.html">Building Blocks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/programming-model.html">Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/ui-hints.html">UI Hints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/crud.html">CRUD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/business-rules.html">Business Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/drop-downs-and-defaults.html">Drop downs and Defaults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../fun/available-domain-services.html">Available Domain Services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Beyond the Basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="i18n.html">i18n</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="headless-access.html">Headless Access</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="hints-and-tips.html">Hints-n-Tips</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="programming-model.html">Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="deployment.html">Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="web-xml.html">web.xml</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">User Guide</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Core Framework</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../core/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../extensions/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../incubator/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../legacy/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../refguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Starter Apps</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../starters/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorial App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">User Guide</a></li>
    <li><a href="about.html">Beyond the Basics</a></li>
    <li><a href="hints-and-tips.html">Hints-n-Tips</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/antora/components/userguide/modules/btb/pages/hints-and-tips.adoc">Edit this Page</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Hints and Tips</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides some solutions for problems we&#8217;ve encountered ourselves or have been raised on the Apache Isis mailing lists.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="are-you-sure"><a class="anchor" href="#are-you-sure"></a>'Are you sure?' idiom</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes an action might perform irreversible changes.
In such a case it&#8217;s probably a good idea for the UI to require that the end-user explicitly confirms that they intended to invoke the action.</p>
</div>
<div class="sect2">
<h3 id="using-action-semantics"><a class="anchor" href="#using-action-semantics"></a>Using action semantics</h3>
<div class="paragraph">
<p>One way to meet this requirement is using the framework&#8217;s built-in <a href="../../refguide/applib-ant/Action.html#semantics" class="page"><code>@Action#semantics()</code></a> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(
        semantics = SemanticsOf.IDEMPOTENT_ARE_YOU_SURE
)
public SimpleObject updateName(
        @Parameter(maxLength = NAME_LENGTH)
        @ParameterLayout(named = "New name")
        final String name) {
    setName(name);
    return this;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will render as:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/action-semantics-are-you-sure.png"><img src="_images/hints-and-tips/action-semantics-are-you-sure.png" alt="action semantics are you sure"></a>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using-a-checkbox"><a class="anchor" href="#using-a-checkbox"></a>Using a checkbox</h3>
<div class="paragraph">
<p>An alternative approach (for all versions of the framework) is to require the end-user to check a dummy checkbox parameter (and prevent the action from being invoked if the user hasn&#8217;t checked that parameter).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/are-you-sure.png"><img src="_images/hints-and-tips/are-you-sure.png" alt="are you sure"></a>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these screenshots shows an earlier version of the <a href="../../vw/about.html" class="page">Wicket viewer</a> UI (specifically, pre 1.8.0).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the user checks the box:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/are-you-sure-happy-case.png"><img src="_images/hints-and-tips/are-you-sure-happy-case.png" alt="are you sure happy case"></a>
</div>
</div>
<div class="paragraph">
<p>then the action will complete.</p>
</div>
<div class="paragraph">
<p>However, if the user fails to check the box, then a validation message is shown:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/are-you-sure-sad-case.png"><img src="_images/hints-and-tips/are-you-sure-sad-case.png" alt="are you sure sad case"></a>
</div>
</div>
<div class="paragraph">
<p>The code for this is pretty simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public List&lt;ToDoItem&gt; delete(@ParameterLayout(named="Are you sure?") boolean areYouSure) {
    repositoryService.remove(this);
    messageService.informUser("Deleted " + titleService.titleOf(this));
    return toDoItems.notYetComplete();          <i class="conum" data-value="1"></i><b>(1)</b>
}
public String validateDelete(boolean areYouSure) {
    return areYouSure? null: "Please confirm you are sure";
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>invalid to return <code>this</code> (cannot render a deleted object)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the action itself does not use the boolean parameter, it is only used by the supporting <a href="../../refguide/applib-cm/methods.html#validate" class="page"><code>validate&#8230;&#8203;()</code></a> method.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="replacing-default-service-implementations"><a class="anchor" href="#replacing-default-service-implementations"></a>Overriding Default Service Implns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework provides default implementations for many of the <a href="../../refguide/applib-svc/about.html" class="page">domain services</a>.
This is convenient, but sometimes you will want to replace the default implementation with your own service implementation.</p>
</div>
<div class="paragraph">
<p>For example, suppose you wanted to provide your own implementation of <a href="../../refguide/applib-svc/presentation-layer-spi/LocaleProvider.html" class="page"><code>LocaleProvider</code></a>.
The trick is to use the <a href="../../refguide/applib-ant/DomainServiceLayout.html#menuOrder" class="page"><code>@DomainServiceLayout#menuOrder()</code></a> attribute, specifying a low number (typically <code>"1"</code>).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s how:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainService(
        nature = NatureOfService.DOMAIN
)
public class MyLocaleProvider implements LocaleProvider {
    @Override
    public Locale getLocale() {
        return ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The framework uses the value of the <code>menuOrder</code> attribute to determine priority; lowest number wins.</p>
</div>
<div class="paragraph">
<p>However, there is no need to specify the <code>menuOrder</code> attribute: its default value is now set to a lower value (specifically: <code>Integer.MAX_VALUE - 100</code>) than all of the framework-provided implementations, and thus always takes precedence.</p>
</div>
<div class="paragraph">
<p>Thus, if a single instance is to be injected, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@javax.inject.Inject
LocalProvider localeProvider;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then the custom implementation will be used in preference to the framework&#8217;s default implementation.</p>
</div>
<div class="paragraph">
<p>If multiple instances are injected, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@javax.inject.Inject
List&lt;LocalProvider&gt; localeProviders;</code></pre>
</div>
</div>
<div class="paragraph">
<p>then all implementations will be present in the list, ordered by priority; your custom implementation will be first in the list.</p>
</div>
<div class="sect2">
<h3 id="decorating-existing-implementations"><a class="anchor" href="#decorating-existing-implementations"></a>Decorating existing implementations</h3>
<div class="paragraph">
<p>It&#8217;s also quite common to want to decorate the existing implementation (ie have your own implementation delegate to the default); this is also possible and quite easy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainService(
        nature = NatureOfService.DOMAIN
)
@DomainServiceLayout(
        menuOrder = "1"                                                                             <i class="conum" data-value="1"></i><b>(1)</b>
)
public class MyLocaleProvider implements LocaleProvider {
    @Override
    public Locale getLocale() {
        return getDelegateLocaleProvider().getLocale();                                             <i class="conum" data-value="2"></i><b>(2)</b>
    }
    Optional&lt;LocaleProvider&gt; delegateLocaleProvider;                                                <i class="conum" data-value="3"></i><b>(3)</b>
    private LocaleProvider getDelegateLocaleProvider() {
        if(delegateLocaleProvider == null) {
            delegateLocaleProvider = Iterables.tryFind(localeProviders, input -&gt; input != this);    <i class="conum" data-value="4"></i><b>(4)</b>
        }
        return delegateLocaleProvider.orNull();
    }
    @Inject
    List&lt;LocaleProvider&gt; localeProviders;                                                           <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>takes precedence over the default implementation when injected elsewhere.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>this implementation merely delegates to the default implementation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>lazily populated</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>delegate to the first implementation that isn&#8217;t <em>this</em> implementation (else infinite loop!)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Injects all implementations, including this implemenation</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vetoing-visibility"><a class="anchor" href="#vetoing-visibility"></a>Vetoing Visibility</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
FIXME - a write-up of the "vetoing subscriber" design pattern, eg as described in the  <a href="../../refguide/applib-svc/integration-api/BookmarkService.html" class="page"><code>BookmarkService</code></a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>eg if included an addon such as auditing or security.</p>
</div>
<div class="paragraph">
<p>solution is to write a domain event subscriber that vetoes the visibility</p>
</div>
<div class="paragraph">
<p>All the addons actions inherit from common base classes so this can be as broad-brush or fine-grained as required</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions-and-errors"><a class="anchor" href="#transactions-and-errors"></a>Transactions and Errors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Apache Isis, every interaction (action invocation or property edit) is automatically wrapped in a transaction,
and any repository query automatically does a flush before hand.</p>
</div>
<div class="paragraph">
<p>What that means is that there&#8217;s no need to explicitly start or commit transactions in Apache Isis; this will be done
for you. Indeed, if you do try to manage transactions (eg by reaching into the JDO <code>PersistenceManager</code> exposed by the
<a href="../../refguide/applib-svc/persistence-layer-api/IsisJdoSupport.html" class="page">IsisJdoSupport</a> domain service, then you are likely to confuse the
framework and get a stack trace for your trouble.</p>
</div>
<div class="paragraph">
<p>However, you can complete a given transaction and start a new one.  This is sometimes useful if writing a fixture
script which is going to perform some sort of bulk migration of data from an old system.  For this use case, use the
<a href="../../refguide/applib-svc/application-layer-api/TransactionService.html" class="page"><code>TransactionService</code></a>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SomeLongRunningFixtureScript extends FixtureScript

    protected void execute(final ExecutionContext executionContext) {
        // do some work
        transactionService.nextTransaction();
        // do some work
        transactionService.nextTransaction();
        // do yet more work
    }

    @javax.inject.Inject
    TransactionService transactionService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You get the idea.</p>
</div>
<div class="sect2">
<h3 id="raise-message-in-the-ui"><a class="anchor" href="#raise-message-in-the-ui"></a>Raise message in the UI</h3>
<div class="paragraph">
<p>The framework provides the <a href="../../refguide/applib-svc/application-layer-api/MessageService.html" class="page"><code>MessageService</code></a> as a means to return an out-of-band
message to the end-user.  In the <a href="../../vw/about.html" class="page">Wicket viewer</a> these are shown as "toast" pop-ups; the
<a href="../../vro/about.html" class="page">Restful Objects viewer</a> returns an HTTP header.</p>
</div>
<div class="paragraph">
<p>The <code>UserService</code> provides three APIs, for different:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>informUser()</code> - an informational message.  In the Wicket viewer these are short-lived pop-ups that disappear after a short time.</p>
</li>
<li>
<p><code>warnUser()</code> - a warning.  In the Wicket viewer these do not auto-close; they must be acknowledged.</p>
</li>
<li>
<p><code>raiseError()</code> - an error.  In the Wicket viewer these do not auto-close; they must be acknowledged.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each pop-up has a different background colour indicating its severity.</p>
</div>
<div class="paragraph">
<p>None of these messages/errors has any influence on the transaction; any changes to objects will be committed.</p>
</div>
</div>
<div class="sect2">
<h3 id="aborting-transactions"><a class="anchor" href="#aborting-transactions"></a>Aborting transactions</h3>
<div class="paragraph">
<p>If you want to abort Apache Isis' transaction, this can be done by throwing an exception.  The exception message
is displayed to the user on the error page (if <a href="../../vw/about.html" class="page">Wicket viewer</a>) or a 500 status error code (if the
<a href="../../vro/about.html" class="page">Restful Objects</a> viewer).</p>
</div>
<div class="paragraph">
<p>If the exception thrown is because of an unexpected error (eg a <code>NullPointerException</code> in the domain app itself), then
the error page will include a stack trace.  If however you want to indicate that the exception is in some sense
"expected", then throw a <code>RecoverableException</code> (or any subclass, eg <code>ApplicationException</code>); the stack trace will then
be suppressed from the error page.</p>
</div>
<div class="paragraph">
<p>Another way in which exceptions might be considered "expected" could be as the result of attempting to persist an
object which then violates some type of database constraint.  Even if the domain application checks beforehand, it
could be that another user operating on the object at the same moment of time might result in the conflict.</p>
</div>
<div class="paragraph">
<p>To handle this the <a href="../../refguide/applib-svc/presentation-layer-spi/ExceptionRecognizer.html" class="page"><code>ExceptionRecognizer</code></a> SPI can be used.  The
framework provides a number of implementations out-of-the-box; whenever an exception is thrown it is passed to each
known recognizer implementation to see if it recognizes the exception and can return a user-meaningful error message.
For example, <code>ExceptionRecognizerForSQLIntegrityConstraintViolationUniqueOrIndexException</code> checks if the
exception inherits from <code>java.sql.SQLIntegrityConstraintViolationException</code>, and if so, constructs a suitable message.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persisted-title"><a class="anchor" href="#persisted-title"></a>Persisted Title</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Normally the title of an object is not persisted to the database, rather it is recomputed automatically from underlying properties.  On occasion though you might want the title to also be persisted; either to make things easier for the DBA, or for an integration scenario, or some other purpose.</p>
</div>
<div class="paragraph">
<p>We can implement this feature by leveraging the <a href="../../refguide/applib-cm/methods.html#jdo-api" class="page">JDO lifecycle</a>.  In the design we discuss here we make it a responsibility of the entities to persist the title as a property, by implementing a <code>ObjectWithPersistedTitle</code> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ObjectWithPersistedTitle {
    @PropertyLayout(hidden = Where.EVERYWHERE)  <i class="conum" data-value="1"></i><b>(1)</b>
    String getTitle();
    void setTitle(final String title);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>we don&#8217;t want to expose this in the UI because the title is already prominently displayed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We can then define a subscribing domain service that leverage this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.context.event.EventListener;

@DomainService(nature = NatureOfService.DOMAIN)
public class TitlingService extends AbstractSubscriber {

    @EventListener(ObjectPersistingEvent.class)
    public void on(ObjectPersistingEvent ev) {
        handle(ev.getSource());
    }

    @EventListener(ObjectUpdatingEvent.class)
    public void on(ObjectUpdatingEvent ev) {
        handle(ev.getSource());
    }

    private void handle(final Object persistentInstance) {
        if(persistentInstance instanceof ObjectWithPersistedTitle) {
            final ObjectWithPersistedTitle objectWithPersistedTitle =
                (ObjectWithPersistedTitle) persistentInstance;
            objectWithPersistedTitle.setTitle(titleService.titleOf(objectWithPersistedTitle));
        }
    }

    @Inject
    TitleService titleService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to accomplish this by accessing the JDO API directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequestScoped
@DomainService(nature = NatureOfService.DOMAIN)
public class TitlingService {
    @PostConstruct
    public void init() {
        isisJdoSupport.getJdoPersistenceManager().addInstanceLifecycleListener(
            new StoreLifecycleListener() {
                @Override
                public void preStore(final InstanceLifecycleEvent event) {
                    final Object persistentInstance = event.getPersistentInstance();
                    if(persistentInstance instanceof ObjectWithPersistedTitle) {
                        final ObjectWithPersistedTitle objectWithPersistedTitle =
                            (ObjectWithPersistedTitle) persistentInstance;
                        objectWithPersistedTitle.setTitle(titleService.titleOf(objectWithPersistedTitle));
                    }
                }
                @Override
                public void postStore(final InstanceLifecycleEvent event) {
                }
            }, null);
    }
    @Inject
    IsisJdoSupport isisJdoSupport;
    @Inject
    TitleService titleService;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above is probably the easiest and most straightforward design. One could imagine other designs where the persisted title is stored elsewhere.  It could even be stored off into an <a href="http://lucene.apache.org/">Apache Lucene</a> (or similar) database to allow for free-text searches.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view-model-instantiation"><a class="anchor" href="#view-model-instantiation"></a>View Model Instantiation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vith view models, some care must be taken in how they are instantiated.
Specifically, it&#8217;s important that the framework doesn&#8217;t "know" about the view model until its state is "sufficiently" populated to distinguish from other view models.</p>
</div>
<div class="paragraph">
<p>In practical terms, this means that view models should be instantiated using a constructor, and then injecting services (if required) using the <a href="../../refguide/applib-svc/metadata-api/ServiceRegistry.html" class="page"><code>ServiceRegistry</code></a> service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerViewModel viewModel = new CustomerViewModel("Joe", "Bloggs");
serviceRegistry.injectServicesInto(viewModel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>What will most likely <strong>fail</strong> is to use the <a href="../../refguide/applib-svc/core-domain-api/FactoryService.html" class="page"><code>FactoryService</code></a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// DON'T DO THIS WITH VIEW MODELS
CustomerViewModel viewModel = factoryService.instantiate(CustomerViewModel.class);

viewModel.setFirstName("Joe");
viewModel.setLastName("Bloggs");
serviceRegistry.injectServicesInto(viewModel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s because the internal "OID" identifier that the framework creates to handle this view model will be incomplete.
Although the framework can handle changes to the OID (when the corresponding view model&#8217;s state changes) once created, this isn&#8217;t the case during initial instantiation process.</p>
</div>
<div class="sect2">
<h3 id="example"><a class="anchor" href="#example"></a>Example</h3>
<div class="paragraph">
<p>To explain further, here&#8217;s an implementation using <code>FactoryService</code> that fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { /* ... */ } )
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {                                                  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
    @XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

        OfficeOptionViewModel office1 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
            factoryService.instantiate(OfficeOptionViewModel.class);
        office1.setOffice("Amsterdam");                                     <i class="conum" data-value="3"></i><b>(3)</b>
        office1.setAmount(200);
        amountsPerOffice.add(office1);

        OfficeOptionViewModel office2 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
            factoryService.instantiate(OfficeOptionViewModel.class);
        office2.setOffice("London");                                        <i class="conum" data-value="3"></i><b>(3)</b>
        office2.setAmount(100);
        amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parent view model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>FactoryService</code>, incorrectly.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Hard-coded just for demo purposes</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This collection, is, confusing, rendered as:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/view-model-fail.png"><img src="_images/hints-and-tips/view-model-fail.png" alt="view model fail" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>Even though the <code>amountsPerOffice</code> collection of view models is correctly populated, the framework/viewer maps these to their corresponding OIDs before they are rendered.
Because the "Amsterdam" pojo and "London" pojo each mapped to the same OID, when fetching out the results the viewer obtains the London pojo both times.</p>
</div>
<div class="paragraph">
<p>The following implementation, on the other hand, succeeds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { /* ... */ } )
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {
    ...
    @XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

		OfficeOptionViewModel office1 = new OfficeOptionViewModel("Amsterdam", 200);    <i class="conum" data-value="1"></i><b>(1)</b>
		serviceRegistry.injectServicesInto(office1);
		amountsPerOffice.add(office1);

		OfficeOptionViewModel office2 = new OfficeOptionViewModel("London", 100);       <i class="conum" data-value="1"></i><b>(1)</b>
		serviceRegistry.injectServicesInto(office2);
		amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just instantiate with constructor.
The framework "sees" the domain object when services are injected into it.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As can be seen, this renders just fine:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/hints-and-tips/view-model-success.png"><img src="_images/hints-and-tips/view-model-success.png" alt="view model success" width="800px"></a>
</div>
</div>
<div class="paragraph">
<p>To complicate matters a little, note though that following "incorrect" implementation using <code>FactoryService</code> does also work correctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { ..., "amountsPerOffice" } )                     <i class="conum" data-value="1"></i><b>(1)</b>
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {
	...

    void init() {
        amountsPerOffice = calculateAmountsPerOffice();
    }

    @XmlElementWrapper
    @XmlElement(name = "officeOption")
    @CollectionLayout(defaultView = "table")
    @Getter @Setter
    private List&lt;OfficeOptionViewModel&gt; amountsPerOffice = Lists.newArrayList();

	@XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; calculateAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

		OfficeOptionViewModel office1 = factoryService.instantiate(OfficeOptionViewModel.class);
		office1.setOffice("Amsterdam");
		office1.setAmount(200);

		amountsPerOffice.add(office1);

		OfficeOptionViewModel office2 = factoryService.instantiate(OfficeOptionViewModel.class);
		office2.setOffice("London");
		office2.setAmount(100);

		amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>"amountsPerOffice" is part of the state of the parent view model</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the <code>amountsPerOffice</code> collection is part of the state of the parent view model and so in this particular case everything works with either <code>FactoryService#instantiate</code> or using <code>ServiceRegistry</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simulating-collections-of-values"><a class="anchor" href="#simulating-collections-of-values"></a>Collections of values</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although in Apache Isis you can have properties of either values (string, number, date etc) or of (references to other) entities, with collections the framework (currently) only supports collections of (references to) entities.  That is, collections of values (a bag of numbers, say) are not supported.</p>
</div>
<div class="paragraph">
<p>However, it is possible to simulate a bag of numbers using view models.</p>
</div>
<div class="sect2">
<h3 id="view-model"><a class="anchor" href="#view-model"></a>View Model</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
FIXME
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="persistence-concerns"><a class="anchor" href="#persistence-concerns"></a>Persistence Concerns</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
FIXME -  easiest to simply store using DataNucleus' support for collections, marked as <a href="../../refguide/applib-ant/Programmatic.html" class="page"><code>@Programmatic</code></a> so that it is ignored by Apache Isis.  Alternatively can store as json/xml in a varchar(4000) or clob and manually unpack.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-handle-void-and-null-results"><a class="anchor" href="#how-to-handle-void-and-null-results"></a>How to handle void/null results</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From this <a href="http://isis.markmail.org/thread/yf7qdeiu3vrvk2ei">thread</a> on the Apache Isis users mailing list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>When using a <code>void</code> action, let&#8217;s say a remove action, the user is redirected to a
page "no results".
When clicking the back button in the browser the user sees "Object not found" (since you&#8217;ve just deleted this object).</em></p>
</li>
<li>
<p><em>You can return a list for example to prevent the user from being redirect to a
"No results" page, but I think it&#8217;s not the responsibility of the controllers in
the domain model.</em></p>
</li>
<li>
<p><em>A solution could be that wicket viewer goes back one page when
  encountering a deleted object.
And refresh the current page when receiving a null response or invoking a void action.
But how to implement this?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One way to implement this idea is to provide a custom implementation of the <a href="../../refguide/applib-svc/presentation-layer-spi/RoutingService.html" class="page"><code>RoutingService</code></a> SPI domain service.
The default implementation will either return the current object (if not null), else the home page (as defined by <a href="../../refguide/applib-ant/HomePage.html" class="page"><code>@HomePage</code></a>) if one exists.</p>
</div>
<div class="paragraph">
<p>The following custom implementation refines this to use the breadcrumbs (available in the Wicket viewer) to return the first non-deleted domain object found in the list of breadcrumbs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainService(nature = NatureOfService.DOMAIN)
@DomainServiceLayout(menuOrder = "1")                                           <i class="conum" data-value="1"></i><b>(1)</b>
public class RoutingServiceUsingBreadcrumbs extends RoutingServiceDefault {
    @Override
    public Object route(final Object original) {
        if(original != null) {                                                  <i class="conum" data-value="2"></i><b>(2)</b>
            return original;
        }
        repositoryService.flush();                                              <i class="conum" data-value="3"></i><b>(3)</b>

        final BreadcrumbModelProvider wicketSession =                           <i class="conum" data-value="4"></i><b>(4)</b>
            (BreadcrumbModelProvider) AuthenticatedWebSession.get();
        final BreadcrumbModel breadcrumbModel =
            wicketSession.getBreadcrumbModel();
        final List&lt;EntityModel&gt; breadcrumbs = breadcrumbModel.getList();

        final Optional&lt;Object&gt; firstViewModelOrNonDeletedPojoIfAny =
                breadcrumbs.stream()                                            <i class="conum" data-value="5"></i><b>(5)</b>
                .filter(entityModel -&gt; entityModel != null)
                .map(EntityModel::getObject)                                    <i class="conum" data-value="6"></i><b>(6)</b>
                .filter(objectAdapter -&gt; objectAdapter != null)
                .map(ObjectAdapter::getObject)                                  <i class="conum" data-value="7"></i><b>(7)</b>
                .filter(pojo -&gt; !(pojo instanceof Persistable) ||
                                !((Persistable)pojo).dnIsDeleted())             <i class="conum" data-value="8"></i><b>(8)</b>
                .findFirst();

        return firstViewModelOrNonDeletedPojoIfAny.orElse(homePage());          <i class="conum" data-value="9"></i><b>(9)</b>
    }
    private Object homePage() {
        return homePageProviderService.homePage();
    }
    @Inject
    HomePageProviderService homePageProviderService;
    @Inject
    RepositoryService repositoryService;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>override the default imlpementation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if a non-null object was returned, then return this</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>ensure that any persisted objects have been deleted.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>reach inside the Wicket viewer&#8217;s internals to obtain the list of breadcrumbs.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>loop over all breadcrumbs</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>unwrap the Wicket viewer&#8217;s serializable representation of each domain object (<code>EntityModel</code>) to the Isis runtime&#8217;s
representation (<code>ObjectAdapter</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>unwrap the Isis runtime&#8217;s representation of each domain object (<code>ObjectAdapter</code>) to the domain object pojo itself</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>if object is persistable (not a view model) then make sure it is not deleted</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>return the first object if any, otherwise the home page object (if any).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that the above implementation uses Java 8, so if you are using Java 7 then you&#8217;ll need to backport accordingly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multi-tenancy"><a class="anchor" href="#multi-tenancy"></a>Multi-tenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One significant feature provided by the <a href="../../secman/about.html" class="page">SecMan extension</a> is the ability to associate users and objects with a "tenancy".</p>
</div>
<div class="paragraph">
<p>For more details, see the <a href="../../secman/about.html" class="page">SecMan extension</a>'s documentation.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="subclass-properties-in-tables"><a class="anchor" href="#subclass-properties-in-tables"></a>Subclass properties in tables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Suppose you have a hierarchy of classes where a property is derived and abstract in the superclass, concrete implementations in the subclasses. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class LeaseTerm {
    public abstract BigDecimal getEffectiveValue();
    ...
}

public class LeaseTermForIndexableTerm extends LeaseTerm {
    public BigDecimal getEffectveValue() { /* ... */ }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently the Wicket viewer will not render the property in tables (though the property is correctly rendered in views).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For more background on this workaround, see <a href="https://issues.apache.org/jira/browse/ISIS-582">ISIS-582</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The work-around is simple enough; make the method concrete in the superclass and return a dummy implementation, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public abstract class LeaseTerm {
    public BigDecimal getEffectiveValue() {
        return null;        // workaround for ISIS-582
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively the implementation could throw a <code>RuntimeException</code>, eg</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">throw new RuntimeException("never called; workaround for ISIS-582");</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pushing-changes"><a class="anchor" href="#pushing-changes"></a>Pushing Changes (deprecated)</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This technique is much less powerful than using <a href="#userguide:fun/building-blocks.adoc#domain-events" class="page unresolved">the event bus</a> or an SPI service.
We present it mostly for completeness.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="when-a-property-is-changed"><a class="anchor" href="#when-a-property-is-changed"></a>When a property is changed</h3>
<div class="paragraph">
<p>If you want to invoke functionality whenever a property is changed by the user, then you can create a supporting <code>modifyXxx()</code> method and include the functionality within that. The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void modifyPropertyName(PropertyType param) { /* ... */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Why not just put this functionality in the setter? Well, the setter is used by the object store to recreate the state of an already persisted object. Putting additional behaviour in the setter would cause it to be triggered incorrectly.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Order() {
    public Integer getAmount() { /* ... */ }
    public void setAmount(Integer amount) { /* ... */ }
    public void modifyAmount(Integer amount) { <i class="conum" data-value="1"></i><b>(1)</b>
        setAmount(amount);  <i class="conum" data-value="3"></i><b>(3)</b>
        addToTotal(amount); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>modifyAmount()</code> method calls &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; the <code>addToTotal()</code> (not shown) to maintain some running total.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We don&#8217;t want this <code>addToCall()</code> method to be called when pulling the object back from the object store, so we put it into the modify, not the setter.</p>
</div>
<div class="paragraph">
<p>You may optionally also specify a <code>clearXxx()</code> which works the same way as modify <code>modify Xxx()</code> but is called when the property is cleared by the user (i.e. the current value replaced by nothing). The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void clearPropertyName() { /* ... */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>To extend the above example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Order() {
    public Integer getAmount() { /* ... */ }
    public void setAmount(Integer amount) { /* ... */ }
    public void modifyAmount(Integer amount) { /* ... */ }
    public void clearAmount() {
        removeFromTotal(this.amount);
        setAmount(null);
    }
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="when-a-collection-is-modified"><a class="anchor" href="#when-a-collection-is-modified"></a>When a collection is modified</h3>
<div class="paragraph">
<p>A collection may have a corresponding <code>addToXxx()</code> and/or
<code>removeFromXxx()</code> method. If present, and direct manipulation of the
contents of the connection has not been disabled (see ?), then they will
be called (instead of adding/removing an object directly to the
collection returned by the accessor).</p>
</div>
<div class="paragraph">
<p>The reason for this behaviour is to allow other behaviour to be
triggered when the contents of the collection is altered. That is, it is
directly equivalent to the supporting <code>modifyXxx()</code> and <code>clearXxx()</code>
methods for properties (see ?).</p>
</div>
<div class="paragraph">
<p>The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void addTo&lt;CollectionName&gt;(EntityType param) { /* ... */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void removeFromCollectionName(EntityType param) { /* ... */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>EntityType</code> is the same type as the generic collection type.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class Employee { /* ... */ }

public class Department {

    private int numMaleEmployees;                           <i class="conum" data-value="1"></i><b>(1)</b>
    private int numFemaleEmployees;                         <i class="conum" data-value="2"></i><b>(2)</b>

    private Set&lt;Employee&gt; employees = new TreeSet&lt;Employee&gt;();
    public Set&lt;Employee&gt; getEmployees() {
        return employees;
    }
    private void setEmployees(Set&lt;Employee&gt; employees) {
        this.employees = employees;
    }
    public void addToEmployees(Employee employee) {         <i class="conum" data-value="3"></i><b>(3)</b>
        numMaleEmployees += countOneMale(employee);
        numFemaleEmployees += countOneFemale(employee);
        employees.add(employee);
    }
    public void removeFromEmployees(Employee employee) {    <i class="conum" data-value="4"></i><b>(4)</b>
        numMaleEmployees -= countOneMale(employee);
        numFemaleEmployees -= countOneFemale(employee);
        employees.remove(employee);
    }
    private int countOneMale(Employee employee) { return employee.isMale()?1:0; }
    private int countOneFemale(Employee employee) { return employee.isFemale()?1:0; }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>maintain a count of the number of male &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; and female employees (getters and setters omitted)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the <a href="../../refguide/applib-cm/methods.html#addTo" class="page"><code>addTo&#8230;&#8203;()</code></a> method increments the derived properties</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>the <a href="../../refguide/applib-cm/methods.html#removeFrom" class="page"><code>removeFrom&#8230;&#8203;()</code></a> method similarly decrements the derived properties</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-implement-a-spellchecker"><a class="anchor" href="#how-to-implement-a-spellchecker"></a>How to implement a spellchecker?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>From this <a href="http://isis.markmail.org/thread/dduarjscrbnodfsi">thread</a> on the Apache Isis users mailing list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>What is the easiest way to add a spell checker to the text written in a field in
a domain object, for instance to check English syntax?</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One way to implement is to use the <a href="../../refguide/applib-svc/core-domain-api/EventBusService.html" class="page">event bus</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set up a <a href="../../refguide/applib-cm/classes/domainevent.html" class="page">domain event</a> <a href="../../refguide/applib-cm/classes/super.html#AbstractSubscriber" class="page">subscriber</a> that can veto the changes.</p>
</li>
<li>
<p>if the change is made through an action, you can use <a href="../../refguide/applib-ant/Action.html#domainEvent" class="page"><code>@Action#domainEvent()</code></a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>if if the change is made through an edit, you can use <a href="../../refguide/applib-ant/Property.html#domainEvent" class="page"><code>@Property#domainEvent()</code></a>.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll need some way to know which fields should be spell checked.  Two ways spring to mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>either look at the domain event&#8217;s identifier</p>
</li>
<li>
<p>or subclass the domain event (recommended anyway) and have those subclass events implement some sort of marker interface, eg a <code>SpellCheckEvent</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And you&#8217;ll (obviously) also need some sort of spell checker implementation to call.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <h3 class="toc-title">On this page</h3>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2019 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20191213-0404-acdccad6</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hideEffect: "slideUp",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
