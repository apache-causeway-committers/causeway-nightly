<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>View Models :: causeway</title>
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../.." title="causeway">
  <link rel="next" href="mixins.html" title="Mixins">
  <link rel="prev" href="drop-downs-and-defaults.html" title="Drop downs &amp;amp; Defaults">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
          <span class="icon">
            <img src="../../_/img/causeway-logo-no-words-65x48.png"></img>
          </span>
        <span class="navbar-title">causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../docs/latest/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../docs/latest/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Learning &amp; Tutorials</span>
            <a class="navbar-item" href="../../docs/latest/reference/about.html">Reference App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../docs/latest/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../docs/latest/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/about.html">User Guide</a>
            <a class="navbar-item" href="../../refguide/latest/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../testing/latest/about.html">Testing Guide</a>
            <a class="navbar-item" href="../../security/latest/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">For use in apps</span>
            <a class="navbar-item" href="../../valuetypes/latest/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../setupguide/latest/about.html">Setup Guide</a>
            <a class="navbar-item" href="../../conguide/latest/about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/bypass/about.html">Bypass</a>
            <a class="navbar-item" href="../../security/latest/shiro/about.html">Shiro</a>
            <a class="navbar-item" href="../../security/latest/spring/about.html">Spring</a>
            <a class="navbar-item" href="../../security/latest/keycloak/about.html">Keycloak</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/latest/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../vro/latest/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../pjpa/latest/about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../pjdo/latest/about.html">JDO (DataNucleus)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Extensions</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/commandlog/about.html">Command Log</a>
            <a class="navbar-item" href="../../userguide/latest/docgen/about.html">Doc Gen</a>
            <a class="navbar-item" href="../../userguide/latest/executionlog/about.html">Execution Log</a>
            <a class="navbar-item" href="../../userguide/latest/executionoutbox/about.html">Execution Outbox</a>
            <a class="navbar-item" href="../../userguide/latest/executionrepublisher/about.html">Execution Republisher</a>
            <a class="navbar-item" href="../../userguide/latest/excel/about.html">Excel</a>
            <a class="navbar-item" href="../../userguide/latest/flyway/about.html">Flyway</a>
            <a class="navbar-item" href="../../userguide/latest/layoutloaders/about.html">Layout Loaders</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/secman/about.html">Secman</a>
            <a class="navbar-item" href="../../security/latest/audittrail/about.html">Audit Trail</a>
            <a class="navbar-item" href="../../security/latest/spring-oauth2/about.html">Spring OAuth2 Integration</a>
            <a class="navbar-item" href="../../security/latest/shiro-realm-ldap/about.html">LDAP Realm for Shiro</a>
            <a class="navbar-item" href="../../security/latest/sessionlog/about.html">Session Log</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Web UI (Wicket)</span>
            <a class="navbar-item" href="../../vw/latest/fullcalendar/about.html">Full Calendar</a>
            <a class="navbar-item" href="../../vw/latest/pdfjs/about.html">pdf.js</a>
            <a class="navbar-item" href="../../vw/latest/sse/about.html">Server Side Events</a>
            <a class="navbar-item" href="../../vw/latest/tabular/about.html">Tabular Download</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">REST API (Restful Objects)</span>
            <a class="navbar-item" href="../../vro/latest/cors/about.html">CORS</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../docs/latest/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../docs/latest/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/CAUSEWAY">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/causeway">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../docs/latest/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/latest/about.html">Release Notes</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../comguide/latest/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../tooling/latest/about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_isis">SonarCloud.io</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Interim Builds</span>
            <a class="navbar-item" href="../../comguide/latest/nightly-builds.html">Nightly builds</a>
            <a class="navbar-item" href="../../comguide/latest/weekly-builds.html">Weekly builds</a>
            <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">Website Preview (not ASF hosted)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../core/latest/about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../regressiontests/latest/about.html">Regression Tests</a>
            <a class="navbar-item" href="../../incubator/latest/about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../more-thanks/latest/more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Causeway.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../docs/latest/about.html">
          <span class="icon">
            <img src="../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="userguide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-search hide-for-print">
  <input id="algolia-search-input" placeholder="Search"></span>
</div>
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="drop-downs-and-defaults.html" title="Drop downs &amp;amp; Defaults"><span></span></a>
  <a class="page-next" rel="next"
     href="mixins.html" title="Mixins"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Drop downs &amp;amp; Defaults"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="overview.html">10,000ft overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="domain-entities.html">Domain Entities</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="domain-services.html">Domain Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="properties-collections-actions.html">Properties, Collections &amp; Actions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ui-layout-and-hints.html">UI Layout &amp; Hints</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="business-rules.html">Business Rules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="drop-downs-and-defaults.html">Drop downs &amp; Defaults</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="view-models.html">View Models</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="mixins.html">Mixins</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="events.html">Events</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="modules.html">Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="value-types.html">Value types</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="meta-annotations.html">Meta-annotations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="background-context-and-theory.html">Background, Context &amp; Theory</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="btb/about.html">Beyond the Basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="btb/headless-access.html">Headless Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="btb/programming-model.html">Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="btb/hints-and-tips.html">Hints-n-Tips</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="btb/i18n.html">Internationalization (i18n)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="commandlog/about.html">Command Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="docgen/about.html">DocGen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="executionlog/about.html">Execution Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="executionoutbox/about.html">Execution Outbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="executionrepublisher/about.html">Execution Republisher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="excel/about.html">Excel Library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="flyway/about.html">Flyway</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="layoutloaders/about.html">Layout Loaders</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">User Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version">
          <a href="../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions</span>
      <ul class="versions">
        <li class="version">
          <a href="../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tooling</span>
      <ul class="versions">
        <li class="version">
          <a href="../../tooling/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version">
          <a href="../../tutorials/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">User Guide</a></li>
    <li><a href="view-models.html">View Models</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/causeway/edit/master/antora/components/userguide/modules/ROOT/pages/view-models.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">View Models</h1>
<div class="sect1">
<h2 id="introduction"><a class="anchor" href="#introduction"></a>Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>View models are similar to entities in that (unlike domain services) there can be many instances of any given type.
End users interact with view models in the same way as a domain entity, indeed they are unlikely to distinguish one from the other.</p>
</div>
<div class="paragraph">
<p>However, whereas domain entities are mapped to a datastore, view models are not.
Instead, they are recreated dynamically by serializing their state, ultimately into the URL itself (meaning their state it is in effect implicitly managed by the client browser).
You will notice that the URL for view models (as shown in <a href="../../vw/latest/about.html" class="xref page">Web UI (Wicket viewer)</a> or <a href="../../vro/latest/about.html" class="xref page">RestfulObjects viewer</a>) tends to be quite long.</p>
</div>
<div class="paragraph">
<p>This capability opens up a number of more advanced use cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the same way that an (RDBMS) database view can aggregate and abstract from multiple underlying database tables, a view model sits on top of one or many underlying entities.</p>
</li>
<li>
<p>A view model could also be used as a proxy for some externally managed entity, accessed over a web service or REST API; it could even be a representation of state held in-memory (such as user preferences, for example).</p>
</li>
<li>
<p>view models can also be used to support a particular use case.
An example that comes to mind is to expose a list of scanned PDFs to be processed as an "intray", showing the list of PDFs on one side of the page, and the current PDF being viewed on the other.
Such view models are part of the application layer, not part of the domain layer (where entities live).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We explore these use cases in more detail below.</p>
</div>
<div class="sect2">
<h3 id="application-layer-view-models"><a class="anchor" href="#application-layer-view-models"></a>Application-layer view models</h3>
<div class="paragraph">
<p>Domain entities (whether locally persisted or managed externally) are the bread-and-butter of Apache Causeway applications: the focus after all, should be on the business domain concepts and ensuring that they are solid.
Generally those domain entities will make sense to the business domain experts: they form the <em>ubiquitous language</em> of the domain.
These domain entities are part of the domain layer.</p>
</div>
<div class="paragraph">
<p>When developing an Apache Causeway application you will most likely start off with the persistent domain entities: <code>Customer</code>, <code>Order</code>, <code>Product</code>, and so on.
For some applications this may well suffice.</p>
</div>
<div class="paragraph">
<p>That said, it may not always be practical to expect end-users of the application to interact solely with those domain entities.
If the application needs to integrate with other systems, or if the application needs to support reasonably complex business processes, then you may need to look beyond just domain entities; view models are the tool of choice.</p>
</div>
<div class="paragraph">
<p>One such use case for view models is to help co-ordinate complex business processes; for example to perform a quarterly invoicing run, or to upload annual interest rates from an Excel spreadsheet, or prepare payment batches from incoming invoices, to be uploaded to an external payment system.
In these cases the view model managing the business process might have some state of its own, but in most cases that state does not need to be persisted between user sessions.
Many of the actions will be queries but in some cases such view model actions might also modify state of underlying domain entities.
Either way, ultimately these actions just delegate down to the domain-layer.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Desire Lines</div>
<div class="paragraph">
<p>One way to think of application view models is that they model the "desire line": the commonly-trod path that end-users must follow to get from point A to point B as quickly as possible.</p>
</div>
<div class="paragraph">
<p>To explain: there are <a href="http://ask.metafilter.com/62599/Where-the-sidewalk-ends">documented</a> <a href="https://sivers.org/walkways">examples</a> <a href="http://www.softpanorama.org/People/Wall/larry_wall_articles_and_interviews.shtml">that</a> architects of university campus will only add in paths some while after the campus buildings are complete: let the pedestrians figure out the routes they want to take.
One name for this idea is "desire lines".</p>
</div>
<div class="paragraph">
<p>What that means is you should add view models <em>after</em> having built up the domain layer, rather than before.
These view models pave that commonly-trod path, automating the steps that the end-user would otherwise have to do by hand.</p>
</div>
<div class="paragraph">
<p>However, you <em>shouldn&#8217;t</em> try to build out a domain layer that could support every conceivable use case before starting to think about view models.
Instead, iterate.
Identify the use case/story/end-user objective that will deliver value to the business.
Build out the minimum domain entities to support that use case.
Then, introduce view models to simplify high-volume end-user interactions with the system (perhaps automating several related use cases together).</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Another common requirement is to show a dashboard of the most significant data in the system to a user, often pulling in and aggregating information from multiple points of the app.
Obtaining this information by hand (by querying the respective services/repositories) would be tedious and slow; far better to have a dashboard do the job for the end user.</p>
</div>
<div class="paragraph">
<p>A dashboard object is a model of the most relevant state to the end-user, in other words it is (quite literally) a view model.
It is not a persisted entity, instead it belongs to the application layer.</p>
</div>
</div>
<div class="sect2">
<h3 id="self-persisting-domain-entities"><a class="anchor" href="#self-persisting-domain-entities"></a>Self-persisting Domain entities</h3>
<div class="paragraph">
<p>Sometimes we may have domain entities whose persistence is <em>not</em> managed by JDO or JPA mechanism, in other words they take responsibility for their own persistence.
Because such entities are responsible for their own state management, they can be implemented as view models.</p>
</div>
<div class="sect3">
<h4 id="externally-managed-entities"><a class="anchor" href="#externally-managed-entities"></a>Externally-managed entities</h4>
<div class="paragraph">
<p>Sometimes the entities that make up your application are persisted not in the local database but reside in some other system, for example accessible only through a SOAP web service.
Logically that data might still be considered a domain entity and we might want to associate behaviour with it, however it cannot be modelled as a domain entity if only because JDO/DataNucleus doesn&#8217;t know about the entity nor how to retrieve or update it.</p>
</div>
<div class="paragraph">
<p>There are a couple of ways around this: we could either replicate the data somehow from the external system into the Causeway-managed database (in which case it is once again just another domain entity), or we could set up a stub/proxy for the externally managed entity.
This proxy would hold the reference to the externally-managed domain entity (eg an external id), as well as the "smarts" to know how to interact with that entity (by making SOAP web service calls etc).</p>
</div>
<div class="paragraph">
<p>The stub/proxy is a type of view model: a view&#8201;&#8212;&#8201;if you like&#8201;&#8212;&#8201;onto the domain entity managed by the external system.</p>
</div>
</div>
<div class="sect3">
<h4 id="internal-entities"><a class="anchor" href="#internal-entities"></a>Internal entities</h4>
<div class="paragraph">
<p>Alternatively, perhaps your application has an entity that is best persisted not in a relational database but instead in a custom datastore, for example a graph database such as neo4j.</p>
</div>
</div>
<div class="sect3">
<h4 id="in-memory-entities"><a class="anchor" href="#in-memory-entities"></a>In-memory entities</h4>
<div class="paragraph">
<p>As a variation on the above, sometimes there are domain objects that are, conceptually at least entities, but whose state is not actually persisted anywhere, merely held in-memory (eg in a hash).</p>
</div>
<div class="paragraph">
<p>A simple example is read-only configuration data that is read from a config file (eg log4j appender definitions) but thereafter is presented in the UI just like any other entity.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dtos"><a class="anchor" href="#dtos"></a>DTOs</h3>
<div class="paragraph">
<p>DTOs (data transfer objects) are simple classes that (according to <a href="https://en.wikipedia.org/wiki/Data_transfer_object">wikipedia</a>) "carry data between processes".</p>
</div>
<div class="paragraph">
<p>If those two processes are parts of the same overall application (the same team builds and deploys both server and client) then there&#8217;s generally no need to define a DTO; just access the entities using Apache Causeway' <a href="../../vro/latest/about.html" class="xref page">RestfulObjects viewer</a>.</p>
</div>
<div class="paragraph">
<p>On the other hand, if the client consuming the DTO is a different application&#8201;&#8212;&#8201;by which we mean developed/deployed by a different (possible third-party) team&#8201;&#8212;&#8201;then the DTOs act as a formal contract between the provider and the consumer.
In such cases, exposing domain entities over <a href="../../vro/latest/about.html" class="xref page">RestfulObjects</a> would be "A Bad Thing"&#8482; because the consumer would in effect have access to implementation details that could then not be easily changed by the producer.
There&#8217;s plenty of discussion on this topic (eg <a href="https://stackoverflow.com/questions/36174516/rest-api-dtos-or-not">here</a> and <a href="https://juristr.com/blog/2012/10/lessions-learned-dont-expose-ef-entities-to-the-client-directly/">here</a>).
Almost all of these recommend exposing only DTOs (which is to say view models), not domain entities, in REST APIs.</p>
</div>
<div class="paragraph">
<p>To support this use case, a view model can be defined such that it can act as a DTO.
This is done by annotating the class using JAXB annotations; this allows the consumer to obtain the DTO in XML format along with a corresponding XSD schema describing the structure of that XML.</p>
</div>
<div class="paragraph">
<p>These DTOs are still usable as "regular" view models; they will render in the <a href="../../vw/latest/about.html" class="xref page">Web UI (Wicket viewer)</a> just like any other.
In fact (as the <a href="#jaxb">programming model</a> section below makes clear), these JAXB-annotated view models are in many regards the most powerful of all the alternative ways of writing view models.</p>
</div>
<div class="paragraph">
<p>It&#8217;s also worth noting that it is also possible to download the XML (or XSD) straight from the UI, useful during development.
The view model simply needs to implement the <a href="../../refguide/latest/applib/index/mixins/dto/Dto.html" class="xref page">Dto</a> marker interface; the framework has <a href="../../refguide/latest/applib-classes/mixees-and-mixins.html#Dto" class="xref page">mixins</a> that contribute the download actions to the view model.</p>
</div>
</div>
<div class="sect2">
<h3 id="for-rest-clients"><a class="anchor" href="#for-rest-clients"></a>For REST Clients</h3>
<div class="paragraph">
<p>The <a href="../../vro/latest/about.html" class="xref page">Restful Objects</a> viewer automatically provides a REST API for both domain entities.
Or, you can use it to only expose view models, taking care to map the state of the domain entity/ies into a view model.
The question to consider is whether the REST API is a public API or an internal private API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If it&#8217;s a public API, which is to say that there are third-party clients out over which you have no control, then view models are the way to go.</p>
<div class="paragraph">
<p>In this case view models provide an isolation layer which allow you to modify the structure of the underlying domain entities without breaking this API.</p>
</div>
</li>
<li>
<p>If it&#8217;s a private API, which is to say that the only clients of the REST API are under your control, then view models are an unnecessary overhead.</p>
<div class="paragraph">
<p>In this case, just expose domain entities directly.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The caveat to the "private API" option is that private APIs have a habit of becoming public APIs.
Even if the REST API is only exposed within your organisation&#8217;s intranet, other teams may "discover" your REST API and start writing applications that consume it.
If that REST API is exposing domain entities, you could easily break those other teams' clients if you refactor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="https://projects.spring.io/spring-data-rest/">Spring Data REST</a> subproject has a similar capability of being able to expose domain entities as REST resources.
This <a href="https://stackoverflow.com/questions/38874746/is-it-problematic-that-spring-data-rest-exposes-entities-via-rest-resources-with">SO question</a>, which debates the pros-and-cons, is also worth a read.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If your REST API is intended to be public (or you can&#8217;t be sure that it will remain private), then exposing view models will entail a lot of marshalling of state from domain entities into view models.
There are numerous open source tools that can help with that, for example <a href="http://modelmapper.org/">Model Mapper</a>, <a href="http://dozer.sourceforge.net/">Dozer</a> and <a href="https://github.com/orika-mapper/orika">Orika</a>.</p>
</div>
<div class="paragraph">
<p>Or, rather than marshalling state, the view model could hold a reference to the underlying domain entity/ies and dynamically read from it (ie, all the view model&#8217;s properties are derived from the entity&#8217;s).</p>
</div>
<div class="paragraph">
<p>A third option is to define an RDBMS view, and then map a "non-durable" entity to that view.
The RDBMS view then becomes the public API that must be preserved.
ORMs such as DataNucleus <a href="http://www.datanucleus.org:15080/products/accessplatform_5_1/jdo/mapping.html#schema_rdbms_views">support this</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="programming-model"><a class="anchor" href="#programming-model"></a>Programming Model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>View models are generally considered to reside in the application layer, and&#8201;&#8212;&#8201;unlike <a href="domain-entities.html" class="xref page">domain entities</a>&#8201;&#8212;&#8201;their state is <em>not</em> persisted to a database.
Instead, it is serialized into its identifier (in effect, its URL).
The framework unpacks this URL to infer/recreate the view model&#8217;s state with each interaction.</p>
</div>
<div class="paragraph">
<p>View models are typically annotated with <a href="../../refguide/latest/applib/index/annotation/DomainObject.html" class="xref page">@DomainObject(nature=VIEW_MODEL)</a>.</p>
</div>
<div class="paragraph">
<p>The framework provides four different ways to implement a view model:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotating the class using JAXB annotations; this allows the state of the object&#8217;s properties and also its collections.</p>
<div class="paragraph">
<p>The serialized form of these view models is therefore XML, which also enables these view models to act as DTO (useful for various integration scenarios).</p>
</div>
</li>
<li>
<p>Using Apache Causeway specific annotations.</p>
<div class="paragraph">
<p>This is more concise, but less powerful: only the state of the object&#8217;s properties is serialized&#8201;&#8212;&#8201;collections are ignored&#8201;&#8212;&#8201;and not every datatype is recognized.</p>
</div>
<div class="paragraph">
<p>On the other hand, they are more likely to perform better.</p>
</div>
</li>
<li>
<p>Implementing the <a href="../../refguide/latest/applib/index/ViewModel.html" class="xref page">ViewModel</a> interface.</p>
<div class="paragraph">
<p>With this option you take full control of the marshalling and unmarshalling of the object&#8217;s state to/from a string.</p>
</div>
</li>
<li>
<p>Implementing <code>java.io.Serializable</code>.</p>
<div class="paragraph">
<p>View models implemented this way cannot reference entities, either as properties or collections, and indeed must make sure that every other object referenced is also <code>Serializable</code>.</p>
</div>
<div class="paragraph">
<p>Domain services can be injected, but must be annotated declared with the <code>transient</code> keyword.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If a view model class employs several of these options, then there is a precedence:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>explicitly implemented interfaces take precedence:</p>
<div class="paragraph">
<p><code>ViewModel</code> interface over <code>Serializable</code></p>
</div>
</li>
<li>
<p>JAXB-annotated classes are next</p>
</li>
<li>
<p>Causeway-annotated classes are the fallback.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these options are discussed in more detail in the sections below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jaxb"><a class="anchor" href="#jaxb"></a>JAXB View Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most powerful way to implement a view model (at the expense of some boilerplate) is to use JAXB view models.
These can serialize both properties (value types and references to entities) and collections (references to entities).</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a typical example of a JAXB view model, to allow (certain properties of) two <code>Customer</code>s to be compared:</p>
</div>
<div class="listingblock">
<div class="title">CompareCustomers.java, using JAXB</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "compareCustomers")          <i class="conum" data-value="1"></i><b>(1)</b>
@XmlType(
        propOrder = {                               <i class="conum" data-value="2"></i><b>(2)</b>
            "customer1",
            "customer2"
        }
)
@XmlAccessorType(XmlAccessType.FIELD)               <i class="conum" data-value="3"></i><b>(3)</b>
public class CompareCustomers {

    @XmlElement(required = true)                    <i class="conum" data-value="4"></i><b>(4)</b>
    @Getter @Setter
    Customer customer1;

    @XmlElement(required = true)                    <i class="conum" data-value="5"></i><b>(5)</b>
    @Getter @Setter
    Customer customer2;

    @XmlTransient                                   <i class="conum" data-value="6"></i><b>(6)</b>
    public String getCustomer1Name() {
        return getCustomer1().getName();
    }

    @XmlTransient                                   <i class="conum" data-value="7"></i><b>(7)</b>
    public String getCustomer2Name() {
        return getCustomer2().getName();
    }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The JAXB <a href="../../refguide/latest/applib-ant/XmlRootElement.html" class="xref page">@XmlRootElement</a> annotation indicates this is a view model to Apache Causeway, which then uses JAXB to serialize the state of the view model between interactions</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionally, the properties of the view model can be listed using the <code>XmlType#propOrder</code> attribute.<br>
This is an all-or-nothing affair: either all properties must be listed, or else the annotation omitted.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Specifying field accessor type allows the Lombok <code>@Getter</code> and <code>@Setter</code> annotations to be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>@XmlElement</code> indicates the property is part of the view model&#8217;s state.
For collections, the <code>@XmlElementWrapper</code> would also typically be used.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>@XmlTransient</code> indicates that the property is derived and should be ignored by JAXB.<br>
The derived properties could also have been implemented using <a href="mixins.html" class="xref page">mixins</a>.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="referencing-domain-entities"><a class="anchor" href="#referencing-domain-entities"></a>Referencing Domain Entities</h3>
<div class="paragraph">
<p>It&#8217;s quite common for view models to be "backed by" (be projections of) some underlying domain entity.
For example, the <code>CompareCustomers</code> view model described <a href="#jaxb">above</a> actually references two underlying <code>Customer</code> entities.</p>
</div>
<div class="paragraph">
<p>It wouldn&#8217;t make sense to serialize out the state of a persistent entity.
However, the identity of the underlying entity is well defined; Apache Causeway defines the <a href="../../refguide/latest/schema/common.html" class="xref page">common schema</a> which defines the <code>&lt;oid-dto&gt;</code> element (and corresponding <code>OidDto</code> class): the object&#8217;s type and its identifier.
This is basically a formal XML equivalent to the <code>Bookmark</code> object obtained from the <a href="../../refguide/latest/applib/index/services/bookmark/BookmarkService.html" class="xref page">BookmarkService</a>.</p>
</div>
<div class="paragraph">
<p>There is only one requirement to make this work: every referenced domain entity must be annotated with <a href="../../refguide/latest/applib-ant/XmlJavaTypeAdapter.html" class="xref page">@XmlJavaTypeAdapter</a>, specifying the framework-provided <code>PersistentEntityAdapter</code>.
And this class is similar to the <a href="../../refguide/latest/applib/index/services/bookmark/BookmarkService.html" class="xref page">BookmarkService</a>: it knows how to create an <code>OidDto</code> from an object reference.</p>
</div>
<div class="paragraph">
<p>Thus, in our view model we can legitimately write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CompareCustomers {

    @XmlElement(required = true)
    @Getter @Setter
    Customer customer1;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>All we need to do is remember to add that <code>@XmlJavaTypeAdapter</code> annotation to the referenced entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlJavaTypeAdapter(PersistentEntityAdapter.class)
public class Customer ...  {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible for a DTO view models to hold collections of objects.
These can be of any type, either simple properties, or references to other objects.
The only bit of boilerplate that is required is the <code>@XmlElementWrapper</code> annotation.
This instructs JAXB to create an XML element (based on the field name) to contain each of the elements.
(If this is omitted then the contents of the collection are at the same level as the properties; almost certainly not what is required).</p>
</div>
<div class="paragraph">
<p>For example, we could perhaps generalize the view model to hold a set of <code>Customer</code>s to be compared:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class CompareCustomers {
    ...
    @XmlElementWrapper
    @XmlElement(name = "customers")
    @Getter @Setter
    protected List&lt;Customer&gt; customersToCompare = Lists.newArrayList();
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="joda-datatypes"><a class="anchor" href="#joda-datatypes"></a>JODA Time Datatypes</h3>
<div class="paragraph">
<p>If your JAXB view model contains fields using the JODA datatypes (<code>LocalDate</code> and so on), then <code>@XmlJavaTypeAdapter</code> additional annotations in order to "teach" JAXB how to serialize out the state.</p>
</div>
<div class="paragraph">
<p>The Apache Causeway applib provides a number of adapters to use out-of-the-box.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "categorizeIncomingInvoice")
@XmlType(
        propOrder = {
                ...
                "dateReceived",
                ...
        }
)
@XmlAccessorType(XmlAccessType.FIELD)
public class IncomingInvoiceViewModel extends IncomingOrderAndInvoiceViewModel {

    @XmlJavaTypeAdapter(JodaLocalDateStringAdapter.ForJaxb.class)
    private LocalDate dateReceived;

    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The full list of adapter classes are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. JAXB adapters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">JODA datatype</th>
<th class="tableblock halign-left valign-top">Adapter</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>org.joda.time.DateTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaDateTimeStringAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaDateTimeXMLGregorianCalendarAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>org.joda.time.LocalDate</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalDateStringAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalDateXMLGregorianCalendarAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>org.joda.time.LocalDateTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalDateTimeStringAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalDateTimeXMLGregorianCalendarAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><div class="content"><div class="paragraph">
<p><code>org.joda.time.LocalTime</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalTimeStringAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JodaLocalTimeXMLGregorianCalendarAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>java.sql.Timestamp</code></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>JavaSqlTimestampXmlGregorianCalendarAdapter.ForJaxb</code></p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you want use other Joda data types, check out <a href="http://blog.bdoughan.com/2011/05/jaxb-and-joda-time-dates-and-times.html">this blog post</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="non-jaxb"><a class="anchor" href="#non-jaxb"></a>Non-JAXB View Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Instead of using JAXB to specify a view model, it is also possible to simply rely on the fact that the view model is annotated with <a href="../../refguide/latest/applib/index/annotation/DomainObject.html#nature" class="xref page">@DomainObject</a><a href="../../refguide/latest/applib/index/annotation/Nature.html#VIEW_MODEL" class="xref page">(nature=VIEW_MODEL)</a>.</p>
</div>
<div class="paragraph">
<p>With this approach the state of properties&#8201;&#8212;&#8201;but not collections&#8201;&#8212;&#8201;is serialized.
So this approach is not as powerful as using the JAXB-style of view models, on the other hand it takes little effort.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">CompareCustomers.java, using @DomainObject(nature = VIEW_MODEL)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainObject(nature = Nature.VIEW_MODEL)           <i class="conum" data-value="1"></i><b>(1)</b>
public class CompareCustomers {

    @Property                                       <i class="conum" data-value="2"></i><b>(2)</b>
    @Getter @Setter
    Customer customer1;

    @Property                                       <i class="conum" data-value="2"></i><b>(2)</b>
    @Getter @Setter
    Customer customer2;

    public String getCustomer1Name() {
        return getCustomer1().getName();
    }

    public String getCustomer2Name() {
        return getCustomer2().getName();
    }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>declares the domain object as a view model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>fields must be annotated with <code>@Property</code> so that they are part of the metamodel.
<div class="paragraph">
<p>Note that they do <em>not</em> need to be visible, however.</p>
</div></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Of all the alternative ways to implement a view model, this is probably the simplest.
However, it also has the most limitations.
As noted above, it can only capture the values of properties, not collections.
Moreover, those property types must be built-in value types or to entities.
It is <strong><em>not</em></strong> possible though to reference another view model instance.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="view-model-interface"><a class="anchor" href="#view-model-interface"></a><code>ViewModel</code> interface</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most flexible approach to implement a view model is to implement the <a href="../../refguide/latest/applib/index/ViewModel.html" class="xref page">ViewModel</a> interface.</p>
</div>
<div class="paragraph">
<p>This defines a single method, <code>viewModelMemento()</code>, which returns a String representation of the object&#8217;s state.
Or, it could return be a handle to its state if the state is actually stored elsewhere, eg in an external database.</p>
</div>
<div class="paragraph">
<p>The corollary is that the view model must also define a constructor whose first parameter is a <code>String</code>.
This constructor can optionally take additional injected services, which the view model can use to initialize itself (eg look up from the external database, if required).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">CompareCustomers.java, using ViewModel interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainObject
public class CompareCustomers implements ViewModel {    <i class="conum" data-value="1"></i><b>(1)</b>

    public CompareCustomers(
            String memento,                                                 <i class="conum" data-value="2"></i><b>(2)</b>
            CustomerRepository customerRepository                           <i class="conum" data-value="3"></i><b>(3)</b>
    ) {
        customer1 = customerRepository.findByRef(memento.split(":")[0]);    <i class="conum" data-value="4"></i><b>(4)</b>
        customer2 = customerRepository.findByRef(memento.split(":")[1]);    <i class="conum" data-value="3"></i><b>(3)</b>
    }

    public String viewModelMemento() {
        return getCustomer1().getRef() + ":" + getCustomer2().getRef();     <i class="conum" data-value="5"></i><b>(5)</b>
    }

    @Getter @Setter
    Customer customer1;

    @Getter @Setter
    Customer customer2;

    public String getCustomer1Name() {
        return getCustomer1().getName();
    }

    public String getCustomer2Name() {
        return getCustomer2().getName();
    }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>View model&#8217;s state as originally returned by <code>viewModelMemento()</code> (below); mandatory</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Injected domain services; optional</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Unpacks the memento and uses it to restore state</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Encodes the current state into a string</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serializable"><a class="anchor" href="#serializable"></a>Serializable View Models</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A further another option for view models is for the class to implement <code>java.io.Serializable</code>.
This is a lower-level abstraction: you must take care that all fields referenced by the view model are serializable.
Most of the value types are indeed serializable (including date/time classes), but for reference types, you will need to store the reference as a <a href="../../refguide/latest/applib/index/services/bookmark/Bookmark.html" class="xref page">bookmark</a>.
You can still inject services, but the fields these must be <code>transient</code> (that is, using the Java keyword).</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">CompareCustomers.java, implementing Serializable interface</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainObject
public class CompareCustomers implements java.io.Serializable {     <i class="conum" data-value="1"></i><b>(1)</b>

    @Inject transient BookmarkService bookmarkService;              <i class="conum" data-value="2"></i><b>(2)</b>

    Bookmark customer1Bookmark;
    Bookmark customer2Bookmark;

    public Customer getCustomer1{} {
        return bookmarkService.lookup(customer1Bookmark, Customer.class).orElse(null);
    }

    public Customer getCustomer2{} {
        return bookmarkService.lookup(customer1Bookmark, Customer.class).orElse(null);
    }

    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>View model class implements <code>java.io.Serializable</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Injected domain services must be <code>transient</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serializable"><a class="anchor" href="#serializable"></a>UrlEncodingService</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When implementing view models, you must be aware that all the state will ultimately converted into a URL-safe form (by way of the <a href="../../refguide/latest/applib/index/services/urlencoding/UrlEncodingService.html" class="xref page">UrlEncodingService</a>).</p>
</div>
<div class="paragraph">
<p>There are limits to the lengths of URLs, however.
If the URL does exceed limits or contains invalid characters, then provide a custom implementation of <a href="../../refguide/latest/applib/index/services/urlencoding/UrlEncodingService.html" class="xref page">UrlEncodingService</a> to handle the memento string in some other fashion (eg substituting it with a GUID, with the memento cached somehow on the server).</p>
</div>
<div class="paragraph">
<p>Another reason to provide your own implementation is security: perhaps to encrypt the serialization of the content with a key specific to the currently logged in user.
This would prevent your end-users from sharing view model URLs, potentially leaking information.</p>
</div>
<div class="paragraph">
<p>A custom implementation might also encode a time period within which the URL can be used before becoming invalid.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright  2010~2023 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Causeway, and the Apache Causeway project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-RC3.20231128-0222-5bc06e96</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'causeway-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
