<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>View Model Instantiation :: Apache Causeway</title>
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../../../_/css/site.css">
    <link rel="stylesheet" href="../../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../../../.." title="Apache Causeway">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">
          <span class="icon">
            <img src="../../../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item hide-for-print">
          <span>
            <input id="algolia-search-input" placeholder="Search"></span>
          </span>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../../docs//starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../../docs//starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../../../docs//demo/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../../docs//resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../../docs//resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../../userguide//about.html">User Guide</a>
            <a class="navbar-item" href="../../../../refguide//about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../../testing//about.html">Testing Guide</a>
            <a class="navbar-item" href="../../../../security//about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../../setupguide//about.html">Setup Guide</a>
            <a class="navbar-item" href="../../../../conguide//about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../../vw//about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../../../vro//about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../../pjpa//about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../../../pjdo//about.html">JDO (DataNucleus)</a>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../../security//bypass/about.html">Bypass (Authenticator & Authorizor)</a>
            <a class="navbar-item" href="../../../../security//shiro/about.html">Shiro (Authenticator & Authorizor)</a>
            <a class="navbar-item" href="../../../../security//spring/about.html">Spring (Authenticator only)</a>
            <a class="navbar-item" href="../../../../security//keycloak/about.html">Keycloak (Authenticator only)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Catalogs</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">For Use in Apps</span>
            <a class="navbar-item" href="../../../../valuetypes//about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extending the framework itself</span>
            <a class="navbar-item" href="../../../../extensions//about.html">Extensions</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../../docs//support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../../docs//support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../../docs//downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../../relnotes//about.html">Release Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Nightly Builds</span>
            <a class="navbar-item" href="https://github.com/apache/isis">Packages (ASF hosted)</a>
            <a class="navbar-item" href="https://github.com/apache-isis-committers/isis-nightly">Packages (not ASF hosted)</a>
            <a class="navbar-item" href="https://apache-isis-committers.github.io/isis-nightly">Website Preview (not ASF hosted)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../../../comguide//about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../../tooling//about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_isis">SonarCloud.io</a>
            <a class="navbar-item" href="https://fisheye.apache.org/browse/~br=master/isis-git/">ASF Fisheye</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../../core//about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../../../regressiontests//about.html">Regression Tests</a>
            <a class="navbar-item" href="../../../../incubator//about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../../../more-thanks//more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../../docs//about.html">
          <span class="icon">
            <img src="../../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="userguide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-pagination">
  <a class="page-previous disabled" rel="prev" href="" title=""><span></span></a>
  <a class="page-next disabled" rel="next"
     href="" title=""><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title=""><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../about.html">User Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../fun/about.html">Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/concepts-patterns.html">Concepts &amp; Patterns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/domain-entities-and-services.html">Domain Entities &amp; Services</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/object-members.html">Properties, Collections &amp; Actions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/ui.html">UI Layout &amp; Hints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/business-rules.html">Business Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/drop-downs-and-defaults.html">Drop downs and Defaults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/meta-annotations.html">Meta-annotations</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/view-models.html">View Models</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/mixins.html">Mixins</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/modules.html">Modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../about.html">Beyond the Basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../i18n.html">i18n</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../headless-access.html">Headless Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hints-and-tips.html">Hints-n-Tips</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../programming-model.html">Programming Model</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../commandlog/about.html">Command Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../excel/about.html">Excel Library</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../executionlog/about.html">Execution Log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../executionoutbox/about.html">Execution Outbox</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../executionrepublisher/about.html">Execution Republisher</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../flyway/about.html">Flyway</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">User Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tooling</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../tooling/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../tutorials/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../about.html">User Guide</a></li>
    <li><a href="view-model-instantiation.html">View Model Instantiation</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/master/antora/components/userguide/modules/btb/pages/hints-and-tips/view-model-instantiation.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">View Model Instantiation</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../../../../refguide/latest/applib/index/services/factory/FactoryService.html" class="xref page">FactoryService</a> service
covers all use-cases for programmatic view model creation and takes care,
that all injection points are resolved for the resulting view model instance.</p>
</div>
<div class="listingblock">
<div class="title">Simple Case (using the public no-arg constructor)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerViewModel viewModel = factoryService.viewModel(CustomerViewModel.class);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Advanced Case (using a custom constructor)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerViewModel viewModel = factoryService.viewModel(new CustomerViewModel("Joe", "Bloggs"));</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="todo-outdated-docs-likely-to-just-be-removed"><a class="anchor" href="#todo-outdated-docs-likely-to-just-be-removed"></a>TODO outdated docs (likely to just be removed) &#8230;&#8203;</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO - v2 - don&#8217;t know if this is still valid or not.
If it is, then we should probably remove FactoryService#create(&#8230;&#8203;) for view models completely.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With view models, some care must be taken in how they are instantiated.
Specifically, it&#8217;s important that the framework doesn&#8217;t "know" about the view model until its state is "sufficiently" populated to distinguish from other view models.</p>
</div>
<div class="paragraph">
<p>In practical terms, this means that view models should be instantiated using a constructor, and then injecting services (if required) using the <a href="../../../../refguide/latest/applib/index/services/registry/ServiceRegistry.html" class="xref page">ServiceRegistry</a> service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">CustomerViewModel viewModel = new CustomerViewModel("Joe", "Bloggs");
serviceInjector.injectServicesInto(viewModel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>What will most likely <strong>fail</strong> is to use the <a href="../../../../refguide/latest/applib/index/services/factory/FactoryService.html" class="xref page">FactoryService</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// DON'T DO THIS WITH VIEW MODELS
CustomerViewModel viewModel = factoryService.instantiate(CustomerViewModel.class);

viewModel.setFirstName("Joe");
viewModel.setLastName("Bloggs");
serviceInjector.injectServicesInto(viewModel);</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s because the internal "OID" identifier that the framework creates to handle this view model will be incomplete.
Although the framework can handle changes to the OID (when the corresponding view model&#8217;s state changes) once created, this isn&#8217;t the case during initial instantiation process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="example"><a class="anchor" href="#example"></a>Example</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To explain further, here&#8217;s an implementation using <code>FactoryService</code> that fails:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { /* ... */ } )
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {                                                  <i class="conum" data-value="1"></i><b>(1)</b>
    ...
    @XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

        OfficeOptionViewModel office1 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
            factoryService.viewModel(OfficeOptionViewModel.class);
        office1.setOffice("Amsterdam");                                     <i class="conum" data-value="3"></i><b>(3)</b>
        office1.setAmount(200);
        amountsPerOffice.add(office1);

        OfficeOptionViewModel office2 =                                     <i class="conum" data-value="2"></i><b>(2)</b>
            factoryService.viewModel(OfficeOptionViewModel.class);
        office2.setOffice("London");                                        <i class="conum" data-value="3"></i><b>(3)</b>
        office2.setAmount(100);
        amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Parent view model</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Using <code>FactoryService</code>, incorrectly.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Hard-coded just for demo purposes</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This collection, is, confusing, rendered as:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/hints-and-tips/view-model-fail.png" alt="view model fail" width="800px">
</div>
</div>
<div class="paragraph">
<p>Even though the <code>amountsPerOffice</code> collection of view models is correctly populated, the framework/viewer maps these to their corresponding OIDs before they are rendered.
Because the "Amsterdam" pojo and "London" pojo each mapped to the same OID, when fetching out the results the viewer obtains the London pojo both times.</p>
</div>
<div class="paragraph">
<p>The following implementation, on the other hand, succeeds:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { /* ... */ } )
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {
    ...
    @XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; getAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

		OfficeOptionViewModel office1 = new OfficeOptionViewModel("Amsterdam", 200);    <i class="conum" data-value="1"></i><b>(1)</b>
		serviceInjector.injectServicesInto(office1);
		amountsPerOffice.add(office1);

		OfficeOptionViewModel office2 = new OfficeOptionViewModel("London", 100);       <i class="conum" data-value="1"></i><b>(1)</b>
		serviceInjector.injectServicesInto(office2);
		amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Just instantiate with constructor.
The framework "sees" the domain object when services are injected into it.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As can be seen, this renders just fine:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../_images/hints-and-tips/view-model-success.png" alt="view model success" width="800px">
</div>
</div>
<div class="paragraph">
<p>To complicate matters a little, note though that following "incorrect" implementation using <code>FactoryService</code> does also work correctly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@XmlRootElement(name = "yearSummary")
@XmlType( propOrder = { ..., "amountsPerOffice" } )                     <i class="conum" data-value="1"></i><b>(1)</b>
@XmlAccessorType(XmlAccessType.FIELD)
public class YearSummary {
	...

    void init() {
        amountsPerOffice = calculateAmountsPerOffice();
    }

    @XmlElementWrapper
    @XmlElement(name = "officeOption")
    @CollectionLayout(defaultView = "table")
    @Getter @Setter
    private List&lt;OfficeOptionViewModel&gt; amountsPerOffice = Lists.newArrayList();

	@XmlTransient
    @CollectionLayout(defaultView = "table")
    public List&lt;OfficeOptionViewModel&gt; calculateAmountsPerOffice() {
        List&lt;OfficeOptionViewModel&gt; amountsPerOffice = new ArrayList&lt;&gt;();

		OfficeOptionViewModel office1 = factoryService.viewModel(OfficeOptionViewModel.class);
		office1.setOffice("Amsterdam");
		office1.setAmount(200);

		amountsPerOffice.add(office1);

		OfficeOptionViewModel office2 = factoryService.viewModel(OfficeOptionViewModel.class);
		office2.setOffice("London");
		office2.setAmount(100);

		amountsPerOffice.add(office2);

        return amountsPerOffice;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>"amountsPerOffice" is part of the state of the parent view model</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the <code>amountsPerOffice</code> collection is part of the state of the parent view model and so in this particular case everything works with either <code>FactoryService#create(&#8230;&#8203;)</code> or using <code>ServiceRegistry</code>.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2021 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M9.20221111-0339-10c1a26c</p>
        </div>
    </div>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
<script src="../../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'isis-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
