<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Overview :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../_/css/site.css">
    <link rel="stylesheet" href="../_/css/site-custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="..">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../helloworld/about.html">Hello World</a>
            <a class="navbar-item" href="../simpleapp/about.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../demoapp/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">User Guide</span>
            <a class="navbar-item" href="../userguide/about.html">Fundamentals &amp; Beyond</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Reference</span>
            <a class="navbar-item" href="../refguide/about.html">Reference Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../security/about.html">Security Guide</a>
            <a class="navbar-item" href="../ext-secman/about.html">SecMan (extension)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Testing</span>
            <a class="navbar-item" href="../testing/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../vw/about.html">Wicket UI</a>
            <a class="navbar-item" href="../vro/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../odn/about.html">DataNucleus Object Store</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../extensions/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../toc/devguide/about.html">Developers' Guide</a>
            <a class="navbar-item" href="../toc/mavendeps/about.html">Maven dependencies</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Mailing Lists</span>
            <a class="navbar-item" href="../toc/mailing-list/how-to-subscribe.html">How to subscribe</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">ASF JIRA</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../toc/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../relnotes/about.html">Release Notes</a>
            <a class="navbar-item" href="../mignotes/about.html">Migration Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Internal</span>
            <a class="navbar-item" href="../toc/comguide/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../core/about.html">Core Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">@ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../toc/about.html">
          <span class="icon">
            <img src="../_/img/isis-logo-48x48.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="overview.html">Overview</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="unit-test-support/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="integ-test-support/about.html">Integ Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="specsupport/about.html">BDD Spec Support (extension)</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="fixtures/about.html">Fixture Scripts (extension)</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Core Framework</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../core/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../extensions/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../incubator/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../legacy/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../refguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Starter Apps</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../starters/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorial App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../userguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">Testing Guide</a></li>
    <li><a href="overview.html">Overview</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/antora/components/testing/modules/ROOT/pages/overview.adoc">Edit this Page</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Overview</h1>
<div class="sect1">
<h2 id="unit-tests-vs-integ-tests"><a class="anchor" href="#unit-tests-vs-integ-tests"></a>Unit tests vs Integ tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We divide automated tests into two broad categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unit tests exercise a single unit (usually a method) of a domain object, in isolation. <br></p>
<div class="paragraph">
<p>Dependencies of that object are mocked out.  These are written by a developer and for a developer; they are to ensure that a particular "cog in the machine" works correctly</p>
</div>
</li>
<li>
<p>integration tests exercise the application as a whole, usually focusing on one particular business operation (action). <br></p>
<div class="paragraph">
<p>These are tests that represent the acceptance criteria of some business story; their intent should make sense to the domain expert (even if the domain expert is "non-technical")</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>To put it another way:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Integration tests help ensure that you are <strong><em>building the right system</em></strong></p>
</div>
<div class="paragraph">
<p>Unit tests help ensure that you are <strong><em>building the system right</em></strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integ-tests-vs-bdd-specs"><a class="anchor" href="#integ-tests-vs-bdd-specs"></a>Integ tests vs BDD Specs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We further sub-divide integration tests into:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>those that are implemented in Java and JUnit (we call these simply <em>"integration tests"</em>)<br></p>
<div class="paragraph">
<p>Even if a domain expert understands the intent of these tests, the actual implementation will be opaque to them.  Also, the only output from the tests is a (hopefully) green CI job</p>
</div>
</li>
<li>
<p>tests (or rather, specifications) that are implemented in a <em>behaviour-driven design</em> (BDD) language such as <a href="https://cucumber.io/">Cucumber</a> (we call these <em>"BDD specs"</em>)<br></p>
<div class="paragraph">
<p>The natural language specification then maps down onto some glue code that is used to drive the application.  But the benefits of taking a BDD approach include the fact that your domain expert will be able to read the tests/specifications, and that when you run the specs, you also get documentation of the application&#8217;s behaviour ("living documentation").</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>It&#8217;s up to you whether you use BDD specs for your apps; it will depend on your development process and company culture.  But if you don&#8217;t then you certainly should write integration tests: acceptance criteria for user stories should be automated!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simulated-ui-wrapperfactory"><a class="anchor" href="#simulated-ui-wrapperfactory"></a>Simulated UI (<code>WrapperFactory</code>)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When we talk about integration tests/specs here, we mean tests that exercise the domain object logic, through to the actual database.  But we also want the tests to exercise the app from the users&#8217;s perspective, which means including the user interface.</p>
</div>
<div class="paragraph">
<p>For most other frameworks that would require having to test the application in a very heavy weight/fragile fashion using a tool such as <a href="http://docs.seleniumhq.org/">Selenium</a>, driving a web browser to navigate .  In this regard though, Apache Isis has a significant trick up its sleeve.  Because Apache Isis implements the naked objects pattern, it means that the UI is generated automatically from declared domain-objects, -views and -services. This therefore allows for other implementations of the UI.</p>
</div>
<div class="paragraph">
<p>The <a href="../refguide/applib-svc/application-layer-api/WrapperFactory.html" class="page"><code>WrapperFactory</code></a> domain service allows a test to wrap domain objects and thus to interact with said objects "as if" through the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/integ-tests.png"><img src="_images/integ-tests.png" alt="integ tests" width="700px"></a>
</div>
</div>
<div class="paragraph">
<p>If the test invokes an action that is disabled, then the wrapper will throw an appropriate exception.  If the action is ok to invoke, it delegates through.</p>
</div>
<div class="paragraph">
<p>What this means is that an Apache Isis application can be tested end-to-end without having to deploy it onto a webserver; the whole app can be tested while running in-memory.  Although integration tests re (necessarily) slower than unit tests, they are not any harder to write (in fact, in some respects they are easier).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependency-injection"><a class="anchor" href="#dependency-injection"></a>Dependency Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Isis provides autowiring dependency injection into every domain object.  This is most useful when writing unit tests; simply mock out the service and inject into the domain object.</p>
</div>
<div class="paragraph">
<p>There are a number of syntaxes supported, but the simplest is to use <code>@javax.inject.Inject</code> annotation; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@javax.inject.Inject
CustomerRepository customers;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Isis can inject into this even if the field has package-level (or even <code>private</code>) visibility.  We recommend that you use package-level visibility, though, so that your unit tests (in the same package as the class under test) are able to inject mocks.</p>
</div>
<div class="paragraph">
<p>Isis does also support a couple of other syntaxes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void setCustomerRepository(CustomerRepository customers) { /* ... */ }</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public void injectCustomerRepository(CustomerRepository customers) { /* ... */ }</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Apache Isis also supports automatic dependency injection into integration tests; just declare the service dependency in the usual fashion and it will be automatically injected.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="givenwhenthen"><a class="anchor" href="#givenwhenthen"></a>Given/When/Then</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Whatever type of test/spec you are writing, we recommend you follow the given/when/then idiom:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>given</strong> the system is in this state (preconditions)</p>
</li>
<li>
<p><strong>when</strong> I poke it with a stick</p>
</li>
<li>
<p><strong>then</strong> it looks like this (postconditions)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A good test should be 5 to 10 lines long; the test should be there to help you reason about the behaviour of the system.  Certainly if the test becomes more than 20 lines it&#8217;ll be too difficult to understand.</p>
</div>
<div class="paragraph">
<p>The "when" part is usually a one-liner, and in the "then" part there will often be only two or three assertions that you want to make that the system has changed as it should.</p>
</div>
<div class="paragraph">
<p>For unit test the "given" part shouldn&#8217;t be too difficult either: just instantiate the class under test, wire in the appropriate mocks and set up the expectations.  And if there are too many mock expectations to set up, then "listen to the tests" &#8230;&#8203; they are telling you your design needs some work.</p>
</div>
<div class="paragraph">
<p>Where things get difficult though is the "given" for integration tests; which is the topic of the next section&#8230;&#8203;</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fixture-management"><a class="anchor" href="#fixture-management"></a>Fixture Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous section we discussed using given/when/then as a form of organizing tests, and why you should keep your tests small.</p>
</div>
<div class="paragraph">
<p>For integration tests though it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system.  Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p>
</div>
<div class="paragraph">
<p>The solution that Apache Isis provides is a domain service called <a href="../refguide/applib-cm/classes/super.html#FixtureScripts" class="page">Fixture Scripts</a>, that defines a pattern and supporting classes to help ensure that the "data setup" for your tests are reusable and maintainable over time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="fake-data"><a class="anchor" href="#fake-data"></a>Fake data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In any given test there are often quite a few variables involved, to initialize the state of the objects, or to act as arguments for invoking a method, or when asserting on post-conditions.  Sometimes those values are important (eg verifying that an `Order&#8217;s state went from PENDING to SHIPPED, say), but often they aren&#8217;t (a customer&#8217;s name, for example) but nevertheless need to be set up (especially in integration tests).</p>
</div>
<div class="paragraph">
<p>We want our tests to be easily understood, and we want the reader&#8217;s eye to be drawn to the values that are significant and ignore those that are not.</p>
</div>
<div class="paragraph">
<p>One way to do this is to use random (or fake) values for any insignificant data.  This in effect tells the reader that "any value will do".  Moreover, if it turns out that any data won&#8217;t do, and that there&#8217;s some behaviour that is sensitive to the value, then the test will start to flicker, passing and then failing depending on inputs.  This is A Good Thing&#8482;.</p>
</div>
<div class="paragraph">
<p>Apache Isis does not, itself, ship with a fake data library.  However, the (non-ASF) <a href="https://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s fakedata module (non-ASF) does provide exactly this capability.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Using fake data works very well with fixture scripts; the fixture script can invoke the business action with sensible (fake/random) defaults, and only require that the essential information is passed into it by the test.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="feature-toggles"><a class="anchor" href="#feature-toggles"></a>Feature Toggles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writing automated tests is just good development practice.  Also good practice is developing on the mainline (master, trunk); so that your continuous integration system really is integrating all code.  Said another way: <a href="http://martinfowler.com/bliki/FeatureBranch.html">don&#8217;t use branches</a>!</p>
</div>
<div class="paragraph">
<p>Sometimes, though, a feature will take longer to implement than your iteration cycle.  In such a case, how do you use continuous integration to keep everyone working on the mainline without revealing a half-implemented feature on your releases?  One option is to use <a href="http://martinfowler.com/bliki/FeatureToggle.html">feature toggle</a>s.</p>
</div>
<div class="paragraph">
<p>Apache Isis does not, itself, ship with a feature toggle library.  However, the (non-ASF) <a href="https://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a>'s togglz module does provide exactly this capability.</p>
</div>
<div class="paragraph">
<p>With all that said, let&#8217;s look in detail at the testing features provided by Apache Isis.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <h3 class="toc-title">On this page</h3>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2019 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20191207-0402-ebcec83c</p>
        </div>
    </div>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
<script src="../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hideEffect: "slideUp",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
