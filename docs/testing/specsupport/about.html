<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BDD Spec Support :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
          <span class="icon">
            <img src="../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../starters/helloworld/about.html">Hello World</a>
            <a class="navbar-item" href="../../starters/simpleapp/about.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../demoapp/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/about.html">User Guide</a>
            <a class="navbar-item" href="../../refguide/about.html">Reference Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../toc/devguide/about.html">Developers' Guide</a>
            <a class="navbar-item" href="../../testing/about.html">Testing Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Libraries</span>
            <a class="navbar-item" href="../../subdomain/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../valuetypes/about.html">Value Types</a>
            <a class="navbar-item" href="../../mappings/about.html">Bounded Context Mapping Libraries</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../vro/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../odn/about.html">DataNucleus (JDO)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../extensions/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../toc/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../toc/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Releases</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../toc/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/about.html">Release Notes</a>
            <a class="navbar-item" href="../../mignotes/about.html">Migration Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">More Libraries</span>
            <a class="navbar-item" href="../../incubator/about.html">Incubator</a>
            <a class="navbar-item" href="../../legacy/about.html">Legacy</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Internal</span>
            <a class="navbar-item" href="../../toc/comguide/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../core/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../toc/about.html">
          <span class="icon">
            <img src="../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unittestsupport/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../integtestsupport/about.html">Integ Test Support</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="about.html">BDD Spec Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fixtures/about.html">Fixture Scripts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fakedata/about.html">Fakedata</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../h2console/about.html">H2 Console</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hsqldbmgr/about.html">HSQLDB Manager</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mappings Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mappings/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Core Framework</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../core/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Demo App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../extensions/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../incubator/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../pjdo/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../legacy/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../refguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Starter Apps</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../starters/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../subdomains/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../userguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../valuetypes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Testing Guide</a></li>
    <li><a href="about.html">BDD Spec Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/testing/specsupport/adoc/modules/specsupport/pages/about.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">BDD Spec Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behaviour-driven design</a> (BDD) redefines testing not as an after-the-fact "let&#8217;s check the system works", but instead as a means to specify the required behaviour in conjunction with the domain expert.
Once the feature has been implemented, it also provide a means by which the domain expert can verify the feature has been implemented to spec.</p>
</div>
<div class="paragraph">
<p>Since domain experts are usually non-technical (at least, they are unlikely to be able to read or want to learn how to read JUnit/Java code), then applying BDD typically requires writing specifications in using structured English text and (ASCII) tables.
The BDD tooling parses this text and uses it to actually interact with the system under test.
As a byproduct the BDD frameworks generate readable output of some form; this is often an annotated version of the original specification, marked up to indicate which specifications passed, which have failed.
This readable output is a form of "living documentation"; it captures the actual behaviour of the system, and so is guaranteed to be accurate.</p>
</div>
<div class="paragraph">
<p>There are many BDD tools out there; Apache Isis provides an integration with <a href="https://cucumber.io/docs/reference/jvm#java">Cucumber JVM</a> (see also the <a href="https://github.com/cucumber/cucumber-jvm">github site</a>):</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-it-works"><a class="anchor" href="#how-it-works"></a>How it works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At a high level, here&#8217;s how Cucumber works</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifications are written in the <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a> DSL, following the <a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">"given/when/then"</a> format.</p>
</li>
<li>
<p>Cucumber-JVM itself is a JUnit runner, and searches for <a href="https://github.com/cucumber/cucumber/wiki/Feature-Introduction">feature files</a> on the classpath.</p>
</li>
<li>
<p>These in turn are matched to <a href="https://github.com/cucumber/cucumber/wiki/Step-Definitions">step definition</a>s through regular expressions.</p>
<div class="paragraph">
<p>It is the step definitions (also called "glue") that exercise the system.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code that goes in step definitions is broadly the same as the code that goes in an integration test method.
However one benefit of using step definitions (rather than integration tests) is that the step definitions are reusable across scenarios, so there may be less code overall to maintain.</p>
</div>
<div class="paragraph">
<p>For example, if you have a step definition that maps to "given an uncompleted todo item", then this can be used for all the scenarios that start with that as their precondition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-a-bdd-spec"><a class="anchor" href="#writing-a-bdd-spec"></a>Writing a BDD spec</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BDD specifications contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>XxxSpec.feature</code> file, describing the feature and the scenarios (given/when/then)s that constitute its acceptance criteria</p>
</li>
<li>
<p>a <code>RunIntegBddSpecs</code> class file to run the specification (all boilerplate).
This will run all <code>.feature</code> files in the same package or subpackages, but is basically just boilerplate.</p>
</li>
<li>
<p>one or several <code>XxxStepDef</code> classes constituting the step definitions to be matched against.</p>
<div class="paragraph">
<p>The step definitions are intended to be reused across features.
We therefore recommend that they reside in a separate package, and are organized by the entity type upon which they act.</p>
</div>
<div class="paragraph">
<p>For example, given a feature that involves <code>Customer</code> and <code>Order</code>, have the step definitions pertaining to <code>Customer</code> reside in <code>CustomerStepDef</code>, and the step definitions pertaining to <code>Order</code> reside in <code>OrderStepDef</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="../../starters/simpleapp/about.html" class="page">SimpleApp</a> starter app provides some BDD specs, so we&#8217;ll use them to understand how this all works.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrapping"><a class="anchor" href="#bootstrapping"></a>Bootstrapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RunIntegBddSpecs</code> class uses the Cucumber (JUnit4) runner to discover the features and step defs (glue).
It also determines how to emit the results.</p>
</div>
<div class="paragraph">
<p>The class itself is pretty much boilerplate:</p>
</div>
<div class="listingblock">
<div class="title">RunIntegBddSpecs.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd;                           <i class="conum" data-value="1"></i><b>(1)</b>
...
@RunWith(Cucumber.class)                                <i class="conum" data-value="2"></i><b>(2)</b>
@CucumberOptions(
        plugin = {
                "html:target/cucumber-html-report"
                ,"json:target/cucumber.json"            <i class="conum" data-value="3"></i><b>(3)</b>
        },
        strict = true,
        tags = { "not @backlog", "not @ignore" },
        glue = {}
        )
public class RunIntegBddSpecs {
    // intentionally empty
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All feature files and step definitions under this package will be found.
<div class="paragraph">
<p>This can be overridden using the <code>glue</code> attribute, if required.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The tests are run through JUnit 4</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The JSON formatter allows integration with enhanced reports.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We also use two "infrastructure" step definitions to bootstrap and configure Spring.
These are also boilerplate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>BootstrapStepDef</code> class actually starts the Spring application context:</p>
<div class="listingblock">
<div class="title">BootstrapStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.infrastructure;                <i class="conum" data-value="1"></i><b>(1)</b>
...

public class BootstrapStepDef
                extends ApplicationIntegTestAbstract {      <i class="conum" data-value="2"></i><b>(2)</b>

    @Before(order= OrderPrecedence.FIRST)                   <i class="conum" data-value="3"></i><b>(3)</b>
    public void bootstrap() {
        // empty                                            <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>in a subpackage of <code>RunIntegBddSpecs</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subclasses from the corresponding integration tests, see <a href="../integtestsupport/about.html" class="page">integ test support</a> for more on this.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>this <code>@Before</code> runs before anything else</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>there&#8217;s not anything to do (the heavy lifting is in the superclass)</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <code>TransactionalStepDef</code> simulates Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> attribute:</p>
<div class="listingblock">
<div class="title">TransactionalStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.infrastructure;                <i class="conum" data-value="1"></i><b>(1)</b>
...
public class TransactionalStepDef {                         <i class="conum" data-value="2"></i><b>(2)</b>

    private Runnable afterScenario;

    @Before(order = OrderPrecedence.EARLY)
    public void beforeScenario(){
        val txTemplate = new TransactionTemplate(txMan);    <i class="conum" data-value="3"></i><b>(3)</b>
        val status = txTemplate.getTransactionManager().getTransaction(null);
        afterScenario = () -&gt; {
            txTemplate.getTransactionManager().rollback(status);
        };

        status.flush();
    }

    @After
    public void afterScenario(){
        if(afterScenario==null) {
            return;
        }
        afterScenario.run();                                <i class="conum" data-value="4"></i><b>(4)</b>
        afterScenario = null;
    }

    @Inject private PlatformTransactionManager txMan;       <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>again, in a subpackage of <code>RunIntegBddSpecs</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no need to subclass anything</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>uses Spring&#8217;s <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/support/TransactionTemplate.html">TransactionTemplate</a> to wrap up the rest of the steps</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>rolls back the transaction at the end.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>supporting services are automatically injected.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two "infrastructure" step definitions could be combined into a single class, if desired.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="typical-usage"><a class="anchor" href="#typical-usage"></a>Typical Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the bootstrapping and infrastructure taken care of, let&#8217;s look at the actual spec and corresponding step defs.</p>
</div>
<div class="listingblock">
<div class="title">SimpleObjectSpec_listAllAndCreate.feature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: List and Create New Simple Objects                             <i class="conum" data-value="1"></i><b>(1)</b>

  @DomainAppDemo                                                        <i class="conum" data-value="2"></i><b>(2)</b>
  Scenario: Existing simple objects can be listed and new ones created  <i class="conum" data-value="1"></i><b>(1)</b>
    Given there are initially 10 simple objects                         <i class="conum" data-value="3"></i><b>(3)</b>
    When  I create a new simple object                                  <i class="conum" data-value="3"></i><b>(3)</b>
    Then  there are 11 simple objects                                   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provide context, but not actually executed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tag indicates the fixture to be run</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Map onto step definitions</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need a step definition to match the Cucumber tag to a <a href="../fixtures/about.html" class="page">fixture script</a>.</p>
</div>
<div class="listingblock">
<div class="title">DomainAppDemoStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.fixtures;
...

public class DomainAppDemoStepDef {

    @Before(value="@DomainAppDemo", order= OrderPrecedence.MIDPOINT) <i class="conum" data-value="1"></i><b>(1)</b>
    public void runDomainAppDemo() {
        fixtureScripts.runFixtureScript(new DomainAppDemo(), null);  <i class="conum" data-value="2"></i><b>(2)</b>
    }

    @Inject private FixtureScripts fixtureScripts;                   <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specifies the tag to match</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>invokes the similarly named <code>FixtureScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>fixtureScripts</code> service is injected automatically</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will only activate for feature files tagged with "@DomainAppDemo".</p>
</div>
<div class="paragraph">
<p>Finally, the step definitions pertaining to <code>SimpleObjects</code> domain service residein the <code>SimpleObjectsSpecDef</code> class.
This is where the heavy lifting gets done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.stepdefs;
...
public class SimpleObjectsStepDef {

    @Inject protected SimpleObjects simpleObjects;                      <i class="conum" data-value="1"></i><b>(1)</b>

    @Given("^there (?:is|are).* (\\d+) simple object[s]?$")             <i class="conum" data-value="2"></i><b>(2)</b>
    public void there_are_N_simple_objects(int n) {
        final List&lt;SimpleObject&gt; list = wrap(simpleObjects).listAll();  <i class="conum" data-value="3"></i><b>(3)</b>
        assertThat(list.size(), is(n));
    }

    @When("^.*create (?:a|another) .*simple object$")
    public void create_a_simple_object() {
        wrap(simpleObjects).create(UUID.randomUUID().toString());
    }

    &lt;T&gt; T wrap(T domainObject) {
        return wrapperFactory.wrap(domainObject);
    }

    @Inject protected WrapperFactory wrapperFactory;                    <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>injected domain service being interacted with</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>regex to match to feature file specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>code that interacts with the domain service.
This is done using the <a href="../integtestsupport/about.html#wrapper-factory" class="page">WrapperFactory</a> to simulate the UI.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>supporting domain services</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="../../refguide/applib-svc/core-domain-api/Scratchpad.html" class="page"><code>Scratchpad</code></a> domain service is one way in which glue classes can pass state between each other.
Or, for more type safety, you could develop your own custom domain services for each scenario, and inject these in as regular services.
See <a href="http://www.thinkcode.se/blog/2017/04/01/sharing-state-between-steps-in-cucumberjvm-using-picocontainer">this blog</a> post for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven-configuration"><a class="anchor" href="#maven-configuration"></a>Maven Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis' BDD spec support is most easily configured through a dependency on the <code>isis-mavendeps-testing</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.mavendeps&lt;/groupId&gt;
    &lt;artifactId&gt;isis-mavendeps-integspecs&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;                             <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normally <code>test</code>; usual Maven scoping rules apply.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is no need to specify the version if you inherit from from the <a href="../../starters/parent-pom/about.html" class="page">starter app parent POM</a>, then</p>
</div>
<div class="paragraph">
<p>This will set up unit testing, integration testing and BDD specs support .</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="../../starters/parent-pom/about.html" class="page">Parent POM</a> configures the Maven surefire plugin in three separate executions for unit test, integ test and BDD specs.
This relies on a naming convention:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unit tests, which must have a suffix <code>Test</code>, but excluding &#8230;&#8203;</p>
</li>
<li>
<p>integ tests, which must have the suffix <code>IntegTest</code></p>
</li>
<li>
<p>BDD specs, which must have suffix <code>IntegBddSpecs</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not following this convention is likely to cause integ tests/specs to fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you just want to set up BDD spec support, then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.core&lt;/groupId&gt;
    &lt;artifactId&gt;isis-core-specsupport&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You may also find it more convenient to place the <code>.feature</code> files in <code>src/test/java</code>, rather than <code>src/test/resources</code>.
If you wish to do this, then your integtest module&#8217;s <code>pom.xml</code> must contain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;build&gt;
    &lt;testResources&gt;
        &lt;testResource&gt;
            &lt;filtering&gt;false&lt;/filtering&gt;
            &lt;directory&gt;src/test/resources&lt;/directory&gt;
        &lt;/testResource&gt;
        &lt;testResource&gt;
            &lt;filtering&gt;false&lt;/filtering&gt;
            &lt;directory&gt;src/test/java&lt;/directory&gt;
            &lt;includes&gt;
                &lt;include&gt;**&lt;/include&gt;
            &lt;/includes&gt;
            &lt;excludes&gt;
                &lt;exclude&gt;**/*.java&lt;/exclude&gt;
            &lt;/excludes&gt;
        &lt;/testResource&gt;
    &lt;/testResources&gt;
&lt;/build&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generated-report"><a class="anchor" href="#generated-report"></a>Generated Report</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BDD is all about creating a conversation with the domain expert, and that includes providing meaningful feedback as to whether the spec is passing or failing.</p>
</div>
<div class="paragraph">
<p>The <a href="../../starters/simpleapp/about.html" class="page">SimpleApp</a>'s <code>webapp</code> module uses a Maven plugin to generate a snazzy HTML website based on the contents of the <code>.json</code> file emitted by <code>RunBddIntegSpecs</code>.</p>
</div>
<div class="paragraph">
<p>The plugin&#8217;s configuration is:</p>
</div>
<div class="listingblock">
<div class="title">webapp/pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;net.masterthought&lt;/groupId&gt;
    &lt;artifactId&gt;maven-cucumber-reporting&lt;/artifactId&gt;
    &lt;version&gt;${maven-cucumber-reporting.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;id&gt;execution&lt;/id&gt;
            &lt;phase&gt;verify&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;generate&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;projectName&gt;SimpleApp&lt;/projectName&gt;
                &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;
                &lt;inputDirectory&gt;${project.build.directory}&lt;/inputDirectory&gt;
                &lt;jsonFiles&gt;
                    &lt;param&gt;**/*.json&lt;/param&gt;
                &lt;/jsonFiles&gt;
                &lt;skip&gt;${skipBSs}&lt;/skip&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The report generated by <a href="../../starters/simpleapp/about.html" class="page">SimpleApp</a> looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/bdd-report.png"><img src="_images/bdd-report.png" alt="bdd report" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The idea is that this could then be published to a webserver to create an information radiator.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright Â© 2010~2019 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20200201-0400-2fbfcbe2</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
