<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Fixture Scripts :: Apache Isis</title>
    <meta name="generator" content="Antora 2.3.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../../.." title="Apache Isis">
  <link rel="next" href="services/ExecutionParametersService.html" title="ExecutionParametersService">
  <link rel="prev" href="../specsupport/about.html" title="BDD Spec Support">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
          <span class="icon">
            <img src="../../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item hide-for-print">
          <span>
            <input id="algolia-search-input" placeholder="Search"></span>
          </span>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/demo/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/2.0.0-M5/about.html">Setup Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-M5/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/2.0.0-M5/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/2.0.0-M5/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Libraries</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">For Use in Apps</span>
            <a class="navbar-item" href="../../../subdomains/2.0.0-M5/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../../valuetypes/2.0.0-M5/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Integrate between Apps</span>
            <a class="navbar-item" href="../../../mappings/2.0.0-M5/about.html">Bounded Context Mapping Libraries</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Other</span>
            <a class="navbar-item" href="../../../incubator/2.0.0-M5/about.html">Incubator</a>
            <a class="navbar-item" href="../../../legacy/2.0.0-M5/about.html">Legacy</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/2.0.0-M5/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../../vro/2.0.0-M5/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-M5/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjdo/2.0.0-M5/about.html">DataNucleus (JDO)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../../extensions/2.0.0-M5/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/2.0.0-M5/about.html">Release Notes</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M5/archive/1-x.html">Archive (1.x)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Framework</span>
            <a class="navbar-item" href="../../../conguide/2.0.0-M5/about.html">Contributors' Guide</a>
            <a class="navbar-item" href="../../../comguide/2.0.0-M5/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../core/2.0.0-M5/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/2.0.0-M5/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="../specsupport/about.html" title="BDD Spec Support"><span></span></a>
  <a class="page-next" rel="next"
     href="services/ExecutionParametersService.html" title="ExecutionParametersService"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="BDD Spec Support"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unittestsupport/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integtestsupport/about.html">Integ Test Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/domain-model-validator.html">Domain Model Validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/swagger-exporter.html">Swagger Exporter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../specsupport/about.html">BDD Spec Support</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Fixture Scripts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="services/ExecutionParametersService.html">ExecutionParametersService</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="services/FixtureScripts.html">FixtureScripts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="services/FixtureScriptsSpecificationProvider.html">FixtureScriptsSpecificationProvider</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fakedata/about.html">Fakedata</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../h2console/about.html">H2 Console</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../h2console/services/H2ManagerMenu.html">H2ManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hsqldbmgr/about.html">HSQLDB Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../hsqldbmgr/services/HsqlDbManagerMenu.html">HsqlDbManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mappings Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mappings/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../legacy/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../subdomains/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">System Overview</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../system/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Testing Guide</a></li>
    <li><a href="about.html">Fixture Scripts</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/testing/fixtures/adoc/modules/fixtures/pages/about.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Fixture Scripts</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When writing integration tests (and implementing the glue for BDD specs) it can be difficult to keep the "given" short; there could be a lot of prerequisite data that needs to exist before you can actually exercise your system.
Moreover, however we do set up that data, but we also want to do so in a way that is resilient to the system changing over time.</p>
</div>
<div class="paragraph">
<p>On a very simple system you could probably get away with using SQL to insert directly into the database, or you could use a toolkit such as <a href="http://dbunit.sourceforge.net/howto.html">dbunit</a> to upload data from flat files.
Such approaches aren&#8217;t particularly maintainable though.
If in the future the domain entities (and therefore corresponding database tables) change their structure, then all of those data sets will need updating.</p>
</div>
<div class="paragraph">
<p>Even more significantly, there&#8217;s no way to guarantee that the data that&#8217;s being loaded is logically consistent with the business behaviour of the domain objects themselves.
That is, there&#8217;s nothing to stop your test from putting data into the database that would be invalid if one attempted to add it through the app.</p>
</div>
<div class="paragraph">
<p>The solution that Apache Isis provides is a small library called <strong><em>fixture scripts</em></strong>.
A fixture script is basically a command object for executing arbitrary work, where the work in question is almost always invoking one or more business actions.
In other words, the database is populating through the functionality of the domain object model itself.</p>
</div>
<div class="paragraph">
<p>There is another benefit to Apache Isis' fixture script approach; the fixtures can be (in prototyping mode) run from your application.
This means that fixture scripts can actually help all the way through the development lifecycle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>when specifying a new feature, you can write a fixture script to get the system into the "given" state, and then start exploring the required functionality with the domain expert actually <em>within</em> the application<br></p>
<div class="paragraph">
<p>And if you can&#8217;t write a fixture script for the story, it probably means that there&#8217;s some prerequisite feature that needs implementing that you hadn&#8217;t previously recognized</p>
</div>
</li>
<li>
<p>when the developer implements the story, s/he has a precanned script to run when they manually verify the functionality works</p>
</li>
<li>
<p>when the developer automates the story&#8217;s acceptance test as an integration test, they already have the "given" part of the test implemented</p>
</li>
<li>
<p>when you want to pass the feature over to the QA/tester for additional manual exploratory testing, they have a fixture script to get them to a jumping off point for their explorations</p>
</li>
<li>
<p>when you want to demonstrate the implemented feature to your domain expert, your demo can use the fixture script so you don&#8217;t bore your audience in performing lots of boring setup before getting to the actual feature</p>
</li>
<li>
<p>when you want to roll out training to your users, you can write fixture scripts as part of their training exercises</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following  sections explain the API and how to go about using the API.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="api-and-usage"><a class="anchor" href="#api-and-usage"></a>API and Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are two main parts to using fixture scripts: the <code>FixtureScripts</code> domain service class, and the <code>FixtureScript</code> view model class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The role of the <code>FixtureScripts</code> domain service is to locate all fixture scripts from the classpath and to let them be invoked, either from an integration test/BDD spec or from the UI of your Isis app.</p>
</li>
<li>
<p>The role of <code>FixtureScript</code> meanwhile is to subclass for each of the scenarios that you want to define.
You can also subclass from <code>FixtureScript</code> to create helpers; more on this below.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s look at <code>FixtureScripts</code> domain service in more detail first.</p>
</div>
<div class="sect2">
<h3 id="fixturescripts"><a class="anchor" href="#fixturescripts"></a><code>FixtureScripts</code></h3>
<div class="paragraph">
<p>The framework provides a default implementation of <code>FixtureScripts</code> domain service, namely the <a href="services/FixtureScripts.html" class="page"><code>FixtureScriptsDefault</code></a> domain service.
This is annotated to be rendered on the secondary "Prototyping" menu.</p>
</div>
<div class="paragraph">
<p>The behaviour of this domain menu service can be refined by providing an implementation of the optional <a href="services/FixtureScriptsSpecificationProvider.html" class="page"><code>FixtureScriptsSpecificationProvider</code></a> SPI.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s the <code>FixtureScriptsSpecificationProvider</code> service that&#8217;s generated by the <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter apps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainService( nature = NatureOfService.DOMAIN )
public class DomainAppFixtureScriptsSpecificationProvider
                    implements FixtureScriptsSpecificationProvider {
    public FixtureScriptsSpecification getSpecification() {
        return FixtureScriptsSpecification
            .builder(DomainAppFixtureScriptsSpecificationProvider.class)               <i class="conum" data-value="1"></i><b>(1)</b>
            .with(FixtureScripts.MultipleExecutionStrategy.EXECUTE)                    <i class="conum" data-value="2"></i><b>(2)</b>
            .withRunScriptDefault(DomainAppDemo.class)                                 <i class="conum" data-value="3"></i><b>(3)</b>
            .withRunScriptDropDown(FixtureScriptsSpecification.DropDownPolicy.CHOICES) <i class="conum" data-value="4"></i><b>(4)</b>
            .withRecreate(DomainAppDemo.class)                                         <i class="conum" data-value="5"></i><b>(5)</b>
            .build();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>search for all fixture scripts under the package containing this class</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>if the same fixture script (class) is encountered more than once, then run anyway; more on this in <a href="#testing:fixtures:about/api-and-usage.adoc#organizing" class="page unresolved">Organizing Fixture scripts</a>, below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>specify the fixture script class to provide as the default for the service&#8217;s "run fixture script" action</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>whether the service&#8217;s "run fixture script" action should display other fixture scripts using a choices drop down or (if there are very many of them) using an auto-complete</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>if present, enables a "recreate objects and return first" action to be displayed in the UI</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s how the domain service looks like in the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prototyping-menu.png" alt="prototyping menu" width="700px">
</div>
</div>
<div class="paragraph">
<p>and here&#8217;s what the <code>runFixtureScript</code> action prompt looks like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prompt.png" alt="prompt" width="700px">
</div>
</div>
<div class="paragraph">
<p>when this is executed, the resultant objects (actually, instances of FixtureResult`) are shown in the UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/result-list.png" alt="result list" width="700px">
</div>
</div>
<div class="paragraph">
<p>If you had defined many fixture scripts then a drop-down might become unwieldy, in which case your code would probably override the <code>autoComplete&#8230;&#8203;())</code> instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Override
    public List&lt;FixtureScript&gt; autoComplete0RunFixtureScript(final @MinLength(1) String searchArg) {
        return super.autoComplete0RunFixtureScript(searchArg);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>You are free, of course, to add additional "convenience" actions into it if you wish for the most commonly used/demo&#8217;d setups ; you&#8217;ll find that the <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp archetype</a> adds this additional action:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Action(
            restrictTo = RestrictTo.PROTOTYPING
    )
    @ActionLayout(
            cssClassFa="fa fa-refresh"
    )
    @MemberOrder(sequence="20")
    public Object recreateObjectsAndReturnFirst() {
        final List&lt;FixtureResult&gt; run = findFixtureScriptFor(RecreateSimpleObjects.class).run(null);
        return run.get(0).getObject();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s now look at the <code>FixtureScript</code> class, where there&#8217;s a bit more going on.</p>
</div>
</div>
<div class="sect2">
<h3 id="fixturescript"><a class="anchor" href="#fixturescript"></a><code>FixtureScript</code></h3>
<div class="paragraph">
<p>A fixture script is ultimately just a block of code that can be executed, so it&#8217;s up to you how you implement it to set up the system.
However, we strongly recommend that you use it to invoke actions on business objects, in essence to replay what a real-life user would have done.
That way, the fixture script will remain valid even if the underlying implementation of the system changes in the future.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s a fixture script called <code>RecreateSimpleObjects</code>.
(This used to be part of the <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter app, though it now has a more sophisticated design, discussed below):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import lombok.Accessors;
import lombok.Getter;
import lombok.Setter;

@Accessors(chain = true)
public class RecreateSimpleObjects extends FixtureScript {                   <i class="conum" data-value="1"></i><b>(1)</b>

    public final List&lt;String&gt; NAMES = Collections.unmodifiableList(Arrays.asList(
            "Foo", "Bar", "Baz", "Frodo", "Froyo",
            "Fizz", "Bip", "Bop", "Bang", "Boo"));                           <i class="conum" data-value="2"></i><b>(2)</b>
    public RecreateSimpleObjects() {
        withDiscoverability(Discoverability.DISCOVERABLE);                   <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Getter @Setter
    private Integer number;                                                  <i class="conum" data-value="4"></i><b>(4)</b>

    @Getter
    private final List&lt;SimpleObject&gt; simpleObjects = Lists.newArrayList();   <i class="conum" data-value="5"></i><b>(5)</b>

    @Override
    protected void execute(final ExecutionContext ec) {          <i class="conum" data-value="6"></i><b>(6)</b>
        // defaults
        final int number = defaultParam("number", ec, 3);        <i class="conum" data-value="7"></i><b>(7)</b>
        // validate
        if(number &lt; 0 || number &gt; NAMES.size()) {
            throw new IllegalArgumentException(
                String.format("number must be in range [0,%d)", NAMES.size()));
        }
        // execute
        ec.executeChild(this, new SimpleObjectsTearDown());      <i class="conum" data-value="8"></i><b>(8)</b>
        for (int i = 0; i &lt; number; i++) {
            final SimpleObjectCreate fs =
                new SimpleObjectCreate().setName(NAMES.get(i));
            ec.executeChild(this, fs.getName(), fs);             <i class="conum" data-value="9"></i><b>(9)</b>
            simpleObjects.add(fs.getSimpleObject());             <i class="conum" data-value="10"></i><b>(10)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>org.apache.isis.applib.fixturescripts.FixtureScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>a hard-coded list of values for the names.
Note that the <a href="../fakedata/about.html" class="page">Fakedata</a> testing module could also have been used</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>whether the script is "discoverable"; in other words whether it should be rendered in the drop-down by the <code>FixtureScripts</code> service</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>input property: the number of objects to create, up to 10; for the calling test to specify, but note this is optional and has a default (see below).
It&#8217;s important that a wrapper class is used (ie <code>java.lang.Integer</code>, not <code>int</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>output property: the generated list of objects, for the calling test to grab</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the mandatory execute(&#8230;&#8203;) API</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>the <code>defaultParam(&#8230;&#8203;)</code> (inherited from <code>FixtureScript</code>) will default the <code>number</code> property (using Java&#8217;s Reflection API) if none was specified</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>call another fixture script (<code>SimpleObjectsTearDown</code>) using the provided <code>ExecutionContext</code>.
Note that although the fixture script is a view model, it&#8217;s fine to simply instantiate it (rather than using <code>FactoryService#create(&#8230;&#8203;)</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>calling another fixture script (<code>SimpleObjectCreate</code>) using the provided <code>ExecutionContext</code></td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>adding the created object to the list, for the calling object to use.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Because this script has exposed a "number" property, it&#8217;s possible to set this from within the UI.
For example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/prompt-specifying-number.png" alt="prompt specifying number" width="700px">
</div>
</div>
<div class="paragraph">
<p>When this is executed, the framework will parse the text and attempt to reflectively set the corresponding properties on the fixture result.
So, in this case, when the fixture script is executed we actually get 6 objects created.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-within-tests"><a class="anchor" href="#using-within-tests"></a>Using within Tests</h3>
<div class="paragraph">
<p>Fixture scripts can be called from integration tests just the same way that fixture scripts can call one another.</p>
</div>
<div class="paragraph">
<p>For example, here&#8217;s an integration test from the <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter app:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleObjectIntegTest extends SimpleAppIntegTest {
    SimpleObject simpleObjectWrapped;
    @Before
    public void setUp() throws Exception {
        // given
        RecreateSimpleObjects fs =
             new RecreateSimpleObjects().setNumber(1);  <i class="conum" data-value="1"></i><b>(1)</b>
        fixtureScripts.runFixtureScript(fs, null);      <i class="conum" data-value="2"></i><b>(2)</b>

        SimpleObject simpleObjectPojo =
            fs.getSimpleObjects().get(0);               <i class="conum" data-value="3"></i><b>(3)</b>
        assertThat(simpleObjectPojo).isNotNull();

        simpleObjectWrapped = wrap(simpleObjectPojo);   <i class="conum" data-value="4"></i><b>(4)</b>
    }
    @Test
    public void accessible() throws Exception {
        // when
        final String name = simpleObjectWrapped.getName();
        // then
        assertThat(name).isEqualTo(fs.NAMES.get(0));
    }
    ...
    @Inject
    FixtureScripts fixtureScripts;                      <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instantiate the fixture script for this test, and configure</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>execute the fixture script</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>obtain the object under test from the fixture</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>wrap the object (to simulate being interacted with through the UI)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>inject the <code>FixtureScripts</code> domain service (just like any other domain service)</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="personas-and-builders"><a class="anchor" href="#personas-and-builders"></a>Personas and Builders</h3>
<div class="paragraph">
<p>Good integration tests are probably the best way to understand the behaviour of the domain model: better, even, than reading the code itself.
This requires though that the tests are as minimal as possible so that the developer reading the test knows that everything mentioned in the test is essential to the functionality under test.</p>
</div>
<div class="paragraph">
<p>At the same time, "Persona" instances of entity classes help the developer become familiar with the data being set up.
For example, "Steve Single" the Customer might be 21, single and no kids, whereas vs "Meghan Married-Mum" the Customer might be married 35 with 2 kids.
Using "Steve" vs "Meghan" immediately informs the developer about the particular scenario being explored.</p>
</div>
<div class="paragraph">
<p>The <code>PersonaWithBuilderScript</code> and <code>PersonaWithFinder</code> interfaces are intended to be implemented typically by "persona" enums, where each enum instance captures the essential data of some persona.
So, going back to the previous example, we might have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">public enum Customer_persona
        implements PersonaWithBuilderScript&lt;..&gt;, PersonaWithFinder&lt;..&gt; {

    SteveSingle("Steve", "Single", 21, MaritalStatus.SINGLE, 0)
    MeghanMarriedMum("Meghan", "Married-Mum", 35, MaritalStatus.MARRIED, 2);
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonaWithBuilderScript</code> interface means that this enum is able to act as a factory for a <code>BuilderScriptAbstract</code>.
This is a specialization of <code>FixtureScript</code> that is used to actually create the entity (customer, or whatever), using the data taken out of the enum instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">public interface PersonaWithBuilderScript&lt;T, F extends BuilderScriptAbstract&lt;T,F&gt;&gt;  {
    F builder();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>PersonaWithFinder</code> interface meanwhile indicates that the enum can "lookup" its corresponding entity from the appropriate repository domain service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">public interface PersonaWithFinder&lt;T&gt; {
    T findUsing(final ServiceRegistry2 serviceRegistry);

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter app provides a sample implementation of these interfaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@lombok.AllArgsConstructor
public enum SimpleObject_persona
        implements PersonaWithBuilderScript&lt;SimpleObject, SimpleObjectBuilder&gt;,
                   PersonaWithFinder&lt;SimpleObject&gt; {
    FOO("Foo"),
    BAR("Bar"),
    BAZ("Baz"),
    FRODO("Frodo"),
    FROYO("Froyo"),
    FIZZ("Fizz"),
    BIP("Bip"),
    BOP("Bop"),
    BANG("Bang"),
    BOO("Boo");

    private final String name;

    @Override
    public SimpleObjectBuilder builder() {
        return new SimpleObjectBuilder().setName(name);
    }

    @Override
    public SimpleObject findUsing(final ServiceRegistry2 serviceRegistry) {
        SimpleObjectRepository simpleObjectRepository =
            serviceRegistry.lookupService(SimpleObjectRepository.class);
        return simpleObjectRepository.findByNameExact(name);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>SimpleObjectBuilder</code> in turn is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import javax.inject.Inject;
import lombok.Accessors;
import lombok.Getter;
import lombok.Setter;

@Accessors(chain = true)
public class SimpleObjectBuilder
            extends BuilderScriptAbstract&lt;SimpleObject, SimpleObjectBuilder&gt; {

    @Getter @Setter
    private String name;                                    <i class="conum" data-value="1"></i><b>(1)</b>

    @Override
    protected void execute(final ExecutionContext ec) {
        checkParam("name", ec, String.class);               <i class="conum" data-value="2"></i><b>(2)</b>
        object = wrap(simpleObjects).create(name);
    }

    @Getter
    private SimpleObject object;                            <i class="conum" data-value="3"></i><b>(3)</b>

    @Inject
    SimpleObjects simpleObjects;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The persona class should set this value (copied from its own state)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the inherited "checkParam" is used to ensure that a value is set</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the created entity is provided as an output</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This simplifies the integration tests considerably:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleObject_IntegTest extends SimpleModuleIntegTestAbstract {

    SimpleObject simpleObject;

    @Before
    public void setUp() {
        // given
        simpleObject = fixtureScripts.runBuilderScript(SimpleObject_persona.FOO.builder());
    }

    @Test
    public void accessible() {
        // when
        final String name = wrap(simpleObject).getName();

        // then
        assertThat(name).isEqualTo(simpleObject.getName());
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Put together, the persona enums provide the "what" - hard-coded values for certain key data that the developer becomes very familiar with - while the builder provides the "how-to".</p>
</div>
<div class="paragraph">
<p>These builder scripts (<code>BuilderScriptAbstract</code> implementations) can be used independently of the enum personas.
And for more complex entity -where there might be many potential values that need to be provided
- the builder script can automatically default some or even all of these values.</p>
</div>
<div class="paragraph">
<p>For example, for a customer&#8217;s date of birth, the buider could default to a date making the customer an adult, aged between 18 and 65, say.
For an email address or postal address, or an image, or some "lorem ipsum" text, the <a href="../fakedata/about.html" class="page">Fakedata</a> testing module could provide randomised values.</p>
</div>
<div class="paragraph">
<p>The benefit of an intelligent builder is that it further simplifies the test.
The developer reading the test then knows that everything that has been specified exactly is of significance.
Because non-specified values are randomised and change on each run, it also decreases the chance that the test passes "by accident" (based on some lucky hard-coded input value).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mocking-the-clock"><a class="anchor" href="#mocking-the-clock"></a>Mocking the Clock</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s often useful to be able to change the effective time that a test runs.
The framework itself uses the <a href="../../../refguide/latest/applib-svc/ClockService.html" class="page"><code>ClockService</code></a> to obtain the current time, and applications should also use this domain service for a consistent view of the current time.</p>
</div>
<div class="paragraph">
<p>This page describes how to change the current time, and how to set up tests using fixture scripts with a mocked time.</p>
</div>
<div class="sect2">
<h3 id="fixtureclock"><a class="anchor" href="#fixtureclock"></a>FixtureClock</h3>
<div class="paragraph">
<p>The default <a href="../../../refguide/latest/applib-svc/ClockService.html" class="page"><code>ClockService</code></a> implementation in fact simply delegates to another class defined in the API, namely the <code>o.a.i.applib.clock.Clock</code>, an abstract singleton class.
It is not recommended that your code use the <code>Clock</code> directly, but it&#8217;s worth understanding how this all works.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If running in <a href="../../../refguide/latest/config/about.html#deployment-types" class="page">production</a> (server) mode, then the framework will (lazily) instantiate the <code>`SystemClock</code> when first required.
This is a read-only clock that reads from the system time.
The instance registers itself as the singleton and cannot be replaced.</p>
</li>
<li>
<p>If running in <a href="../../../refguide/latest/config/about.html#deployment-types" class="page">prototype</a> mode, though, then the framework (using <code>FixturesLifecycleService</code>) will instead instantiate <code>FixtureClock</code>.
This is a read-write clock that will behave as the system clock, unless it is explicitly set using eg, <code>FixtureClock#setDate(&#8230;&#8203;)</code> or <code>FixtureClock#setTime(&#8230;&#8203;)</code> etc.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO: v2 - looking now to remove Clock singleton, so refactor FixtureClock and TickingFixtureClock with alternative implementations of ClockService.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Moreover, the <code>FixtureClock</code> singleton can be replaced with another implementation.
And, it is sometimes useful to replace it using <code>TickingFixtureClock</code>, a subclass that is very similar to <code>FixtureClock</code> (in that the time can be changed) but which will continue to tick once set.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
TODO: v2 - this is currently broken; there is nothing that actually instantiates and installs the TickingFixtureClock.
Will be superceded as a requirement if refactor to provide alternative ClockService implementations instead.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tickingclockfixture"><a class="anchor" href="#tickingclockfixture"></a>TickingClockFixture</h3>
<div class="paragraph">
<p>The <code>TickingClockFixture</code> is a pre-built fixture script that resets the date/time returned by the <a href="../../../refguide/latest/applib-svc/ClockService.html" class="page"><code>ClockService</code></a> to a known value.</p>
</div>
<div class="paragraph">
<p>Thereafter the time returned continues to tick forward (as would the real clock) until reset once more.</p>
</div>
<div class="paragraph">
<p>For example, to set the clock to return "3 Sept 2014", use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">executionContext.executeChild(this, new TickingClockFixture().setTo("2014-09-03"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>A variety of format strings are supported; the format "YYYY-MM-DD" (as shown above) will work in every locale.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This fixture script requires that a <code>TickingFixtureClock</code> is initialized during bootstrapping.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sudoservice"><a class="anchor" href="#sudoservice"></a><code>SudoService</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes in our fixture scripts we want to perform a business action running as a particular user.
This might be for the usual reason - so that our fixtures accurately reflect the reality of the system with all business constraints enforced using the <code>WrapperFactory</code> - or more straightforwardly it might be simply that the action depends on the identity of the user invoking the action.</p>
</div>
<div class="paragraph">
<p>For example, consider this code that creates a todo item:</p>
</div>
<div class="listingblock">
<div class="title">Production code that depends on current user</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// annotations omitted for clarity
public ToDoItem newToDo(
        final String description,
        final Category category,
        final Subcategory subcategory,
        final LocalDate dueBy,
        final BigDecimal cost) {
    return newToDo(description, category, subcategory, currentUserName(), dueBy, cost);
}
private String currentUserName() {
    return container.getUser().getName();       <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>is the current user.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The fixture for this can use the <code>SudoService</code> to run a block of code as a specified user:</p>
</div>
<div class="listingblock">
<div class="title">Fixture Script</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final String description = ...
final Category category = ...
final Subcategory subcategory = ...
final LocalDate dueBy = ...
final BigDecimal cost = ...
final Location location = ...

toDoItem = sudoService.sudo(username,
        new Callable&lt;ToDoItem&gt;() {
            @Override
            public ToDoItem call() {
                final ToDoItem toDoItem = wrap(toDoItems).newToDo(
                        description, category, subcategory, dueBy, cost);
                wrap(toDoItem).setLocation(location);
                return toDoItem;
            }
        });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Behind the scenes the <code>SudoService</code> simply talks to the <code>UserService</code> to override the user returned by the <code>getUser()</code> API.
It is possible to override both users and roles.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright  2010~2020 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M4.20201030-1151-99e099c2</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'isis-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
