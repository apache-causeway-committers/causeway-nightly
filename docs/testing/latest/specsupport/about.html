<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BDD Spec Support :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
<link rel="home" href="../../.." title="Apache Isis">
  <link rel="next" href="../fixtures/about.html" title="Fixture Scripts">
  <link rel="prev" href="../integtestsupport/swagger-exporter.html" title="Swagger Exporter">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
          <span class="icon">
            <img src="../../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/demo/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/2.0.0-M4/about.html">Setup Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-M4/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/2.0.0-M4/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/2.0.0-M4/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Libraries</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">For Use in Apps</span>
            <a class="navbar-item" href="../../../subdomains/2.0.0-M4/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../../valuetypes/2.0.0-M4/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Integrate between Apps</span>
            <a class="navbar-item" href="../../../mappings/2.0.0-M4/about.html">Bounded Context Mapping Libraries</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Other</span>
            <a class="navbar-item" href="../../../incubator/2.0.0-M4/about.html">Incubator</a>
            <a class="navbar-item" href="../../../legacy/2.0.0-M4/about.html">Legacy</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/2.0.0-M4/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../../vro/2.0.0-M4/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-M4/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjdo/2.0.0-M4/about.html">DataNucleus (JDO)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../../extensions/2.0.0-M4/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/2.0.0-M4/about.html">Release Notes</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/archive/1-x.html">Archive (1.x)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Framework</span>
            <a class="navbar-item" href="../../../conguide/2.0.0-M4/about.html">Contributors' Guide</a>
            <a class="navbar-item" href="../../../comguide/2.0.0-M4/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../core/2.0.0-M4/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/2.0.0-M4/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="../integtestsupport/swagger-exporter.html" title="Swagger Exporter"><span></span></a>
  <a class="page-next" rel="next"
     href="../fixtures/about.html" title="Fixture Scripts"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Swagger Exporter"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unittestsupport/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integtestsupport/about.html">Integ Test Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/domain-model-validator.html">Domain Model Validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/swagger-exporter.html">Swagger Exporter</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="about.html">BDD Spec Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../fixtures/about.html">Fixture Scripts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/ExecutionParametersService.html">ExecutionParametersService</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/FixtureScripts.html">FixtureScripts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/FixtureScriptsSpecificationProvider.html">FixtureScriptsSpecificationProvider</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fakedata/about.html">Fakedata</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../h2console/about.html">H2 Console</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../h2console/services/H2ManagerMenu.html">H2ManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hsqldbmgr/about.html">HSQLDB Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../hsqldbmgr/services/HsqlDbManagerMenu.html">HsqlDbManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mappings Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mappings/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../legacy/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../subdomains/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Testing Guide</a></li>
    <li><a href="about.html">BDD Spec Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/testing/specsupport/adoc/modules/specsupport/pages/about.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">BDD Spec Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Behavior-driven_development">Behaviour-driven design</a> (BDD) redefines testing not as an after-the-fact "let&#8217;s check the system works", but instead as a means to specify the required behaviour in conjunction with the domain expert.
Once the feature has been implemented, it also provide a means by which the domain expert can verify the feature has been implemented to spec.</p>
</div>
<div class="paragraph">
<p>Since domain experts are usually non-technical (at least, they are unlikely to be able to read or want to learn how to read JUnit/Java code), then applying BDD typically requires writing specifications in using structured English text and (ASCII) tables.
The BDD tooling parses this text and uses it to actually interact with the system under test.
As a byproduct the BDD frameworks generate readable output of some form; this is often an annotated version of the original specification, marked up to indicate which specifications passed, which have failed.
This readable output is a form of "living documentation"; it captures the actual behaviour of the system, and so is guaranteed to be accurate.</p>
</div>
<div class="paragraph">
<p>There are many BDD tools out there; Apache Isis provides an integration with <a href="https://cucumber.io/docs/reference/jvm#java">Cucumber JVM</a> (see also the <a href="https://github.com/cucumber/cucumber-jvm">github site</a>):</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-it-works"><a class="anchor" href="#how-it-works"></a>How it works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At a high level, here&#8217;s how Cucumber works</p>
</div>
<div class="ulist">
<ul>
<li>
<p>specifications are written in the <a href="https://github.com/cucumber/cucumber/wiki/Gherkin">Gherkin</a> DSL, following the <a href="https://github.com/cucumber/cucumber/wiki/Given-When-Then">"given/when/then"</a> format.</p>
</li>
<li>
<p>Cucumber-JVM itself is a JUnit runner, and searches for <a href="https://github.com/cucumber/cucumber/wiki/Feature-Introduction">feature files</a> on the classpath.</p>
</li>
<li>
<p>These in turn are matched to <a href="https://github.com/cucumber/cucumber/wiki/Step-Definitions">step definition</a>s through regular expressions.</p>
<div class="paragraph">
<p>It is the step definitions (also called "glue") that exercise the system.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The code that goes in step definitions is broadly the same as the code that goes in an integration test method.
However one benefit of using step definitions (rather than integration tests) is that the step definitions are reusable across scenarios, so there may be less code overall to maintain.</p>
</div>
<div class="paragraph">
<p>For example, if you have a step definition that maps to "given an uncompleted todo item", then this can be used for all the scenarios that start with that as their precondition.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-a-bdd-spec"><a class="anchor" href="#writing-a-bdd-spec"></a>Writing a BDD spec</h2>
<div class="sectionbody">
<div class="paragraph">
<p>BDD specifications contain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>Xxx.feature</code> file, describing the feature and the scenarios (given/when/then)s that constitute its acceptance criteria</p>
</li>
<li>
<p>a <code>RunCucumberTest</code> class file to run the specifications (all boilerplate).
This will run all <code>.feature</code> files in the same package or subpackages, but is basically just boilerplate.</p>
</li>
<li>
<p>one or several <code>XxxStepDef</code> classes constituting the step definitions to be matched against.</p>
<div class="paragraph">
<p>The step definitions are intended to be reused across features.
We therefore recommend that they reside in a separate package, and are organized by the entity type upon which they act.</p>
</div>
<div class="paragraph">
<p>For example, given a feature that involves <code>Customer</code> and <code>Order</code>, have the step definitions pertaining to <code>Customer</code> reside in <code>CustomerStepDef</code>, and the step definitions pertaining to <code>Order</code> reside in <code>OrderStepDef</code>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter app provides some BDD specs, so we&#8217;ll use them to understand how this all works.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrapping"><a class="anchor" href="#bootstrapping"></a>Bootstrapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>RunCucumberSpecs</code> class is annotated with the <code>@Cucumber</code> JUnit 5 <a href="https://junit.org/junit5/docs/current/user-guide/#launcher-api-engines-custom">platform test engine</a> to discover the features and step defs (glue).</p>
</div>
<div class="paragraph">
<p>The class itself is trivial:</p>
</div>
<div class="listingblock">
<div class="title">RunCucumberSpecs.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd;

import io.cucumber.junit.platform.engine.Cucumber;

@Cucumber                                           <i class="conum" data-value="1"></i><b>(1)</b>
public class RunCucumberSpecs {
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The tests are run through JUnit 5, as a custom platform engine</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Cucumber engine is configured using JUnit 5&#8217;s standard mechanism, namely the <code>junit-platform.properties</code> file (in the root package):</p>
</div>
<div class="listingblock">
<div class="title">junit-platform.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-ini hljs" data-lang="ini">cucumber.filter.tags=not @backlog and not @ignore
cucumber.glue=domainapp.webapp.bdd.stepdefs</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also use two "infrastructure" step definitions to bootstrap and configure Spring.
These are also boilerplate:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>BootstrapStepDef</code> class actually starts the Spring application context:</p>
<div class="listingblock">
<div class="title">BootstrapStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.stepdefs.infrastructure;       <i class="conum" data-value="1"></i><b>(1)</b>
...

public class BootstrapStepDef
                extends ApplicationIntegTestAbstract {      <i class="conum" data-value="2"></i><b>(2)</b>

    @Before(order= OrderPrecedence.FIRST)                   <i class="conum" data-value="3"></i><b>(3)</b>
    public void bootstrap() {
        // empty                                            <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>in a subpackage of <code>domainapp.webapp.bdd.stepdefs</code>.<br>
See <code>junit-platform.properties</code>, above.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subclasses from the corresponding integration tests, see <a href="../integtestsupport/about.html" class="page">integ test support</a> for more on this.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>this <code>@Before</code> runs before anything else</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>there&#8217;s not anything to do (the heavy lifting is in the superclass)</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <code>TransactionalStepDef</code> simulates Spring&#8217;s <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> attribute:</p>
<div class="listingblock">
<div class="title">TransactionalStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.stepdefs.infrastructure;       <i class="conum" data-value="1"></i><b>(1)</b>
...
public class TransactionalStepDef {                         <i class="conum" data-value="2"></i><b>(2)</b>

    private Runnable afterScenario;

    @Before(order = OrderPrecedence.EARLY)
    public void beforeScenario(){
        val txTemplate = new TransactionTemplate(txMan);    <i class="conum" data-value="3"></i><b>(3)</b>
        val status = txTemplate.getTransactionManager().getTransaction(null);
        afterScenario = () -&gt; {
            txTemplate.getTransactionManager().rollback(status);
        };

        status.flush();
    }

    @After
    public void afterScenario(){
        if(afterScenario==null) {
            return;
        }
        afterScenario.run();                                <i class="conum" data-value="4"></i><b>(4)</b>
        afterScenario = null;
    }

    @Inject private PlatformTransactionManager txMan;       <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>again, in a subpackage of the <code>stepdefs</code> package.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no need to subclass anything</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>uses Spring&#8217;s <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/support/TransactionTemplate.html">TransactionTemplate</a> to wrap up the rest of the steps</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>rolls back the transaction at the end.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>supporting services are automatically injected.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>These two "infrastructure" step definitions could be combined into a single class, if desired.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="typical-usage"><a class="anchor" href="#typical-usage"></a>Typical Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With the bootstrapping and infrastructure taken care of, let&#8217;s look at the actual spec and corresponding step defs.</p>
</div>
<div class="listingblock">
<div class="title">SimpleObjectSpec_listAllAndCreate.feature</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gherkin hljs" data-lang="gherkin">Feature: List and Create New Simple Objects                             <i class="conum" data-value="1"></i><b>(1)</b>

  @DomainAppDemo                                                        <i class="conum" data-value="2"></i><b>(2)</b>
  Scenario: Existing simple objects can be listed and new ones created  <i class="conum" data-value="1"></i><b>(1)</b>
    Given there are initially 10 simple objects                         <i class="conum" data-value="3"></i><b>(3)</b>
    When  I create a new simple object                                  <i class="conum" data-value="3"></i><b>(3)</b>
    Then  there are 11 simple objects                                   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Provide context, but not actually executed</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Tag indicates the fixture to be run</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Map onto step definitions</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We need a step definition to match the Cucumber tag to a <a href="../fixtures/about.html" class="page">fixture script</a>.</p>
</div>
<div class="listingblock">
<div class="title">DomainAppDemoStepDef.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.stepdefs.fixtures;                      <i class="conum" data-value="1"></i><b>(1)</b>
...

public class DomainAppDemoStepDef {

    @Before(value="@DomainAppDemo", order= OrderPrecedence.MIDPOINT) <i class="conum" data-value="2"></i><b>(2)</b>
    public void runDomainAppDemo() {
        fixtureScripts.runFixtureScript(new DomainAppDemo(), null);  <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Inject private FixtureScripts fixtureScripts;                   <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>again, under the <code>stepdefs</code> package</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>specifies the tag to match</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>invokes the similarly named <code>FixtureScript</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>fixtureScripts</code> service is injected automatically</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will only activate for feature files tagged with "@DomainAppDemo".</p>
</div>
<div class="paragraph">
<p>Finally, the step definitions pertaining to <code>SimpleObjects</code> domain service residein the <code>SimpleObjectsSpecDef</code> class.
This is where the heavy lifting gets done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package domainapp.webapp.bdd.stepdefs.domain;                           <i class="conum" data-value="1"></i><b>(1)</b>
...
public class SimpleObjectsStepDef {

    @Inject protected SimpleObjects simpleObjects;                      <i class="conum" data-value="2"></i><b>(2)</b>

    @Given("^there (?:is|are).* (\\d+) simple object[s]?$")             <i class="conum" data-value="3"></i><b>(3)</b>
    public void there_are_N_simple_objects(int n) {
        final List&lt;SimpleObject&gt; list = wrap(simpleObjects).listAll();  <i class="conum" data-value="4"></i><b>(4)</b>
        assertThat(list.size(), is(n));
    }

    @When("^.*create (?:a|another) .*simple object$")
    public void create_a_simple_object() {
        wrap(simpleObjects).create(UUID.randomUUID().toString());
    }

    &lt;T&gt; T wrap(T domainObject) {
        return wrapperFactory.wrap(domainObject);
    }

    @Inject protected WrapperFactory wrapperFactory;                    <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>again, under the <code>stepdefs</code> package</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>injected domain service being interacted with</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>regex to match to feature file specification.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>code that interacts with the domain service.
This is done using the <a href="../integtestsupport/about.html#wrapper-factory" class="page">WrapperFactory</a> to simulate the UI.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>supporting domain services</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="../../../refguide/latest/applib-svc/Scratchpad.html" class="page"><code>Scratchpad</code></a> domain service is one way in which glue classes can pass state between each other.
Or, for more type safety, you could develop your own custom domain services for each scenario, and inject these in as regular services.
See <a href="http://www.thinkcode.se/blog/2017/04/01/sharing-state-between-steps-in-cucumberjvm-using-picocontainer">this blog</a> post for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-from-the-ide"><a class="anchor" href="#running-from-the-ide"></a>Running from the IDE</h2>
<div class="sectionbody">
<div class="paragraph">
<p>IntelliJ IDEA (ultimate edition) has built-in support for running individual features:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/intellij-idea-run-feature.png"><img src="_images/intellij-idea-run-feature.png" alt="intellij idea run feature" width="400px"></a>
</div>
</div>
<div class="paragraph">
<p>Running the feature will automatically create a Run Configuration.
It may however be necessary to tweak this Run Configuration before the feature file runs successfully:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/intellij-idea-feature-run-configuration.png"><img src="_images/intellij-idea-feature-run-configuration.png" alt="intellij idea feature run configuration"></a>
</div>
</div>
<div class="paragraph">
<p>There are (up to) three things to change:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the "Glue" property can be simplified to just the <code>domainapp.webapp.bdd.stepdefs</code> package</p>
</li>
<li>
<p>the "Working directory" property should be set to <code>${MODULE_WORKING_DIR}</code></p>
<div class="paragraph">
<p>Note: at the time of writing this doesn&#8217;t seem to be in the drop-down, so just type it in</p>
</div>
</li>
<li>
<p>in the "Before launch", make sure that the domain entities are enhanced.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven-configuration"><a class="anchor" href="#maven-configuration"></a>Maven Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h3>
<div class="paragraph">
<p>Apache Isis' BDD spec support is most easily configured through a dependency on the <code>isis-mavendeps-integspecs</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.mavendeps&lt;/groupId&gt;
    &lt;artifactId&gt;isis-mavendeps-integspecs&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;                                <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normally <code>test</code>; usual Maven scoping rules apply.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will set up dependencies for BDD specs support libraries, along with a number of libraries.
There is no need to specify the version if you inherit from from the <a href="../../../docs/latest/parent-pom/about.html" class="page">Parent POM</a>.</p>
</div>
<div class="paragraph">
<p>If you just want to set up BDD spec support, then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.core&lt;/groupId&gt;
    &lt;artifactId&gt;isis-core-specsupport&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cucumber-cli"><a class="anchor" href="#cucumber-cli"></a>Cucumber CLI</h3>
<div class="paragraph">
<p>At the time of writing, the Maven Surefire does not support custom JUnit platform test engines.
As a workaround, we use the Antrun plugin to execute the Cucumber CLI.</p>
</div>
<div class="listingblock">
<div class="title">webapp/pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
  &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;cucumber-cli&lt;/id&gt;
      &lt;phase&gt;integration-test&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;run&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;target&gt;
          &lt;echo message="Running Cucumber CLI" /&gt;
          &lt;java classname="io.cucumber.core.cli.Main"
                fork="true"
                failonerror="true"
                newenvironment="true"
                maxmemory="1024m"
                classpathref="maven.test.classpath"&gt;
            &lt;arg value="--plugin" /&gt;
            &lt;arg value="json:${project.build.directory}/cucumber-no-clobber.json" /&gt;
            &lt;arg value="--glue" /&gt;
            &lt;arg value="domainapp.webapp.bdd.stepdefs" /&gt;
            &lt;arg value="${project.build.directory}/test-classes/domainapp/webapp/bdd/specs" /&gt;
          &lt;/java&gt;
        &lt;/target&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This uses all of the step definitions found in the <code>stepdefs</code> package, and writes the results to the <code>cucumber-no-clobber.json</code> file.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
see <a href="https://github.com/cucumber/cucumber-jvm/blob/master/core/src/main/resources/io/cucumber/core/options/USAGE.txt">Cucumber-JVM</a> documentat for the full set of arguments.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="generated-report"><a class="anchor" href="#generated-report"></a>Generated Report</h3>
<div class="paragraph">
<p>BDD is all about creating a conversation with the domain expert, and that includes providing meaningful feedback as to whether the spec is passing or failing.</p>
</div>
<div class="paragraph">
<p>The <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a>'s <code>webapp</code> module uses a Maven plugin to generate a snazzy HTML website based on the contents of the <code>.json</code> file emitted by the <a href="#cucumber-cli">Cucumber CLI</a>.</p>
</div>
<div class="paragraph">
<p>The plugin&#8217;s configuration is:</p>
</div>
<div class="listingblock">
<div class="title">webapp/pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;plugin&gt;
  &lt;groupId&gt;net.masterthought&lt;/groupId&gt;
  &lt;artifactId&gt;maven-cucumber-reporting&lt;/artifactId&gt;
  &lt;version&gt;${maven-cucumber-reporting.version}&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;id&gt;default&lt;/id&gt;
      &lt;phase&gt;post-integration-test&lt;/phase&gt;
      &lt;goals&gt;
        &lt;goal&gt;generate&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;projectName&gt;SimpleApp&lt;/projectName&gt;
        &lt;outputDirectory&gt;${project.build.directory}&lt;/outputDirectory&gt;
        &lt;inputDirectory&gt;${project.build.directory}&lt;/inputDirectory&gt;
        &lt;jsonFiles&gt;
          &lt;param&gt;**/cucumber-no-clobber.json&lt;/param&gt;
        &lt;/jsonFiles&gt;
        &lt;skip&gt;${skipBDD}&lt;/skip&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how this reads the same file that was generated by Cucumber CLI.</p>
</div>
<div class="paragraph">
<p>The report generated by <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> looks like this:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/bdd-report.png"><img src="_images/bdd-report.png" alt="bdd report" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The idea is that this could then be published to a webserver to create an information radiator.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2020 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20200331-0400-393966e9</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
