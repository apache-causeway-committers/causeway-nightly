<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Architecture Test Support :: Apache Isis</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../../.." title="Apache Isis">
  <link rel="next" href="../h2console/about.html" title="H2 Console">
  <link rel="prev" href="../fakedata/about.html" title="Fakedata">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
          <span class="icon">
            <img src="../../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item hide-for-print">
          <span>
            <input id="algolia-search-input" placeholder="Search"></span>
          </span>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/demo/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/2.0.0-M7/about.html">Setup Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-M7/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/2.0.0-M7/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/2.0.0-M7/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/2.0.0-M7/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../../vro/2.0.0-M7/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjpa/2.0.0-M7/about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../../pjdo/2.0.0-M7/about.html">JDO (DataNucleus)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-M7/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Libraries</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">For Use in Apps</span>
            <a class="navbar-item" href="../../../subdomains/2.0.0-M7/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../../valuetypes/2.0.0-M7/about.html">Value Type Catalog</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Integrate between Apps</span>
            <a class="navbar-item" href="../../../mappings/2.0.0-M7/about.html">Bounded Context Mapping Libraries</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extending the framework itself</span>
            <a class="navbar-item" href="../../../extensions/2.0.0-M7/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/2.0.0-M7/about.html">Release Notes</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M7/archive/1-x.html">Archive (1.x)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Framework</span>
            <a class="navbar-item" href="../../../conguide/2.0.0-M7/about.html">Contributors' Guide</a>
            <a class="navbar-item" href="../../../comguide/2.0.0-M7/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../core/2.0.0-M7/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/2.0.0-M7/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="../fakedata/about.html" title="Fakedata"><span></span></a>
  <a class="page-next" rel="next"
     href="../h2console/about.html" title="H2 Console"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Fakedata"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unittestsupport/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../integtestsupport/about.html">Integ Test Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/domain-model-validator.html">Domain Model Validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../integtestsupport/swagger-exporter.html">Swagger Exporter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../specsupport/about.html">BDD Spec Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fixtures/about.html">Fixture Scripts</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fakedata/about.html">Fakedata</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="about.html">Architecture Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../h2console/about.html">H2 Console</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../hsqldbmgr/about.html">HSQLDB Manager</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mapping Libraries</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mappings/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../subdomains/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tooling</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../tooling/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Testing Guide</a></li>
    <li><a href="about.html">Architecture Test Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/master/testing/archtestsupport/adoc/modules/archtestsupport/pages/about.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Architecture Test Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis provides a library of <a href="https://www.archunit.org/">ArchUnit</a> tests to verify the structure of your domain applications.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven-configuration"><a class="anchor" href="#maven-configuration"></a>Maven Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependency-management"><a class="anchor" href="#dependency-management"></a>Dependency Management</h3>
<div class="paragraph">
<p>If your application inherits from the Apache Isis starter app (<code>org.apache.isis.app:isis-app-starter-parent</code>) then that will define the version automatically:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parent&gt;
    &lt;groupId&gt;org.apache.isis.app&lt;/groupId&gt;
    &lt;artifactId&gt;isis-app-starter-parent&lt;/artifactId&gt;
    &lt;version&gt;2.0.0-M7&lt;/version&gt;
    &lt;relativePath/&gt;
&lt;/parent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, import the core BOM.
This is usually done in the top-level parent pom of your application:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.isis.core&lt;/groupId&gt;
            &lt;artifactId&gt;isis-core&lt;/artifactId&gt;
            &lt;version&gt;2.0.0-M7&lt;/version&gt;
            &lt;scope&gt;import&lt;/scope&gt;
            &lt;type&gt;pom&lt;/type&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, add a section for the BOM of all the testing support libraries:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencyManagement&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
        	&lt;groupId&gt;org.apache.isis.testing&lt;/groupId&gt;
	        &lt;artifactId&gt;isis-testing&lt;/artifactId&gt;
            &lt;scope&gt;import&lt;/scope&gt;
            &lt;type&gt;pom&lt;/type&gt;
            &lt;version&gt;2.0.0-M7&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/dependencyManagement&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h3>
<div class="paragraph">
<p>In the webapp module(s) of your application, add the following dependency:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.apache.isis.testing&lt;/groupId&gt;
        &lt;artifactId&gt;isis-testing-archtestsupport-applib&lt;/artifactId&gt;
        &lt;scope&gt;test&lt;/scope&gt;     <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>this assumes that the architecture tests reside in <code>src/test/java</code> (but see notes on excluding tests, in the <a href="#architecture_test-boilerplate">next section</a>).</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture_test-boilerplate"><a class="anchor" href="#architecture_test-boilerplate"></a>Architecture_Test Boilerplate</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s generally sufficient to have a single <code>Architecture_Test</code> class that runs all architecture tests against all classes.
This should look something like:</p>
</div>
<div class="listingblock">
<div class="title">ArchitectureTests.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.tngtech.archunit.junit.ArchTest;
import com.tngtech.archunit.lang.ArchRule;

import static org.apache.isis.testing.archtestsupport.applib.domainrules.ArchitectureDomainRules.*;

@AnalyzeClasses(
    packagesOf = {
        CustomerModule.class                                                <i class="conum" data-value="1"></i><b>(1)</b>
        , OrderModule.class                                                 <i class="conum" data-value="1"></i><b>(1)</b>
        , ProductModule.class                                               <i class="conum" data-value="1"></i><b>(1)</b>
    },
    importOptions = { ImportOption.DoNotIncludeTests.class }                <i class="conum" data-value="2"></i><b>(2)</b>
)
public class Architecture_Test {                                            <i class="conum" data-value="3"></i><b>(3)</b>

  @ArchTest                                                                 <i class="conum" data-value="4"></i><b>(4)</b>
  public static ArchRule every_DomainObject_must_specify_logicalTypeName =  <i class="conum" data-value="5"></i><b>(5)</b>
      every_DomainObject_must_specify_logicalTypeName();                    <i class="conum" data-value="6"></i><b>(6)</b>

  ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the modules of the application to be scanned</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>excludes running against the tests themselves.
But see caveat, below.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Recommended name.
Architecture tests run quickly, so it generally makes sense to name them as <a href="../unittestsupport/about.html" class="page">unit tests</a> (with a <code>Test</code> suffix, to be picked up by surefire).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>indicates this is an architecture test.
There can be many such tests in a single file; all are expressed as <code>static</code> fields.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>the field name is unimportant (but must be unique, of course).</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>the architecture test itself, imported from <code>ArchitectureXxxRules</code></td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Don&#8217;t architecture check your tests</div>
<div class="paragraph">
<p>In theory tests can be skipped from checking using the <code>ImportOption.DoNotIncludeTests</code> annotation shown above.</p>
</div>
<div class="paragraph">
<p>If this does not work for you, consider creating a separate Maven module as a peer of your webapp, and place the architecture tests in <code>src/main/java</code>.
Also remember to change the <code>&lt;scope&gt;test&lt;/scope&gt;</code> to <code>&lt;scope&gt;compile&lt;/scope&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="domain-rules"><a class="anchor" href="#domain-rules"></a>Domain rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Checks for rules defined against domain classes reside in the <code>ArchitectureDomainRules</code> library.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Strongly Recommended</p>
<div class="ulist">
<ul>
<li>
<p>logical type name</p>
<div class="paragraph">
<p>This ensures that persisted/serialized bookmarks of domain objects are stable even if the domain class' physical canonical name changes over time due to refactoring etc.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_DomainObject_must_specify_logicalTypeName()</code></p>
</li>
<li>
<p><code>every_DomainService_must_specify_logicalTypeName()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>JAXB view models are annotated with <code>@DomainObject(nature=VIEW_MODEL)</code></p>
<div class="paragraph">
<p>This ensures that the framework is able to correctly detect the view models in the metamodel:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jaxb_view_model_must_also_be_annotated_with_DomainObject_nature_VIEWMODEL()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>allow injected fields in view models (strongly recommended)</p>
<div class="paragraph">
<p>Ensures that view models safely ignore injected services.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_injected_field_of_jaxb_view_model_must_be_annotated_with_XmlTransient()</code></p>
</li>
<li>
<p><code>every_injected_field_of_serializable_view_model_must_be_transient()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Recommended</p>
<div class="ulist">
<ul>
<li>
<p>consistency with repository finders</p>
<div class="paragraph">
<p>Requires that the caller of a repository finder handle the case that there may be no such object in the database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_finder_method_in_Repository_must_return_either_Collection_or_Optional()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>mixin naming and coding conventions</p>
<div class="paragraph">
<p>For teams that rely on the <code>Mixee_memberName</code> convention to find mixins of domain objects:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_Action_mixin_must_follow_naming_convention()</code></p>
</li>
<li>
<p><code>every_Property_mixin_must_follow_naming_convention()</code></p>
</li>
<li>
<p><code>every_Collection_mixin_must_follow_naming_convention()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional</p>
<div class="ulist">
<ul>
<li>
<p>layout annotations</p>
<div class="paragraph">
<p>For teams that prefer to use annotations instead of layout files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_DomainObject_must_also_be_annotated_with_DomainObjectLayout()</code></p>
</li>
<li>
<p><code>every_DomainService_must_also_be_annotated_with_DomainServiceLayout()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>repository class naming/annotation conventions (optional)</p>
<div class="paragraph">
<p>For teams that prefer that repositories are easily identifiable by their name <code>XxxRepository</code>, (and are annotated accordingly):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_Repository_must_follow_naming_conventions()</code></p>
</li>
<li>
<p><code>every_class_named_Repository_must_be_annotated_correctly()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>controller class naming/annotation conventions (optional)</p>
<div class="paragraph">
<p>For teams that prefer that custom controllers are easily identifiable by their name <code>XxxController</code>, (and are annotated accordingly):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_Controller_must_be_follow_naming_conventions()</code></p>
</li>
<li>
<p><code>every_class_named_Controller_must_be_annotated_correctly()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>None of these rules take any arguments, so simply include (as a static field) those that you wish to enforce.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="entity-checks"><a class="anchor" href="#entity-checks"></a>Entity Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Entity rule checks are provided for both <a href="../../../pjpa/latest/about.html" class="page">JPA/Eclipselink</a> and <a href="../../../pjdo/latest/about.html" class="page">JDO/DataNucleus</a>, in <code>ArchitectureJpaRules</code> and <code>ArchitectureJdoRules</code> respectively:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Strongly Recommended</p>
<div class="ulist">
<ul>
<li>
<p>ensure JPA entities can support auditing and dependency injection:</p>
<div class="paragraph">
<p>Required in almost all cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_be_annotated_as_an_IsisEntityListener()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure entities can be referenced in JAXB view models:</p>
<div class="paragraph">
<p>Required to allow JAXB view models to transparently reference entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_be_annotated_with_XmlJavaAdapter_of_PersistentEntityAdapter()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_be_annotated_as_XmlJavaAdapter_PersistentEntityAdapter()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure JPA entity defines a surrogate key:</p>
<div class="paragraph">
<p>Enforces a very common convention for JPA entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_have_an_id_field()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Recommended</p>
<div class="ulist">
<ul>
<li>
<p>encourage entities be organised into schemas:</p>
<div class="paragraph">
<p>for teams adopting a "(micro) service-oriented" mindset:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_be_annotated_as_Table_with_schema()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_have_schema()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure JPA enum fields are persisted as strings:</p>
<div class="paragraph">
<p>For teams that prefer to query the database with enum values persisted as strings rather than as ordinal numbers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_enum_field_of_jpa_Entity_must_be_annotated_with_Enumerable_STRING()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure entities can be used in <code>SortedSet</code> parented collections:</p>
<div class="paragraph">
<p>For teams that like to use <code>SortedSet</code> for parented collections, and rely on the entity to render itself in a "sensible" order:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_implement_Comparable()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_implement_Comparable()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure entities have a unique business key:</p>
<div class="paragraph">
<p>For teams that insist on business keys in addition to surrogate keys</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_be_annotated_as_Table_with_uniqueConstraints()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_be_annotated_as_Uniques_or_Unique()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Optional</p>
<div class="ulist">
<ul>
<li>
<p>ensure conformance of persistence vs Isis annotations</p>
<div class="paragraph">
<p>For teams that like to emphasise entities vs view models:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_be_annotated_with_DomainObject_nature_of_ENTITY()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_be_annotated_with_DomainObject_nature_of_ENTITY</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>ensure if JDO entity has a surrogate key then its annotations are consistent:</p>
<div class="paragraph">
<p>For teams that like to be explicit about the use of surrogate keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jdo_PersistenceCapable_with_DATASTORE_identityType_must_be_annotated_as_DataStoreIdentity()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>enable injected fields in entities:</p>
<div class="paragraph">
<p>For teams that use type-safe queries (and want to ensure that services do not appear superfluously as fields in the "QXxx" classes):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_injected_field_of_jpa_Entity_must_be_annotated_with_Transient()</code></p>
</li>
<li>
<p><code>every_injected_field_of_jdo_PersistenceCapable_must_be_annotated_with_NotPersistent()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>encourage optimistic locking:</p>
<div class="paragraph">
<p>For teams that prefer optimistic locking as a standard everywhere:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_have_a_version_field()</code></p>
</li>
<li>
<p><code>every_jdo_PersistenceCapable_must_be_annotated_with_Version()</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>encourage static factory methods for entities:</p>
<div class="paragraph">
<p>For teams that prefer the use of factory methods to vanilla constructors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>every_jpa_Entity_must_have_protected_no_arg_constructor()</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>None of these rules takes any arguments, so simply call those (from a static field) those that you wish to enforce.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="module-rules"><a class="anchor" href="#module-rules"></a>Module Rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The module rules, residing in <code>ArchitectureModuleRules</code> class, are used to check the coarse-grained dependencies between modules <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>, to ensure proper layering.
A further check checks at a more fine-grained level for the placement of classes into subpackages of those modules.</p>
</div>
<div class="sect2">
<h3 id="code_dependencies_follow_module_imports"><a class="anchor" href="#code_dependencies_follow_module_imports"></a>code_dependencies_follow_module_Imports</h3>
<div class="paragraph">
<p>The <code>@Import</code> statements between modules form an acyclic dependency graph.
If there is a cycle between those modules, then Spring itself will fail to boot.</p>
</div>
<div class="paragraph">
<p>This architecture check doesn&#8217;t check the the modules' graph itself, but rather ensures that the dependencies between classes that live within each module honour the direction of the module graph.</p>
</div>
<div class="paragraph">
<p>For example, if the <code>OrderModule</code> depends on (<code>@Import</code>s) the <code>CustomerModule</code>, then we allow for the <code>Order</code> entity to reference the <code>Customer</code> entity.
However, we do not allow the opposite reference.</p>
</div>
<div class="paragraph">
<p>To run the test, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ArchTest
public static ArchRule code_dependencies_follow_module_Imports =
    code_dependencies_follow_module_Imports(                        <i class="conum" data-value="1"></i><b>(1)</b>
        analyzeClasses_packagesOf(Architecture_Test.class));        <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>architecture test itself, imported from <code>ArchitectureModuleRules</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>utility that passes in for all analysis all of the module classes that are annotated on <code>Architecture_Test</code>.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="aside"><a class="anchor" href="#aside"></a>Aside</h4>
<div class="paragraph">
<p>You might well ask: if deleting a customer requires deleting its orders, then how is this done if a customer does not "know" abouts its related orders?</p>
</div>
<div class="paragraph">
<p>There are two main options:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>use a mixin.
Provide a <code>Customer_delete</code> action, but place it in the <code>OrderModule</code>.
That way the mixin code has access to delete the associated <code>Order</code>s</p>
<div class="paragraph">
<p>However, this trick won&#8217;t work if there are multiple referencing modules to customer, all of which need to do their work but none of which know about the other.
For example, if there is also an <code>AddressModule</code> that maintains the customer&#8217;s address, and neither <code>OrderModule</code> nor <code>AddressModule</code> know about the other, then there is no one place to put the mixin that has knowledge of all of the related "stuff" of customer to be dealt with.</p>
</div>
</li>
<li>
<p>use a domain event.</p>
<div class="paragraph">
<p>Here we keep the <code>Customer_delete</code> mixin in the <code>CustomerModule</code> (indeed, it could even be a regular action) and instead it emits a domain event:</p>
</div>
<div class="listingblock">
<div class="title">Customer_delete.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(domainEvent = Customer_delete.ActionEvent.class)
@RequiredArgsConstructor
public class Customer_delete {
    public static class ActionEvent                     <i class="conum" data-value="1"></i><b>(1)</b>
        extends ActionDomainEvent&lt;Customer_delete&gt;{}
    private final Customer customer;
    public void act() {
        customerRepo.delete(customer);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>event to be fired.</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="module-package-tests"><a class="anchor" href="#module-package-tests"></a>Module Package Tests</h3>
<div class="paragraph">
<p>The module package tests builds upon the module layering tests and <em>also</em> checks that that each class is in the appropriate subpackage within each module, and that those subpackages access only the allowed subpackages of its own module or of other modules.
Different sets of subpackages can be defined for both the "local" (same) module and "foreign" (referencing) modules.</p>
</div>
<div class="paragraph">
<p>Because different teams will undoubtedly have different standards, the exact rules for subpackages are pluggable, with the <code>Subpackage</code> interface defining the information that the architecture test requires:</p>
</div>
<div class="listingblock">
<div class="title">Subpackage</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Subpackage {

    String getName();                                               <i class="conum" data-value="1"></i><b>(1)</b>
    List&lt;String&gt; mayBeAccessedBySubpackagesInSameModule();          <i class="conum" data-value="2"></i><b>(2)</b>
    List&lt;String&gt; mayBeAccessedBySubpackagesInReferencingModules();  <i class="conum" data-value="3"></i><b>(3)</b>

    default String packageIdentifier() {                            <i class="conum" data-value="4"></i><b>(4)</b>
        return "." + getName() + "..";
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The name of the subpackage, for example "dom", "api", "spi" or "fixtures".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>A list of the (names of the) subpackages where classes in the same module as this package have access.
<div class="paragraph">
<p>For example, the "dom" subpackage can probably be referenced from the "menu" subpackage, but not vice versa.</p>
</div>
<div class="paragraph">
<p>The special value of "*" is a wildcard meaning that all subpackages (in the same module) can access.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>A list of the (names of the) subpackages where classes in the packages of other referencing modules may have access.
<div class="paragraph">
<p>For example, in some cases the the "dom" subpackage may &lt;i&gt;not&lt;/i&gt; be accessible from other modules if the intention is to require all programmatic access through an "api" subpackage (where the classes in <code>dom</code> implement interfaces defined in <code>api</code>).</p>
</div>
<div class="paragraph">
<p>The special value of "*" is a wildcard meaning that all subpackages (in other modules) can access.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>allows a subpackage to more precisely control the classes that it includes.
Useful if want to declare a subpackage representing that of the module&#8217;s own package (where the <code>XxxModule</code> class resides).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>SubpackageEnum</code> provides an off the shelf implementation; you will probably want to copy this and adjust as necessary.</p>
</div>
<div class="paragraph">
<p>To run the test, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ArchTest
public static ArchRule code_deps_follow_module_Imports_and_subpackage_rules =
      code_dependencies_follow_module_Imports_and_subpackage_rules(     <i class="conum" data-value="1"></i><b>(1)</b>
          analyzeClasses_packagesOf(ModulesArchTests.class),            <i class="conum" data-value="2"></i><b>(2)</b>
          asList(SimplifiedSubpackageEnum.values()));                   <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>architecture test itself, imported from <code>ArchitectureModuleRules</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>utility that passes in for all analysis all of the module classes that are annotated on <code>Architecture_Test</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>list of the <code>Subpackage</code>s whose relationships are to be checked</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>where for example <code>Subpackage</code> is implemented using with:</p>
</div>
<div class="listingblock">
<div class="title">SimplifiedSubpackageEnum.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequiredArgsConstructor
public enum SimplifiedSubpackageEnum implements Subpackage {

    dom(
            singletonList("*"),         <i class="conum" data-value="1"></i><b>(1)</b>
            emptyList()                 <i class="conum" data-value="2"></i><b>(2)</b>
    ),
    api(
            singletonList("*"),         <i class="conum" data-value="1"></i><b>(1)</b>
            singletonList("*")          <i class="conum" data-value="3"></i><b>(3)</b>
    ),
    spi(
            singletonList("dom"),       <i class="conum" data-value="4"></i><b>(4)</b>
            singletonList("spiimpl")    <i class="conum" data-value="5"></i><b>(5)</b>
    ),
    spiimpl(
            emptyList(),                <i class="conum" data-value="6"></i><b>(6)</b>
            emptyList()                 <i class="conum" data-value="2"></i><b>(2)</b>
    ),
    ;

    final List&lt;String&gt; local;
    final List&lt;String&gt; referencing;

    @Override
    public String getName() { return name(); }

    @Override
    public List&lt;String&gt; mayBeAccessedBySubpackagesInSameModule() {
        return local;
    }
    @Override
    public List&lt;String&gt; mayBeAccessedBySubpackagesInReferencingModules() {
        return referencing;
    }
    private static String[] asArray(List&lt;String&gt; list) {
        return list != null ? list.toArray(new String[] {}) : null;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>wildcard means that all subpackages in this module can access this module</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>no direct access from other modules</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>wildcard means that all subpackages in other modules can access this module</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>callers of a module&#8217;s own SPI</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>other modules should only implement the SPI</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>no direct access from <em>this</em> module</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. By "module" we mean a classes annotated with <code>@Configuration</code>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright Â© 2010~2021 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M6.20210904-0228-765b9940</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'isis-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
