<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Integration Test Support :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../../.." title="Apache Isis">
  <link rel="next" href="domain-model-validator.html" title="Domain Model Validator">
  <link rel="prev" href="../unittestsupport/about.html" title="Unit Test Support">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
          <span class="icon">
            <img src="../../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item hide-for-print">
          <span>
            <input id="algolia-search-input" placeholder="Search"></span>
          </span>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/demo/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/2.0.0-M4/about.html">Setup Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-M4/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/2.0.0-M4/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/2.0.0-M4/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Libraries</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">For Use in Apps</span>
            <a class="navbar-item" href="../../../subdomains/2.0.0-M4/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../../valuetypes/2.0.0-M4/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Integrate between Apps</span>
            <a class="navbar-item" href="../../../mappings/2.0.0-M4/about.html">Bounded Context Mapping Libraries</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Other</span>
            <a class="navbar-item" href="../../../incubator/2.0.0-M4/about.html">Incubator</a>
            <a class="navbar-item" href="../../../legacy/2.0.0-M4/about.html">Legacy</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/2.0.0-M4/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../../vro/2.0.0-M4/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-M4/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjdo/2.0.0-M4/about.html">DataNucleus (JDO)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../../extensions/2.0.0-M4/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/2.0.0-M4/about.html">Release Notes</a>
            <a class="navbar-item" href="../../../docs/2.0.0-M4/archive/1-x.html">Archive (1.x)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Framework</span>
            <a class="navbar-item" href="../../../conguide/2.0.0-M4/about.html">Contributors' Guide</a>
            <a class="navbar-item" href="../../../comguide/2.0.0-M4/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../core/2.0.0-M4/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/2.0.0-M4/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="testing" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="../unittestsupport/about.html" title="Unit Test Support"><span></span></a>
  <a class="page-next" rel="next"
     href="domain-model-validator.html" title="Domain Model Validator"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Unit Test Support"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Testing Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../unittestsupport/about.html">Unit Test Support</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Integ Test Support</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="domain-model-validator.html">Domain Model Validator</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="swagger-exporter.html">Swagger Exporter</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../specsupport/about.html">BDD Spec Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../fixtures/about.html">Fixture Scripts</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/ExecutionParametersService.html">ExecutionParametersService</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/FixtureScripts.html">FixtureScripts</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../fixtures/services/FixtureScriptsSpecificationProvider.html">FixtureScriptsSpecificationProvider</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../fakedata/about.html">Fakedata</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../h2console/about.html">H2 Console</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../h2console/services/H2ManagerMenu.html">H2ManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../hsqldbmgr/about.html">HSQLDB Manager</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Domain Services</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../hsqldbmgr/services/HsqlDbManagerMenu.html">HsqlDbManagerMenu</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Testing Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mappings Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mappings/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../legacy/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../subdomains/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Testing Guide</a></li>
    <li><a href="about.html">Integ Test Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/testing/integtestsupport/adoc/modules/integtestsupport/pages/about.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Integration Test Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis builds on top of Spring Boot&#8217;s integration testing support, in particular using <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/context/SpringBootTest.html">@SpringBootTest</a>.
This configures and bootstraps the Apache Isis runtime, usually running against an in-memory database.</p>
</div>
<div class="paragraph">
<p>On top of that, we usually:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <a href="../fixtures/about.html" class="page">fixture scripts</a> to set up the app&#8217;s initial state</p>
</li>
<li>
<p>use the <a href="../../../refguide/latest/applib-svc/WrapperFactory.html" class="page">WrapperFactory</a> to simulate the UI.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To explain further, let&#8217;s walk through of the <a href="../../../docs/latest/starters/simpleapp.html" class="page">SimpleApp</a> starter app.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bootstrapping"><a class="anchor" href="#bootstrapping"></a>Bootstrapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We typically put the bootstrapping of Apache Isis into a superclass, one for each Maven module.
This allows an individual "slice" of the application to be tested, rather than as a monolith.</p>
</div>
<div class="paragraph">
<p>So, for the <code>module-simple</code> module, we have:</p>
</div>
<div class="listingblock">
<div class="title">SimpleModuleIntegTestAbstract.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(
        classes = SimpleModuleIntegTestAbstract.AppManifest.class
)
@TestPropertySource({
        IsisPresets.H2InMemory_withUniqueSchema,
        IsisPresets.DataNucleusAutoCreate,
        IsisPresets.UseLog4j2Test,
})
public abstract class SimpleModuleIntegTestAbstract extends IsisIntegrationTestAbstractWithFixtures {

    @Configuration
    @Import({
        IsisModuleCoreRuntimeServices.class,
        IsisModuleSecurityBypass.class,
        IsisModuleJdoDataNucleus5.class,
        IsisModuleTestingFixturesApplib.class,
        SimpleModule.class                      <i class="conum" data-value="1"></i><b>(1)</b>
    })
    public static class AppManifest {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>references just the <code>SimpleModule</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>while in the <code>webapp</code> module we have:</p>
</div>
<div class="listingblock">
<div class="title">ApplicationIntegTestAbstract.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@SpringBootTest(
        classes = ApplicationIntegTestAbstract.AppManifest.class
)
@TestPropertySource({
        IsisPresets.H2InMemory_withUniqueSchema,
        IsisPresets.DataNucleusAutoCreate,
        IsisPresets.UseLog4j2Test,
})
@ContextConfiguration
public abstract class ApplicationIntegTestAbstract extends IsisIntegrationTestAbstract {

    @Configuration
    @Import({
        IsisModuleCoreRuntimeServices.class,
        IsisModuleJdoDataNucleus5.class,
        IsisModuleSecurityBypass.class,
        IsisModuleTestingFixturesApplib.class,
        ApplicationModule.class                 <i class="conum" data-value="1"></i><b>(1)</b>
    })
    public static class AppManifest {
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>references the top-level <code>ApplicationModule</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can see that these are very similar, what&#8217;s different is the module referenced.</p>
</div>
<div class="paragraph">
<p>They both also force an in-memory database, with JDO/DataNucleus ORM configured to autocreate the database schema.</p>
</div>
<div class="sect2">
<h3 id="faster-bootstrapping"><a class="anchor" href="#faster-bootstrapping"></a>Faster bootstrapping</h3>
<div class="paragraph">
<p>By default integration tests are run in "production" deployment mode.
With the <code>isis.core.meta-model.introspector.mode=</code> set to its default value, this results in full introspection of the Apache Isis metamodel.</p>
</div>
<div class="paragraph">
<p>While this <em>does</em> have the benefit that the metamodel will be validated, the downside is that the test takes longer to bootstrap.</p>
</div>
<div class="paragraph">
<p>To bootstrap lazily, set the property to 'lazy'.
This can be done by adding:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@TestPropertySource(IsisPresets.IntrospectLazily)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="typical-usage"><a class="anchor" href="#typical-usage"></a>Typical Usage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s now drill down and look at <code>SimpleObject_IntegTest</code>, which (not surprisingly) is the integration test that exercises the <code>SimpleObject</code> class:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Transactional                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
public class SimpleObject_IntegTest extends SimpleModuleIntegTestAbstract {     <i class="conum" data-value="2"></i><b>(2)</b>

    SimpleObject simpleObject;

    @BeforeEach                                                                 <i class="conum" data-value="3"></i><b>(3)</b>
    public void setUp() {
        // given
        simpleObject = fixtureScripts.runPersona(SimpleObject_persona.FOO);     <i class="conum" data-value="4"></i><b>(4)</b>
    }

    //...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Spring <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> annotation means that any changes made in the database will be rolled back automatically.
There&#8217;s further discussion <a href="#manual-teardown">below</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>inherits from the module-level abstract class (which in turn will be annotated with <code>@SpringBootTest</code>, see <a href="#bootstrapping">bootstrapping</a> earlier).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>uses JUnit 5</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>uses a <a href="../fixtures/about.html" class="page">fixture script</a> to setup the database.
The <code>FixtureScripts</code> domain service is inherited from the superclass.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="testing-a-property"><a class="anchor" href="#testing-a-property"></a>Testing a property</h3>
<div class="paragraph">
<p>For example, let&#8217;s test the <code>SimpleObject#name</code> property:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import lombok.Getter;
import lombok.Setter;

@DomainObject()
public class SimpleObject
    ...
    @Getter @Setter
    @Name private String name;
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Properties are visible but unmodifiable by default
We therefore have two tests for each of these facts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Non-editable properties is change from Isis v1.x.
Use the <code>isis.applib.annotation.domain-object.editing</code> configuration property to pverride.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By convention, we group tests into nested static classes, so the corresponding integration test is:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleObject_IntegTest extends SimpleModuleIntegTestAbstract {
    ...
    public static class name extends SimpleObject_IntegTest {   <i class="conum" data-value="1"></i><b>(1)</b>

        @Test
        public void accessible() {
            // when
            final String name = wrap(simpleObject).getName();   <i class="conum" data-value="2"></i><b>(2)</b>

            // then
            assertThat(name).isEqualTo(simpleObject.getName()); <i class="conum" data-value="3"></i><b>(3)</b>
        }

        @Test
        public void not_editable() {

            // expect
            assertThrows(DisabledException.class, ()-&gt;{         <i class="conum" data-value="4"></i><b>(4)</b>

                // when
                wrap(simpleObject).setName("new name");
            });
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>inherit from <code>SimpleObject_IntegTest</code>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
JUnit 5&#8217;s <code>@Nested</code> annotation doesn&#8217;t work here.
</td>
</tr>
</table>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>we use the <a href="#wrapper-factory">WrapperFactory</a> to access the domain object.
<div class="paragraph">
<p>This will check that property (for access) is visible to the current user.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>we use <a href="http://joel-costigliola.github.io/assertj">AssertJ</a> for assertions.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>attempting to set the name on the property (through the wrapper) is disallowed.
We detect this by catching a <code>DisabledException</code> (using JUnit 5&#8217;s <code>assertThrows()</code>).</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-an-action"><a class="anchor" href="#testing-an-action"></a>Testing an action</h3>
<div class="paragraph">
<p>The way that the simple app allows the name to be updated is through an <code>updateName</code> action:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@DomainObject()
public class SimpleObject
    ...
    public static class UpdateNameActionDomainEvent extends SimpleObject.ActionDomainEvent {}
    @Action(...
            domainEvent = UpdateNameActionDomainEvent.class)                <i class="conum" data-value="1"></i><b>(1)</b>
    public SimpleObject updateName(
            @Name final String name) {                                      <i class="conum" data-value="2"></i><b>(2)</b>
        setName(name);                                                      <i class="conum" data-value="3"></i><b>(3)</b>
        return this;
    }
    public String default0UpdateName() {                                    <i class="conum" data-value="4"></i><b>(4)</b>
        return getName();
    }
    ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>an event will be emitted whenever the action is interacted with</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>(the <code>@Name</code> annotation is discussed later)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the business functionality to be tested.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>(we normally test default methods using unit tests).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The corresponding integration test is:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleObject_IntegTest extends SimpleModuleIntegTestAbstract {
    ...
    public static class updateName extends SimpleObject_IntegTest {

        @DomainService                                                      <i class="conum" data-value="1"></i><b>(1)</b>
        public static class UpdateNameListener {

            @Getter
            List&lt;SimpleObject.UpdateNameActionDomainEvent&gt; events = new ArrayList&lt;&gt;();

            @EventListener(SimpleObject.UpdateNameActionDomainEvent.class)
            public void on(SimpleObject.UpdateNameActionDomainEvent ev) {
                events.add(ev);
            }
        }

        @Inject
        UpdateNameListener updateNameListener;

        @Test
        public void can_be_updated_directly() {

            // given
            updateNameListener.getEvents().clear();

            // when
            wrap(simpleObject).updateName("new name");                      <i class="conum" data-value="2"></i><b>(2)</b>
            transactionService.flushTransaction();

            // then
            assertThat(wrap(simpleObject).getName()).isEqualTo("new name"); <i class="conum" data-value="3"></i><b>(3)</b>
            assertThat(updateNameListener.getEvents()).hasSize(5);          <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>defines a domain service to detect the domain events emitted when interacting with the action (through the wrapper).
<div class="paragraph">
<p>This domain service is not part of the production code base, but is detected automatically thanks to <code>@ComponentScan</code> on the <code>SimpleModule</code>.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>interact with the action through the wrapper</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>verify the object was updated correctly</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>verify that the domain events were emitted.
<div class="paragraph">
<p>Since this was a successful interaction, there will have been 5 events, one for each of the event phases (hide, disable, validate, executing, executed)</p>
</div></td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="testing-a-type-meta-annotation"><a class="anchor" href="#testing-a-type-meta-annotation"></a>Testing a type meta-annotation</h3>
<div class="paragraph">
<p>As was pointed out earlier, the <code>name</code> parameter to <code>updateName()</code> has the <code>@Name</code> meta-annotation.
This meta-annotation also defines some business rules, through <code>@Property</code> and <code>@Parameter</code>:</p>
</div>
<div class="listingblock">
<div class="title">Name.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(mustSatisfy = Name.NoExclamationMarks.class, maxLength = Name.MAX_LEN)
@Parameter(mustSatisfy = Name.NoExclamationMarks.class, maxLength = Name.MAX_LEN)
@ParameterLayout(named = "Name")
...
public @interface Name {

    int MAX_LEN = 40;

    class NoExclamationMarks extends AbstractSpecification2&lt;String&gt; {

        @Override
        public TranslatableString satisfiesTranslatableSafely(final String name) {
            return name != null &amp;&amp; name.contains("!")
                    ? TranslatableString.tr("Exclamation mark is not allowed")
                            : null;
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We test this by checking the wrapper throws an <code>InvalidException</code>:</p>
</div>
<div class="listingblock">
<div class="title">SimpleObject_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SimpleObject_IntegTest extends SimpleModuleIntegTestAbstract {
    ...
    public static class updateName extends SimpleObject_IntegTest {
        ...
        @Test
        public void failsValidation() {

            // expect
            InvalidException cause = assertThrows(InvalidException.class, ()-&gt;{

                // when
                wrap(simpleObject).updateName("new name!");
            });

            // then
            assertThat(cause.getMessage(), containsString("Exclamation mark is not allowed."));
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some of the methods being called here are inherited from the superclass, so let&#8217;s look at that next.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="isisintegrationtestabstract"><a class="anchor" href="#isisintegrationtestabstract"></a>IsisIntegrationTestAbstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For convenience the framework provides the <code>IsisIntegrationTestAbstract</code> as a base class for integration tests.</p>
</div>
<div class="paragraph">
<p>This is the class that provides the <code>wrap(&#8230;&#8203;)</code> method (as see in the <a href="#typical-usage">previous section</a>).
It also provides a number of other convenience methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wrap()</code> - as just mentioned.
Also has an alias of <code>w()</code>.</p>
</li>
<li>
<p><code>unwrap()</code> - to unwrap.</p>
</li>
<li>
<p><code>mixin()</code> - to instantiate a mixin around a domain object.
Also has an alias of <code>m()</code>.</p>
</li>
<li>
<p><code>wrapMixin()</code> - which naturally enough <code>wrap()</code>s the result of a <code>mixin()</code>.
This has an alias of <code>wm()</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This class also provides a number of injected domain services:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../../refguide/latest/applib-svc/RepositoryService.html" class="page"><code>RepositoryService</code></a></p>
<div class="paragraph">
<p>to query and persist objects through a generic repository</p>
</div>
</li>
<li>
<p><a href="../../../refguide/latest/applib-svc/FactoryService.html" class="page"><code>FactoryService</code></a></p>
<div class="paragraph">
<p>for instantiating domain objects and mixins</p>
</div>
</li>
<li>
<p><a href="../../../refguide/latest/applib-svc/UserService.html" class="page"><code>UserService</code></a></p>
<div class="paragraph">
<p>to acces the current user</p>
</div>
</li>
<li>
<p><a href="../../../refguide/latest/applib-svc/ServiceRegistry.html" class="page"><code>ServiceRegistry</code></a></p>
<div class="paragraph">
<p>to access domain services</p>
</div>
</li>
<li>
<p><a href="#refguide:applib-svc:MetamodelService.adoc" class="page unresolved"><code>MetaModelService</code></a></p>
<div class="paragraph">
<p>to access the metamodel.</p>
</div>
</li>
<li>
<p><a href="../../../refguide/latest/applib-svc/WrapperFactory.html" class="page"><code>WrapperFactory</code></a></p>
<div class="paragraph">
<p>to simulate interactions through the UI.
This is discussed further <a href="#wrapper-factory">below</a>.</p>
</div>
</li>
<li>
<p><a href="../../../refguide/latest/applib-svc/TransactionService.html" class="page"><code>TransactionService</code></a></p>
<div class="paragraph">
<p>for more control over transactions</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The class also defines (as a nested static class) the <code>CommandSupport</code> as a domain service.
If <code>@Import</code>ed into the integration test&#8217;s "app manifest", this ensures that any <code>Command</code>s that are raised as the result of interactions through the wrapper factory are setup correctly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="wrapper-factory"><a class="anchor" href="#wrapper-factory"></a>Wrapper Factory</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="../../../refguide/latest/applib-svc/WrapperFactory.html" class="page"><code>WrapperFactory</code></a> service is responsible for wrapping a domain object in a dynamic proxy, of the same type as the object being proxied.
The role of this wrapper is to simulate the UI.</p>
</div>
<div class="paragraph">
<p>It does this by allowing through method invocations that would be allowed if the user were interacting with the domain object through one of the viewers, but throwing an exception if the user attempts to interact with the domain object in a way that would not be possible if using the UI.
The <code>WrapperFactory</code> uses <a href="https://bytebuddy.net/">ByteBuddy</a> to perform its magic.</p>
</div>
<div class="paragraph">
<p>The mechanics are as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the integration test calls the <code>WrapperFactory</code> to obtain a wrapper for the domain object under test.
This is usually done in the test&#8217;s <code>setUp()</code> method.</p>
</li>
<li>
<p>the test calls the methods on the wrapper rather than the domain object itself</p>
</li>
<li>
<p>the wrapper performs a reverse lookup from the method invoked (a regular <code>java.lang.reflect.Method</code> instance) into the Apache Isis metamodel</p>
</li>
<li>
<p>(like a viewer), the wrapper then performs the "see it/use it/do it" checks, checking that the member is visible, that it is enabled and (if there are arguments) that the arguments are valid</p>
</li>
<li>
<p>if the business rule checks pass, then the underlying member is invoked.
Otherwise an exception is thrown.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The type of exception depends upon what sort of check failed.
It&#8217;s straightforward enough: if the member is invisible then a <code>HiddenException</code> is thrown; if it&#8217;s not usable then you&#8217;ll get a <code>DisabledException</code>, if the args are not valid then catch an <code>InvalidException</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/wrapper-factory.png"><img src="_images/wrapper-factory.png" alt="wrapper factory" width="600px"></a>
</div>
</div>
<div class="sect2">
<h3 id="wrapping-and-unwrapping"><a class="anchor" href="#wrapping-and-unwrapping"></a>Wrapping and Unwrapping</h3>
<div class="paragraph">
<p>Wrapping a domain object is very straightforward; simply call <code>WrapperFactory#wrap(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Customer customer = ...;
Customer wrappedCustomer = wrapperFactory.wrap(wrappedCustomer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Going the other way&#8201;&#8212;&#8201;getting hold of the underlying (wrapped) domain object&#8201;&#8212;&#8201;is just as easy; just call <code>WrapperFactory#unwrap(&#8230;&#8203;)</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Customer wrappedCustomer = ...;
Customer customer = wrapperFactory.unwrap(wrappedCustomer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you prefer, you also can get the underlying object from the wrapper itself, by downcasting to <code>WrappingObject</code> and calling <code>__isis_wrapped()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">Customer wrappedCustomer = ...;
Customer customer = (Customer)((WrappingObject)wrappedCustomer).__isis_wrapped());</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;re not sure that&#8217;s any easier (in fact we&#8217;re certain it looks rather obscure).  Stick with calling <code>unwrap(&#8230;&#8203;)</code>!</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-wrapper"><a class="anchor" href="#using-the-wrapper"></a>Using the wrapper</h3>
<div class="paragraph">
<p>As the wrapper is intended to simulate the UI, only those methods that correspond to the "primary" methods of the domain object&#8217;s members are allowed to be called.
That means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for <strong><em>object properties</em></strong> the test can call the getter or setter method</p>
</li>
<li>
<p>for <strong><em>object collections</em></strong> the test can call the getter to access the contents.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
For this to work properly, the collection should be marked as read-only, generally globally using the <code>isis.applib.annotation.domain-object.editing</code> configuration property.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>for <strong><em>object actions</em></strong> the test can call the action method itself.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a convenience, we also allow the test to call any <code>default&#8230;&#8203;()</code>,<code>choices&#8230;&#8203;()</code> or <code>autoComplete&#8230;&#8203;()</code> method.
These are often useful for obtaining a valid value to use.</p>
</div>
<div class="paragraph">
<p>What the test can&#8217;t call is any of the remaining supporting methods, such as <code>hide&#8230;&#8203;()</code>, <code>disable&#8230;&#8203;()</code> or <code>validate&#8230;&#8203;()</code>.
That&#8217;s because their value is implied by the exception being thrown.</p>
</div>
<div class="paragraph">
<p>The wrapper <em>does</em> also allow the object&#8217;s <code>title()</code> method or its  <code>toString()</code> , however this is little use for objects whose title is built up using the <code>@Title</code> annotation.
Instead, we recommend that your test verifies an object&#8217;s title by calling <code>TitleService#titleOf(&#8230;&#8203;)</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="firing-domain-events"><a class="anchor" href="#firing-domain-events"></a>Firing Domain Events</h3>
<div class="paragraph">
<p>As well as enforcing business rules, the wrapper has another important feature, namely that it will cause domain events to be fired.</p>
</div>
<div class="paragraph">
<p>The walk through of <a href="#typical-usage">SimpleApp</a> above showed how this works.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="manual-teardown"><a class="anchor" href="#manual-teardown"></a>Manual Teardown</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Spring <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> annotation means that any changes made in the database will be rolled back automatically.
Normally this is what we want.
For more on this topic, see the <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#testcontext-tx-enabling-transactions">Spring docs</a>.</p>
</div>
<div class="paragraph">
<p>Sometimes you may want to commit to the database to verify state, eg using Spring&#8217;s <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/testing.html#spring-testing-annotation-commit">@Commit</a> annotation.
In these cases, you&#8217;ll need to manually tear down the database contents afterwards, in readiness for the next test.</p>
</div>
<div class="paragraph">
<p>This can be done using the <a href="../fixtures/about.html" class="page">fixture</a> library&#8217;s <code>ModuleWithFixtures</code> interface:</p>
</div>
<div class="listingblock">
<div class="title">ModuleWithFixtures.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface ModuleWithFixtures {
    default FixtureScript getRefDataSetupFixture() {        <i class="conum" data-value="1"></i><b>(1)</b>
        return FixtureScript.NOOP;
    }
    default FixtureScript getTeardownFixture() {            <i class="conum" data-value="2"></i><b>(2)</b>
        return FixtureScript.NOOP;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Optionally each module can define a <code>FixtureScript</code> which holds immutable "reference data".</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Optionally each module can define a tear-down <code>FixtureScript</code>, used to remove the contents of all of the operational/transactional entities (but ignoring reference data fixtures).</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This should be implemented by module classes, eg as is the case for <code>SimpleModule</code>.</p>
</div>
<div class="listingblock">
<div class="title">SimpleModule.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Configuration
@Import({})
@ComponentScan
public class SimpleModule implements ModuleWithFixtures {

    @Override
    public FixtureScript getTeardownFixture() {
        return new TeardownFixtureAbstract() {
            @Override
            protected void execute(ExecutionContext executionContext) {
                deleteFrom(SimpleObject.class);
            }
        };
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>ModuleWithFixturesService</code> aggregates all these setup and teardown fixtures, honouring the module dependencies:</p>
</div>
<div class="listingblock">
<div class="title">ModuleWithFixtures.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Service
public class ModuleWithFixturesService {
    ...
    public FixtureScript getRefDataSetupFixture() { ... }
    public FixtureScript getTeardownFixture() { ... }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, the setup fixture runs the setup for the "inner-most" "leaf-level" modules with no dependencies first, whereas the teardown fixture runs in the opposite order, with the "outer-most" "top-level" modules torn down first.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validate-metamodel"><a class="anchor" href="#validate-metamodel"></a>Validate MetaModel</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metamodel validation checks for a number of semantic errors with the domain model.
For example, if a supporting method (such as <code>default0UpdateName()</code> in <code>SimpleObject</code>) is misspelt, then this would be flagged.</p>
</div>
<div class="paragraph">
<p>Running up the application will flag any metamodel validation issues, as will running an integration test.
However, depending upon configuration, the metamodel may only be built lazily, meaning that issues will only be detected while the application is running, rather than at bootstrap.</p>
</div>
<div class="paragraph">
<p>The <code>DomainModelValidator</code> is a simple utility class that will fullu rebuild the metamodel if required, and then verify that there are no issues.</p>
</div>
<div class="listingblock">
<div class="title">ValidateDomainModel_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class ValidateDomainModel_IntegTest
        extends ApplicationIntegTestAbstract {

    @Inject ServiceRegistry serviceRegistry;

    @Test
    void validate() {
        new DomainModelValidator(serviceRegistry).assertValid();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see this in action in the <a href="../../../docs/latest/starters/simpleapp.html" class="page">simpleapp</a> starter app:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>change <code>isis.applib.annotation.action.explicit</code> to <code>false</code> in <code>application.yml</code></p>
</li>
<li>
<p>introduce an error, for example by renaming <code>default0UpdateName</code> to <code>default0UpdateFoo</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="swagger-exporter"><a class="anchor" href="#swagger-exporter"></a>Swagger Exporter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>@SpringBootTest(
classes = {
ApplicationIntegTestAbstract.AppManifest.class,
IsisModuleViewerRestfulObjectsJaxrsResteasy4.class
}
)
class SwaggerExport_IntegTest extends ApplicationIntegTestAbstract {</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@Inject ServiceRegistry serviceRegistry;</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>    @Test
    void export() throws IOException {
        new SwaggerExporter(serviceRegistry)
                .export(SwaggerService.Visibility.PRIVATE, SwaggerService.Format.JSON);
    }
}</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven-configuration"><a class="anchor" href="#maven-configuration"></a>Maven Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis' integ test support is most easily configured through a dependency on the <code>isis-mavendeps-integtests</code> module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.mavendeps&lt;/groupId&gt;
    &lt;artifactId&gt;isis-mavendeps-integtests&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;                             <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Normally <code>test</code>; usual Maven scoping rules apply.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will set up integration testing support .
There is no need to specify the version if you inherit from from the <a href="../../../docs/latest/parent-pom/about.html" class="page">Parent POM</a>.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The <a href="../../../docs/latest/parent-pom/about.html" class="page">Parent POM</a> configures the Maven surefire plugin in two separate executions for unit test and fo integ tests.
This relies on a naming convention:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>unit tests, which must have a suffix <code>Test</code>, but excluding &#8230;&#8203;</p>
</li>
<li>
<p>integ tests, which must have the suffix <code>IntegTest</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Not following this convention is likely to cause integ tests to fail.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you just want to set up integration testing support, then use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.isis.core&lt;/groupId&gt;
    &lt;artifactId&gt;isis-core-integtestsupport&lt;/artifactId&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hints-n-tips"><a class="anchor" href="#hints-n-tips"></a>Hints-n-Tips</h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using JDO/DataNucleus</div>
<div class="paragraph">
<p>When running integration tests through the IDE, and if using the JDO/DataNucleus ORM, then make sure the module(s) with entities have been enhanced first.</p>
</div>
<div class="paragraph">
<p>If using IntelliJ, we recommend creating a run Maven configuration that runs <code>datanucleus:enhance</code>, and then pinning the configuration once run as a tab in the "Debug" window for easy access.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/pin-enhance-run-configuration.png"><img src="_images/pin-enhance-run-configuration.png" alt="pin enhance run configuration" width="400px"></a>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2020 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20200412-0400-07f93799</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'isis-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
