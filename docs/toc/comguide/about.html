<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Committers' Guide :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../helloworld/about.html">Hello World</a>
            <a class="navbar-item" href="../../simpleapp/about.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../demoapp/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">User Guide</span>
            <a class="navbar-item" href="../../userguide/about.html">Fundamentals &amp; Beyond</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Reference</span>
            <a class="navbar-item" href="../../refguide/about.html">Reference Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/about.html">Security Guide</a>
            <a class="navbar-item" href="../../ext-secman/about.html">SecMan (extension)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Testing</span>
            <a class="navbar-item" href="../../testing/about.html">Testing Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../vro/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../odn/about.html">DataNucleus Object Store</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../extensions/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../toc/devguide/about.html">Developers' Guide</a>
            <a class="navbar-item" href="../../toc/mavendeps/about.html">Maven dependencies</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Mailing Lists</span>
            <a class="navbar-item" href="../../toc/mailing-list/how-to-subscribe.html">How to subscribe</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">ASF JIRA</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../toc/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/about.html">Release Notes</a>
            <a class="navbar-item" href="../../mignotes/about.html">Migration Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Internal</span>
            <a class="navbar-item" href="../../toc/comguide/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../core/about.html">Core Framework</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">@ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../toc/about.html">
          <span class="icon">
            <img src="../../_/img/isis-logo-48x48.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="toc" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html"> </a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">What is Apache Isis?</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/isis-in-pictures.html">Apache Isis in pictures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/common-use-cases.html">Common Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/screencasts.html">Screencasts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/powered-by.html">Powered By</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Starter Apps</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../starters/helloworld/about.html">HelloWorld</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../starters/simpleapp/about.html">SimpleApp</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Demos &amp; Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../demoapp/about.html">Demo App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../userguide/about.html">User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../refguide/about.html">Reference Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../security/about.html">Security Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../secman/about.html">SecMan (extension)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/about.html">Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../vw/about.html">Wicket UI</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../vro/about.html">Restful Objects (REST API)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../odn/about.html">DataNucleus Object Store</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Catalogs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../extensions/about.html">Extensions Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../incubator/about.html">Incubator Catalog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../legacy/about.html">Legacy Catalog</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../devguide/about.html">Developers' Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mavendeps/about.html">Maven Dependencies</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#toc:mixins:about.adoc">Maven Mixins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#toc:ROOT:mailing-list.adoc#how-to-subscribe">Mailing Lists</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=87">ASF JIRA</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://cwiki.apache.org/confluence/display/ISIS/Index">ASF Wiki</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://fisheye.apache.org/browse/~br=master/isis-git/">ASF Fisheye</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="http://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Releases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/how-to.html">Downloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../relnotes/about.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mignotes/about.html">Migration Notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Internal</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Committers' Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#cutting-a-release">Cutting a Release</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#verifying-releases">Verifying a Release</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/about.html">Core Framework</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../more-thanks/more-thanks.html">Acknowledgements</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title"> </span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Core Framework</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../core/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../extensions/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../incubator/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../legacy/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../refguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Starter Apps</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../starters/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorial App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../userguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html"> </a></li>
    <li>Internal</li>
    <li><a href="about.html">Committers' Guide</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/antora/components/toc/modules/comguide/pages/about.adoc">Edit this Page</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Committers' Guide</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This committers' guide is for committers of Apache Isis itself who want guidance on release process, publishing documents and other related procedures.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="applying-patches"><a class="anchor" href="#applying-patches"></a>Applying Patches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If a patch is received on a JIRA ticket, then it should be reviewed and applied. The commands are slightly different for diff files vs patch files.</p>
</div>
<div class="sect2">
<h3 id="diff-files"><a class="anchor" href="#diff-files"></a>Diff files</h3>
<div class="paragraph">
<p>If a diff file has been provided, then it can easily be applied using eGit&#8217;s wizards (Eclipse&#8217;s Git integration)…</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
FIXME - this stuff needs fleshing out &#8230;&#8203;
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="patch-files"><a class="anchor" href="#patch-files"></a>Patch files</h3>
<div class="paragraph">
<p>If a patch file has been provided, then it can be applied using command line tools.</p>
</div>
<div class="sect3">
<h4 id="inspect-the-patch"><a class="anchor" href="#inspect-the-patch"></a>Inspect the patch</h4>
<div class="paragraph">
<p>First, take a look at what changes are in the patch. You can do this easily with <code>git apply</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git apply --stat ISIS-xxx.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this command does not apply the patch, but only shows you the stats about what itâ€™ll do. After peeking into the patch file with your favorite editor, you can see what the actual changes are.</p>
</div>
<div class="paragraph">
<p>Next, you&#8217;re interested in how troublesome the patch is going to be. Git allows you to test the patch before you actually apply it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git apply --check ISIS-xxx.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t get any errors, the patch has no conflicts. Otherwise you may see what trouble youâ€™ll run into.</p>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-clean-patch"><a class="anchor" href="#apply-a-clean-patch"></a>Apply a (clean) patch</h4>
<div class="paragraph">
<p>To apply a clean patch (adding the items and commit/signoff in a single step), use <code>git am</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git am --signoff &lt; ISIS-xxx.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>This preserves the original author&#8217;s commit message.</p>
</div>
<div class="paragraph">
<p>However, this can fail if the patch file does not contain the original committers email address. In this case you will need to abort the <code>am</code> session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git am abort</code></pre>
</div>
</div>
<div class="paragraph">
<p>and continue on by applying a non-clean patch, as described next.</p>
</div>
</div>
<div class="sect3">
<h4 id="apply-a-non-clean-patch"><a class="anchor" href="#apply-a-non-clean-patch"></a>Apply a (non-clean) patch</h4>
<div class="paragraph">
<p>If the patch does not apply cleanly, then the original authors commit message cannot be preserved. This sequence in this case is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git apply ISIS-xxx.patch</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fix up any issues. The add and commit as usual</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git add .
git commit -am "&lt;original authors' commit message&gt;" --signoff</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--signoff</code> simply adds a line to the commit message indicating you have signed off the commit.</p>
</div>
<div class="paragraph">
<p>Information adapted from <a href="https://ariejan.net/2009/10/26/how-to-create-and-apply-a-patch-with-git/">this blog post</a> and <a href="http://wiki.eclipse.org/Jetty/Contributor/Contributing_Patches">this wiki page</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="merging-a-pull-request"><a class="anchor" href="#merging-a-pull-request"></a>Merging a Pull Request</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The process for merging in github pull requests (so that they can be tested locally before committing) has been scripted in the <code>github-pr.sh</code> script.</p>
</div>
<div class="paragraph">
<p>The script will merge the fork into a temporary branch, and then run a build.  Once you are happy, you can commit.</p>
</div>
<div class="sect2">
<h3 id="process-and-usage"><a class="anchor" href="#process-and-usage"></a>Process and Usage</h3>
<div class="paragraph">
<p>The overall process is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate/raise corresponding JIRA ticket, eg ISIS-1162</p>
</li>
<li>
<p>checkout branch from which PR was forked (usually just 'master')</p>
</li>
<li>
<p>merge PR into temporary branch using the <code>github-pr.sh</code> script</p>
</li>
<li>
<p>test the change locally (run the app, rebuild, manual regression tests etc)</p>
</li>
<li>
<p>if required, tidy up/refactor code as required</p>
</li>
<li>
<p>merge temporary branch into mainline, and commit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This <a href="https://youtu.be/CKSLZBBHjME">screencast</a> also shows the process.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>The script uses 'jq' to parse JSON.  To install:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on Linux:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aptitude install jq</code></pre>
</div>
</div>
</li>
<li>
<p>on MacOS:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">brew install jq</code></pre>
</div>
</div>
</li>
<li>
<p>on Windows:<br></p>
<div class="paragraph">
<p>Download exe from <a href="http://stedolan.github.io/jq/download/">website</a></p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="syntax"><a class="anchor" href="#syntax"></a>Syntax</h3>
<div class="paragraph">
<p>The syntax is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">github-pr.sh -j 1162 -g 31 [-s] [-p ISIS]</code></pre>
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-j 1162</code><br></p>
<div class="paragraph">
<p>is the JIRA ticket number</p>
</div>
</li>
<li>
<p><code>-g 31</code>  <br></p>
<div class="paragraph">
<p>is the github PR issue number</p>
</div>
</li>
<li>
<p><code>-s</code><br></p>
<div class="paragraph">
<p>will optionally skip the build and auto-merge</p>
</div>
</li>
<li>
<p><code>-p ISIS</code><br></p>
<div class="paragraph">
<p>optionally overrids the JIRA project (defaults to 'ISIS')</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="example-transcript"><a class="anchor" href="#example-transcript"></a>Example transcript</h3>
<div class="paragraph">
<p>The listing below shows the steps taken by the script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ sh github-pr.sh isis 1162 31

Found JIRA ticket
Found github PR
branch_name_local: master
username         : sebadiaz
repo_full_name   : sebadiaz/isis
repo_clone_url   : https://github.com/sebadiaz/isis.git
branch_name_fork : master

merging into: ISIS-1162_pr-31

Deleting branch 'ISIS-1162_pr-31'
Deleted branch ISIS-1162_pr-31 (was bd2e3c2).
Creating the branch ISIS-1162_pr-31
Switched to a new branch 'ISIS-1162_pr-31'
Pulling the changes from https://github.com/sebadiaz/isis.git master
From https://github.com/sebadiaz/isis
 * branch            master     -&gt; FETCH_HEAD
Auto-merging core/pom.xml
Merge made by the 'recursive' strategy.
 core/pom.xml                                       |   3 +-
 .../apache/isis/security/shiro/IsisLdapRealm.java  | 198 +++++++++++++++++++--
 2 files changed, 186 insertions(+), 15 deletions(-)

Merged the PR; hit enter to build</code></pre>
</div>
</div>
<div class="paragraph">
<p>The build now commences.  Once done, the script continues:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">If build successful and happy to merge, execute:

git checkout master &amp;&amp; git merge --no-ff ISIS-1162_pr-31 &amp;&amp; git branch -d ISIS-1162_pr-31</code></pre>
</div>
</div>
<div class="paragraph">
<p>The screenshot belows shows the history we end up with:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/committers/github-pr-history.png"><img src="_images/committers/github-pr-history.png" alt="github pr history"></a>
</div>
</div>
<div class="paragraph">
<p>This shows the fork being merged into the temporary branch ("ISIS-1162_pr-31"), then some further tidy-up, and finally the merging of the temporary branch into mainline.</p>
</div>
<div class="paragraph">
<p>Note that there is no rebasing in this model.  This is intentional: when the merged branch is pushed, github will automatically close the original pull request.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cutting-a-release"><a class="anchor" href="#cutting-a-release"></a>Cutting a Release</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The release process consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release manager cutting the release (documented below)</p>
</li>
<li>
<p>Members of the Apache Isis PMC <a href="#verifying-releases">verifying</a> and voting on the release</p>
</li>
<li>
<p>the release manager performing post-release tasks, for either a <a href="#post-release-successful.adoc">successful</a> or an <a href="#toc:comguide:post-release-unsuccessful">unsuccessful</a> vote.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apache Isis itself consists of three separately releasable modules; relative to the <a href="https://github.com/apache/isis">source code root</a> there are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core</code></p>
</li>
<li>
<p><code>component/example/archetypes/helloworld</code></p>
</li>
<li>
<p><code>component/example/archetypes/simpleapp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section details the process for formally releasing Isis modules.  It describes the process for both <code>core</code> and then the archetypes.
The subsequent sections describe how other committers can <a href="#verifying-releases.adoc">verify a release</a> and how the release manager can then perform <a href="#toc:comguide:post-release">post-release</a> activities and set up for the next development iteration.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve not performed a release before, then note that there are some configuration <a href="#release-process-prereqs">prerequisites</a> that must be configured first.
In particular, you&#8217;ll need signed public/private keys, and the ASF Nexus staging repo inlocal <code>~/.m2/settings.xml</code> file.</p>
</div>
<div class="paragraph">
<p>These release notes using bash command line tools.
They should work on Linux and MacOS; for Windows, use mSysGit.</p>
</div>
<div class="sect2">
<h3 id="obtain-consensus"><a class="anchor" href="#obtain-consensus"></a>Obtain Consensus</h3>
<div class="paragraph">
<p>Before releasing <code>core</code>, ensure there is consensus on the <a href="../support.html" class="page">dev mailing list</a> that this is the right time for a release.
The discussion should include confirming the version number to be used, and to confirm content.</p>
</div>
<div class="paragraph">
<p>These discussions should also confirm the version number of the module being released.
This should be in line with our <a href="#versioning-policy">semantic versioning policy</a>.</p>
</div>
<div class="paragraph">
<p>Make sure you have a JIRA ticket open against which to perform all commits.
In most cases a JIRA ticket will have been created at the beginning of the previous release cycle.</p>
</div>
</div>
<div class="sect2">
<h3 id="set-environment-variables"><a class="anchor" href="#set-environment-variables"></a>Set environment variables</h3>
<div class="paragraph">
<p>We use environment variables to parameterize as many of the steps as possible.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp                               <i class="conum" data-value="1"></i><b>(1)</b>
export ISISREL=2.0.0-M3
export ISISRC=RC1
export ISISBRANCH=release-$ISISREL-$ISISRC
export ISISJIRA=ISIS-9999                           <i class="conum" data-value="2"></i><b>(2)</b>
export CATALINA_HOME=/c/java/apache-tomcat-9.0.10   <i class="conum" data-value="3"></i><b>(3)</b>

env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adjust by platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set to an "umbrella" ticket for all release activities.
(One should exist already, <a href="post-release-successful.html#create-new-jira" class="page">created at</a> the beginning of the development cycle now completing).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>adjust as required (Tomcat is used to smoke test the simpleapp archetype)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Obviously, alter <code>$ISISREL</code> as required, and bump <code>$ISISRC</code> for re-releasing following an <a href="#post-release-unsuccessful">unsuccessful</a> release.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the branch name is intentionally <strong>not</strong> the same any of the eventual tag names (eg <code>isis-2.0.0-M3</code> or <code>simpleapp-archetype-2.0.0-M3</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pull-down-code-to-release"><a class="anchor" href="#pull-down-code-to-release"></a>Pull down code to release</h3>
<div class="paragraph">
<p>Set the HEAD of your local git repo to the commit to be released.
This will usually be the tip of the origin&#8217;s <code>master</code> branch.
Then, create a release branch for the version number being released; eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout master
git pull --ff-only
git checkout -b $ISISBRANCH</code></pre>
</div>
</div>
<div class="paragraph">
<p>The release is performed on a branch; if we are successful, this branch will be merged back into master.</p>
</div>
<div class="paragraph">
<p>Check that there are no snapshot dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep SNAPSHOT `/bin/find . -name pom.xml | grep -v target | grep -v mothball | sort`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only mention of <code>SNAPSHOT</code> should be in the <code>revision</code> property of the root <code>core/pom.xml</code> file.</p>
</div>
</div>
<div class="sect2">
<h3 id="bump-revision-property-to-isisrel"><a class="anchor" href="#bump-revision-property-to-isisrel"></a>Bump <code>revision</code> property to <code>$ISISREL</code></h3>
<div class="paragraph">
<p>Previously we used the <code>maven-release-plugin</code> which took responsibility for bumping the <code>&lt;version&gt;</code> from -SNAPSHOT to release, and then onto the next -SNAPSHOT.
However, this plugin does not seem to be compatible with the support for <code>${revision}</code> property introduced in Maven 3.5.0 in order <a href="https://maven.apache.org/maven-ci-friendly.html">to support CI/CD use cases</a>; at least we couldn&#8217;t make it work.</p>
</div>
<div class="paragraph">
<p>So, instead, we perform the edit of <code>${revision}</code> in the three <code>pom.xml</code> files (for <code>core</code> and the two archetypes):</p>
</div>
<div class="paragraph">
<p>Change all of these to the release version, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/version-bump.sh $ISISJIRA $ISISREL</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that they should read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;
    &lt;revision&gt;2.0.0-M3&lt;/revision&gt;
    ...
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After release, there is a <a href="cutting-a-release.html#reset-revision" class="page">similar step at the end</a> to reset back to <code>1.0.0-SNAPSHOT</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="releasing-core"><a class="anchor" href="#releasing-core"></a>Releasing Core</h3>
<div class="paragraph">
<p>First, we release <code>core</code>.
Switch to the appropriate directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd core</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="set-environment-variables-2"><a class="anchor" href="#set-environment-variables-2"></a>Set environment variables</h4>
<div class="paragraph">
<p>Set additional environment variables for the core "artifact":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=isis

env | grep ISIS | sort</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="license-headers"><a class="anchor" href="#license-headers"></a>License headers</h4>
<div class="paragraph">
<p>The Apache Release Audit Tool <code>RAT</code> (from the <a href="http://creadur.apache.org">Apache Creadur</a> project) checks for missing license header files.
The parent <code>pom.xml</code> of each releasable module specifies the RAT Maven plugin, with a number of custom exclusions.</p>
</div>
<div class="paragraph">
<p>To run the RAT tool, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn org.apache.rat:apache-rat-plugin:check -D rat.numUnapprovedLicenses=50 -o &amp;&amp; \
for a in `/bin/find . -name rat.txt -print`; do grep '!???' $a; done || \
for a in `/bin/find . -name rat.txt -print`; do grep '!AL' $a; done</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>rat.numUnapprovedLicenses</code> property is set to a high figure, temporarily overriding the default value of 0.
This will allow the command to run over all submodules, rather than failing after the first one.
The command writes out a <code>target\rat.txt</code> for each submodule.  missing license notes are indicated using the key <code>!???</code>.
The <code>for</code> command collates all the errors.</p>
</div>
<div class="paragraph">
<p>Investigate and fix any reported violations, typically by either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding genuinely missing license headers from Java (or other) source files, or</p>
</li>
<li>
<p>updating the <code>&lt;excludes&gt;</code> element for the <code>apache-rat-plugin</code> plugin to ignore test files, log files and any other non-source code files</p>
</li>
<li>
<p>also look to remove any stale <code>&lt;exclude&gt;</code> entries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you&#8217;ve fixed all issues, confirm once more that <code>apache-rat-plugin</code> no longer reports any license violations, this time leaving the <code>rat.numUnapprovedLicenses</code> property to its default, 0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn org.apache.rat:apache-rat-plugin:check -D rat.numUnapprovedLicenses=0 -o &amp;&amp; \
for a in `find . -name rat.txt -print`; do grep '!???' $a; done</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="missing-license-check"><a class="anchor" href="#missing-license-check"></a>Missing License Check</h4>
<div class="paragraph">
<p>Although Apache Isis has no dependencies on artifacts with incompatible licenses, the POMs for some of these dependencies (in the Maven central repo) do not necessarily contain the required license information.
Without appropriate additional configuration, this would result in the generated <code>DEPENDENCIES</code> file and generated Maven site indicating dependencies as having "unknown" licenses.</p>
</div>
<div class="paragraph">
<p>Fortunately, Maven allows the missing information to be provided by configuring the <code>maven-remote-resources-plugin</code>.
This is stored in the <code>src/main/appended-resources/supplemental-models.xml</code> file, relative to the root of each releasable module.</p>
</div>
<div class="paragraph">
<p>It&#8217;s first necessary to have built the framework locally at least once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install -o</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, capture the missing license information using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn license:download-licenses &amp;&amp; \
groovy ../scripts/checkmissinglicenses.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Maven plugin creates a <code>license.xml</code> file in the <code>target/generated-resources</code> directory of each module.
The script then searches for these <code>licenses.xml</code> files, and compares them against the contents of the <code>supplemental-models.xml</code> file.</p>
</div>
<div class="paragraph">
<p>For example, the output could be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">licenses to add to supplemental-models.xml:

[org.slf4j, slf4j-api, 1.5.7]
[org.codehaus.groovy, groovy-all, 1.7.2]

licenses to remove from supplemental-models.xml (are spurious):

[org.slf4j, slf4j-api, 1.5.2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any missing entries are listed or are spurious, then update <code>supplemental-models.xml</code> and try again.</p>
</div>
</div>
<div class="sect3">
<h4 id="commit-changes"><a class="anchor" href="#commit-changes"></a>Commit changes</h4>
<div class="paragraph">
<p>Commit any changes from the preceding steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -am "$ISISJIRA: updates to pom.xml etc for release"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sanity-check"><a class="anchor" href="#sanity-check"></a>Sanity check</h4>
<div class="paragraph">
<p>Perform one last sanity check on the codebase.
Delete all Isis artifacts from your local Maven repo, then build using the <code>-o</code> offline flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf ~/.m2/repository/org/apache/isis
mvn clean install -o</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploy"><a class="anchor" href="#deploy"></a>Deploy</h4>
<div class="paragraph">
<p>Previously the release procedures used <code>mvn release:prepare</code> and <code>mvn release:perform</code>.
These are however not compatible with <code>${revision}</code> that we now use <a href="https://maven.apache.org/maven-ci-friendly.html">for CI/CD</a>.</p>
</div>
<div class="paragraph">
<p>We therefore just use <code>mvn deploy</code> directly, activating the (inherited) <code>apache-release</code> profile that, amongst other things, brings in the <code>gpg</code> plugin for code signing.</p>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgit \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="releasing-simpleapp-archetype"><a class="anchor" href="#releasing-simpleapp-archetype"></a>Releasing <code>simpleapp</code> archetype</h3>
<div class="paragraph">
<p>The Apache Isis archetypes are reverse engineered from example applications.
Once reverse engineered, the source is checked into git (replacing any earlier version of the archetype) and released.</p>
</div>
<div class="paragraph">
<p>There are currently two archetypes, <code>simpleapp</code> and <code>helloworld</code>.
In this section we release <code>simpleapp</code>, in the following <a href="#support:cutting-a-release.adoc#releasing-the-helloworld-archetype" class="page unresolved">section</a> we release <code>helloworld</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If releasing using Windows, then there is an issue that requires a small workaround.</p>
</div>
<div class="paragraph">
<p>In Maven 3.3.3 and later, the <code>mvn.bat</code> file was removed, replaced instead with <code>mvn.cmd</code>.
However, <code>maven-archetype-plugin:2.4</code> only uses <code>mvn.bat</code>; this causes the <code>archetype:create-from-project</code> goal to fail.
The fix is simple: just copy <code>mvn.cmd</code> to <code>mvn.bat</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Switch to the directory containing the <code>simpleapp</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ../example/application/simpleapp</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="setup-environment-variables"><a class="anchor" href="#setup-environment-variables"></a>Setup environment variables</h4>
<div class="paragraph">
<p>Set additional environment variables for the <code>simpleapp-archetype</code> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=simpleapp-archetype
export ISISPAR=$ISISREL                 <i class="conum" data-value="1"></i><b>(1)</b>

export ISISCPT=$(echo $ISISART | cut -d- -f2)
export ISISCPN=$(echo $ISISART | cut -d- -f1)

env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>$ISISPAR</code> is the version of the Apache Isis core that will act as the archetype&#8217;s parent.
Usually this is the same as <code>$ISISREL</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="check-the-example-app"><a class="anchor" href="#check-the-example-app"></a>Check the example app</h4>
<div class="paragraph">
<p>Double check that the app:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>builds:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>can be run from an IDE</p>
<div class="ulist">
<ul>
<li>
<p>mainClass=<code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>args=<code>-m domainapp.application.manifest.DomainAppAppManifestWithFixtures</code></p>
</li>
<li>
<p>run before: <code>mvn -pl module-simple datanucleus:enhance -o</code> in the root module</p>
</li>
</ul>
</div>
</li>
<li>
<p>can be run using the mvn jetty plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -pl webapp jetty:run</code></pre>
</div>
</div>
</li>
<li>
<p>can be packaged and run using the mvn jetty-console plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-jettyconsole
mvn antrun:run -Dmavenmixin-jettyconsole</code></pre>
</div>
</div>
</li>
<li>
<p>can be deployed as a WAR</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp webapp/target/simpleapp.war $CATALINA_HOME/webapps/ROOT.war
pushd $CATALINA_HOME/bin
sh startup.sh
tail -f ../logs/catalina.out</code></pre>
</div>
</div>
<div class="paragraph">
<p>quit using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh shutdown.sh
popd</code></pre>
</div>
</div>
</li>
<li>
<p>can be packaged and run using Docker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-docker -D docker-plugin.imageName=test/simpleapp
docker container run -p 8080:8080 --name simpleapp -d test/simpleapp</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Windows, make sure that Docker is first switched to using linux containers, not Windows containers (because the <code>Dockerfile</code> in the application references a linux base image).</p>
</div>
<div class="paragraph">
<p>You may also need to enable the Docker daemon first, otherwise the "mvn install" command above will fail:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/docker/docker-daemon.png"><img src="_images/docker/docker-daemon.png" alt="docker daemon" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>You might also need to ensure that the "Unidentified networks" are configured to be private:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/docker/026-docker-nat-private.png"><img src="_images/docker/026-docker-nat-private.png" alt="026 docker nat private" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>This can be done using the "Local Security Policy" application.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally, you can connect to the running container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on Mac/Linux:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker exec -it simpleapp sh</code></pre>
</div>
</div>
</li>
<li>
<p>on Windows</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">winpty docker exec -it simpleapp sh</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can then tail the log of the Tomcat instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /opt/*tomcat*/logs
tail -f catalina.*.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>This too should be accessed at <a href="http://localhost:8080">localhost:8080</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Kitematic UI tool is handy for viewing and interacting with running containers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To tidy up, kill and remove the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker container kill simpleapp
docker container rm simpleapp</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="recreate-the-archetype"><a class="anchor" href="#recreate-the-archetype"></a>Recreate the archetype</h4>
<div class="paragraph">
<p>Make sure you are in the correct directory and environment variables are correct.</p>
</div>
<div class="paragraph">
<p>To recreate the <strong>simpleapp</strong> archetype, first ensure in the correct directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd example/application/simpleapp
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, run the script (which also builds the archetype once generated) and switch to the archetype&#8217;s directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh ../../../scripts/recreate-archetype.sh $ISISJIRA
cd `pwd|sed 's/application/archetype/'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script automatically commits changes; if you wish use <code>git log</code> and
<code>git diff</code> (or a tool such as SourceTree) to review changes made.</p>
</div>
</div>
<div class="sect3">
<h4 id="sanity-check-2"><a class="anchor" href="#sanity-check-2"></a>Sanity check</h4>
<div class="paragraph">
<p><em>In a different session</em>, create a new app from the archetype.
First set up environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp    # or as required
export ISISCPN=simpleapp
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then generate a new app from the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf $ISISTMP/test-$ISISCPN

mkdir $ISISTMP/test-$ISISCPN
cd $ISISTMP/test-$ISISCPN
mvn archetype:generate  \
    -D archetypeCatalog=local \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=$ISISCPN-archetype \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the newly generated app and test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd myapp
mvn clean install -o
mvn -pl webapp jetty:run              # runs as mvn jetty plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also check that the generated app can be built as a Docker image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-docker -D docker-plugin.imageName=test/myapp
docker container run -p 8080:8080 --name myapp -d test/myapp
sleep 10 &amp;&amp; curl http://localhost:8080
docker container kill myapp
docker container rm myapp</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploy-2"><a class="anchor" href="#deploy-2"></a>Deploy</h4>
<div class="paragraph">
<p>Back in the original session, we upload (deploy) the archetype to the staging repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously we used <code>mvn release:prepare</code> and <code>mvn release:perform</code> to do this.
However not compatible with <code>${revision}</code> that we now use <a href="https://maven.apache.org/maven-ci-friendly.html">for CI/CD</a>.
We therefore now just use <code>mvn deploy</code> directly, activating the (inherited) <code>apache-release</code> profile that, amongst other things, brings in the <code>gpg</code> plugin for code signing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="releasing-helloworld-archetype"><a class="anchor" href="#releasing-helloworld-archetype"></a>Releasing <code>helloworld</code> archetype</h3>
<div class="paragraph">
<p>We now repeat the archetype release procedure, this time for the <code>helloworld</code> example app.</p>
</div>
<div class="paragraph">
<p>Start by switching to the directory containing the <code>helloworld</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ../../../example/application/helloworld</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="setup-environment-variables-2"><a class="anchor" href="#setup-environment-variables-2"></a>Setup environment variables</h4>
<div class="paragraph">
<p>Update additional environment variables for the <code>helloworld-archetype</code> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=helloworld-archetype
export ISISPAR=$ISISREL

export ISISCPT=$(echo $ISISART | cut -d- -f2)
export ISISCPN=$(echo $ISISART | cut -d- -f1)

env | grep ISIS | sort</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="check-the-example-app-2"><a class="anchor" href="#check-the-example-app-2"></a>Check the example app</h4>
<div class="paragraph">
<p>Check that the app:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>builds:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>can be run from an IDE</p>
<div class="ulist">
<ul>
<li>
<p>mainClass=<code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>args=<code>-m domainapp.application.HelloWorldAppManifest</code></p>
</li>
<li>
<p>run before: <code>mvn datanucleus:enhance -o</code> in the root module</p>
</li>
</ul>
</div>
</li>
<li>
<p>can be run using the mvn jetty plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn jetty:run</code></pre>
</div>
</div>
</li>
<li>
<p>can be deployed as a WAR</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp target/helloworld.war $CATALINA_HOME/webapps/ROOT.war
pushd $CATALINA_HOME/bin
sh startup.sh
tail -f ../logs/catalina.out</code></pre>
</div>
</div>
<div class="paragraph">
<p>quit using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh shutdown.sh
popd</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This too should be accessed at <a href="http://localhost:8080">localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>In each case, check the about page and confirm has been built against non-SNAPSHOT versions of the Apache Isis jars.</p>
</div>
</div>
<div class="sect3">
<h4 id="recreate-the-archetype-2"><a class="anchor" href="#recreate-the-archetype-2"></a>Recreate the archetype</h4>
<div class="paragraph">
<p>Make sure you are in the correct directory and environment variables are correct.</p>
</div>
<div class="paragraph">
<p>To recreate the <strong>helloworld</strong> archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd example/application/helloworld
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, run the script (which also builds the archetype once generated) and then switch to the archetype&#8217;s directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh ../../../scripts/recreate-archetype.sh $ISISJIRA
cd `pwd|sed 's/application/archetype/'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script automatically commits its changes.
If you wish use <code>git log</code> and <code>git diff</code> (or a tool such as SourceTree) to review changes made.</p>
</div>
</div>
<div class="sect3">
<h4 id="sanity-check-3"><a class="anchor" href="#sanity-check-3"></a>Sanity check</h4>
<div class="paragraph">
<p><em>In a different session</em>, create a new app from the archetype.
First set up environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp    # or as required
export ISISCPN=helloworld
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then generate a new app from the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf $ISISTMP/test-$ISISCPN

mkdir $ISISTMP/test-$ISISCPN
cd $ISISTMP/test-$ISISCPN
mvn archetype:generate  \
    -D archetypeCatalog=local \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=$ISISCPN-archetype \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the newly generated app and test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd myapp
mvn clean install -o
mvn jetty:run</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="deploy-3"><a class="anchor" href="#deploy-3"></a>Deploy</h4>
<div class="paragraph">
<p>Back in the original session, we upload (deploy) the archetype to the staging repository.</p>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="checkclose-staging-repo"><a class="anchor" href="#checkclose-staging-repo"></a>Check/Close Staging Repo</h3>
<div class="paragraph">
<p>The <code>mvn deploy</code> commands will have uploaded release artifacts for both <code>core</code> and the <code>simpleapp</code> archetype into a newly created staging repository on the ASF Nexus repository server.</p>
</div>
<div class="paragraph">
<p>Log onto <a href="http://repository.apache.org">repository.apache.org</a> (using your ASF LDAP account):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-0.png"><img src="_images/release-process/nexus-staging-0.png" alt="nexus staging 0" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>And then check that the release has been staged (select <code>staging repositories</code> from left-hand side):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-1.png"><img src="_images/release-process/nexus-staging-1.png" alt="nexus staging 1" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>If nothing appears in a staging repo you should stop here and work out why.</p>
</div>
<div class="paragraph">
<p>Assuming that the repo has been populated, make a note of its repo id; this is needed for the voting thread. In the screenshot above the id is <code>org.apache.isis-008</code>.</p>
</div>
<div class="paragraph">
<p>After checking that the staging repository contains the artifacts that you expect you should close the staging repository. This will make it available so that people can check the release.</p>
</div>
<div class="paragraph">
<p>Press the Close button and complete the dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-2.png"><img src="_images/release-process/nexus-staging-2.png" alt="nexus staging 2" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Nexus should start the process of closing the repository.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-2a.png"><img src="_images/release-process/nexus-staging-2a.png" alt="nexus staging 2a" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>All being well, the close should (eventually) complete successfully (keep hitting refresh):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-3.png"><img src="_images/release-process/nexus-staging-3.png" alt="nexus staging 3" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The Nexus repository manager will also email you with confirmation of a successful close.</p>
</div>
<div class="paragraph">
<p>If Nexus has problems with the key signature, however, then the close will be aborted:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-4.png"><img src="_images/release-process/nexus-staging-4.png" alt="nexus staging 4" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Use <code>gpg --keyserver hkp://pgp.mit.edu --recv-keys nnnnnnnn</code> to confirm that the key is available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unfortunately, Nexus does not seem to allow subkeys to be used for signing. See <a href="#key-generation">Key Generation</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="reset-revision-property"><a class="anchor" href="#reset-revision-property"></a>Reset <code>revision</code> property</h3>
<div class="paragraph">
<p>At the beginning of the release process we bumped the <code>revision</code> property to the release version, ie <code>$ISISREL</code>.
With the release now deployed we now need to reset the revision back down to the base snapshot, ie <code>1.0.0-SNAPSHOT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously we bumped to the next development snapshot.
However, this approach doesn&#8217;t play well with CI/CD when Apache Isis is mounted as a git submodule, so instead we always use <code>1.0.0-SNAPSHOT</code> for all development work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the root of the Apache Isis repo, we do this for all three <code>pom.xml</code>s with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/version-reset.sh $ISISJIRA</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="push-branches"><a class="anchor" href="#push-branches"></a>Push branches</h3>
<div class="paragraph">
<p>Push the release branch to origin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push -u origin $ISISBRANCH</code></pre>
</div>
</div>
<div class="paragraph">
<p>and also push tags for both core and the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push origin refs/tags/isis-$ISISREL:refs/tags/isis-$ISISREL-$ISISRC
git push origin refs/tags/simpleapp-archetype-$ISISREL:refs/tags/simpleapp-archetype-$ISISREL-$ISISRC
git push origin refs/tags/helloworld-archetype-$ISISREL:refs/tags/helloworld-archetype-$ISISREL-$ISISRC
git fetch</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The remote tags aren&#8217;t visible locally but can be seen <a href="https://github.com/apache/isis/tags">online</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="voting"><a class="anchor" href="#voting"></a>Voting</h3>
<div class="paragraph">
<p>Once the artifacts have been uploaded, you can call a vote.</p>
</div>
<div class="paragraph">
<p>In all cases, votes last for 72 hours and require a +3 (binding) vote from members.</p>
</div>
<div class="sect3">
<h4 id="start-voting-thread-on-dev-mailing-list"><a class="anchor" href="#start-voting-thread-on-dev-mailing-list"></a>Start voting thread on dev mailing list</h4>
<div class="paragraph">
<p>That is, <a href="mailto:dev@apache.isis.org" class="bare">mailto:dev@apache.isis.org</a></p>
</div>
<div class="paragraph">
<p>The following boilerplate is for a release of the Apache Isis Core.
Adapt as required:</p>
</div>
<div class="paragraph">
<p>Use the following subject, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[VOTE] Apache Isis Core release 2.0.0-M3 RC1</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use the following body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">I've cut a release for Apache Isis Framework (Core, Extensions, Mavendeps + Mixins):

* Framework 2.0.0-M3

The source code artifacts have been uploaded to staging repositories on repository.apache.org.
For each zip there is a corresponding signature file (append .asc to the zip's url).

In the source code repo the code has been tagged as isis-2.0.0-M3-RC1, helloworld-archetype-2.0.0-M3-RC1 and simpleapp-archetype-2.0.0-M3-RC1; see https://github.com/apache/isis/tags

To verify the source code, you can use the following commands (in an empty directory):

    NEXUSREPONUM=10xx
    VERSION=2.0.0-M3

    curl http://www.apache.org/dist/isis/KEYS &gt; /tmp/KEYS
    gpg --import /tmp/KEYS

    rm -rf isis-$VERSION*
    rm -rf simpleapp-archetype-$VERSION*
    rm -rf helloworld-archetype-$VERSION*

    curl -O -L https://raw.githubusercontent.com/apache/isis/06f947ad7a0968c34d8e6941a77e12aa0196cd17/scripts/verify-isis-release.sh

    chmod +x ./verify-isis-release.sh
    ./verify-isis-release.sh $NEXUSREPONUM $VERSION


Assuming this completes successfully, you can then test the two applications generated from the `simpleapp` and `helloworld` archetypes:

    pushd test-simpleapp/myapp
    mvn -pl webapp jetty:run
    popd

and

    pushd test-helloworld/myapp
    mvn jetty:run
    popd


For more details, see https://isis.apache.org/toc/comguide/about.html#verifying-releases

Please verify the release and cast your vote.  The vote will be open for a minimum of 72 hours.

[ ] +1
[ ]  0
[ ] -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the version number (<code>2.0.0-M3</code> or whatever)</p>
</li>
<li>
<p>the release candidate number (<code>RC1</code> or whatever)</p>
</li>
<li>
<p>the <code>NEXUSREPONUM</code> to the repository id as provided by Nexus earlier (<code>10xx</code> or whatever)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the email also references the procedure for other committers to <a href="#verifying-releases">verify the release</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="verifying-releases"><a class="anchor" href="#verifying-releases"></a>Verifying a Release</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The release process consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release manager <a href="#cutting-a-release">cutting the release</a></p>
</li>
<li>
<p>members of the Apache Isis PMC verifying and voting on the release (documented below)</p>
</li>
<li>
<p>the release manager performing post-release tasks, for either a <a href="#post-release-successful.adoc">successful</a> or an <a href="#toc:comguide:post-release-unsuccessful">unsuccessful</a> vote.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section describes some guidance on what a voter (members of the Apache Isis PMC and anyone else who wishes) is expected to do before casting their vote in order to verify a release.</p>
</div>
<div class="sect2">
<h3 id="background"><a class="anchor" href="#background"></a>Background</h3>
<div class="paragraph">
<p>Whenever a release manager announces a vote on a release (as per the <a href="#release-process">release process</a>) on the <a href="../support.html" class="page">dev mailing list</a>, it is the responsibility of the project&#8217;s PMC to cast their vote on the release.
Anyone else can also vote, but only members of the Apache Isis PMC&#8217;s vote are binding.</p>
</div>
<div class="paragraph">
<p>Per this <a href="http://www.apache.org/dev/release.html">ASF documentation</a>, the legal requirements for an ASF release are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a source zip file + corresponding signature (signed by the release manager, which is in the ASF web of trust and in our KEYS file)</p>
</li>
<li>
<p>all source files have the Apache license (this is ensured by the running of the rat plugin prior to release; you could run it on the unzipped source)</p>
</li>
<li>
<p>all dependencies are appropriately licensed; see the <code>DEPENDENCIES</code> file which is automatically generated from the POMs plus the supplemental-models.xml file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the binaries are <em>not</em> an ASF release, they merely exist on the Maven central repo as a convenience.
That said, you might also want to verify the release by pulling the binaries from the Maven staging repository.
Details of how to do this are also documented below.</p>
</div>
</div>
<div class="sect2">
<h3 id="prerequisites-2"><a class="anchor" href="#prerequisites-2"></a>Prerequisites</h3>
<div class="paragraph">
<p>You will also require the following commands/tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bash</code></p>
<div class="paragraph">
<p>to run shell script</p>
</div>
</li>
<li>
<p><code>curl</code></p>
<div class="paragraph">
<p>to download the ZIP files</p>
</div>
</li>
<li>
<p><code>gpg</code></p>
<div class="paragraph">
<p>to verify signatures</p>
</div>
</li>
<li>
<p><code>unzip</code></p>
<div class="paragraph">
<p>to unzip the ZIP files</p>
</div>
</li>
<li>
<p>JDK 7</p>
</li>
<li>
<p>Apache Maven (<code>mvn</code>) 3.5.0+</p>
<div class="paragraph">
<p>to build the code</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="verifying-source-artifacts"><a class="anchor" href="#verifying-source-artifacts"></a>Verifying source artifacts</h3>
<div class="paragraph">
<p>The easiest way to verify the source artifacts is to use a script that automates the steps.
Run these commands (they should also be listed in the VOTE email):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">NEXUSREPONUM=10xx                   <i class="conum" data-value="1"></i><b>(1)</b>
VERSION=2.0.0-M3

curl http://www.apache.org/dist/isis/KEYS &gt; /tmp/KEYS
gpg --import /tmp/KEYS

rm -rf isis-$VERSION*
rm -rf simpleapp-archetype-$VERSION*
rm -rf helloworld-archetype-$VERSION*

curl -O -L https://gist.githubusercontent.com/danhaywood/9b052f68ef56cfdbeb3eb1603c5f772a/raw/a083599d34a502a18c5ccfd4a4d26f18352ca0e4/verify-isis-release.sh

chmod +x ./verify-isis-release.sh
./verify-isis-release.sh $NEXUSREPONUM $VERSION</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Adjust as per VOTE email.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just copy and paste these commands to your terminal, and run.</p>
</div>
<div class="paragraph">
<p>The <code>verify-isis-release.sh</code> script performs the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it downloads artifacts (<code>.zip</code> files and <code>.asc</code> files from the staging repository hosted on the Apache (Nexus) repository server.</p>
<div class="paragraph">
<p>The location of this repository will be in the VOTE email.</p>
</div>
</li>
<li>
<p>it verifies that the signatures are correct</p>
<div class="paragraph">
<p>in other words, to confirm that the release was created by an Apache Isis committer</p>
</div>
</li>
<li>
<p>builds all the framework code from source</p>
<div class="paragraph">
<p>that is, <code>core</code>, <code>simpleapp-archetype</code> and <code>helloworld-archetype</code></p>
</div>
</li>
<li>
<p>generates and build an app for each of the two archetypes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Assuming this completes successfully, you can then test the two applications generated from the <code>simpleapp</code> and <code>helloworld</code> archetypes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Test out simpleapp using:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pushd test-simpleapp/myapp
mvn -pl webapp jetty:run
popd</code></pre>
</div>
</div>
</li>
<li>
<p>Test out helloworld using:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">pushd test-helloworld/myapp
mvn jetty:run
popd</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can if you wish perform some additional optional checks, listed in the sections below.
Alternatively, you can <a href="verifying-releases.html#casting-a-vote" class="page">cast your vote</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="optional-verifying-binary-artifacts"><a class="anchor" href="#optional-verifying-binary-artifacts"></a>(Optional) Verifying binary artifacts</h3>
<div class="paragraph">
<p>You can verify the binary releases by configuring your local Maven install to point to the Maven staging repository (or repositories) and then using them, eg to run the <a href="../../starters/helloworld/about.html" class="page">HelloWorld archetype</a> or the <a href="../../starters/simpleapp/about.html" class="page">SimpleApp archetype</a> and running the resultant app.</p>
</div>
<div class="paragraph">
<p>Configuring your local Maven install amounts to updating the <code>~/.m2/settings.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;verify-isis&lt;/id&gt;
        &lt;repositories&gt;
            &lt;repository&gt;
                &lt;id&gt;isis-core-staging&lt;/id&gt;
                &lt;name&gt;Isis Core Staging&lt;/name&gt;
                &lt;releases&gt;
                    &lt;enabled&gt;true&lt;/enabled&gt;
                    &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
                    &lt;checksumPolicy&gt;warn&lt;/checksumPolicy&gt;
                &lt;/releases&gt;
                &lt;url&gt;http://repository.apache.org/content/repositories/orgapacheisis-10xx&lt;/url&gt;
                &lt;layout&gt;default&lt;/layout&gt;
            &lt;/repository&gt;
            ...
        &lt;/repositories&gt;
    &lt;/profile&gt;
    ...
&lt;/profiles&gt;
&lt;activeProfiles&gt;
    &lt;activeProfile&gt;verify-isis&lt;/activeProfile&gt;
    ...
&lt;/activeProfiles&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where the repository URL is as provided in the VOTE email.
If there is more than one repository (as is sometimes the case if multiple components have been released), then repeat the &lt;repository&gt; section for each.</p>
</div>
<div class="paragraph">
<p>Once the vote has completed, the staging repositories will be removed and so you should deactive the profile (comment out the <code>&lt;activeProfile&gt;</code> element).
If you forget to deactive the profile, there should be no adverse effects; Maven will just spend unnecessary cycles attempting to hit a non-existent repo.</p>
</div>
</div>
<div class="sect2">
<h3 id="optional-creadur-tools"><a class="anchor" href="#optional-creadur-tools"></a>(Optional) Creadur Tools</h3>
<div class="paragraph">
<p>The <a href="http://creadur.apache.org">Apache Creadur</a> project exists to provide a set of tools to ensure compliance with Apache&#8217;s licensing standards.</p>
</div>
<div class="paragraph">
<p>The main release auditing tool, <a href="http://creadur.apache.org/rat">Apache RAT</a> is used in the <a href="#cutting-a-release">release process</a>.</p>
</div>
<div class="paragraph">
<p>Creadur&#8217;s remaining tools - <a href="http://creadur.apache.org/tentacles/">Tentacles</a> and <a href="http://creadur.apache.org/whisker/">Whisker</a> - are to support the verification process.</p>
</div>
<div class="paragraph">
<p>For example, Tentacles generates a report called <code>archives.html</code>.
This lists all of the top-level binaires, their <code>LICENSE</code> and <code>NOTICE</code> files and any <code>LICENSE</code> and <code>NOTICE</code> files of any binaries they may contain.</p>
</div>
<div class="paragraph">
<p>Validation of the output at this point is all still manual.
Things to check include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>any binaries that contain no LICENSE and NOTICE files</p>
</li>
<li>
<p>any binaries that contain more than one LICENSE or NOTICE file</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this report, each binary will have three links listed after its name '(licenses, notices, contents)'</p>
</div>
</div>
<div class="sect2">
<h3 id="casting-a-vote"><a class="anchor" href="#casting-a-vote"></a>Casting a Vote</h3>
<div class="paragraph">
<p>When you have made the above checks (and any other checks you think may be relevant), cast your vote by replying to the email thread on the mailing list.</p>
</div>
<div class="paragraph">
<p>If you are casting <code>-1</code>, please provide details of the problem(s) you have found.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="post-release-successful"><a class="anchor" href="#post-release-successful"></a>Post Release (Successful)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The release process consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release manager <a href="#cutting-a-release">cutting the release</a></p>
</li>
<li>
<p>members of the Apache Isis PMC <a href="#verifying-releases">verifying</a> and voting on the release</p>
</li>
<li>
<p>the release manager performing post-release tasks, for either a successful or an <a href="#post-release-unsuccessful">unsuccessful</a> vote (former documented below)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For a vote to succeed, there must be +3 votes from PMC members, and the vote must have been open at least 72 hours.
If there are not +3 votes after this time then it is perfectly permissible to keep the vote open longer.</p>
</div>
<div class="paragraph">
<p>This section describes the steps to perform if the vote has been successful.</p>
</div>
<div class="sect2">
<h3 id="inform-dev-ml"><a class="anchor" href="#inform-dev-ml"></a>Inform dev ML</h3>
<div class="paragraph">
<p>Post the results to the <code>dev@isis.a.o</code> mailing list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[RESULT] [VOTE] Apache Isis Core release 2.0.0-M3</code></pre>
</div>
</div>
<div class="paragraph">
<p>using the body (alter last line as appropriate):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">The vote has completed with the following result :

  +1 (binding): ... list of names ...
  +1 (non binding): ... list of names ...

  -1 (binding): ... list of names ...
  -1 (non binding): ... list of names ...

The vote is SUCCESSFUL.

I'll now go ahead and complete the post-release activities.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-tags"><a class="anchor" href="#update-tags"></a>Update tags</h3>
<div class="paragraph">
<p>Replace the <code>-RCn</code> tag with another without the qualifier.</p>
</div>
<div class="paragraph">
<p>You can do this using the <code>scripts/promoterctag.sh</code> script; for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/promoterctag.sh isis-2.0.0-M3 RC1
sh scripts/promoterctag.sh helloworld-archetype-2.0.0-M3 RC1
sh scripts/promoterctag.sh simpleapp-archetype-2.0.0-M3 RC1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script pushes the tag under <code>refs/tags/rel</code>.
As per Apache policy (communicated on 10th Jan 2016 to Apache PMCs), this path is 'protected' and is unmodifiable (guaranteeing the provenance that the ASF needs for releases).</p>
</div>
<div class="paragraph">
<p>Then, continue onto the next section for the steps to promote and announce the release.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-to-maven-central"><a class="anchor" href="#release-to-maven-central"></a>Release to Maven Central</h3>
<div class="paragraph">
<p>From the <a href="http://repository.apache.org">ASF Nexus repository</a>, select the staging repository and select 'release' from the top menu.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-release-1.png"><img src="_images/release-process/nexus-release-1.png" alt="nexus release 1" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>This moves the release artifacts into an Apache releases repository; from there they will be automatically moved to the Maven repository.</p>
</div>
</div>
<div class="sect2">
<h3 id="release-source-zip"><a class="anchor" href="#release-source-zip"></a>Release Source Zip</h3>
<div class="paragraph">
<p>As described in the <a href="http://www.apache.org/dev/release-publishing.html#distribution_dist">Apache documentation</a>, each Apache TLP has a <code>release/TLP-name</code> directory in the distribution Subversion repository at <a href="https://dist.apache.org/repos/dist">https://dist.apache.org/repos/dist</a>.
Once a release vote passes, the release manager should <code>svn add</code> the artifacts (plus signature and hash files) into this location.
The release is then automatically pushed to <a href="http://www.apache.org/dist/">http://www.apache.org/dist/</a> by <code>svnpubsub</code>.
Only the most recent release of each supported release line should be contained here, old versions should be deleted.</p>
</div>
<div class="paragraph">
<p>Each project is responsible for the structure of its directory.
The directory structure of Apache Isis reflects the directory structure in our git source code repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>isis/
  core/
  example/
    archetype/
      simpleapp/</code></pre>
</div>
</div>
<div class="paragraph">
<p>If necessary, checkout this directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">svn co https://dist.apache.org/repos/dist/release/isis isis-dist</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, add the new release into the appropriate directory, and delete any previous release.
The <code>upd.sh</code> script (also downloadable from <a href="https://gist.github.com/danhaywood/aa79c18d993df1b1e2c5a9933e48bcbc">this gist</a>) can be used to automate this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">old_ver=$1
new_ver=$2


# constants
repo_root=https://repository.apache.org/content/repositories/releases/org/apache/isis

zip="source-release.zip"
asc="$zip.asc"
md5="$zip.md5"


#
# isis-core
#
type="core"
fullname="isis"
pushd isis-core

curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$asc
svn add $fullname-$new_ver-$asc
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$md5
svn add $fullname-$new_ver-$md5
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$zip
svn add $fullname-$new_ver-$zip

svn delete $fullname-$old_ver-$asc
svn delete $fullname-$old_ver-$md5
svn delete $fullname-$old_ver-$zip

popd


#
# helloworld-archetype
#
type="archetype"
fullname="helloworld-archetype"
pushd $type/$fullname

curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$md5
svn add $fullname-$new_ver-$md5
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$asc
svn add $fullname-$new_ver-$asc
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$zip
svn add $fullname-$new_ver-$zip

svn delete $fullname-$old_ver-$md5
svn delete $fullname-$old_ver-$asc
svn delete $fullname-$old_ver-$zip

popd


#
# simpleapp-archetype
#
type="archetype"
fullname="simpleapp-archetype"
pushd $type/$fullname

curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$md5
svn add $fullname-$new_ver-$md5
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$asc
svn add $fullname-$new_ver-$asc
curl -O $repo_root/$type/$fullname/$new_ver/$fullname-$new_ver-$zip
svn add $fullname-$new_ver-$zip

svn delete $fullname-$old_ver-$md5
svn delete $fullname-$old_ver-$asc
svn delete $fullname-$old_ver-$zip

popd</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh upd.sh 2.0.0-M2 2.0.0-M3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script downloads the artifacts from the Nexus release repository, adds the artifacts to subversion and deletes the previous version.</p>
</div>
<div class="paragraph">
<p>Double check that the files are correct; there is sometimes a small delay in the files becoming available in the release repository.
It should be sufficient to check just the <code>md5</code> or <code>.asc</code> files that these look valid (aren&#8217;t HTML 404 error pages):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">vi `find . -name *.md5`</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming all is good, commit the changes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>svn commit -m "publishing isis source releases to dist.apache.org"</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the files are invalid, then revert using <code>svn revert . --recursive</code> and try again in a little while.</p>
</div>
</div>
<div class="sect2">
<h3 id="update-jira"><a class="anchor" href="#update-jira"></a>Update JIRA</h3>
<div class="sect3">
<h4 id="generate-release-notes"><a class="anchor" href="#generate-release-notes"></a>Generate Release Notes</h4>
<div class="paragraph">
<p>From the root directory, generate the release notes for the current release, in Asciidoc format; eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/jira-release-notes.sh ISIS 2.0.0-M3 &gt; /tmp/1</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This script uses 'jq' to parse JSON.
See the script itself for details of how to install this utility.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="close-tickets"><a class="anchor" href="#close-tickets"></a>Close tickets</h4>
<div class="paragraph">
<p>Close all JIRA tickets for the release, or moved to future releases if not yet addressed.
Any tickets that were partially implemented should be closed, and new tickets created for the functionality on the ticket not yet implemented.</p>
</div>
</div>
<div class="sect3">
<h4 id="mark-the-version-as-released"><a class="anchor" href="#mark-the-version-as-released"></a>Mark the version as released</h4>
<div class="paragraph">
<p>In JIRA, go to the <a href="https://issues.apache.org/jira/plugins/servlet/project-config/ISIS/versions">administration section</a> for the Apache Isis project and update the version as being released.</p>
</div>
<div class="paragraph">
<p>In the <a href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=87">Kanban view</a> this will have the effect of marking all tickets as released (clearing the "done" column).</p>
</div>
</div>
<div class="sect3">
<h4 id="create-new-jira"><a class="anchor" href="#create-new-jira"></a>Create new JIRA</h4>
<div class="paragraph">
<p>Create a new JIRA ticket as a catch-all for the <em>next</em> release.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-the-asf-reporter-website"><a class="anchor" href="#update-the-asf-reporter-website"></a>Update the ASF Reporter website</h4>
<div class="paragraph">
<p>Log the new release in the <a href="https://reporter.apache.org/addrelease.html?isis">ASF Reporter website</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-image-to-docker-hub"><a class="anchor" href="#release-image-to-docker-hub"></a>Release image to Docker hub</h3>
<div class="paragraph">
<p>This is currently a placeholder.</p>
</div>
<div class="paragraph">
<p>TODO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>This is currently dependent on <a href="https://issues.apache.org/jira/browse/INFRA-17518">INFRA-17518</a>.</p>
</li>
<li>
<p>the entry: <code>&lt;docker-plugin.imageName&gt;</code> in <code>pom.xml</code> will need to change from <code>apacheisis/core</code> to simply <code>apache/isis-9.0.10-jre8-alpine</code>.</p>
</li>
<li>
<p>Once this has been implemented, we also need to update the documentation for helloworld and simpleapp in order to explain how to build and deploy a skinny war to a running container.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The idea is to use <code>isis-webdocker</code> to create a new image, then upload.</p>
</div>
<div class="paragraph">
<p>Prereqs are:</p>
</div>
<div class="listingblock">
<div class="title">m2/settings.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings ...&gt;
  ...
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;docker-hub&lt;/id&gt;
      &lt;username&gt;danhaywood&lt;/username&gt;
      &lt;password&gt;xxx&lt;/password&gt;
      &lt;configuration&gt;
        &lt;email&gt;xxx@xxx.xxx&lt;/email&gt;
      &lt;/configuration&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>... because <code>isis-webdocker/pom.xml</code> references <code>docker-hub</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd core
rm -rf ~/.m2/repository/org/apache/isis
mvn -Drevision=$ISISREL \
    -D docker-plugin.imageName="apacheisis/isis-9.0.10-jre8-alpine" \
    -pl webdocker \
    -D package-docker \
    deploy</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-website"><a class="anchor" href="#update-website"></a>Update website</h3>
<div class="paragraph">
<p>In the main <code>isis</code> repo (ie containing the asciidoc source):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Paste in the JIRA-generated release notes generated above, adding to top of <code>antora/components/relnotes/modules/ROOT/pages/about.adoc</code>.</p>
<div class="paragraph">
<p>Also add a summary line for the release.</p>
</div>
</li>
<li>
<p>Update the [<code>site.yml</code>] file that declares the current and next releases.</p>
</li>
<li>
<p>Update any pages (<code>.adoc</code>, <code>.md</code>, <code>.html</code> etc) that describe how to run the archetype, and ensure they reference the correct version.</p>
<div class="paragraph">
<p>A search for <code>archetypeGroupId=org.apache.isis.archetype</code> should find these pages.</p>
</div>
</li>
<li>
<p>update the <code>doap_isis.rdf</code> file (which provides a machine-parseable description of the project) with details of the new release.
Validate using the <a href="http://www.w3.org/RDF/Validator/">W3C RDF Validator</a> service.</p>
<div class="paragraph">
<p>For more information on DOAP files, see these <a href="http://projects.apache.org/doap.html">Apache policy docs</a>.</p>
</div>
</li>
<li>
<p>Update the <a href="https://github.com/apache/isis/blob/master/STATUS">STATUS</a> file (in root of Apache Isis' source) should be updated with details of the new release.</p>
</li>
<li>
<p>commit the <code>.adoc</code> changes</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now we need to publish the website:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate <code>template/document.html.erb</code> file, and remove <code>-SNAPSHOT</code> from the navbar, so that it reads something like:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;p class="nav navbar-text navbar-right small"&gt;2.0.0-M3&lt;/p&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>publish to the <code>isis-site</code> repo.</p>
<div class="paragraph">
<p>This will have published to the <code>SNAPSHOT</code> directory of the <code>isis-site</code> repo.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now, in the <code>isis-site</code> repo itself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>double check that a copy of <code>current</code> exists as a named directory under <code>content/versions</code></p>
<div class="paragraph">
<p>If for any reason it isn&#8217;t there, then create a copy (under <code>content/versions</code>) before it gets deleted in the step below.</p>
</div>
</li>
<li>
<p>delete the <code>current</code> version and then rename the just-published <code>SNAPSHOT</code> as <code>current</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf content/versions/current
mv content/versions/SNAPSHOT content/versions/current</code></pre>
</div>
</div>
</li>
<li>
<p>take a copy of the new <code>current</code> version as its appropriately named version:</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp -rf content/versions/current content/versions/2.0.0-M3</code></pre>
</div>
</div>
</li>
<li>
<p>update the new named version&#8217;s <code>index.html</code> with one that will redirect back to the home page.</p>
<div class="paragraph">
<p>You can take a copy from one of the older named versions, or just use this text:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Redirecting to index.html&lt;/title&gt;
        &lt;meta http-equiv="refresh" content="1; URL=../../index.html"&gt;
        &lt;meta name="keywords" content="automatic redirection"&gt;
        &lt;/head&gt;
    &lt;body&gt;
        Redirecting to &lt;a href="../../index.html"&gt;index.html&lt;/a&gt;...
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>In the home page&#8217;s index page (<code>content/index.html</code>):</p>
<div class="ulist">
<ul>
<li>
<p>update the menu to reference the new version</p>
</li>
<li>
<p>update the version in the archetype.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point the files in the root (directly under <code>content</code>) will still be out of date; the publish process simply preserves whatever is in <code>content/versions/current</code>.
Also, the <code>SNAPSHOT</code> will be missing (above it was renamed to <code>current</code>).
And, we also need to make sure that any future publishing of snapshots has the correct version in the navbar.</p>
</div>
<div class="paragraph">
<p>Therefore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate <code>template/document.html.erb</code> file, and add in <code>-SNAPSHOT</code> for version in the navbar:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-html hljs" data-lang="html">&lt;p class="nav navbar-text navbar-right small"&gt;2.0.0-M4-SNAPSHOT&lt;/p&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>publish the website once more (from the <code>isis</code> main repo).</p>
</li>
<li>
<p>Finally, preview the changes (using <code>sh preview.sh</code> in the <code>isis-site</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If everything looks ok, then push the changes to make live.</p>
</div>
</div>
<div class="sect2">
<h3 id="announce-the-release"><a class="anchor" href="#announce-the-release"></a>Announce the release</h3>
<div class="paragraph">
<p>Announce the release to <a href="mailto:users@isis.apache.org">users mailing list</a>.</p>
</div>
<div class="paragraph">
<p>For example, for a release of Apache Isis Core, use the following subject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[ANN] Apache Isis version 2.0.0-M3 Released</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use the following body (summarizing the main points as required):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>The Apache Isis team is pleased to announce the release of Apache Isis 2.0.0-M3.

New features in this release include:
* ...

Full release notes are available on the Apache Isis website at [1].
Please also read the migration notes [2].

You can access this release directly from the Maven central repo [3].
Alternatively, download the release and build it from source [4].

Enjoy!

--The Apache Isis team

[1] http://isis.apache.org/downloads/rn/about.html#_release-notes_2.0.0-M3
[2] http://isis.apache.org/downloads/mn/about.html#_migration-notes_2.0.0-M2-to-2.0.0-M3
[3] http://search.maven.org
[4] http://isis.apache.org/downloads.html</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="blog-post"><a class="anchor" href="#blog-post"></a>Blog post</h3>
<div class="paragraph">
<p><a href="https://blogs.apache.org/roller-ui/login.rol">Log onto</a> the <a href="http://blogs.apache.org/isis/">Apache blog</a> and create a new post.
Copy-n-paste the above mailing list announcement should suffice.</p>
</div>
</div>
<div class="sect2">
<h3 id="merge-in-release-branch"><a class="anchor" href="#merge-in-release-branch"></a>Merge in release branch</h3>
<div class="paragraph">
<p>Because we release from a branch, the changes made in the branch (changes to <code>pom.xml</code> made by the <code>maven-release-plugin</code>, or any manual edits) should be merged back from the release branch back into the <code>master</code> branch:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout master                           # update master with latest
git pull
git merge release-2.0.0-M3-RC1                  # merge branch onto master
git push origin --delete release-2.0.0-M3-RC1   # remote branch no longer needed
git branch -d release-2.0.0-M3-RC1              # branch no longer needed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="update-dependencies"><a class="anchor" href="#update-dependencies"></a>Update dependencies</h3>
<div class="paragraph">
<p>With the release complete, now is a good time to bump versions of dependencies (so that there is a full release cycle to identify any possible issues).</p>
</div>
<div class="paragraph">
<p>You will probably want to create a new JIRA ticket for these updates (or if minor then use the "catch-all" JIRA ticket raised earlier for the next release).</p>
</div>
<div class="sect3">
<h4 id="update-parent-of-core"><a class="anchor" href="#update-parent-of-core"></a>Update parent of Core</h4>
<div class="paragraph">
<p>Check (via <a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.apache%22%20a%3A%22apache%22">search.maven.org</a>) whether there is a newer version of the Apache parent <code>org.apache:apache</code>.</p>
</div>
<div class="paragraph">
<p>If there is, update the <code>&lt;version&gt;</code> in the <code>&lt;parent&gt;</code> element in the parent POM to match the newer version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;parent&gt;
    &lt;groupId&gt;org.apache&lt;/groupId&gt;
    &lt;artifactId&gt;apache&lt;/artifactId&gt;
    &lt;version&gt;NN&lt;/version&gt;
    &lt;relativePath /&gt;
&lt;/parent&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>NN</code> is the updated version number.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-plugin-versions"><a class="anchor" href="#update-plugin-versions"></a>Update plugin versions</h4>
<div class="paragraph">
<p>The <code>maven-versions-plugin</code> should be used to determine if there are newer versions of any of the plugins used to build Apache Isis.
Since this goes off to the internet, it may take a minute or two to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn versions:display-plugin-updates &gt; /tmp/foo
grep "\-&gt;" /tmp/foo | /bin/sort -u</code></pre>
</div>
</div>
<div class="paragraph">
<p>Review the generated output and make updates as you see fit.
(However, if updating, please check by searching for known issues with newer versions).</p>
</div>
</div>
<div class="sect3">
<h4 id="update-dependency-versions"><a class="anchor" href="#update-dependency-versions"></a>Update dependency versions</h4>
<div class="paragraph">
<p>The <code>maven-versions-plugin</code> should be used to determine if there are newer versions of any of Isis' dependencies.
Since this goes off to the internet, it may take a minute or two to run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn versions:display-dependency-updates &gt; /tmp/foo
grep "\-&gt;" /tmp/foo | /bin/sort -u</code></pre>
</div>
</div>
<div class="paragraph">
<p>Update any of the dependencies that are out-of-date.
That said, do note that some dependencies may show up with a new dependency, when in fact the dependency is for an old, badly named version.
Also, there may be new dependencies that you do not wish to move to, eg release candidates or milestones.</p>
</div>
<div class="paragraph">
<p>For example, here is a report showing both of these cases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[INFO]   asm:asm ..................................... 3.3.1 -&gt; 20041228.180559
[INFO]   commons-httpclient:commons-httpclient .......... 3.1 -&gt; 3.1-jbossorg-1
[INFO]   commons-logging:commons-logging ......... 1.1.1 -&gt; 99.0-does-not-exist
[INFO]   dom4j:dom4j ................................. 1.6.1 -&gt; 20040902.021138
[INFO]   org.datanucleus:datanucleus-api-jdo ................ 3.1.2 -&gt; 3.2.0-m1
[INFO]   org.datanucleus:datanucleus-core ................... 3.1.2 -&gt; 3.2.0-m1
[INFO]   org.datanucleus:datanucleus-jodatime ............... 3.1.1 -&gt; 3.2.0-m1
[INFO]   org.datanucleus:datanucleus-rdbms .................. 3.1.2 -&gt; 3.2.0-m1
[INFO]   org.easymock:easymock ................................... 2.5.2 -&gt; 3.1
[INFO]   org.jboss.resteasy:resteasy-jaxrs ............. 2.3.1.GA -&gt; 3.0-beta-1</code></pre>
</div>
</div>
<div class="paragraph">
<p>For these artifacts you will need to search <a href="http://search.maven.org">Maven central repo</a> directly yourself to confirm there are no newer dependencies not shown in this list.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="code-formatting"><a class="anchor" href="#code-formatting"></a>Code formatting</h3>
<div class="paragraph">
<p>This is also a good time to make source code has been cleaned up and formatted according to the Apache Isis and ASF conventions.
Use <a href="../dg/resources/eclipse/Apache-code-style-formatting.xml">this</a> Eclipse template and <a href="../dg/resources/eclipse/isis.importorder">this</a> import order.</p>
</div>
</div>
<div class="sect2">
<h3 id="push-changes"><a class="anchor" href="#push-changes"></a>Push changes</h3>
<div class="paragraph">
<p>Finally, push the changes up to origin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git fetch    # check no new commits on origin/master
git push</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="release-non-asf-modules"><a class="anchor" href="#release-non-asf-modules"></a>Release (non-ASF) Modules</h3>
<div class="paragraph">
<p>The (non-ASF) <a href="https://platform.incode.org" target="_blank" rel="noopener">Incode Platform</a> should also be released, as per their <a href="https://platform.incode.org/pages/committers-guide/committers-guide.html#_release_to_maven_central">release guide</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="post-release-unsuccessful"><a class="anchor" href="#post-release-unsuccessful"></a>Post Release (Unsuccessful)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The release process consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release manager <a href="#cutting-a-release">cutting the release</a></p>
</li>
<li>
<p>members of the Apache Isis PMC <a href="#verifying-releases">verifying</a> and voting on the release</p>
</li>
<li>
<p>the release manager performing post-release tasks, for either a <a href="#post-release-successful">successful</a> or an unsuccessful vote (latter documented below).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the vote did not succeed (did not achieve +3 votes after 72 hours and/or is unlikely to do so), then the vote should be closed and the following steps performed.</p>
</div>
<div class="paragraph">
<p>Note that a release manager may also decide to cancel a vote before 72 hours has elapsed (for example if an error is quickly discovered).</p>
</div>
<div class="sect2">
<h3 id="inform-dev-ml-2"><a class="anchor" href="#inform-dev-ml-2"></a>Inform dev ML</h3>
<div class="paragraph">
<p>Post the results to the <code>dev@isis.a.o</code> mailing list.</p>
</div>
<div class="paragraph">
<p>For example, use the following subject for a vote on Apache Isis Core:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[RESULT] [VOTE] Apache Isis Core release 2.0.0-M3</code></pre>
</div>
</div>
<div class="paragraph">
<p>using the body (alter last line as appropriate):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">The vote has completed with the following result :

  +1 (binding): _list of names_
  +1 (non binding): _list of names_

  -1 (binding): _list of names_
  -1 (non binding): _list of names_

The vote is UNSUCCESSFUL.</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tidy-up-branches"><a class="anchor" href="#tidy-up-branches"></a>Tidy up branches</h3>
<div class="paragraph">
<p>Tidy up remote branches in the git repo:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>delete the remote branch, for example:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push --delete origin release-2.0.0-M3-RC1</code></pre>
</div>
</div>
</li>
<li>
<p>delete the remote origin server&#8217;s tags, for example:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push --delete origin isis-2.0.0-M3-RC1
git push --delete origin helloworld-archetype-2.0.0-M3-RC1
git push --delete origin simpleapp-archetype-2.0.0-M3-RC1</code></pre>
</div>
</div>
</li>
<li>
<p>delete the tags that were created locally, for example:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git tag -d isis-2.0.0-M3
git tag -d helloworld-archetype-2.0.0-M3
git tag -d simpleapp-archetype-2.0.0-M3</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="tidy-up-the-nexus-repo"><a class="anchor" href="#tidy-up-the-nexus-repo"></a>Tidy up the Nexus repo</h3>
<div class="paragraph">
<p>Drop staging repositories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>drop the staging repository in <a href="http://repository.apache.org">Nexus</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="reset"><a class="anchor" href="#reset"></a>Reset</h3>
<div class="paragraph">
<p>Finally, rewind the release branch to prior to the previous release candidate, and continue from there.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-process-for-snapshots"><a class="anchor" href="#release-process-for-snapshots"></a>Snapshot Releases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Snapshot releases allows the current <code>-SNAPSHOT</code> version of the <code>core</code> modules  of the framework to be released to the Maven snapshot repository maintained by Apache Software Foundation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unless otherwise stated, you should assume that the steps described here are performed in the base directory of the module being released.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="prerequisites-3"><a class="anchor" href="#prerequisites-3"></a>Prerequisites</h3>
<div class="paragraph">
<p>Before you start, make sure you&#8217;ve defined the snapshots repo in your local <code>~/.m2/settings.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  &lt;servers&gt;
    &lt;!-- To publish a snapshot of some part of Maven --&gt;
    &lt;server&gt;
      &lt;id&gt;apache.snapshots.https&lt;/id&gt;
      &lt;username&gt;xxxxxxx&lt;/username&gt;
      &lt;password&gt;yyyyyyy&lt;/password&gt;
    &lt;/server&gt;
    ...
  &lt;/servers&gt;
  ...
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>xxxxxxx</code> and <code>yyyyyyy</code> are your Apache LDAP username and password. For more information, see these <a href="http://www.apache.org/dev/publishing-maven-artifacts.html#dev-env">ASF docs</a>.</p>
</div>
<div class="paragraph">
<p>{note
It is also possible to configure to use <code>.ssh</code> secure keys, and thereby avoid hardcoding your Apache LDAP password into your <code>.m2/settings.xml</code> file. A description of how to do this can be found, for example, <a href="http://bval.apache.org/release-setup.html">here</a>.
}</p>
</div>
</div>
<div class="sect2">
<h3 id="sanity-check-4"><a class="anchor" href="#sanity-check-4"></a>Sanity Check</h3>
<div class="paragraph">
<p>Before deploying the snapshot, perform a quick sanity check.</p>
</div>
<div class="paragraph">
<p>First, delete all Isis artifacts from your local Maven repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf ~/.m2/repository/org/apache/isis</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, check that the framework builds ok:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd core
mvn clean install -o</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm that the versions of the Isis artifacts now cached in your local repository are correct (both those pulled down from Maven central repo, as well as those of the component built locally).</p>
</div>
</div>
<div class="sect2">
<h3 id="deploy-4"><a class="anchor" href="#deploy-4"></a>Deploy</h3>
<div class="paragraph">
<p>Deploy the framework using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bsah hljs" data-lang="bsah">cd core
mvn -D deploy=snapshot deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will deploy all the modules that make up a release.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Expect this to take about 10 minutes, give or take.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To confirm that they are present, browse to Apache&#8217;s <a href="https://repository.apache.org">Nexus repository manager</a> and search for "isis".</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-process-for-interim-releases"><a class="anchor" href="#release-process-for-interim-releases"></a>Interim Releases</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The intent of an "interim" release is to allow a developer team to release their application based on a <code>-SNAPSHOT</code> version of the framework.
Since <code>-SNAPSHOT</code> changes on a day-to-day basis, the idea is to tag a particular revision and to release this, thereby providing stability/traceability for the application being developed.</p>
</div>
<div class="paragraph">
<p>Whereas <a href="#cutting-a-release.adoc">formal release</a>s and <a href="#toc:comguide:release-process-for-snapshots">snapshot release</a>s are public (released through the Maven repository maintained by Apache Software Foundation), interim releases are non-public and rely on infrastructure provided by a developer team.
The tagged release resides <em>not</em> in the <a href="#toc:ROOT:downloads.adoc#\__downloads_source_code" class="page unresolved">official Apache Isis git repository</a>, but instead in a fork/clone maintained by the developer team.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The procedure developed here was put together for the team working on the <a href="#toc:ROOT:powered-by/powered-by.adoc#_powered-by_estatio" class="page unresolved">Estatio app</a>, which maintains its own <a href="https://github.com/incodehq/isis">fork on github</a> and uses <a href="https://www.cloudbees.com/">CloudBees</a> as a Jenkins build server/private Maven repo.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="prerequisites-4"><a class="anchor" href="#prerequisites-4"></a>Prerequisites</h3>
<div class="paragraph">
<p>Create a remote fork/clone of the Apache Isis repository (eg using <a href="http://github.com">github</a> or <a href="http://bitbucket.org">bitbucket</a> or similar), and ensure that your local fork specifies this remote.</p>
</div>
<div class="paragraph">
<p>Also, set up a CI server against your fork/clone, to build against any branches called <code>origin/interim/*</code>.
To build it should use the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install -Dskip.app -Dskip.arch</code></pre>
</div>
</div>
<div class="paragraph">
<p>that is, skipping the example simpleapp and archetype; only <code>core</code> framework is built</p>
</div>
<div class="paragraph">
<p>The CI server should then also publish the resultant artifacts to a local Maven repository.
For example, Jenkins provides post-build plugins to perform such a task.</p>
</div>
</div>
<div class="sect2">
<h3 id="sanity-check-5"><a class="anchor" href="#sanity-check-5"></a>Sanity Check</h3>
<div class="paragraph">
<p>Ensure that the framework builds ok using the same command that your CI server is set up to execute (see section above).</p>
</div>
</div>
<div class="sect2">
<h3 id="release"><a class="anchor" href="#release"></a>Release</h3>
<div class="paragraph">
<p>Deploy the framework using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bsah hljs" data-lang="bsah">sh interim-release.sh xxx yyyyy</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>xxx</code> is the most recent release of Isis (to act as the base), and <code>yyyyy</code> is the name of the remote.</p>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh interim-release.sh 1.13.0 incodehq</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will result in a new branch and tagged being pushed to the remote, with an appropriate version (details below).</p>
</div>
<div class="paragraph">
<p>As noted in the prereqs (above), the CI server configured should then detect the new branch (or tag, if you prefer), build the framework (skipping application and architecture, as in the prerequisites) and then publish the resultant artifacts to a private Maven repo.</p>
</div>
<div class="sect3">
<h4 id="implementation-details"><a class="anchor" href="#implementation-details"></a>Implementation details</h4>
<div class="paragraph">
<p>The script itself:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>removes any local branches called <code>interim/*</code></p>
</li>
<li>
<p>creates a new branch called <code>interim/YYYYmmDD-HHMM</code></p>
<div class="ulist">
<ul>
<li>
<p>eg <code>interim/1.13.0.20160909-0758</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>updates the version of the pom.xml to the baseline plus the date</p>
<div class="ulist">
<ul>
<li>
<p>eg <code>&lt;version&gt;1.13.0.20160909-0758&lt;/version&gt;</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>commits the changes and tags the new commit</p>
<div class="ulist">
<ul>
<li>
<p>eg <code>isis-1.13.0.20160909-0758</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>removes any remote branches called <code>interim/*</code></p>
</li>
<li>
<p>pushes both the branch and the tag to the remote.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="antora-publish-procedure"><a class="anchor" href="#antora-publish-procedure"></a>Publishing the Docs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis' documentation (meaning the website and the users' guide, the reference guide and this contributors' guide) is written using <a href="https://asciidoctor.org/">Asciidoctor</a> syntax, and organized to be published as an <a href="https:antora.org">Antora</a> website.</p>
</div>
<div class="paragraph">
<p>The website and guides are created by running build tools (documented below) which create the HTML version of the site and guides.
You can therefore easily check the documentation before raising a pull request (as a contributor) or publishing the site (if a committer).</p>
</div>
<div class="paragraph">
<p>For details of authoring/updating the documents and website, see the <a href="#toc:devguide:asciidoc.adoc" class="page unresolved">developers' guide</a>.</p>
</div>
<div class="paragraph">
<p>Publishing is performed by copying the generated HTML to a different git repository (<a href="https://github.com/apache/isis-site.git">isis-site</a>).
This is synced by ASF infrastructure over to <a href="http://isis.apache.org">isis.apache.org</a>.
This can only be done by Apache Isis committers, and is discussed below.</p>
</div>
<div class="sect2">
<h3 id="one-time-setup"><a class="anchor" href="#one-time-setup"></a>One-time setup</h3>
<div class="paragraph">
<p>The generated site is published by copying into the <code>content/</code> directory of the <a href="https://github.com/apache/isis-site.git">isis-site</a> git repo.
You therefore need to check this out this repo.</p>
</div>
<div class="paragraph">
<p>The procedure assumes that two git repos (for <a href="https://github.com/apache/isis">isis</a> itself on github, and for isis-site) are checked out into the same parent directory, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/GITHUB/
  apache/
    isis/                       <i class="conum" data-value="1"></i><b>(1)</b>
      adocs
        documentation/
          README.adoc
          ...
    isis-site/                  <i class="conum" data-value="2"></i><b>(2)</b>
      content/                  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>checkout of isis.git</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>checkout of isis-site.git</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the published website</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One oddity; ASF&#8217;s script to upload the documentation to the web server checks out from the 'asf-site' branch, NOT from the 'master' branch.
Therefore, in the <code>isis.git</code> repo site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout asf-site</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="preview"><a class="anchor" href="#preview"></a>Preview</h3>
<div class="paragraph">
<p>To preview changes (ignoring PDFs), run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh preview-html.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will update the documentation and start a (Python) webserver so that the documents can be viewed.</p>
</div>
<div class="paragraph">
<p>If you want to also view the PDFs, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh preview-pdf.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s generally little point in doing this, however.</p>
</div>
</div>
<div class="sect2">
<h3 id="publishing-full-build"><a class="anchor" href="#publishing-full-build"></a>Publishing (full build)</h3>
<div class="paragraph">
<p>The <code>content</code> directory for the published website contains not only the "current version" of the docs, but also has an archive of older versions of the document from earlier releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/GITHUB/
  apache/
    isis-site/
      content/                  <i class="conum" data-value="1"></i><b>(1)</b>
        index.html              <i class="conum" data-value="2"></i><b>(2)</b>
        *                       <i class="conum" data-value="3"></i><b>(3)</b>
        versions/
          current/              <i class="conum" data-value="4"></i><b>(4)</b>
          SNAPSHOT/             <i class="conum" data-value="5"></i><b>(5)</b>
          ...                   <i class="conum" data-value="6"></i><b>(6)</b>
          latest/               <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the published website</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>home page.
This has a drop-down to access older versions of the documentation, but most links are through to the "current version"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>documentation for the current release version</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>also holds documentation for the current release version</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>documentation for the next snapshot version, ie work-in-progress</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>other versions, by version number (eg <code>1.16.2</code>, <code>1.16.1</code>, etc)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>not checked into git, this is a working directory that contains the results of the latest publication build.
This is an implementation detail actually, so this directory need not be considered further.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The earlier versions of the documentation are (obviously) not recreated when the documentation is published, only the current version is updated.</p>
</div>
<div class="paragraph">
<p>To publish the current version of the documents, switch to the  <code>adocs/documentation</code> directory of the main <code>isis-git.repo</code>.
Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh publish.sh "ISIS-nnnn: a custom commit message"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deletes everything under <code>content</code> (except <code>content/versions</code>)</p>
</li>
<li>
<p>generates documentation and copies to <code>content/versions/SNAPSHOT</code></p>
<div class="paragraph">
<p>Including fixing up line endings, standardizing on unix-style LFs.</p>
</div>
</li>
<li>
<p>copies over current home page (<code>index.html</code>)</p>
</li>
<li>
<p>reinstates <code>content/*</code> with the contents of <code>content/versions/current</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, the effect of running <code>publish.sh</code> is in essence to overwrite <code>content/versions/SNAPSHOT</code> and to overwrite <code>index.html</code>, but leave everything else as it is.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The version on the header of each generated document is hard-coded in the <code>adocs/template/document.html.erb</code> file.</p>
</div>
<div class="paragraph">
<p>This should therefore be updated whenever working on a new release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="new-release"><a class="anchor" href="#new-release"></a>New release</h4>
<div class="paragraph">
<p>When a new release is published, we therefore need to do a little extra work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>publish.sh</code> a first time</p>
<div class="paragraph">
<p>This will  update <code>content/versions/SNAPSHOT</code></p>
</div>
</li>
<li>
<p>delete <code>content/versions/current</code></p>
</li>
<li>
<p>rename <code>content/versions/SNAPSHOT</code> to <code>content/versions/current</code></p>
</li>
<li>
<p>run <code>publish.sh</code> a second time.</p>
<div class="paragraph">
<p>This has the effect of "promoting" <code>content/versions/current</code> to <code>content/*</code></p>
</div>
</li>
<li>
<p>(optionally) also copy <code>content/versions/current</code> to <code>content/versions/N.N.N</code></p>
<div class="paragraph">
<p>where <code>N.N.N</code> is the release number</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ensure in doing this that the dropdown for the home page correctly references the versions.</p>
</div>
<div class="paragraph">
<p>When ready, then stage, commit and push the changes (in the <code>isis-site.git</code> directory, of course):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -am "ISIS-nnnn: updating docs"
git push</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="key-generation"><a class="anchor" href="#key-generation"></a>Key Generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order that a contributor can make a release it is necessary for them to have generated a key and had that key recognized by other members of the Apache Software Foundation.</p>
</div>
<div class="paragraph">
<p>For further background information on this topic, see the <a href="http://www.apache.org/dev/release-signing.html">release signing page</a> and the <a href="http://www.apache.org/dev/openpgp.html#generate-key">openpgp page</a> on the Apache wiki.</p>
</div>
<div class="sect2">
<h3 id="install-and-configure-gpg"><a class="anchor" href="#install-and-configure-gpg"></a>Install and Configure gpg</h3>
<div class="paragraph">
<p>Download and install GnuPG (gpg), version 1.4.10 or higher.</p>
</div>
<div class="paragraph">
<p>Then, edit <code>~/.gnupg/gpg.conf</code> (on Windows, the file to edit is <code>C:\Users\xxx\AppData\Roaming\gnupg\gpg.conf</code>) so that the default is to generate a strong key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">personal-digest-preferences SHA512
cert-digest-algo SHA512
default-preference-list SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="key-generation-2"><a class="anchor" href="#key-generation-2"></a>Key Generation</h3>
<div class="paragraph">
<p>The Apache Software Foundation requires that keys are signed with a key (or subkey) based on RSA 4096 bits. To do this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --gen-key
gpg (GnuPG) 1.4.11; Copyright (C) 2010 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Please select what kind of key you want:
   (1) RSA and RSA (default)
   (2) DSA and Elgamal
   (3) DSA (sign only)
   (4) RSA (sign only)
Your selection?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify RSA key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Your selection? 1

RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify key length as 4096 bits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>What keysize do you want? (2048) 4096
Requested keysize is 4096 bits

Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify key as non-expiring:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Key is valid for? (0) 0
Key does not expire at all
Is this correct? (y/N) y

You need a user ID to identify your key; the software constructs the user ID
from the Real Name, Comment and Email Address in this form:
    "Heinrich Heine (Der Dichter) &lt;heinrichh@duesseldorf.de&gt;"

Real name:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enter your name, email and comment:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use your apache.org email</p>
</li>
<li>
<p>the comment should be "CODE SIGNING KEY"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Real name: Xxx Xxxxxxxxx
Email address: <a href="mailto:&#x78;&#120;&#120;&#64;&#97;&#x70;&#97;&#99;&#104;&#x65;&#46;&#111;&#x72;&#103;">&#x78;&#120;&#120;&#64;&#97;&#x70;&#97;&#99;&#104;&#x65;&#46;&#111;&#x72;&#103;</a>
Comment: CODE SIGNING KEY
You selected this USER-ID:
 "Xxx Xxxxxxxxx (CODE SIGNING KEY) <a href="mailto:&#x78;&#x78;&#x78;&#x40;&#97;&#x70;&#97;&#99;h&#101;&#x2e;&#x6f;r&#x67;">&#x78;&#x78;&#x78;&#x40;&#97;&#x70;&#97;&#99;h&#101;&#x2e;&#x6f;r&#x67;</a>"</p>
</div>
<div class="paragraph">
<p>Change (N)ame, &#169;omment, (E)mail or (O)kay/(Q)uit? O</p>
</div>
<div class="paragraph">
<p>You need a Passphrase to protect your secret key.
Enter passphrase:</p>
</div>
<div class="paragraph">
<p>Provide a passphrase to secure your key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Enter passphrase:
Repeat passphrase:</code></pre>
</div>
</div>
<div class="paragraph">
<p>GPG will goes on to generate your key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
...+++++
.........................+++++
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
....+++++
...+++++
gpg: key nnnnnnnn marked as ultimately trusted
public and secret key created and signed.

gpg: checking the trustdb
gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model
gpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u
pub   4096R/nnnnnnnn yyyy-mm-dd
      Key fingerprint = xxxx xxxx xxxx xxxx xxxx  xxxx xxxx xxxx xxxx xxxx
uid                  Xxx Xxxxxx &lt;xxx@apache.org&gt;
sub   4096R/kkkkkkkk yyyy-mm-dd</code></pre>
</div>
</div>
<div class="paragraph">
<p>The public key with id nnnnnnnn should now be stored in <code>~/.gnupg/pubring.pgp</code> (on Windows 7, this is in <code>c:/Users/xxx/AppData/Roaming/gnupg/pubring.pgp</code>).</p>
</div>
<div class="paragraph">
<p>To confirm the key has been generated, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --list-keys --fingerprint</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key Id is the one true way to identify the key, and is also the last 8 digits of the fingerprint. The corresponding secret key for id <code>nnnnnnnn</code> is stored in <code>~/.gnupg/secring.pgp</code> (on Windows 7, this is in <code>c:/Users/xxx/AppData/Roaming/gnupg/secring.pgp</code>).</p>
</div>
<div class="paragraph">
<p>It&#8217;s also worth confirming the key has the correct preference of algorithms (reflecting the initial configuration we did earlier). For this, enter the gpg shell for your new key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --edit-key nnnnnnnnn
&gt;gpg</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>nnnnnnnn</code> is your key id. Now, use the 'showpref' subcommand to list details:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>gpg&gt; showpref
[ultimate] (1). Xxx Xxxxxxxx (CODE SIGNING KEY) &lt;xxx@apache.org&gt;
     Cipher: AES256, AES192, AES, CAST5, 3DES
     Digest: SHA512, SHA384, SHA256, SHA224, SHA1
     Compression: ZLIB, BZIP2, ZIP, Uncompressed
     Features: MDC, Keyserver no-modify

gpg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Digest line should list SHA-512 first and SHA-1 last. If it doesn&#8217;t, use the "setpref" command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>setpref SHA512 SHA384 SHA256 SHA224 AES256 AES192 AES CAST5 ZLIB BZIP2 ZIP Uncompressed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, remember to take a backup of your key and the keyring (ie, backup the <code>.gnupg</code> directory and its contents).</p>
</div>
</div>
<div class="sect2">
<h3 id="subkey-generation"><a class="anchor" href="#subkey-generation"></a>Subkey Generation</h3>
<div class="paragraph">
<p>It&#8217;s recommended to use a subkey with an expiry date to sign releases, rather than your main, non-expiring key. If a subkey is present, then gpg will use it for signing in preference to the main key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>After (binary) release artifacts are created, they are deployed to the ASF&#8217;s Nexus staging repository. However, Nexus seems unable to retrieve a subkey from the public key server. Until we find a fix/workaround for this, all releases should be signed just with a regular non-expiring main key.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a subkey Enter the gpg shell using (the identifier of) your main key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>gpg --edit-key xxxxxxxx
gpg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Type 'addkey' to create a subkey, and enter your passphrase for the main key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>gpg&gt; addkey
Key is protected.
[enter your secret passphrase]

You need a passphrase to unlock the secret key for
user: "Dan Haywood (CODE SIGNING KEY) &lt;danhaywood@apache.org&gt;"
4096-bit RSA key, ID xxxxxxxx, created 2011-02-01

Please select what kind of key you want:
   (3) DSA (sign only)
   (4) RSA (sign only)
   (5) Elgamal (encrypt only)
   (6) RSA (encrypt only)
Your selection?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select (6) to choose an RSA key for encryption:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It would seem that Nexus repository manager does not recognize RSA subkeys with an 'S&#8217;ign usage; see this discussion on a mailing list and this issue on Sonatype&#8217;s JIRA</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Your selection? 6

RSA keys may be between 1024 and 4096 bits long.
What keysize do you want? (2048) 4096

Requested keysize is 4096 bits

Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify that the key is valid for 1 year:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Key is valid for? (0) 1y

Key expires at yy/MM/dd hh:mm:ss
Is this correct? (y/N) y
Really create? (y/N) y
We need to generate a lot of random bytes. It is a good idea to perform
some other action (type on the keyboard, move the mouse, utilize the
disks) during the prime generation; this gives the random number
generator a better chance to gain enough entropy.
...+++++
.+++++

pub  4096R/xxxxxxxx  created: yyyy-mm-dd  expires: never       usage: SC
                     trust: ultimate      validity: ultimate
sub  4096R/xxxxxxxx  created: yyyy-mm-dd  expires: yyYY-mm-dd  usage: E
[ultimate] (1). Dan Haywood (CODE SIGNING KEY) &lt;danhaywood@apache.org&gt;

gpg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quit the gpg shell; you now have a subkey.</p>
</div>
</div>
<div class="sect2">
<h3 id="generate-a-revocation-certificate"><a class="anchor" href="#generate-a-revocation-certificate"></a>Generate a Revocation Certificate</h3>
<div class="paragraph">
<p>It&#8217;s good practice to generate a number of revocation certificates so that the key can be revoked if it happens to be compromised. See the <a href="http://www.apache.org/dev/openpgp.html#revocation-certs">gpg page</a> on the Apache wiki for more background on this topic.</p>
</div>
<div class="paragraph">
<p>First, generate a "no reason specified" key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --output revoke-nnnnnnnn-0.asc --armor --gen-revoke nnnnnnnn

sec  4096R/nnnnnnnn yyyy-mm-dd Xxx Xxxxxxx (CODE SIGNING KEY) &lt;xx@apache.org&gt;
Create a revocation certificate for this key? (y/N) Y

Please select the reason for the revocation:
  0 = No reason specified
  1 = Key has been compromised
  2 = Key is superseded
  3 = Key is no longer used
  Q = Cancel
(Probably you want to select 1 here)
Your decision?</code></pre>
</div>
</div>
<div class="paragraph">
<p>Select 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Your decision? 0

Enter an optional description; end it with an empty line:</code></pre>
</div>
</div>
<div class="paragraph">
<p>Provide a description:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>&gt; Generic certificate to revoke key, generated at time of key creation.
&gt;
Reason for revocation: No reason specified
Generic certificate to revoke key, generated at time of key creation.
Is this okay? (y/N)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm this is ok.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>Is this okay? y

You need a passphrase to unlock the secret key for
user: "Xxx Xxxxxxx (CODE SIGNING KEY) &lt;xxx@apache.org&gt;"
4096-bit RSA key, ID nnnnnnnn, created yyyy-mm-dd

Enter passphrase:
&lt;/pre&gt;

Enter a passphrase:

&lt;pre&gt;
Enter passphrase:
Revocation certificate created.

Please move it to a medium which you can hide away; if Mallory gets
access to this certificate he can use it to make your key unusable.
It is smart to print this certificate and store it away, just in case
your media become unreadable.  But have some caution:  The print system of
your machine might store the data and make it available to others!</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file <code>revoke-nnnnnnnn-0.asc</code> should be created: Then, backup this file.</p>
</div>
<div class="paragraph">
<p>Now repeat the process to create two further revocation certificates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gpg --output revoke-nnnnnnnn-1.asc --armor --gen-revoke nnnnnnnn</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify reason as "1 = Key has been compromised"</p>
</div>
<div class="paragraph">
<p>and:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">gpg --output revoke-nnnnnnnn-3.asc --armor --gen-revoke nnnnnnnn</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specify reason as "3 = Key is no longer used"</p>
</div>
<div class="paragraph">
<p>Backup these files also.</p>
</div>
</div>
<div class="sect2">
<h3 id="publish-key"><a class="anchor" href="#publish-key"></a>Publish Key</h3>
<div class="paragraph">
<p>It is also necessary to publish your key. There are several places where this should be done. In most cases, you&#8217;ll need the "armored" &quot; (ie ASCII) representation of your key. This can be generated using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --armor --export nnnnnnnn &gt; nnnnnnnn.asc</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>nnnnnnnn</code> is the id of your public key.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll also need the fingerprint of your key. This can be generated using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --fingerprint nnnnnnnn</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from this command includes a line beginning "Key fingerprint", followed by a (space delimited) 40 character hexadecimal fingerprint. The last 8 characters should be the same as the key id (<code>nnnnnnnn</code>).</p>
</div>
<div class="sect3">
<h4 id="publish-to-a-public-key-server"><a class="anchor" href="#publish-to-a-public-key-server"></a>Publish to a public key server</h4>
<div class="paragraph">
<p>To a publish your key to a public key server (eg the MIT key server hosted at <a href="http://pgp.mit.edu">http://pgp.mit.edu</a>), use the procedure below. Public key servers synchronize with each other, so publishing to one key server should be sufficient. For background reading on this, see the <a href="http://www.apache.org/dev/release-signing.html#keyserver-upload">release signing page</a> on the Apache wiki, and the <a href="http://maven.apache.org/developers/release/pmc-gpg-keys.html">gpg key page</a> on the Maven wiki.</p>
</div>
<div class="paragraph">
<p>To send the key up to the key server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>$ gpg --send-keys --keyserver pgp.mit.edu nnnnnnnn</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>nnnnnnnn</code> is the key Id.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can browse to the <a href="http://pgp.mit.edu/">MIT key server</a> and paste in the armored representation of your key.</p>
</div>
<div class="paragraph">
<p>Confirm the key has been added by browsing to submitting the following URL:</p>
</div>
<div class="paragraph">
<p><code><a href="http://pgp.mit.edu:11371/pks/lookup?search=0xnnnnnnnnn&amp;op=vindex" class="bare">http://pgp.mit.edu:11371/pks/lookup?search=0xnnnnnnnnn&amp;op=vindex</a></code></p>
</div>
<div class="paragraph">
<p>again, where <code>nnnnnnnn</code> is the key Id.</p>
</div>
</div>
<div class="sect3">
<h4 id="publish-to-your-apache-home-directory"><a class="anchor" href="#publish-to-your-apache-home-directory"></a>Publish to your Apache home directory</h4>
<div class="paragraph">
<p>The armored representation of your public key should be uploaded to your home directory on <code>people.apache.org</code>, and renamed as <code>.pgpkey</code>. Make sure this is readable by all.</p>
</div>
</div>
<div class="sect3">
<h4 id="publish-to-your-apache-html-home-directory"><a class="anchor" href="#publish-to-your-apache-html-home-directory"></a>Publish to your Apache HTML home directory</h4>
<div class="paragraph">
<p>The armored representation of your public key should be uploaded to your <code>public_html</code> home directory on <code>people.apache.org</code>, named <code>nnnnnnnn.asc</code>. Make sure this is readable by all.</p>
</div>
<div class="paragraph">
<p>Check the file is accessible by browsing to:</p>
</div>
<div class="paragraph">
<p><code><a href="http://people.apache.org/~xxxxxxxx/nnnnnnnn.asc" class="bare">http://people.apache.org/~xxxxxxxx/nnnnnnnn.asc</a></code></p>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>xxxxxxxx</code> is your apache LDAP user name</p>
</li>
<li>
<p><code>nnnnnnnn</code> is your public key id.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="foaf"><a class="anchor" href="#foaf"></a>FOAF</h4>
<div class="paragraph">
<p>First, check out the committers/info directory:</p>
</div>
<div class="paragraph">
<p>Go to Apache <a href="http://people.apache.org/foaf/foafamatic.html">FOAF-a-matic</a> web page to generate the FOAF file text (we copy this text out in a minute):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enter ASF LDAP user name</p>
</li>
<li>
<p>enter First name, Last name</p>
</li>
<li>
<p>for PGP key fingerprints, add Key</p>
</li>
<li>
<p>paste in the key id</p>
</li>
<li>
<p>paste in the fingerprint</p>
</li>
<li>
<p>press "Create"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the box below, you should have a FOAF file, something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;rdf:RDF
      xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
      xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
      xmlns:foaf="http://xmlns.com/foaf/0.1/"
      xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
      xmlns:pm="http://www.web-semantics.org/ns/pm#"
      xmlns:wot="http://xmlns.com/wot/0.1/"
      xmlns:rss="http://purl.org/rss/1.0/"
      xmlns:dc="http://purl.org/dc/elements/1.1/"
      xmlns:ical="http://www.w3.org/2002/12/cal/ical#"
      xmlns:doap="http://usefulinc.com/ns/doap#"&gt;
  &lt;foaf:Person rdf:ID="danhaywood"&gt;
    &lt;foaf:name&gt;Xxx Xxxxxxxx&lt;/foaf:name&gt;
    &lt;foaf:givenname&gt;Xxx&lt;/foaf:givenname&gt;
    &lt;foaf:family_name&gt;Xxxxxxxx&lt;/foaf:family_name&gt;
    &lt;wot:hasKey&gt;
      &lt;wot:PubKey&gt;
        &lt;wot:fingerprint&gt;nnnn nnnn nnnn nnnn nnnn  nnnn nnnn nnnn nnnn nnnn&lt;/wot:fingerprint&gt;
        &lt;wot:hex_id&gt;nnnnnnnn&lt;/wot:hex_id&gt;
      &lt;/wot:PubKey&gt;
    &lt;/wot:hasKey&gt;
  &lt;/foaf:Person&gt;
&lt;/rdf:RDF&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>(If you are creating the FOAF file for the first time, you may want to add additional details).</p>
</div>
<div class="paragraph">
<p>From this, copy out the <code>wot:key</code>, and paste into your FDF file in <code>committers/info</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;wot:hasKey&gt;
  &lt;wot:PubKey&gt;
    &lt;wot:fingerprint&gt;nnnn nnnn nnnn nnnn nnnn  nnnn nnnn nnnn nnnn nnnn&lt;/wot:fingerprint&gt;
    &lt;wot:hex_id&gt;nnnnnnnn&lt;/wot:hex_id&gt;
  &lt;/wot:PubKey&gt;
&lt;/wot:hasKey&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, manually add in a <code>&lt;wot:pubkeyAddress&gt;</code> element within <code>&lt;wot:PubKey&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;wot:hasKey&gt;
  &lt;wot:PubKey&gt;
    &lt;wot:fingerprint&gt;nnnn nnnn nnnn nnnn nnnn  nnnn nnnn nnnn nnnn nnnn&lt;/wot:fingerprint&gt;
    &lt;wot:hex_id&gt;nnnnnnnn&lt;/wot:hex_id&gt;
    &lt;wot:pubkeyAddress rdf:resource="http://people.apache.org/~username/nnnnnnnn.asc/"&gt;
  &lt;/wot:PubKey&gt;
&lt;/wot:hasKey&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ie, referencing your publicly exported public key</p>
</div>
<div class="paragraph">
<p>Finally, commit your changes.</p>
</div>
</div>
<div class="sect3">
<h4 id="save-to-keys"><a class="anchor" href="#save-to-keys"></a>Save to <code>KEYS</code></h4>
<div class="paragraph">
<p>The armored representation of the public key should be saved to Apache Isis' <code>KEYS</code> file, <a href="http://www.apache.org/dist/isis/KEYS">http://www.apache.org/dist/isis/KEYS</a> (that is, in the ASF distribution directory for Apache Isis).</p>
</div>
<div class="paragraph">
<p>First, in a new directory, checkout this file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>svn -N co https://svn.apache.org/repos/asf/isis/ .</code></pre>
</div>
</div>
<div class="paragraph">
<p>This should bring down the <code>KEYS</code> file.</p>
</div>
<div class="paragraph">
<p>Then, export your signature and armored representation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>gpg --list-sigs nnnnnnnn &gt;&gt;KEYS
gpg --armor --export nnnnnnnn &gt;&gt;KEYS</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then commit.</p>
</div>
</div>
<div class="sect3">
<h4 id="id-apache-org"><a class="anchor" href="#id-apache-org"></a>id.apache.org</h4>
<div class="paragraph">
<p>Log onto <code>id.apache.org</code> and ensure that the finger print of your public key is correct.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="attend-key-signing-party-apache-web-of-trust"><a class="anchor" href="#attend-key-signing-party-apache-web-of-trust"></a>Attend Key Signing Party (Apache web of trust)</h3>
<div class="paragraph">
<p>It is strongly advised that the contributor attend a key signing party at an Apache event, in order that other Apache committers/members can in person verify their identity against the key. The process for this is described <a href="http://www.apache.org/dev/release-signing.html#key-signing-party">here</a> and <a href="http://wiki.apache.org/apachecon/PgpKeySigning">here</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="update-maven-settings-file-m2settings-xml"><a class="anchor" href="#update-maven-settings-file-m2settings-xml"></a>Update Maven Settings file (<code>~/.m2/settings.xml</code>)</h3>
<div class="paragraph">
<p>The Maven release plugin will automatically sign the release, however it is necessary to update the <code>~/.m2/settings.xml</code> file with your GPG acronym passphrase in order that it can use your secret key. This is defined under a profile so that it is activated only when we perform a release (as defined by <code>[org,apache:apache]</code> parent POM.</p>
</div>
<div class="paragraph">
<p>Therefore, make the following edits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  ...
  &lt;profiles&gt;
    &lt;profile&gt;
      &lt;id&gt;apache-release&lt;/id&gt;
      &lt;properties&gt;
        &lt;gpg.passphrase&gt;xxx xxx xxx xxx xxx xxx xxx&lt;/gpg.passphrase&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, to allow the release plugin to tag SVN changes, you must either add in your LDAP username/password or configure <code>.ssh</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  ...
  &lt;servers&gt;
    ...
    &lt;server&gt;
      &lt;id&gt;apache.releases.https&lt;/id&gt;
      &lt;username&gt;xxxx&lt;/username&gt;
      &lt;password&gt;xxxx&lt;/password&gt;
    &lt;/server&gt;
  &lt;/servers&gt;
&lt;/settings&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="release-process-prereqs"><a class="anchor" href="#release-process-prereqs"></a>Appendix: Release Prereqs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section (appendix) describes the prerequisites for the <a href="#release-process">release process</a>.</p>
</div>
<div class="sect2">
<h3 id="configure-toolchains-plugin"><a class="anchor" href="#configure-toolchains-plugin"></a>Configure toolchains plugin</h3>
<div class="paragraph">
<p>Apache Isis releases are built using Java 7, enforced using the maven toolchains plugin.
Ensure that Java 7 is installed and the toolchains plugin is configured, as described in the <a href="../devguide/building-apache-isis.html#configure-maven-toolchains-plugin" class="page">developers' guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="publicprivate-key"><a class="anchor" href="#publicprivate-key"></a>Public/private key</h3>
<div class="paragraph">
<p>The most important configuration you require is to set up public/private key pair.
This is used by the <code>maven-release-plugin</code> to sign the code artifacts.
See the page on <a href="#key-generation">key generation</a> for more details.</p>
</div>
<div class="paragraph">
<p>In order to prepare the release, you&#8217;ll (need to) have a <code>~/.gnupg</code> directory with the relevant files (<code>gpg.conf</code>, <code>pubring.gpg</code>, <code>secring.gpg</code> etc), and have <code>gpg</code> on your operating system PATH.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If on Windows, the equivalent directory is <code>c:\users\xxx\appdata\roaming\gnupg</code>.
For <code>gpg</code>, use either <a href="http://cygwin.com">cygwin.com</a> or <a href="http://www.gpg4win.org">gpg4win.org</a>.</p>
</div>
<div class="paragraph">
<p>Note also that the mSysGit version of <code>gpg.exe</code> (as provided by GitHub&#8217;s bash client) is not compatible with that provided by cygwin; move it to one side and check that <code>gpg.exe</code> being used is that from gpg4win.</p>
</div>
<div class="paragraph">
<p>If you use Atlassian&#8217;s SourceTree, this also bundles a version of <code>gpg.exe</code> that is not compatible (in <code>C:\Users\xxx\AppData\Local\Atlassian\SourceTree\git_local\usr\bin</code>); again, move it to one side and instead use the one provided by gpg4win.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="maven-settings-xml"><a class="anchor" href="#maven-settings-xml"></a>Maven <code>settings.xml</code></h3>
<div class="paragraph">
<p>During the release process the <code>maven-deploy-plugin</code> uploads the generated artifacts to a staging repo on the <a href="http://repository.apache.org">Apache repository manager</a>. This requires your Apache LDAP credentials to be specified in your <code>~/.m2/settings.xml</code> file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;settings&gt;
  &lt;servers&gt;
    &lt;server&gt;
      &lt;id&gt;apache.releases.https&lt;/id&gt;
      &lt;username&gt;xxxxxxx&lt;/username&gt;
      &lt;password&gt;yyyyyyy&lt;/password&gt;
    &lt;/server&gt;
    ...
  &lt;/servers&gt;
  ...
&lt;/settings&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>xxxxxxx</code> and <code>yyyyyyy</code> are your Apache LDAP username and password.
For more information, see these <a href="http://www.apache.org/dev/publishing-maven-artifacts.html#dev-env">ASF docs</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is also possible to configure to use <code>.ssh</code> secure keys, and thereby avoid hardcoding your Apache LDAP password into your <code>.m2/settings.xml</code> file.
A description of how to do this can be found, for example, <a href="http://bval.apache.org/release-setup.html">here</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also, set up keyphrase for <code>gpg</code>; this avoids being prompted during release:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
  &lt;profile&gt;
    &lt;id&gt;gpg&lt;/id&gt;
    &lt;properties&gt;
      &lt;gpg.executable&gt;gpg2&lt;/gpg.executable&gt;
      &lt;gpg.passphrase&gt;this is not really my passphrase&lt;/gpg.passphrase&gt;
    &lt;/properties&gt;
  &lt;/profile&gt;
  ...
&lt;/profiles&gt;

&lt;activeProfiles&gt;
  &lt;activeProfile&gt;gpg&lt;/activeProfile&gt;
  ...
&lt;/activeProfiles&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="policies"><a class="anchor" href="#policies"></a>Policies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter pulls together various policy documents relating to the development of Apache Isis'.</p>
</div>
<div class="sect2">
<h3 id="versioning-policy"><a class="anchor" href="#versioning-policy"></a>Versioning Policy</h3>
<div class="sect3">
<h4 id="semantic-versioning"><a class="anchor" href="#semantic-versioning"></a>Semantic Versioning</h4>
<div class="paragraph">
<p>Starting from v1.0.0, Apache Isis has adopted <a href="http://semver.org">semantic versioning</a> for its versioning policy.</p>
</div>
<div class="paragraph">
<p>Version numbers are in the form <code>x.y.z</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x is bumped up whenever there a breaking API change</p>
</li>
<li>
<p>y is bumped up whenever there is a new feature that does not break API</p>
</li>
<li>
<p>z is bumped up for minor bug fixes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This scheme would be adopted for both core and components.</p>
</div>
</div>
<div class="sect3">
<h4 id="version-ranges"><a class="anchor" href="#version-ranges"></a>Version ranges</h4>
<div class="paragraph">
<p>Version ranges may not be used.  If necessary, end-users can use <code>&lt;dependencyManagement</code> elements to have combine components built against different versions of core.</p>
</div>
<div class="paragraph">
<p>That said, this can introduce instability and so generally we recommend that end-users configure the <code>maven-enforcer-plugin</code> and its <a href="http://maven.apache.org/enforcer/enforcer-rules/dependencyConvergence.html">DependencyConvergence</a> rule.  This will help avoid "jar hell" (components having conflicting dependencies of core).</p>
</div>
<div class="paragraph">
<p>If there is a conflict, we would ask that end-users engage with Apache Isis committers to have an updated version of the component(s) pushed out.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="git-policy"><a class="anchor" href="#git-policy"></a>Git Policy</h3>
<div class="paragraph">
<p>These notes recommend how contributors should work with git. To understand these notes, the only real concepts that you need to grok are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>git commits form an acyclic graph, with each commit pointing to its parent commit (or commit<strong>s</strong>, if a merge)</p>
</li>
<li>
<p>a branch is merely a pointer to one of these commits; git calls the main branch <code>master</code></p>
</li>
<li>
<p>git commits happen in two steps: first they are added to the index (also called the staging area), then they are committed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more background reading, see:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://git-scm.com/book">Pro Git</a> book (free in electronic form)</p>
</li>
<li>
<p><a href="https://github.s3.amazonaws.com/media/book.pdf">Git community book</a></p>
</li>
<li>
<p><a href="http://git-scm.com/2011/07/11/reset.html">git reset demystified</a> - differentiating the working directory vs index/staging area</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>And, of course, there is loads of good advice on <a href="http://stackoverflow.com/questions/tagged/git">stackoverflow.com</a></p>
</div>
<div class="sect3">
<h4 id="workflow"><a class="anchor" href="#workflow"></a>Workflow</h4>
<div class="paragraph">
<p>There are many ways of using Git, but the Apache Isis committers have adopted the following workflow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a topic branch for a feature<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout -b ISIS-999</code></pre>
</div>
</div>
</li>
<li>
<p>periodically, push the branch to origin (for safekeeping):<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push origin ISIS-999</code></pre>
</div>
</div>
</li>
<li>
<p><code>rebase</code> the topic branch periodically on master.<br></p>
<div class="paragraph">
<p>How often you do this will depend on whether you are collaborating with others on the feature.  You need to ensure that your co-worker has no outstanding work before you do this; otherwise it&#8217;ll create merge conflict hell for them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout master
git pull
git checkout ISIS-999
git rebase master
git push origin ISIS-999 --force</code></pre>
</div>
</div>
</li>
<li>
<p>when feature is complete, rebase once more (as above), then switch to master and perform a <code>merge --no-ff</code>:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout master
git merge --no-ff ISIS-999</code></pre>
</div>
</div>
</li>
<li>
<p>finally, remove the branch<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git branch -d ISIS-999
git push origin --delete ISIS-999</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This way of working gives us the full history on the branch as to what the thought processes were for the feature, but only a single commit on to <code>master</code> to see the ultimate impact of the changes (acting a bit like a summary).</p>
</div>
</div>
<div class="sect3">
<h4 id="commit-message"><a class="anchor" href="#commit-message"></a>Commit message</h4>
<div class="paragraph">
<p>The minimum we expect in a commit messages is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ISIS-nnn: brief summary here

- optionally, longer details
- should be written here
- in bullet points</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>ISIS-nnn</code> is a ticket raised in our <a href="https://issues.apache.org/jira/browse/ISIS">JIRA issue tracker</a>.</p>
</div>
<div class="paragraph">
<p>For non-committers we typically expect more detail again; see the <a href="../devguide/contributing.html" class="page">contributing</a> page for the longer format recommended for contributors to use.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pmc-notes"><a class="anchor" href="#pmc-notes"></a>Appendix: PMC</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every ASF project has a Project Management Committee, or PMC.
This committee is ultimately responsible for the long-term management of the framework.
More information about PMCs can be found <a href="http://www.apache.org/dev/pmc.html">here</a></p>
</div>
<div class="paragraph">
<p>In Apache Isis, every committer is a member of the PMC.</p>
</div>
<div class="paragraph">
<p>This page contains some general notes on maintenance activities required by PMC members.</p>
</div>
<div class="sect2">
<h3 id="prereqs"><a class="anchor" href="#prereqs"></a>Prereqs</h3>
<div class="paragraph">
<p>To complete the procedures documented here, you&#8217;ll need <code>ssh</code> access to <code>minotaur.apache.org</code>.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ssh danhaywood@minotaur.apache.org</code></pre>
</div>
</div>
<div class="paragraph">
<p>When prompted, provide passphrase for private key.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To set up ssh in the first place, take a look at <a href="https://www.apache.org/dev/new-committers-guide.html#ssh-setup">this section in the ASF new committers' guide</a> looks relevant.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="new-committerpmc-member"><a class="anchor" href="#new-committerpmc-member"></a>New Committer/PMC member</h3>
<div class="paragraph">
<p>Currently we don&#8217;t distinguish between committers and PMC members: every committer is automatically invited to also be a member of the PMC.</p>
</div>
<div class="paragraph">
<p>Further notes on the steps for new PMC members can be found <a href="http://www.apache.org/dev/pmc.html#newpmc">here</a>.</p>
</div>
<div class="sect3">
<h4 id="start-a-vote-thread-on-private"><a class="anchor" href="#start-a-vote-thread-on-private"></a>Start a vote thread on private@</h4>
<div class="paragraph">
<p>First, send a [VOTE] email to <code>private@isis.apache.org</code>, making the case for the new committer to join.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[VOTE] Joe Bloggs as a committer and PMC Member                                         <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>with body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>I'd like to nominate Joe Bloggs as a committer and also a PMC member for Apache Isis.   <i class="conum" data-value="1"></i><b>(1)</b>

Joe this ...                                                                            <i class="conum" data-value="1"></i><b>(1)</b>

Joe that ...                                                                            <i class="conum" data-value="1"></i><b>(1)</b>

Overall, I think Joe would be a great addition to Isis' committers and PMC; ...

Voting ends in one week's time, i.e. midnight UTC on YYYY-MM-DD                         <i class="conum" data-value="1"></i><b>(1)</b>
http://www.timeanddate.com/countdown/to?year=YYYY&amp;month=MM&amp;day=DD</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By convention, we run these votes for 7 days (a minimum of 3 days is required by ASF).</p>
</div>
</div>
<div class="sect3">
<h4 id="close-the-vote-announce-results"><a class="anchor" href="#close-the-vote-announce-results"></a>Close the vote, announce results</h4>
<div class="paragraph">
<p>After the 7 days has expired, close the vote thread.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>I'm now closing this vote.  Result will be posted on a new thread.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a separate thread, announce the results.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[RESULT] [VOTE] Joe Bloggs as a committer and PMC Member                                <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>with body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>The vote has now closed. The results are:

+3 (PMC)                                                                                <i class="conum" data-value="1"></i><b>(1)</b>

consisting of:
* Mary (PMC)                                                                            <i class="conum" data-value="1"></i><b>(1)</b>
* Mungo (PMC)
* Midge (PMC)

There were no other votes cast.

The vote is ***successful***

I'll announce to users@ and dev@ by separate thread.</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="icla-obtain-new-account"><a class="anchor" href="#icla-obtain-new-account"></a>ICLA, obtain new account</h4>
<div class="paragraph">
<p>If required (that is, if the committer is not already a committer for a different ASF project),
then ask them to complete an ICLA.
As a result of this, they should also get an @apache.org user name.</p>
</div>
<div class="paragraph">
<p>More info can be found in the <a href="https://www.apache.org/dev/new-committers-guide.html#icla-required-before-account-creation">ASF new committers guide</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="update-the-isis-unix-group"><a class="anchor" href="#update-the-isis-unix-group"></a>Update the <code>isis</code> unix group</h4>
<div class="paragraph">
<p>All committers must be added to the <code>isis</code> UNIX group.
This will give them commit access to the Apache Isis git repo.</p>
</div>
<div class="paragraph">
<p>To do this, log onto <code>minotaur.apache.org</code>, then eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">list_unix_group.pl isis</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">modify_unix_group.pl isis --add joebloggs                                               <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="update-the-ldap-committee-if-a-pmc-member"><a class="anchor" href="#update-the-ldap-committee-if-a-pmc-member"></a>Update the LDAP committee (if a PMC member)</h4>
<div class="paragraph">
<p>(Assuming that the new committer is a PMC member), also add them as to the PMC committee.
This takes two steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>first, log onto <code>minotaur.apache.org</code> and update LDAP committee:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">list_committee.pl isis</code></pre>
</div>
</div>
<div class="paragraph">
<p>and<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">modify_committee.pl isis --add joebloggs                                                <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
</li>
<li>
<p>second, update <code>committee-info.txt</code><br></p>
<div class="paragraph">
<p>This is held in SVN, under <a href="https://svn.apache.org/repos/private">https://svn.apache.org/repos/private</a>; the file resides at <code>committers/board/committee-info.txt</code></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new committer does not officially become a member of the PMC until the ASF records have been updated.</p>
</div>
</div>
<div class="sect3">
<h4 id="notify-the-asf-board-and-private-mailing-list"><a class="anchor" href="#notify-the-asf-board-and-private-mailing-list"></a>Notify the ASF board and private mailing list</h4>
<div class="paragraph">
<p>Send a <code>[NOTICE]</code> email to <code>board@apache.org</code> and also to <code>private@isis.apache.org</code></p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[NOTICE] Joe Bloggs to join Apache Isis as committer and member of the PMC              <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>with body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>The Apache Isis PMC has voted Joe Bloggs as a committer and also member of the PMC.     <i class="conum" data-value="1"></i><b>(1)</b>

Voting thread:
https://mail-search.apache.org/members/private-arch/isis-private/xxx                    <i class="conum" data-value="1"></i><b>(1)</b>

Results announcement:
https://mail-search.apache.org/members/private-arch/isis-private/xxx                    <i class="conum" data-value="1"></i><b>(1)</b>

The committee-info.txt file has been updated, as have the LDAP groups (modify_unix_group.pl,  modify_committee.pl).</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>update the private threads above</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="update-project-metadata"><a class="anchor" href="#update-project-metadata"></a>Update project metadata</h4>
<div class="paragraph">
<p>Update the <code>STATUS</code> file (in the root directory of the Apache Isis git repo) with the new committer details.</p>
</div>
</div>
<div class="sect3">
<h4 id="announce-to-the-world"><a class="anchor" href="#announce-to-the-world"></a>Announce to the world</h4>
<div class="paragraph">
<p>Send an <code>[ANNOUNCE]</code> email TO <code>users@isis.apache.org</code> and to <code>dev@isis.apache.org</code>.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>[ANNOUNCE] New committer - Joe Bloggs                                                   <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>with body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>I'm delighted to announce that Joe Bloggs has been voted in as a committer on Isis, and also as a member of the Isis PMC.  The first gives Joe the right to commit changes directly to Isis' codebase, the second gives him the right to be involved in future votes.

Joe this ...                                                                            <i class="conum" data-value="1"></i><b>(1)</b>

Joe that ...

I'm looking forward to working with Joe in the future; another great addition to Isis' committers.  So please join me in welcoming him to our happy band!

Dan Haywood
Apache Isis PMC Chair</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>update as required</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also, write a similar blog post at <a href="https://blogs.apache.org/isis">blogs.apache.org/isis</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="removing-a-committer"><a class="anchor" href="#removing-a-committer"></a>Removing a committer</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>these notes are only draft, will need fleshing out.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>remove from <code>isis</code> UNIX group:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify_unix_group.pl isis --remove joebloggs</code></pre>
</div>
</div>
</li>
<li>
<p>remove from <code>isis</code> committee:<br></p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>modify_committee.pl isis --add joebloggs
modify_committee.pl isis --remove joebloggs</code></pre>
</div>
</div>
</li>
<li>
<p>remove from <code>committee-info.txt</code></p>
</li>
<li>
<p>send a [NOTICE] email to board@ and private@</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <h3 class="toc-title">On this page</h3>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2019 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20191208-0404-afb43393</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hideEffect: "slideUp",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
