<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cutting a Release :: Apache Isis</title>
    <meta name="generator" content="Antora 2.2.0">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
          <span class="icon">
            <img src="../../_/img/isis-logo-48x48.png"></img>
          </span>
        <span>Apache Isis</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../starters/helloworld/about.html">Hello World</a>
            <a class="navbar-item" href="../../starters/simpleapp/about.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Demos &amp; Tutorials</span>
            <a class="navbar-item" href="../../demoapp/about.html">Demo App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/about.html">User Guide</a>
            <a class="navbar-item" href="../../refguide/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../testing/about.html">Testing Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Libraries</span>
            <a class="navbar-item" href="../../subdomain/about.html">Subdomain Libraries</a>
            <a class="navbar-item" href="../../valuetypes/about.html">Value Types</a>
            <a class="navbar-item" href="../../mappings/about.html">Bounded Context Mapping Libraries</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../toc/devguide/about.html">Developers' Guide</a>
            <a class="navbar-item" href="../../toc/mavendeps/about.html">Maven dependencies</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/about.html">Wicket UI</a>
            <a class="navbar-item" href="../../vro/about.html">Restful Objects (REST)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../odn/about.html">DataNucleus (JDO)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Extensions</span>
            <a class="navbar-item" href="../../extensions/about.html">Extensions Catalog</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../toc/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../toc/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/ISIS">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Releases</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../toc/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/about.html">Release Notes</a>
            <a class="navbar-item" href="../../mignotes/about.html">Migration Notes</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">More Libraries</span>
            <a class="navbar-item" href="../../incubator/about.html">Incubator</a>
            <a class="navbar-item" href="../../legacy/about.html">Legacy</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Internal</span>
            <a class="navbar-item" href="../../toc/comguide/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../core/about.html">Core Design</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Isis.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../toc/about.html">
          <span class="icon">
            <img src="../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="toc" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html"> </a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">What is Apache Isis?</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/isis-in-pictures.html">Apache Isis in pictures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/common-use-cases.html">Common Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/screencasts.html">Screencasts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/powered-by.html">Powered By</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Starter Apps</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/apache/isis-app-helloworld">HelloWorld</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://github.com/apache/isis-app-simpleapp">SimpleApp</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Demos &amp; Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../demoapp/about.html">Demo App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Core</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../userguide/about.html">User Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../refguide/about.html">Reference Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../testing/about.html">Testing Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Libraries</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../subdomains/about.html">Subdomain Libraries</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../valuetypes/about.html">Value Types</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../mappings/about.html">Bounded Context Mapping Libraries</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../devguide/about.html">Developers' Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mavendeps/about.html">Maven dependencies</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Viewers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../vw/about.html">Wicket UI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../vro/about.html">Restful Objects (REST API)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../security/about.html">Security Guide</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Persistence</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../pjdo/about.html">DataNucleus (JDO)</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Extensions</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../extensions/about.html">Extensions Catalog</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/slack-channel.html">Slack</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../support/mailing-list.html">Mailing Lists</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=87">ASF JIRA</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="http://stackoverflow.com/questions/tagged/isis">Stack Overflow</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Releases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../downloads/how-to.html">Downloads</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../relnotes/about.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../mignotes/about.html">Migration Notes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Nightly Builds (not ASF)</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://github.com/apache-isis-committers/isis-nightly">CI</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://repo.incode.cloud/">Maven Repo</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://apache-isis-committers.github.io/isis-nightly/toc/about.html">Website preview</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Internal</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Committers' Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="about.html#cutting-a-release">Cutting a Release</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="about.html#verifying-releases">Verifying a Release</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../core/about.html">Core Design</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../more-thanks/more-thanks.html">Acknowledgements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">More Libraries</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../incubator/about.html">Incubator</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../legacy/about.html">Legacy</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title"> </span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">BC Mappings Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mappings/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Core Framework</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../core/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../pjdo/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../extensions/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../incubator/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Legacy Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../legacy/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../refguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Starter Apps</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../starters/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Subdomains Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../subdomains/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorial App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../userguide/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../valuetypes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html"> </a></li>
    <li><a href="cutting-a-release.html">Cutting a Release</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/isis/edit/HEAD/antora/components/toc/modules/comguide/pages/cutting-a-release.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Cutting a Release</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The release process consists of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the release manager cutting the release (documented below)</p>
</li>
<li>
<p>Members of the Apache Isis PMC <a href="about.html#verifying-releases" class="page">verifying</a> and voting on the release</p>
</li>
<li>
<p>the release manager performing post-release tasks, for either a <a href="about.html#post-release-successful.adoc" class="page">successful</a> or an <a href="#toc:comguide:post-release-unsuccessful">unsuccessful</a> vote.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Apache Isis itself consists of three separately releasable modules; relative to the <a href="https://github.com/apache/isis">source code root</a> there are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>core</code></p>
</li>
<li>
<p><code>component/example/archetypes/helloworld</code></p>
</li>
<li>
<p><code>component/example/archetypes/simpleapp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This section details the process for formally releasing Isis modules.  It describes the process for both <code>core</code> and then the archetypes.
The subsequent sections describe how other committers can <a href="about.html#verifying-releases.adoc" class="page">verify a release</a> and how the release manager can then perform <a href="#toc:comguide:post-release">post-release</a> activities and set up for the next development iteration.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve not performed a release before, then note that there are some configuration <a href="about.html#release-process-prereqs" class="page">prerequisites</a> that must be configured first.
In particular, you&#8217;ll need signed public/private keys, and the ASF Nexus staging repo inlocal <code>~/.m2/settings.xml</code> file.</p>
</div>
<div class="paragraph">
<p>These release notes using bash command line tools.
They should work on Linux and MacOS; for Windows, use mSysGit.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="obtain-consensus"><a class="anchor" href="#obtain-consensus"></a>Obtain Consensus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before releasing <code>core</code>, ensure there is consensus on the <a href="#toc:ROOT:support.adoc" class="page unresolved">dev mailing list</a> that this is the right time for a release.
The discussion should include confirming the version number to be used, and to confirm content.</p>
</div>
<div class="paragraph">
<p>These discussions should also confirm the version number of the module being released.
This should be in line with our <a href="about.html#versioning-policy" class="page">semantic versioning policy</a>.</p>
</div>
<div class="paragraph">
<p>Make sure you have a JIRA ticket open against which to perform all commits.
In most cases a JIRA ticket will have been created at the beginning of the previous release cycle.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="set-environment-variables"><a class="anchor" href="#set-environment-variables"></a>Set environment variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use environment variables to parameterize as many of the steps as possible.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp                               <i class="conum" data-value="1"></i><b>(1)</b>
export ISISREL=2.0.0-M3
export ISISRC=RC1
export ISISBRANCH=release-$ISISREL-$ISISRC
export ISISJIRA=ISIS-9999                           <i class="conum" data-value="2"></i><b>(2)</b>
export CATALINA_HOME=/c/java/apache-tomcat-9.0.10   <i class="conum" data-value="3"></i><b>(3)</b>

env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>adjust by platform</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>set to an "umbrella" ticket for all release activities.
(One should exist already, <a href="post-release-successful.html#create-new-jira" class="page">created at</a> the beginning of the development cycle now completing).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>adjust as required (Tomcat is used to smoke test the simpleapp archetype)</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Obviously, alter <code>$ISISREL</code> as required, and bump <code>$ISISRC</code> for re-releasing following an <a href="about.html#post-release-unsuccessful" class="page">unsuccessful</a> release.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the branch name is intentionally <strong>not</strong> the same any of the eventual tag names (eg <code>isis-2.0.0-M3</code> or <code>simpleapp-archetype-2.0.0-M3</code>).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pull-down-code-to-release"><a class="anchor" href="#pull-down-code-to-release"></a>Pull down code to release</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Set the HEAD of your local git repo to the commit to be released.
This will usually be the tip of the origin&#8217;s <code>master</code> branch.
Then, create a release branch for the version number being released; eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout master
git pull --ff-only
git checkout -b $ISISBRANCH</code></pre>
</div>
</div>
<div class="paragraph">
<p>The release is performed on a branch; if we are successful, this branch will be merged back into master.</p>
</div>
<div class="paragraph">
<p>Check that there are no snapshot dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">grep SNAPSHOT `/bin/find . -name pom.xml | grep -v target | grep -v mothball | sort`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only mention of <code>SNAPSHOT</code> should be in the <code>revision</code> property of the root <code>core/pom.xml</code> file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bump-revision-property-to-isisrel"><a class="anchor" href="#bump-revision-property-to-isisrel"></a>Bump <code>revision</code> property to <code>$ISISREL</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Previously we used the <code>maven-release-plugin</code> which took responsibility for bumping the <code>&lt;version&gt;</code> from -SNAPSHOT to release, and then onto the next -SNAPSHOT.
However, this plugin does not seem to be compatible with the support for <code>${revision}</code> property introduced in Maven 3.5.0 in order <a href="https://maven.apache.org/maven-ci-friendly.html">to support CI/CD use cases</a>; at least we couldn&#8217;t make it work.</p>
</div>
<div class="paragraph">
<p>So, instead, we perform the edit of <code>${revision}</code> in the three <code>pom.xml</code> files (for <code>core</code> and the two archetypes):</p>
</div>
<div class="paragraph">
<p>Change all of these to the release version, using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/version-bump.sh $ISISJIRA $ISISREL</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that they should read:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;properties&gt;
    &lt;revision&gt;2.0.0-M3&lt;/revision&gt;
    ...
&lt;/properties&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>After release, there is a <a href="#reset-revision">similar step at the end</a> to reset back to <code>1.0.0-SNAPSHOT</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="releasing-core"><a class="anchor" href="#releasing-core"></a>Releasing Core</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, we release <code>core</code>.
Switch to the appropriate directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd core</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="set-environment-variables-2"><a class="anchor" href="#set-environment-variables-2"></a>Set environment variables</h3>
<div class="paragraph">
<p>Set additional environment variables for the core "artifact":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=isis

env | grep ISIS | sort</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="license-headers"><a class="anchor" href="#license-headers"></a>License headers</h3>
<div class="paragraph">
<p>The Apache Release Audit Tool <code>RAT</code> (from the <a href="http://creadur.apache.org">Apache Creadur</a> project) checks for missing license header files.
The parent <code>pom.xml</code> of each releasable module specifies the RAT Maven plugin, with a number of custom exclusions.</p>
</div>
<div class="paragraph">
<p>To run the RAT tool, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn org.apache.rat:apache-rat-plugin:check -D rat.numUnapprovedLicenses=50 -o &amp;&amp; \
for a in `/bin/find . -name rat.txt -print`; do grep '!???' $a; done || \
for a in `/bin/find . -name rat.txt -print`; do grep '!AL' $a; done</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>rat.numUnapprovedLicenses</code> property is set to a high figure, temporarily overriding the default value of 0.
This will allow the command to run over all submodules, rather than failing after the first one.
The command writes out a <code>target\rat.txt</code> for each submodule.  missing license notes are indicated using the key <code>!???</code>.
The <code>for</code> command collates all the errors.</p>
</div>
<div class="paragraph">
<p>Investigate and fix any reported violations, typically by either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding genuinely missing license headers from Java (or other) source files, or</p>
</li>
<li>
<p>updating the <code>&lt;excludes&gt;</code> element for the <code>apache-rat-plugin</code> plugin to ignore test files, log files and any other non-source code files</p>
</li>
<li>
<p>also look to remove any stale <code>&lt;exclude&gt;</code> entries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you&#8217;ve fixed all issues, confirm once more that <code>apache-rat-plugin</code> no longer reports any license violations, this time leaving the <code>rat.numUnapprovedLicenses</code> property to its default, 0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn org.apache.rat:apache-rat-plugin:check -D rat.numUnapprovedLicenses=0 -o &amp;&amp; \
for a in `find . -name rat.txt -print`; do grep '!???' $a; done</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="missing-license-check"><a class="anchor" href="#missing-license-check"></a>Missing License Check</h3>
<div class="paragraph">
<p>Although Apache Isis has no dependencies on artifacts with incompatible licenses, the POMs for some of these dependencies (in the Maven central repo) do not necessarily contain the required license information.
Without appropriate additional configuration, this would result in the generated <code>DEPENDENCIES</code> file and generated Maven site indicating dependencies as having "unknown" licenses.</p>
</div>
<div class="paragraph">
<p>Fortunately, Maven allows the missing information to be provided by configuring the <code>maven-remote-resources-plugin</code>.
This is stored in the <code>src/main/appended-resources/supplemental-models.xml</code> file, relative to the root of each releasable module.</p>
</div>
<div class="paragraph">
<p>It&#8217;s first necessary to have built the framework locally at least once:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install -o</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this is done, capture the missing license information using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn license:download-licenses &amp;&amp; \
groovy ../scripts/checkmissinglicenses.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Maven plugin creates a <code>license.xml</code> file in the <code>target/generated-resources</code> directory of each module.
The script then searches for these <code>licenses.xml</code> files, and compares them against the contents of the <code>supplemental-models.xml</code> file.</p>
</div>
<div class="paragraph">
<p>For example, the output could be something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">licenses to add to supplemental-models.xml:

[org.slf4j, slf4j-api, 1.5.7]
[org.codehaus.groovy, groovy-all, 1.7.2]

licenses to remove from supplemental-models.xml (are spurious):

[org.slf4j, slf4j-api, 1.5.2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If any missing entries are listed or are spurious, then update <code>supplemental-models.xml</code> and try again.</p>
</div>
</div>
<div class="sect2">
<h3 id="commit-changes"><a class="anchor" href="#commit-changes"></a>Commit changes</h3>
<div class="paragraph">
<p>Commit any changes from the preceding steps:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -am "$ISISJIRA: updates to pom.xml etc for release"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sanity-check"><a class="anchor" href="#sanity-check"></a>Sanity check</h3>
<div class="paragraph">
<p>Perform one last sanity check on the codebase.
Delete all Isis artifacts from your local Maven repo, then build using the <code>-o</code> offline flag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf ~/.m2/repository/org/apache/isis
mvn clean install -o</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy"><a class="anchor" href="#deploy"></a>Deploy</h3>
<div class="paragraph">
<p>Previously the release procedures used <code>mvn release:prepare</code> and <code>mvn release:perform</code>.
These are however not compatible with <code>${revision}</code> that we now use <a href="https://maven.apache.org/maven-ci-friendly.html">for CI/CD</a>.</p>
</div>
<div class="paragraph">
<p>We therefore just use <code>mvn deploy</code> directly, activating the (inherited) <code>apache-release</code> profile that, amongst other things, brings in the <code>gpg</code> plugin for code signing.</p>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgit \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="releasing-simpleapp-archetype"><a class="anchor" href="#releasing-simpleapp-archetype"></a>Releasing <code>simpleapp</code> archetype</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Apache Isis archetypes are reverse engineered from example applications.
Once reverse engineered, the source is checked into git (replacing any earlier version of the archetype) and released.</p>
</div>
<div class="paragraph">
<p>There are currently two archetypes, <code>simpleapp</code> and <code>helloworld</code>.
In this section we release <code>simpleapp</code>, in the following <a href="#support:cutting-a-release.adoc#releasing-the-helloworld-archetype" class="page unresolved">section</a> we release <code>helloworld</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If releasing using Windows, then there is an issue that requires a small workaround.</p>
</div>
<div class="paragraph">
<p>In Maven 3.3.3 and later, the <code>mvn.bat</code> file was removed, replaced instead with <code>mvn.cmd</code>.
However, <code>maven-archetype-plugin:2.4</code> only uses <code>mvn.bat</code>; this causes the <code>archetype:create-from-project</code> goal to fail.
The fix is simple: just copy <code>mvn.cmd</code> to <code>mvn.bat</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Switch to the directory containing the <code>simpleapp</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ../example/application/simpleapp</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="setup-environment-variables"><a class="anchor" href="#setup-environment-variables"></a>Setup environment variables</h3>
<div class="paragraph">
<p>Set additional environment variables for the <code>simpleapp-archetype</code> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=simpleapp-archetype
export ISISPAR=$ISISREL                 <i class="conum" data-value="1"></i><b>(1)</b>

export ISISCPT=$(echo $ISISART | cut -d- -f2)
export ISISCPN=$(echo $ISISART | cut -d- -f1)

env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>$ISISPAR</code> is the version of the Apache Isis core that will act as the archetype&#8217;s parent.
Usually this is the same as <code>$ISISREL</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="check-the-example-app"><a class="anchor" href="#check-the-example-app"></a>Check the example app</h3>
<div class="paragraph">
<p>Double check that the app:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>builds:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>can be run from an IDE</p>
<div class="ulist">
<ul>
<li>
<p>mainClass=<code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>args=<code>-m domainapp.application.manifest.DomainAppAppManifestWithFixtures</code></p>
</li>
<li>
<p>run before: <code>mvn -pl module-simple datanucleus:enhance -o</code> in the root module</p>
</li>
</ul>
</div>
</li>
<li>
<p>can be run using the mvn jetty plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -pl webapp jetty:run</code></pre>
</div>
</div>
</li>
<li>
<p>can be packaged and run using the mvn jetty-console plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-jettyconsole
mvn antrun:run -Dmavenmixin-jettyconsole</code></pre>
</div>
</div>
</li>
<li>
<p>can be deployed as a WAR</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp webapp/target/simpleapp.war $CATALINA_HOME/webapps/ROOT.war
pushd $CATALINA_HOME/bin
sh startup.sh
tail -f ../logs/catalina.out</code></pre>
</div>
</div>
<div class="paragraph">
<p>quit using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh shutdown.sh
popd</code></pre>
</div>
</div>
</li>
<li>
<p>can be packaged and run using Docker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-docker -D docker-plugin.imageName=test/simpleapp
docker container run -p 8080:8080 --name simpleapp -d test/simpleapp</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>On Windows, make sure that Docker is first switched to using linux containers, not Windows containers (because the <code>Dockerfile</code> in the application references a linux base image).</p>
</div>
<div class="paragraph">
<p>You may also need to enable the Docker daemon first, otherwise the "mvn install" command above will fail:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/docker/docker-daemon.png"><img src="_images/docker/docker-daemon.png" alt="docker daemon" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>You might also need to ensure that the "Unidentified networks" are configured to be private:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/docker/026-docker-nat-private.png"><img src="_images/docker/026-docker-nat-private.png" alt="026 docker nat private" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>This can be done using the "Local Security Policy" application.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Optionally, you can connect to the running container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on Mac/Linux:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker exec -it simpleapp sh</code></pre>
</div>
</div>
</li>
<li>
<p>on Windows</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">winpty docker exec -it simpleapp sh</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can then tail the log of the Tomcat instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd /opt/*tomcat*/logs
tail -f catalina.*.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>This too should be accessed at <a href="http://localhost:8080">localhost:8080</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Kitematic UI tool is handy for viewing and interacting with running containers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To tidy up, kill and remove the container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker container kill simpleapp
docker container rm simpleapp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recreate-the-archetype"><a class="anchor" href="#recreate-the-archetype"></a>Recreate the archetype</h3>
<div class="paragraph">
<p>Make sure you are in the correct directory and environment variables are correct.</p>
</div>
<div class="paragraph">
<p>To recreate the <strong>simpleapp</strong> archetype, first ensure in the correct directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd example/application/simpleapp
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, run the script (which also builds the archetype once generated) and switch to the archetype&#8217;s directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh ../../../scripts/recreate-archetype.sh $ISISJIRA
cd `pwd|sed 's/application/archetype/'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script automatically commits changes; if you wish use <code>git log</code> and
<code>git diff</code> (or a tool such as SourceTree) to review changes made.</p>
</div>
</div>
<div class="sect2">
<h3 id="sanity-check-2"><a class="anchor" href="#sanity-check-2"></a>Sanity check</h3>
<div class="paragraph">
<p><em>In a different session</em>, create a new app from the archetype.
First set up environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp    # or as required
export ISISCPN=simpleapp
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then generate a new app from the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf $ISISTMP/test-$ISISCPN

mkdir $ISISTMP/test-$ISISCPN
cd $ISISTMP/test-$ISISCPN
mvn archetype:generate  \
    -D archetypeCatalog=local \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=$ISISCPN-archetype \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the newly generated app and test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd myapp
mvn clean install -o
mvn -pl webapp jetty:run              # runs as mvn jetty plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also check that the generated app can be built as a Docker image:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn install -Dmavenmixin-docker -D docker-plugin.imageName=test/myapp
docker container run -p 8080:8080 --name myapp -d test/myapp
sleep 10 &amp;&amp; curl http://localhost:8080
docker container kill myapp
docker container rm myapp</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-2"><a class="anchor" href="#deploy-2"></a>Deploy</h3>
<div class="paragraph">
<p>Back in the original session, we upload (deploy) the archetype to the staging repository.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously we used <code>mvn release:prepare</code> and <code>mvn release:perform</code> to do this.
However not compatible with <code>${revision}</code> that we now use <a href="https://maven.apache.org/maven-ci-friendly.html">for CI/CD</a>.
We therefore now just use <code>mvn deploy</code> directly, activating the (inherited) <code>apache-release</code> profile that, amongst other things, brings in the <code>gpg</code> plugin for code signing.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="releasing-helloworld-archetype"><a class="anchor" href="#releasing-helloworld-archetype"></a>Releasing <code>helloworld</code> archetype</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We now repeat the archetype release procedure, this time for the <code>helloworld</code> example app.</p>
</div>
<div class="paragraph">
<p>Start by switching to the directory containing the <code>helloworld</code> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd ../../../example/application/helloworld</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="setup-environment-variables-2"><a class="anchor" href="#setup-environment-variables-2"></a>Setup environment variables</h3>
<div class="paragraph">
<p>Update additional environment variables for the <code>helloworld-archetype</code> artifact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISART=helloworld-archetype
export ISISPAR=$ISISREL

export ISISCPT=$(echo $ISISART | cut -d- -f2)
export ISISCPN=$(echo $ISISART | cut -d- -f1)

env | grep ISIS | sort</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="check-the-example-app-2"><a class="anchor" href="#check-the-example-app-2"></a>Check the example app</h3>
<div class="paragraph">
<p>Check that the app:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>builds:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn clean install</code></pre>
</div>
</div>
</li>
<li>
<p>can be run from an IDE</p>
<div class="ulist">
<ul>
<li>
<p>mainClass=<code>org.apache.isis.WebServer</code></p>
</li>
<li>
<p>args=<code>-m domainapp.application.HelloWorldAppManifest</code></p>
</li>
<li>
<p>run before: <code>mvn datanucleus:enhance -o</code> in the root module</p>
</li>
</ul>
</div>
</li>
<li>
<p>can be run using the mvn jetty plugin:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn jetty:run</code></pre>
</div>
</div>
</li>
<li>
<p>can be deployed as a WAR</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp target/helloworld.war $CATALINA_HOME/webapps/ROOT.war
pushd $CATALINA_HOME/bin
sh startup.sh
tail -f ../logs/catalina.out</code></pre>
</div>
</div>
<div class="paragraph">
<p>quit using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh shutdown.sh
popd</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>This too should be accessed at <a href="http://localhost:8080">localhost:8080</a>.</p>
</div>
<div class="paragraph">
<p>In each case, check the about page and confirm has been built against non-SNAPSHOT versions of the Apache Isis jars.</p>
</div>
</div>
<div class="sect2">
<h3 id="recreate-the-archetype-2"><a class="anchor" href="#recreate-the-archetype-2"></a>Recreate the archetype</h3>
<div class="paragraph">
<p>Make sure you are in the correct directory and environment variables are correct.</p>
</div>
<div class="paragraph">
<p>To recreate the <strong>helloworld</strong> archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd example/application/helloworld
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, run the script (which also builds the archetype once generated) and then switch to the archetype&#8217;s directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh ../../../scripts/recreate-archetype.sh $ISISJIRA
cd `pwd|sed 's/application/archetype/'`</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script automatically commits its changes.
If you wish use <code>git log</code> and <code>git diff</code> (or a tool such as SourceTree) to review changes made.</p>
</div>
</div>
<div class="sect2">
<h3 id="sanity-check-3"><a class="anchor" href="#sanity-check-3"></a>Sanity check</h3>
<div class="paragraph">
<p><em>In a different session</em>, create a new app from the archetype.
First set up environment variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISISTMP=/c/tmp    # or as required
export ISISCPN=helloworld
env | grep ISIS | sort</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then generate a new app from the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">rm -rf $ISISTMP/test-$ISISCPN

mkdir $ISISTMP/test-$ISISCPN
cd $ISISTMP/test-$ISISCPN
mvn archetype:generate  \
    -D archetypeCatalog=local \
    -D groupId=com.mycompany \
    -D artifactId=myapp \
    -D archetypeGroupId=org.apache.isis.archetype \
    -D archetypeArtifactId=$ISISCPN-archetype \
    -B</code></pre>
</div>
</div>
<div class="paragraph">
<p>Build the newly generated app and test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cd myapp
mvn clean install -o
mvn jetty:run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploy-3"><a class="anchor" href="#deploy-3"></a>Deploy</h3>
<div class="paragraph">
<p>Back in the original session, we upload (deploy) the archetype to the staging repository.</p>
</div>
<div class="paragraph">
<p>To build and deploy and tag, we use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn -P apache-release \
    clean deploy      \
    -Dgpg.passphrase="this is not really my passphrase"

git tag $ISISART-$ISISREL
git tag $ISISART-$ISISREL-$ISISRC</code></pre>
</div>
</div>
<div class="paragraph">
<p>using your own GPG passphrase, of course.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This requires <code>gpg</code> v2.1 or later.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="checkclose-staging-repo"><a class="anchor" href="#checkclose-staging-repo"></a>Check/Close Staging Repo</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>mvn deploy</code> commands will have uploaded release artifacts for both <code>core</code> and the <code>simpleapp</code> archetype into a newly created staging repository on the ASF Nexus repository server.</p>
</div>
<div class="paragraph">
<p>Log onto <a href="http://repository.apache.org">repository.apache.org</a> (using your ASF LDAP account):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-0.png"><img src="_images/release-process/nexus-staging-0.png" alt="nexus staging 0" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>And then check that the release has been staged (select <code>staging repositories</code> from left-hand side):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-1.png"><img src="_images/release-process/nexus-staging-1.png" alt="nexus staging 1" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>If nothing appears in a staging repo you should stop here and work out why.</p>
</div>
<div class="paragraph">
<p>Assuming that the repo has been populated, make a note of its repo id; this is needed for the voting thread. In the screenshot above the id is <code>org.apache.isis-008</code>.</p>
</div>
<div class="paragraph">
<p>After checking that the staging repository contains the artifacts that you expect you should close the staging repository. This will make it available so that people can check the release.</p>
</div>
<div class="paragraph">
<p>Press the Close button and complete the dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-2.png"><img src="_images/release-process/nexus-staging-2.png" alt="nexus staging 2" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Nexus should start the process of closing the repository.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-2a.png"><img src="_images/release-process/nexus-staging-2a.png" alt="nexus staging 2a" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>All being well, the close should (eventually) complete successfully (keep hitting refresh):</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-3.png"><img src="_images/release-process/nexus-staging-3.png" alt="nexus staging 3" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>The Nexus repository manager will also email you with confirmation of a successful close.</p>
</div>
<div class="paragraph">
<p>If Nexus has problems with the key signature, however, then the close will be aborted:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="_images/release-process/nexus-staging-4.png"><img src="_images/release-process/nexus-staging-4.png" alt="nexus staging 4" width="600px"></a>
</div>
</div>
<div class="paragraph">
<p>Use <code>gpg --keyserver hkp://pgp.mit.edu --recv-keys nnnnnnnn</code> to confirm that the key is available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Unfortunately, Nexus does not seem to allow subkeys to be used for signing. See <a href="about.html#key-generation" class="page">Key Generation</a> for more details.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reset-revision-property"><a class="anchor" href="#reset-revision-property"></a>Reset <code>revision</code> property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the beginning of the release process we bumped the <code>revision</code> property to the release version, ie <code>$ISISREL</code>.
With the release now deployed we now need to reset the revision back down to the base snapshot, ie <code>1.0.0-SNAPSHOT</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previously we bumped to the next development snapshot.
However, this approach doesn&#8217;t play well with CI/CD when Apache Isis is mounted as a git submodule, so instead we always use <code>1.0.0-SNAPSHOT</code> for all development work.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the root of the Apache Isis repo, we do this for all three <code>pom.xml</code>s with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh scripts/version-reset.sh $ISISJIRA</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="push-branches"><a class="anchor" href="#push-branches"></a>Push branches</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Push the release branch to origin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push -u origin $ISISBRANCH</code></pre>
</div>
</div>
<div class="paragraph">
<p>and also push tags for both core and the archetype:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git push origin refs/tags/isis-$ISISREL:refs/tags/isis-$ISISREL-$ISISRC
git push origin refs/tags/simpleapp-archetype-$ISISREL:refs/tags/simpleapp-archetype-$ISISREL-$ISISRC
git push origin refs/tags/helloworld-archetype-$ISISREL:refs/tags/helloworld-archetype-$ISISREL-$ISISRC
git fetch</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The remote tags aren&#8217;t visible locally but can be seen <a href="https://github.com/apache/isis/tags">online</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="voting"><a class="anchor" href="#voting"></a>Voting</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once the artifacts have been uploaded, you can call a vote.</p>
</div>
<div class="paragraph">
<p>In all cases, votes last for 72 hours and require a +3 (binding) vote from members.</p>
</div>
<div class="sect2">
<h3 id="start-voting-thread-on-dev-mailing-list"><a class="anchor" href="#start-voting-thread-on-dev-mailing-list"></a>Start voting thread on dev mailing list</h3>
<div class="paragraph">
<p>That is, <a href="mailto:dev@apache.isis.org" class="bare">mailto:dev@apache.isis.org</a></p>
</div>
<div class="paragraph">
<p>The following boilerplate is for a release of the Apache Isis Core.
Adapt as required:</p>
</div>
<div class="paragraph">
<p>Use the following subject, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[VOTE] Apache Isis Core release 2.0.0-M3 RC1</code></pre>
</div>
</div>
<div class="paragraph">
<p>And use the following body:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">I've cut a release for Apache Isis Framework (Core, Extensions, Mavendeps + Mixins):

* Framework 2.0.0-M3

The source code artifacts have been uploaded to staging repositories on repository.apache.org.
For each zip there is a corresponding signature file (append .asc to the zip's url).

In the source code repo the code has been tagged as isis-2.0.0-M3-RC1, helloworld-archetype-2.0.0-M3-RC1 and simpleapp-archetype-2.0.0-M3-RC1; see https://github.com/apache/isis/tags

To verify the source code, you can use the following commands (in an empty directory):

    NEXUSREPONUM=10xx
    VERSION=2.0.0-M3

    curl http://www.apache.org/dist/isis/KEYS &gt; /tmp/KEYS
    gpg --import /tmp/KEYS

    rm -rf isis-$VERSION*
    rm -rf simpleapp-archetype-$VERSION*
    rm -rf helloworld-archetype-$VERSION*

    curl -O -L https://raw.githubusercontent.com/apache/isis/06f947ad7a0968c34d8e6941a77e12aa0196cd17/scripts/verify-isis-release.sh

    chmod +x ./verify-isis-release.sh
    ./verify-isis-release.sh $NEXUSREPONUM $VERSION


Assuming this completes successfully, you can then test the two applications generated from the `simpleapp` and `helloworld` archetypes:

    pushd test-simpleapp/myapp
    mvn -pl webapp jetty:run
    popd

and

    pushd test-helloworld/myapp
    mvn jetty:run
    popd


For more details, see https://isis.apache.org/toc/comguide/about.html#verifying-releases

Please verify the release and cast your vote.  The vote will be open for a minimum of 72 hours.

[ ] +1
[ ]  0
[ ] -1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to update:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the version number (<code>2.0.0-M3</code> or whatever)</p>
</li>
<li>
<p>the release candidate number (<code>RC1</code> or whatever)</p>
</li>
<li>
<p>the <code>NEXUSREPONUM</code> to the repository id as provided by Nexus earlier (<code>10xx</code> or whatever)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that the email also references the procedure for other committers to <a href="about.html#verifying-releases" class="page">verify the release</a>.</p>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside toc" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2019 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Isis, and the Apache Isis project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-M2.20200120-0805-ee1286c3</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>
  </body>
</html>
