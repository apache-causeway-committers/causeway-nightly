<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Interactions, Commands and Executions :: causeway</title>
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../../.." title="causeway">
  <link rel="next" href="../internaltestsupport/about.html" title="Internal Test Support">
  <link rel="prev" href="about.html" title="Interaction">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../..">
          <span class="icon">
            <img src="../../../_/img/causeway-logo-no-words-65x48.png"></img>
          </span>
        <span class="navbar-title">causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Learning &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/reference/about.html">Reference App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/2.0.0-RC3/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/2.0.0-RC3/about.html">Testing Guide</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">For use in apps</span>
            <a class="navbar-item" href="../../../valuetypes/2.0.0-RC3/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/2.0.0-RC3/about.html">Setup Guide</a>
            <a class="navbar-item" href="../../../conguide/2.0.0-RC3/about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/bypass/about.html">Bypass</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/shiro/about.html">Shiro</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/spring/about.html">Spring</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/keycloak/about.html">Keycloak</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/2.0.0-RC3/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../../vro/2.0.0-RC3/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjpa/2.0.0-RC3/about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../../pjdo/2.0.0-RC3/about.html">JDO (DataNucleus)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Extensions</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/commandlog/about.html">Command Log</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/docgen/about.html">Doc Gen</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/executionlog/about.html">Execution Log</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/executionoutbox/about.html">Execution Outbox</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/executionrepublisher/about.html">Execution Republisher</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/excel/about.html">Excel</a>
            <a class="navbar-item" href="../../../userguide/2.0.0-RC3/flyway/about.html">Flyway</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/secman/about.html">Secman</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/audittrail/about.html">Audit Trail</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/spring-oauth2/about.html">Spring OAuth2 Integration</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/shiro-realm-ldap/about.html">LDAP Realm for Shiro</a>
            <a class="navbar-item" href="../../../security/2.0.0-RC3/sessionlog/about.html">Session Log</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Web UI (Wicket)</span>
            <a class="navbar-item" href="../../../vw/2.0.0-RC3/exceldownload/about.html">Excel Download</a>
            <a class="navbar-item" href="../../../vw/2.0.0-RC3/fullcalendar/about.html">Full Calendar</a>
            <a class="navbar-item" href="../../../vw/2.0.0-RC3/pdfjs/about.html">pdf.js</a>
            <a class="navbar-item" href="../../../vw/2.0.0-RC3/sse/about.html">Server Side Events</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">REST API (Restful Objects)</span>
            <a class="navbar-item" href="../../../vro/2.0.0-RC3/cors/about.html">CORS</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/CAUSEWAY">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/causeway">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/2.0.0-RC3/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/2.0.0-RC3/about.html">Release Notes</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../../comguide/2.0.0-RC3/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../tooling/2.0.0-RC3/about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_isis">SonarCloud.io</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Interim Builds</span>
            <a class="navbar-item" href="../../../comguide/2.0.0-RC3/nightly-builds.html">Nightly builds</a>
            <a class="navbar-item" href="../../../comguide/2.0.0-RC3/weekly-builds.html">Weekly builds</a>
            <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">Website Preview (not ASF hosted)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../core/2.0.0-RC3/about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../../regressiontests/2.0.0-RC3/about.html">Regression Tests</a>
            <a class="navbar-item" href="../../../incubator/2.0.0-RC3/about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../../more-thanks/2.0.0-RC3/more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Causeway.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/2.0.0-RC3/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="core" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-search hide-for-print">
  <input id="algolia-search-input" placeholder="Search"></span>
</div>
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="about.html" title="Interaction"><span></span></a>
  <a class="page-next" rel="next"
     href="../internaltestsupport/about.html" title="Internal Test Support"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent" rel="prev" href="about.html" title="Interaction"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Design Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../about.html">Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../_overview/about.html">Maven modules</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../commons/about.html">Commons</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../codegen-bytebuddy/about.html">Code Gen</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Interaction</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="interactions-commands-and-executions.html">Interactions, Commands and Executions</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../internaltestsupport/about.html">Internal Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../metamodel/about.html">MetaModel</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metamodel/class-diagram.html">Class Diagram</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metamodel/managed-object.html">Managed Object</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../metamodel/events.html">Events</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runtime/about.html">Runtime</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../runtimeservices/about.html">Runtime Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../transaction/about.html">Transaction</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../webapp/about.html">Webapp</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../webapp/webmodules.html"><code>WebModule</code> interface</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Design Docs</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tooling</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../tooling/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../tutorials/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Design Docs</a></li>
    <li><a href="about.html">Interaction</a></li>
    <li><a href="interactions-commands-and-executions.html">Interactions, Commands and Executions</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/causeway/edit/master/core/interaction/src/main/adoc/modules/interaction/pages/interactions-commands-and-executions.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Interactions, Commands and Executions</h1>
<div class="sect1">
<h2 id="interactions"><a class="anchor" href="#interactions"></a>Interactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html" class="xref page">Interaction</a> is created for each and every request made to the application; you could think of it as analogous to <code>HttpRequest</code>.
Thus, an <code>Interaction</code> is created for every action invocation or property edit, but an <code>Interaction</code> is <em>also</em> created to render an object, or to render an action prompt, or even to evaluate the set of choices from a supporting <code>choicesNAct()</code> method.
It is the responsibility of the viewer implementation to ensure that an <code>Interaction</code> is created early on in the request processing, and torn down later.</p>
</div>
<div class="paragraph">
<p>An <code>Interaction</code> can also be created programmatically, using the <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionService.html" class="xref page">InteractionService</a>.
One use case is for "headless" execution of background commands, eg as scheduled by a Quartz cron job.</p>
</div>
<div class="paragraph">
<p>Another important use case is within testing.
The <a href="../../../refguide/latest/testing/index/integtestsupport/applib/CausewayInteractionHandler.html" class="xref page">CausewayInteractionHandler</a> JUnit 5 extension takes responsibility for wrapping each test with an <code>Interaction</code> (taking account any <a href="../../../refguide/latest/testing/index/integtestsupport/applib/annotation/InteractAs.html" class="xref page">@InteractAs</a> annotation if present).
The <a href="../../../refguide/latest/testing/index/integtestsupport/applib/CausewayIntegrationTestAbstract.html" class="xref page">CausewayIntegrationTestAbstract</a> is provided as a convenient superclass for integration tests, and is already annotated with the <code>CausewayInteractionHandler</code> extension.
(Alternatively, <a href="../../../refguide/latest/testing/index/integtestsupport/applib/CausewayIntegrationGwtAbstract.html" class="xref page">CausewayIntegrationGwtAbstract</a> is <em>not</em> annotated with the handler; instead it provides <code>given(&#8230;&#8203;)</code>, <code>when(&#8230;&#8203;)</code> and <code>then(&#8230;&#8203;)</code> methods that each execute the provided <code>Runnable</code>/<code>Callable</code> within the context of its own <code>Interaction</code>.</p>
</div>
<div class="paragraph">
<p>Integration tests can also simulate multiple interactions (HTTP requests) within a single test using <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionService.html#nextInteraction_" class="xref page">InteractionService#nextInteraction</a>.
When called, any state changes made in the previous <code>Interaction</code> will be committed, and any references to entities should be either discarded or else be re-retrieved in the next <code>Interaction</code>.
(In the case of the JDO ORM, any entities from the previous <code>Interaction</code> will be reset to null when that <code>Interaction</code> completes).</p>
</div>
<div class="sect2">
<h3 id="executions"><a class="anchor" href="#executions"></a>Executions</h3>
<div class="paragraph">
<p>Contained within an <code>Interaction</code> is an <a href="../../../refguide/latest/applib/index/services/iactn/Execution.html" class="xref page">Execution</a>.
In many cases there will be only a single such <code>Execution</code>, and these come in two varieties, representing either an action invocation or a property edit.
However, <code>Execution</code>s can be nested.
This will occur if the "top-level" action invokes another action (or property edit) using the <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html" class="xref page">WrapperFactory</a> service.</p>
</div>
<div class="paragraph">
<p>Conversely, in many cases an <code>Interaction</code> will occur where no <code>Execution</code>s occur within it.
For example, if the interaction is to render an object, or to render an action prompt, or to display a list of choices, then no action would have been invoked nor property edited, and thus its <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html#getCurrentExecution_" class="xref page">Interaction#getCurrentExecution()</a> will be simply empty.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="commands"><a class="anchor" href="#commands"></a>Commands</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every <code>Interaction</code> has a corresponding <a href="../../../refguide/latest/applib/index/services/command/Command.html" class="xref page">Command</a>, accessible using  <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html#getCommand_" class="xref page">Interaction#getCommand</a>.
Both the <code>Interaction</code> and <code>Command</code> are identified by a UUID (<a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html#getInteractionId_" class="xref page">Interaction#getInteractionId()</a> and <a href="../../../refguide/latest/applib/index/services/command/Command.html#getInteractionId_" class="xref page">Command#getInteractionId()</a> respectively); these will have the same value and correlate the <code>Interaction</code> and <code>Command</code> with each other.</p>
</div>
<div class="paragraph">
<p>Whereas an <code>Interaction</code> (or more precisely, the <code>Execution</code>s within an <code>Interaction</code>) represent an action invocation or property edit having occurred, a <code>Command</code> represents the <em>intention</em> to invoke an action/edit a property.
Think of this in terms of cause and effect: the <code>Command</code> is the cause, the <code>Execution</code> is the effect.
However, there is only ever one <code>Command</code>, and this represents the "top-level" action; there will be a corresponding <code>Execution</code> but (as explained above) there could in theory be nested <code>Execution</code>s within if the <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html" class="xref page">WrapperFactory</a> has been used; and for these sub-<code>Execution</code>s there will <em>not</em> be corresponding <code>Command</code>s.</p>
</div>
<div class="paragraph">
<p>(From here on, we&#8217;ll just use the phrase "invoke an action" as this is the more common case; "edit a property" can be thought of as a very particular type of action, modifying a single property with a single value).</p>
</div>
<div class="sect2">
<h3 id="interactions-that-do-not-represent-executions"><a class="anchor" href="#interactions-that-do-not-represent-executions"></a>Interactions that do not represent executions</h3>
<div class="paragraph">
<p>As noted <a href="#executions">above</a>, in many (in fact the majority of) cases the overarching interaction will <em>not</em> be to invoke an action, but instead will be just torender an object, or to render an action prompt, or to display a list of choices.
In such cases there will be no <code>Execution</code>.
While every <code>Interaction</code> <em>does</em> hold a corresponding <code>Command</code>, this corresponding <code>Command</code> will remain mostly empty.
In particular, its <a href="../../../refguide/latest/applib/index/services/command/Command.html#getCommandDto_" class="xref page">Command#getCommandDto()</a> will remain null.</p>
</div>
<div class="paragraph">
<p>Only when the interaction is to <em>actually</em> invoke an action, then the <code>Command</code>'s <a href="../../../refguide/latest/schema/cmd.html#commanddto" class="xref page">CommandDto</a> and other properties will be fleshed out.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publishing"><a class="anchor" href="#publishing"></a>Publishing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="command-publishing"><a class="anchor" href="#command-publishing"></a>Command Publishing</h3>
<div class="paragraph">
<p><em>If</em> the overarching interaction is to actually invoke an action, then the corresponding <code>Command</code> will be populated and will be published to any registered <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html" class="xref page">CommandSubscriber</a>s.</p>
</div>
<div class="paragraph">
<p>Because a <code>Command</code> represents the <em>intention</em> to invoke an action, the  <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onReady_Command" class="xref page">CommandSubscriber#onReady()</a> callback is called first.
The <a href="../../../refguide/latest/extensions/index/commandlog/applib/subscriber/CommandSubscriberForCommandLog.html" class="xref page">CommandSubscriberForCommandLog</a> subscriber uses this to persist a <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/CommandLogEntry.html" class="xref page">CommandLogEntry</a> which represents the fact that the action represented by the <code>Command</code> is to be executed.</p>
</div>
<div class="paragraph">
<p>Just before the action is executed, the <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onStarted_Command" class="xref page">CommandSubscriber#onStarted()</a> callback is called.
The <a href="../../../refguide/latest/extensions/index/commandlog/applib/subscriber/CommandSubscriberForCommandLog.html" class="xref page">CommandSubscriberForCommandLog</a> subscriber uses this to update the persisted <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/CommandLogEntry.html" class="xref page">CommandLogEntry</a> (its startedAt field etc.</p>
</div>
<div class="paragraph">
<p><em>However</em>, recall that there is only ever one <code>Command</code>, representing the invocation of the top-level command.
The final <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onCompleted_Command" class="xref page">CommandSubscriber#onCompleted()</a> callback is called only when the overarching <code>Interaction</code> is being closed.</p>
</div>
</div>
<div class="sect2">
<h3 id="execution-publishing"><a class="anchor" href="#execution-publishing"></a>Execution Publishing</h3>
<div class="paragraph">
<p>Whenever an <code>Interaction</code>s <code>Execution</code> is complete, it will be published to any <a href="../../../refguide/latest/applib/index/services/publishing/spi/ExecutionSubscriber.html" class="xref page">ExecutionSubscriber</a>s.
This happens more or less immediately after the <code>Execution</code> is complete, in other words it isn&#8217;t deferred until the closing of the top-level <code>Interaction</code>.</p>
</div>
<div class="paragraph">
<p>Normally there will only be a single <code>Execution</code> per <code>Interaction</code>, so this publishing will occur immediately prior to the <code>Command</code> being completed is published (see previous section).</p>
</div>
</div>
<div class="sect2">
<h3 id="summary"><a class="anchor" href="#summary"></a>Summary</h3>
<div class="paragraph">
<p>To summarise the previous sections: the "usual" way in which commands/executions are published are as the result of a user invoking an action through the viewer (e.g. clicking on the OK button in an action prompt):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html" class="xref page">Interaction</a> is created as part of the HTTP request processing.
This contains a corresponding <a href="../../../refguide/latest/applib/index/services/command/Command.html" class="xref page">Command</a>, mostly empty at this point.</p>
</li>
<li>
<p>The Wicket UI code delegates down to an <code>ObjectAction</code>; it is this that sets up the state within <a href="../../../refguide/latest/applib/index/services/command/Command.html" class="xref page">Command</a>, in particular its <a href="../../../refguide/latest/schema/cmd.html#commanddto" class="xref page">CommandDto</a></p>
</li>
<li>
<p>The <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onReady_Command" class="xref page">CommandSubscriber#onReady()</a> callback is called.</p>
</li>
<li>
<p>An <a href="../../../refguide/latest/applib/index/services/iactn/Execution.html" class="xref page">Execution</a> is created and held by its owning <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html" class="xref page">Interaction</a></p>
</li>
<li>
<p>The <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onStarted_Command" class="xref page">CommandSubscriber#onStarted()</a> callback is called</p>
</li>
<li>
<p>The action (domain logic) itself is called</p>
</li>
<li>
<p>The <a href="../../../refguide/latest/applib/index/services/iactn/Execution.html" class="xref page">Execution</a> is updated as completed</p>
</li>
<li>
<p><a href="../../../refguide/latest/applib/index/services/publishing/spi/ExecutionSubscriber.html" class="xref page">ExecutionSubscriber</a>'s <a href="../../../refguide/latest/applib/index/services/publishing/spi/ExecutionSubscriber.html#onExecution_Execution" class="xref page">onExecution()</a> callback is called</p>
</li>
<li>
<p>The overarching <a href="../../../refguide/latest/applib/index/services/iactn/Interaction.html" class="xref page">Interaction</a> is closed; as part of that processing:</p>
<div class="ulist">
<ul>
<li>
<p>the associated top-level <a href="../../../refguide/latest/applib/index/services/command/Command.html" class="xref page">Command</a> is marked as complete and</p>
</li>
<li>
<p>the <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html#onCompleted_Command" class="xref page">CommandSubscriber#onCompleted()</a> callback is called.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above assumes of course that the action has command and publishing enabled.
If either are disabled then the corresponding subscribers won&#8217;t be called.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-publishing-scenarios-to-consider"><a class="anchor" href="#other-publishing-scenarios-to-consider"></a>Other publishing scenarios to consider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As well as the "usual" way of executing actions (described <a href="#summary">above</a>), there are a number of other ways in which commands and executions may be published.</p>
</div>
<div class="sect2">
<h3 id="wrapper-factory"><a class="anchor" href="#wrapper-factory"></a>Wrapper Factory</h3>
<div class="paragraph">
<p>When a domain object is wrapped (or more accurately: proxied) using the <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html" class="xref page">WrapperFactory</a>, the wrapping proxy delegates to the <code>DomainObjectInvocationHandler</code> framework class.
This looks up the <code>ObjectAction</code> from the <code>java.lang.reflect.Method</code> being invoked on the proxy and calls it.</p>
</div>
<div class="paragraph">
<p>If this is done in production code, then there will already be an <code>Interaction</code> with a corresponding <code>Command</code>, and this will be set up with the action whose body is calling the wrapped object.
Therefore this scenario has no impact on the <code>Command</code> and <code>CommandSubscriber</code>s will not be called.</p>
</div>
<div class="paragraph">
<p>On the other hand, the wrapped action <em>is</em> an <code>Execution</code>, and so this will result in an execution graph of two levels: the top-level action invoked by the user, and then the nested action invoked via the proxy.
Any <code>ExecutionSubscriber</code>s <em>will</em> be notified as soon as the nested action has completed.
(Of course, the nesting could be arbitrarily deep).</p>
</div>
<div class="paragraph">
<p>If the wrapped domain object&#8217;s action is called in <em>test</em> code, then things will probably be different.
The integration test itself will most likely have set up a top-level <code>Interaction</code> (through the <a href="../../../refguide/latest/testing/index/integtestsupport/applib/CausewayInteractionHandler.html" class="xref page">CausewayInteractionHandler</a> JUnit 5 extension) with a mostly-empty <code>Command</code>.
When the wrapped action is invoked, this will in effect be the top-level action for the interaction, and so the <code>CommandDto</code> will be set up with the details of that wrapped action, and any <code>CommandSubscriber</code>s will be notified.</p>
</div>
</div>
<div class="sect2">
<h3 id="asynchronous-commands"><a class="anchor" href="#asynchronous-commands"></a>Asynchronous Commands</h3>
<div class="paragraph">
<p>The <code>WrapperFactory</code> allows wrapped actions to be invoked synchronously or asynchronously.
The former is more common, and is the process described above.</p>
</div>
<div class="paragraph">
<p>If the wrapper is created for asynchronous invocation (using <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html#asyncWrap_T_AsyncControl" class="xref page">WrapperFactory#asyncWrap()</a> or similar), then the framework passes an <a href="../../../refguide/latest/applib/index/services/wrapper/callable/AsyncCallable.html" class="xref page">AsyncCallable</a> (a subtype of <code>Callable</code>) to the configured <code>ExecutorService</code>.
(The default <code>ExecutorService</code> is the simple <code>ForkJoinPool</code>, though this can be replaced if required).</p>
</div>
<div class="paragraph">
<p>The <code>AsyncCallable</code> interface is implemented by an internal framework class (<code>AsyncTask</code>).
It&#8217;s worth understanding the data that it holds and its behaviour:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in terms of its data, it holds a representation of the action to be invoked as a <code>CommandDto</code>.</p>
<div class="paragraph">
<p>Since this is a "child" command, the <code>CommandDto</code> will have a new UUID identifier.
This <em>isn&#8217;t</em> the UUID of the <code>Command</code> of the action that actually called the wrapped action; that is instead saved as the UUID of the "parent" command</p>
</div>
</li>
<li>
<p>It also holds an <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionContext.html" class="xref page">InteractionContext</a> that determines the who, when and timezone of the "virtual" user that is executing the action.</p>
<div class="paragraph">
<p>This is derived from the <a href="../../../refguide/latest/applib/index/services/wrapper/control/AsyncControl.html" class="xref page">AsyncControl</a> passed into <code>WrapperFactory</code> combined with the <code>InteractionContext</code> of the original parent action.</p>
</div>
</li>
<li>
<p>in terms of its behaviour, it simply delegates back to the <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html#execute_AsyncCallable" class="xref page">WrapperFactory#execute()</a>, in a double-dispatch pattern.</p>
<div class="paragraph">
<p>This in turn:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uses the <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionService.html" class="xref page">InteractionService</a> to create a new <code>Interaction</code>, because of course the <code>ExecutorService</code> will be running the <code>Callable</code> in a separate thread.</p>
<div class="paragraph">
<p>Of course, as a side-effect, this <code>Interaction</code> will be associated with a mostly empty <code>Command</code>.</p>
</div>
</li>
<li>
<p>then, it uses <a href="../../../refguide/latest/applib/index/services/command/CommandExecutorService.html" class="xref page">CommandExecutorService</a> to actually execute the command, "taking over" the (still mostly empty) <code>Command</code> from this <code>Interaction</code> with the DTO obtained from <code>AsyncCallable</code>.</p>
<div class="paragraph">
<p>This service is also responsible for calling the <code>onReady</code> and <code>onStarted</code> <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html" class="xref page">CommandSubscriber</a> callback methods at the appropriate times.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>InteractionService</code> calls the final <code>onCompleted</code> callback of <code>CommandSubscriber</code> when the <code>Interaction</code> is torn down.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typical production usage of wrapped asynchronous actions will result in those actions being invoked in a new <code>Interaction</code> on a separate thread.
If required, the code that calls the async action can obtain a <code>Future</code> from the <a href="../../../refguide/latest/applib/index/services/wrapper/control/AsyncControl.html" class="xref page">AsyncControl</a> passed into <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html#asyncWrap_T_AsyncControl" class="xref page">WrapperFactory#asyncWrap</a> or similar.
Or, it may simply "fire-n-forget".
As described above, because the wrapped action is invoked in its own thread/<code>Interaction</code>, then it will be published to any <a href="../../../refguide/latest/applib/index/services/publishing/spi/CommandSubscriber.html" class="xref page">CommandSubscriber</a>s and <a href="../../../refguide/latest/applib/index/services/publishing/spi/ExecutionSubscriber.html" class="xref page">ExecutionSubscriber</a>s.</p>
</div>
<div class="paragraph">
<p>Typical test production is very similar, though test code is more likely to want to obtain the <code>Future</code> in order to assert that the wrapped async action was executed correctly.</p>
</div>
</div>
<div class="sect2">
<h3 id="background-commands"><a class="anchor" href="#background-commands"></a>Background Commands</h3>
<div class="paragraph">
<p>One consideration when invoking actions asynchronously (as described <a href="#asynchronous-commands">above</a>) is that there are no hard transactional guarantees.
In other words, if the async action hits a problem and aborts, then the original calling action will not also abort.
Now, that code <em>can</em> of course obtain the <code>Future</code> from the <code>AsyncControl</code>, and manually abort if the (eventual) returned value of the <code>Future</code> is not as expected.
However, there&#8217;s little point in using an async action if the calling action is just going to wait on that child async action&#8217;s <code>Future</code> to resolve.
And, if the point of using async actions was to fan out and start multiple async actions in parallel, then there&#8217;s no way to rollback all of these actions if any one of them has failed.</p>
</div>
<div class="paragraph">
<p>An alternative approach is to use the <code>WrapperFactory</code> async API to persist the commands in some form, and then have a Quartz cron job or similar pick up those queued commands and execute them.
If any of those commands fail, there is at least a record as to how they might have failed.
This is the philosophy behind the <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/BackgroundService.html" class="xref page">BackgroundService</a>, part of the <a href="../../../userguide/latest/commandlog/about.html" class="xref page">Command Log</a> extension.</p>
</div>
<div class="paragraph">
<p>Under the covers the <code>BackgroundService</code> calls <code>WrapperFactory</code>, but with a custom <code>ExecutorService</code> (the <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/BackgroundService_PersistCommandExecutorService.html" class="xref page">BackgroundService.PersistCommandExecutorService</a> class) which simply persists the implied command as a <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/CommandLogEntry.html" class="xref page">CommandLogEntry</a>.
Its <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/CommandLogEntry.html#getExecuteIn_" class="xref page">executeIn</a> field indicates that the command is to be executed "in the background".</p>
</div>
<div class="paragraph">
<p>The <a href="../../../userguide/latest/commandlog/about.html" class="xref page">Command Log</a> extension also provides the <a href="../../../refguide/latest/extensions/index/commandlog/applib/job/RunBackgroundCommandsJob.html" class="xref page">RunBackgroundCommandsJob</a>, which is a Quartz <code>Job</code> implementation.
Conceptually this is similar to the <code>AsyncCallable</code> described <a href="#asynchronous-commands">previously</a>, but will run (the <code>CommandDto</code>s of) all queued <code>CommandLogEntry</code>s, rather than just a single <code>CommandDto</code>.</p>
</div>
<div class="paragraph">
<p>To use the <code>RunBackgroundCommandsJob</code>, we configure Quartz to run it periodically, eg every 10 seconds.
When run by Quartz, it performs these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>uses the <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionService.html" class="xref page">InteractionService</a> to start a new <code>Interaction</code> (because&#8201;&#8212;&#8201;obviously&#8201;&#8212;&#8201;the Quartz job runs in a separate thread to the original action that queued up the command)</p>
</li>
<li>
<p>runs a query to find any new <code>CommandLogEntry</code>s since last time, using <a href="../../../refguide/latest/extensions/index/commandlog/applib/dom/CommandLogEntryRepository.html#findBackgroundAndNotYetStarted_" class="xref page">CommandLogEntryRepository#findBackgroundAndNotYetStarted()</a>, and extracts out the <a href="../../../refguide/latest/schema/cmd.html#commanddto" class="xref page">CommandDto</a> from each</p>
</li>
<li>
<p>for each such <code>CommandDto</code>:</p>
<div class="ulist">
<ul>
<li>
<p>starts a new transaction</p>
</li>
<li>
<p>uses the <a href="../../../refguide/latest/applib/index/services/command/CommandExecutorService.html" class="xref page">CommandExecutorService</a> to execute the <code>CommandDto</code>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>As described in the <a href="#asynchronous-commands">previous section</a>, the <code>CommandExecutorService</code> will call the <code>onReady</code> and <code>onStarted</code> callbacks of any <code>CommandSubscriber</code>s, while tearing down the overarching <code>Interaction</code> will call the final <code>onCompleted</code> callback.</p>
</div>
<div class="paragraph">
<p>One wrinkle though that the <a href="../../../refguide/latest/extensions/index/commandlog/applib/subscriber/CommandSubscriberForCommandLog.html" class="xref page">CommandSubscriberForCommandLog</a> subscriber has to cater for is that&#8201;&#8212;&#8201;when its <code>onReady</code> callback is called&#8201;&#8212;&#8201;the <code>CommandLogEntry</code> will already exist for the command; because (of course) this is what is being used by <code>RunBackgroundCommandsJob</code>.
Therefore, rather than persist a <em>new</em> <code>CommandLogEntry</code>, instead callback is a no-op.</p>
</div>
<div class="paragraph">
<p>The above describes how this all works in production code, with a Quartz scheduler set up to run periodically.
When in test code, however, we won&#8217;t want to be running Quartz, so we need to call <code>RunBackgroundCommandsJob</code> within the test.
There are two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the best approximation of Quartz (within a test) would be to simply create a new thread and just execute the <code>RunBackgroundCommandsJob</code> within it.</p>
<div class="paragraph">
<p>The test can then wait for this manually spawned background thread to complete.</p>
</div>
</li>
<li>
<p>alternatively, the <code>RunBackgroundCommandsJob</code> can simply be executed within the thread of the test itself.</p>
<div class="paragraph">
<p><strong>However</strong>, this runs the risk of confusing the <code>Interaction</code> of the test with the <code>Interaction</code> of the background command.
Therefore, call <a href="../../../refguide/latest/applib/index/services/iactnlayer/InteractionService.html#nextInteraction_" class="xref page">InteractionService.adoc#nextInteraction()</a> to ensure that the final <code>onCompleted</code> callback for the async command is correctly called at the end.
This will <strong>also</strong> require re-retrieving any entities etc in the test because they will have become detached as the result of calling <code>nextInteraction()</code>.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions"><a class="anchor" href="#transactions"></a>Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s worth quickly mentioning that sitting between the overarching <code>Interaction</code> and the <code>Command</code>, the framework will always be using <a href="../../../refguide/latest/applib/index/services/xactn/TransactionService.html" class="xref page">TransactionService</a> to create a new transaction.</p>
</div>
<div class="paragraph">
<p>This is done by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the action invocation facet (the <code>ActionInvocationFacetForDomainEventAbstract</code> internal framework class)</p>
</li>
<li>
<p><a href="../../../refguide/latest/applib/index/services/wrapper/callable/AsyncCallable.html" class="xref page">AsyncCallable</a> for <a href="#asynchronous-commands">async commands</a></p>
</li>
<li>
<p><a href="../../../refguide/latest/extensions/index/commandlog/applib/job/RunBackgroundCommandsJob.html" class="xref page">RunBackgroundCommandsJob</a> for <a href="#background-commands">background commands</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ultimately all of the scenarios will use the action invocation facet to invoke the action.
That code will only create a new transaction if one is not already in progress, so there&#8217;s no harm in <code>AsyncCallable</code> or <code>RunBackgroundCommandsJob</code> in explicitly managing the transactions.
This is particulary important for <code>RunBackgroundCommandsJob</code> because it intentionally runs each of the queued commands in a separate transaction.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2023 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Causeway, and the Apache Causeway project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-RC2.20230901-0221-a8cd5a68</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'causeway-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
