<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PetOwner entity :: causeway</title>
    <link rel="canonical" href="https://apache-causeway-committers.github.io/causeway-nightly/tutorials/latest/petclinic/030-petowner-entity.html">
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-custom.css">
<link rel="home" href="https://apache-causeway-committers.github.io/causeway-nightly" title="causeway">
  <link rel="next" href="040-pet-entity.html" title="The &lt;code&gt;Pet&lt;/code&gt; entity">
  <link rel="prev" href="020-the-petclinic-domain.html" title="The PetClinic Domain and &lt;code&gt;petowner&lt;/code&gt; module">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">
          <span class="icon">
            <img src="../../../_/img/causeway-logo-no-words-65x48.png"></img>
          </span>
        <span class="navbar-title">causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../../docs/latest/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../../docs/latest/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Learning &amp; Tutorials</span>
            <a class="navbar-item" href="../../../docs/latest/reference/about.html">Reference App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../../docs/latest/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../../docs/latest/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/latest/about.html">User Guide</a>
            <a class="navbar-item" href="../../../refguide/latest/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../../testing/latest/about.html">Testing Guide</a>
            <a class="navbar-item" href="../../../security/latest/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">For use in apps</span>
            <a class="navbar-item" href="../../../valuetypes/latest/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../setupguide/latest/about.html">Setup Guide</a>
            <a class="navbar-item" href="../../../conguide/latest/about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/latest/bypass/about.html">Bypass</a>
            <a class="navbar-item" href="../../../security/latest/simple/about.html">Simple</a>
            <a class="navbar-item" href="../../../security/latest/spring/about.html">Spring</a>
            <a class="navbar-item" href="../../../security/latest/keycloak/about.html">Keycloak</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../../vw/latest/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../../gqlv/latest/about.html">GraphQL API</a>
            <a class="navbar-item" href="../../../vro/latest/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../pjpa/latest/about.html">JPA (EclipseLink)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Extensions</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../../userguide/latest/commandlog/about.html">Command Log</a>
            <a class="navbar-item" href="../../../userguide/latest/docgen/about.html">Doc Gen</a>
            <a class="navbar-item" href="../../../userguide/latest/executionlog/about.html">Execution Log</a>
            <a class="navbar-item" href="../../../userguide/latest/executionoutbox/about.html">Execution Outbox</a>
            <a class="navbar-item" href="../../../userguide/latest/executionrepublisher/about.html">Execution Republisher</a>
            <a class="navbar-item" href="../../../userguide/latest/excel/about.html">Excel</a>
            <a class="navbar-item" href="../../../userguide/latest/flyway/about.html">Flyway</a>
            <a class="navbar-item" href="../../../userguide/latest/layoutloaders/about.html">Layout Loaders</a>
            <a class="navbar-item" href="../../../userguide/latest/titlecache/about.html">Title Cache</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../../security/latest/secman/about.html">Secman</a>
            <a class="navbar-item" href="../../../security/latest/audittrail/about.html">Audit Trail</a>
            <a class="navbar-item" href="../../../security/latest/spring-oauth2/about.html">Spring OAuth2 Integration</a>
            <a class="navbar-item" href="../../../security/latest/sessionlog/about.html">Session Log</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Web UI (Wicket)</span>
            <a class="navbar-item" href="../../../vw/latest/fullcalendar/about.html">Full Calendar</a>
            <a class="navbar-item" href="../../../vw/latest/pdfjs/about.html">pdf.js</a>
            <a class="navbar-item" href="../../../vw/latest/sse/about.html">Server Side Events</a>
            <a class="navbar-item" href="../../../vw/latest/tabular/about.html">Tabular Download</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">REST API (Restful Objects)</span>
            <a class="navbar-item" href="../../../vro/latest/cors/about.html">CORS</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../../querydsl/latest/about.html">QueryDSL</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../../docs/latest/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../../docs/latest/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/CAUSEWAY">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/causeway">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../../docs/latest/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../../relnotes/latest/about.html">Release Notes</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../../comguide/latest/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../../tooling/latest/about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_causeway">SonarCloud.io</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Interim Builds</span>
            <a class="navbar-item" href="../../../comguide/latest/nightly-builds.html">Nightly builds</a>
            <a class="navbar-item" href="../../../comguide/latest/weekly-builds.html">Weekly builds</a>
            <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">Website Preview (not ASF hosted)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../../core/latest/about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../../regressiontests/latest/about.html">Regression Tests</a>
            <a class="navbar-item" href="../../../incubator/latest/about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../../more-thanks/latest/more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">License</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Causeway.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../../docs/latest/about.html">
          <span class="icon">
            <img src="../../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="tutorials" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-search hide-for-print">
  <input id="algolia-search-input" placeholder="Search"></span>
</div>
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="020-the-petclinic-domain.html" title="The PetClinic Domain and &lt;code&gt;petowner&lt;/code&gt; module"><span></span></a>
  <a class="page-next" rel="next"
     href="040-pet-entity.html" title="The &lt;code&gt;Pet&lt;/code&gt; entity"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="The PetClinic Domain and &lt;code&gt;petowner&lt;/code&gt; module"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Tutorials</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="010-getting-started.html">Getting Started</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#prereqs">Prereqs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#exercise-1-1-starter-apps-clone-the-repo"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>1.1</strong>: Starter apps / clone the repo</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#exercise-1-2-explore-the-simple-app">1.2: Explore the Simple App</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#exercise-1-3-running-from-the-ide">1.3: Running from the IDE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#exercise-1-4-naked-objects-pattern">1.4: Naked Objects pattern</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="010-getting-started.html#exercise-1-5-ui-hints">1.5: UI Hints</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="020-the-petclinic-domain.html">The PetClinic Domain and <code>petowner</code> module</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="020-the-petclinic-domain.html#exercise-2-1-create-a-new-petowner-module"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>2.1</strong>: Create new <code>petowner</code> module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="020-the-petclinic-domain.html#exercise-2-2-configure-the-app-to-include-the-petowner-module"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>2.2</strong>: Include the <code>petowner</code> module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="020-the-petclinic-domain.html#exercise-2-3-add-security-role-for-petowner-module"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>2.3</strong>: Add security role for the <code>petowner</code> module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="020-the-petclinic-domain.html#exercise-2-4-update-menubar-for-PetOwners"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>2.4</strong>: Update menubar for <code>PetOwners</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="020-the-petclinic-domain.html#exercise-2-5-setup-demo-PetOwners"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>2.5</strong>: Setup demo <code>PetOwner</code>s</a>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="030-petowner-entity.html">The <code>PetOwner</code> entity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-1-add-petowners-knownAs-property"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.1</strong>: Add <code>PetOwner</code>'s <code>knownAs</code> property</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-2-define-PetOwners-title-imperatively"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.2</strong>: Define <code>PetOwner</code>'s title imperatively</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-3-remaining-PetOwner-properties"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.3</strong>: Add remaining <code>PetOwner</code> properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-4-list-new-properties-of-PetOwner"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.4</strong>: List new properties of <code>PetOwner</code></a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-5-initial-fixture-script"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.5</strong>: Initial Fixture Script</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-6-update-home-page-to-show-PetOwners"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.6</strong>:  Update Home Page to show <code>PetOwner</code>s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-7-modify-the-menu-action-that-creates-petowners"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.7</strong>: Modify the menu action that creates <code>PetOwner</code>s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-8-prompt-styles"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.8</strong>: Prompt styles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-9-derived-days-since-last-visit-property"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.9</strong>: Derived 'days since last visit' property</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-10-use-meta-annotations-to-reduce-duplication"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.10</strong>: Use meta-annotations to reduce duplication</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-11-validation"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.11</strong>: Validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-12-more-validation"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.12</strong>: More validation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-13-scalar-custom-value-types"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.13</strong>: Scalar custom value types</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-14-use-layout-xml-file-for-ui-semantics"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.14</strong>: Use layout xml file for UI semantics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="#exercise-3-15-update-icon-for-pet-owner"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>3.15</strong>: Update icon for <code>PetOwner</code></a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="040-pet-entity.html">The <code>Pet</code> entity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-1-pet-entitys-key-properties"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.1</strong>: <code>Pet</code> entity&#8217;s key properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-2-add-pet-ui-and-layout-semantics"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.2</strong>: Add <code>Pet</code>'s UI and layout semantics</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-3-add-petowners-collection-of-pets"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.3</strong>: Add <code>PetOwner</code>'s collection of <code>Pet</code>s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-4-add-actions-to-add-or-remove-pets"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.4</strong>: Add actions to add or remove <code>Pet</code>s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-5-extend-the-fixture-data-to-add-in-Pets"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.5</strong>: Extend the fixture data to add in <code>Pet</code>s</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-6-add-action-validation"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.6</strong>: Unique <code>Pet</code> names (action validation)</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-7-add-pets-remaining-properties"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.7</strong>: Add <code>Pet</code>'s remaining properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="040-pet-entity.html#exercise-4-8-dynamic-icons-for-pet"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>4.8</strong>: Add dynamic icons for <code>Pet</code></a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="050-visit-entity.html">The <code>visit</code> module and <code>Visit</code> entity</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="050-visit-entity.html#exercise-5-1-the-visits-module"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>5.1</strong>: The <code>visit</code> module</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="050-visit-entity.html#exercise-5-2-visit-module-dependencies"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>5.2</strong>: The <code>visit</code> module dependencies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="050-visit-entity.html#exercise-5-3-visit-entitys-key-properties"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>5.3</strong>: <code>Visit</code> entity&#8217;s key properties</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="050-visit-entity.html#exercise-5-4-book-visit-action"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>5.4</strong>: The "Book Visit" action</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="060-unit-testing.html">Unit Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="060-unit-testing.html#exercise-6-1-unit-test-the-default-time-when-booking-visits"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>6.1</strong>: Unit test the default time when booking visits</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="070-modularity.html">Modularity (domain events)</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="070-modularity.html#exercise-7-1-refactor-petowners-delete-action"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>7.1</strong>: refactor <code>PetOwner</code>'s delete action</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="080-view-models.html">View Models</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="080-view-models.html#exercise-8-1-extend-the-home-page"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>8.1</strong>: Extend the Home Page.</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="080-view-models.html#exercise-8-2-add-a-convenience-action"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>8.2</strong>: Add a convenience action</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="090-integration-testing.html">Integration Testing</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="090-integration-testing.html#exercise-9-1-testing-bookvisit-using-an-integtest"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>9.1</strong>: Testing <code>bookVisit()</code> using an integtest</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="090-integration-testing.html#exercise-9-2-adds-visit-fixture"><span class="image"><img src="_images/hand.png" alt="hand"></span> <strong>9.2</strong>: Adds fixtures for the <code>visit</code> module</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Tutorials</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">GraphQL Viewer</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../gqlv/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">QueryDSL</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../querydsl/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="../about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Tutorials</a></li>
    <li><a href="030-petowner-entity.html">The <code>PetOwner</code> entity</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/causeway/edit/main/antora/components/tutorials/modules/petclinic/pages/030-petowner-entity.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">PetOwner entity</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>In this set of exercises we&#8217;ll just focus on the <code>PetOwner</code> entity.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-1-add-petowners-knownAs-property"><a class="anchor" href="#exercise-3-1-add-petowners-knownAs-property"></a>Ex 3.1: Add PetOwner&#8217;s knownAs property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this exercise, we&#8217;ll add a new property, <code>knownAs</code>, to capture the <code>PetOwner</code>'s preferred name.
We&#8217;ll also update the fixture script.</p>
</div>
<div class="sect2">
<h3 id="solution"><a class="anchor" href="#solution"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-01-adds-PetOwner-knownAs-property
mvn clean install
mvn -pl webapp spring-boot:run</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use the <span class="menuseq"><b class="menu">Prototyping</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Fixture Scripts</b></span> menu to setup some example data.</p>
</div>
</div>
<div class="sect2">
<h3 id="tasks"><a class="anchor" href="#tasks"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>add a <code>knownAs</code> property:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Column(length = 40, nullable = true, name = "knownAs")     <i class="conum" data-value="1"></i><b>(1)</b>
@Getter @Setter
@Property(editing = Editing.ENABLED)                        <i class="conum" data-value="2"></i><b>(2)</b>
@PropertyLayout(
        fieldSetId = LayoutConstants.FieldSetId.IDENTITY,   <i class="conum" data-value="3"></i><b>(3)</b>
        sequence = "1.1"                                    <i class="conum" data-value="4"></i><b>(4)</b>
)
private String knownAs;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>JPA annotation, declared to be <code>nullable</code> because we don&#8217;t necessarily have a value</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The <a href="../../../refguide/latest/applib/index/annotation/Property.html" class="xref page">@Property</a> annotation provides domain semantics.
(In comparison, the <a href="../../../refguide/latest/applib/index/annotation/PropertyLayout.html" class="xref page">@PropertyLayout</a> annotation defines UI hints/semantics.
Directly editable (similar to the "notes" property)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Renders this new property in the same field set as <code>name</code> &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>&#8230;&#8203; and after the <code>name</code>, not before it
<div class="paragraph">
<p>It&#8217;s also possible to define UI semantics through the associated <code>.layout.xml</code> file; we&#8217;ll look at that alternative in a later exercise.</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>update <code>PetOwner_persona</code> to specify an <code>knownAs</code> for some of the owners:</p>
<div class="listingblock">
<div class="title">PetOwner_persona.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public enum PetOwner_persona
implements Persona&lt;PetOwner, PetOwner_persona.Builder&gt; {

    JAMAL("Jamal Washington", "jamal.pdf", "J"),
    CAMILA("Camila Gonz√°lez", "camila.pdf", null),
    ARJUN("Arjun Patel", "arjun.pdf", null),
    NIA("Nia Robinson", "nia.pdf", null),
    OLIVIA("Olivia Hartman", "olivia.pdf", null),
    LEILA("Leila Hassan", "leila.pdf", null),
    MATT("Matthew Miller", "matt.pdf", "Matt"),
    BENJAMIN("Benjamin Thatcher", "benjamin.pdf", "Ben"),
    JESSICA("Jessica Raynor", "jessica.pdf", "Jess"),
    DANIEL("Daniel Keating", "daniel.pdf", "Dan");

    private final String name;
    private final String contentFileName;
    private final String knownAs;

    ...
}</code></pre>
</div>
</div>
</li>
<li>
<p>for the builder, use the <code>knownAs</code> value of the entity once created:</p>
<div class="listingblock">
<div class="title">PetOwner_persona.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Override
protected PetOwner buildResult(final ExecutionContext ec) {

    val petOwner = wrap(PetOwners).create(persona.name);

    // ...

    if (persona.knownAs != null) {
        petOwner.setKnownAs(persona.knownAs);
    }

    // ...
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-2-define-PetOwners-title-imperatively"><a class="anchor" href="#exercise-3-2-define-PetOwners-title-imperatively"></a>Ex 3.2: Define PetOwner&#8217;s title imperatively</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every domain object has a title, allowing end-users to distinguish one object instance from another.
There&#8217;s no requirement for this title to be unique, but it does need to be unique "enough".</p>
</div>
<div class="paragraph">
<p>Our app currently declares the title of <code>PetOwner</code> declaratively using the <a href="../../../refguide/latest/applib/index/annotation/Title.html" class="xref page">@Title</a> annotation on the <code>name</code> property.
In this exercise, let&#8217;s change that to also include the <code>knownAs</code> property as defined.
Our rule will be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if there is a <code>knownAs</code>, then the title should be "&lt;name&gt; (&lt;knownAs&gt;)"</p>
</li>
<li>
<p>but if <code>knownAs</code> is empty, then the title should be simply the <code>name</code>, as it is now.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To do that, we need to define the title imperatively, using the <a href="../../../refguide/latest/applib-methods/ui-hints.html#title" class="xref page">title()</a> method.</p>
</div>
<div class="sect2">
<h3 id="solution-2"><a class="anchor" href="#solution-2"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-02-define-PetOwner-title-imperatively
mvn clean install
mvn -pl webapp spring-boot:run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-2"><a class="anchor" href="#tasks-2"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>locate the <code>name</code> property of <code>PetOwner</code>, and remove the <code>@Title</code> annotation</p>
</li>
<li>
<p>add a new <code>title()</code> method:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ObjectSupport      <i class="conum" data-value="1"></i><b>(1)</b>
public String title() {
    return getName() + (getKnownAs() != null ? " (" + getKnownAs() + ")" : "");
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../../../refguide/latest/applib/index/annotation/ObjectSupport.html" class="xref page">@ObjectSupport</a> annotation tells the framework to include this method in the metamodel.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-3-remaining-PetOwner-properties"><a class="anchor" href="#exercise-3-3-remaining-PetOwner-properties"></a>Ex 3.3: Add remaining <code>PetOwner</code> properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Comparing <code>PetOwner</code> as it is currently defined with our domain model, there are a couple of changes still to make:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>we need to rename <code>lastCheckedIn</code> property to <code>lastVisit</code> property</p>
</li>
<li>
<p>we still need to add in a <code>telephoneNumber</code> property, and an <code>emailAddress</code> property</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We&#8217;ll make these changes in this exercise.</p>
</div>
<div class="sect2">
<h3 id="solution-3"><a class="anchor" href="#solution-3"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-03-remaining-PetOwner-properties
mvn clean install
mvn -pl webapp spring-boot:run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-3"><a class="anchor" href="#tasks-3"></a>Tasks</h3>
<div class="paragraph">
<p>Rename the <code>lastCheckedIn</code> property to <code>lastVisit</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>rename the field in <code>PetOwner</code></p>
</li>
<li>
<p>update <code>PetOwner_persona</code> also (but your IDE probably refactored this already).</p>
</li>
<li>
<p>to make it more realistic, let&#8217;s change the fixture script so that the value of <code>lastVisit</code> is some number of days in the past:</p>
<div class="listingblock">
<div class="title">PetOwner_persona.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">final var numDaysAgo = fakeDataService.ints().between(100, 2);                          <i class="conum" data-value="1"></i><b>(1)</b>
final var lastVisit = clockService.getClock().nowAsLocalDate().minusDays(numDaysAgo);   <i class="conum" data-value="2"></i><b>(2)</b>
petOwner.setLastVisit(lastVisit);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../../../refguide/latest/testing/index/fakedata/applib/services/FakeDataService.html" class="xref page">FakeDataService</a> provides an easy way to create fake data for testing and prototyping</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>It&#8217;s good practice to use <a href="../../../refguide/latest/applib/index/services/clock/ClockService.html" class="xref page">ClockService</a>, so it can be easily mocked in tests</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now add the two new properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the <code>telephoneNumber</code> property:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Column(length = 40, nullable = true, name = "telephoneNumber") <i class="conum" data-value="1"></i><b>(1)</b>
@Getter @Setter
@Property(editing = Editing.ENABLED)
@PropertyLayout(fieldSetId = "contact", sequence = "1.1")   <i class="conum" data-value="2"></i><b>(2)</b>
private String telephoneNumber;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The JPA <code>@Column</code> annotation indicates that the property is optional in the database; Causeway also understands this for the domain layer.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This places the property in a new "contact" fieldset group; we&#8217;ll define that below</td>
</tr>
</table>
</div>
</li>
<li>
<p>and add the <code>emailAddress</code> property:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Column(length = 40, nullable = true, name = "emailAddress")
@Getter @Setter
@Property(editing = Editing.ENABLED)
@PropertyLayout(fieldSetId = "contact", sequence = "1.2")
private String emailAddress;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>And now let&#8217;s define the referenced "contact" fieldset.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Locate the associated <code>.layout.xml</code> file for <code>PetOwner</code>.
Before the "Details" fieldset, add:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bs3:col span="12"&gt;
    &lt;cpt:fieldSet name="Contact" id="contact"/&gt;
&lt;/bs3:col&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you make changes to this file then your IDE may be able detect the changes automatically.
For example, with IntelliJ you can use <span class="menuseq"><b class="menu">Run</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Debugging Actions</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reload Changed Classes</b></span>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can learn more about layout files <a href="../../../userguide/latest/ui-layout-and-hints.html" class="xref page">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-4-list-new-properties-of-PetOwner"><a class="anchor" href="#exercise-3-4-list-new-properties-of-PetOwner"></a>Ex 3.4: List new properties of PetOwner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Several of the actions in the "Pet Owners" menu return lists of <code>PetOwner</code>s; the "list" action returns all of them.</p>
</div>
<div class="paragraph">
<p>When we do this we see only the <code>name</code> property of the <code>PetOwner</code>.
Let&#8217;s update the app to see some other properties we added in the previous exercise.</p>
</div>
<div class="sect2">
<h3 id="solution-4"><a class="anchor" href="#solution-4"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-04-list-new-properties-of-PetOwner
mvn clean install
mvn -pl webapp spring-boot:run</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-4"><a class="anchor" href="#tasks-4"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>Locate the <code>PetOwner.columnOrder.txt</code> and make these changes:</p>
<div class="listingblock">
<div class="title">PetOwner.columnOrder.txt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">name
telephoneNumber
lastVisit
emailAddress</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Confirm that <span class="menuseq"><b class="menu">Pet Owners</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">List All</b></span> now shows the additional properties as columns.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
if you make changes to this file then your IDE may be able detect the changes automatically.
For example, with IntelliJ you can use <span class="menuseq"><b class="menu">Run</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="submenu">Debugging Actions</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Reload Changed Classes</b></span>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can learn more about layout files <a href="../../../userguide/latest/ui-layout-and-hints.html" class="xref page">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-5-initial-fixture-script"><a class="anchor" href="#exercise-3-5-initial-fixture-script"></a>Ex 3.5: Initial Fixture Script</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we prototype with an in-memory database, it means that we need to setup the database each time we restart the application.
Using the <span class="menuseq"><b class="menu">Prototyping</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">Fixture Scripts</b></span> menu to setup data saves some time, but it would nicer still if that script could be run automatically.
We can do that by specifying a configuration property.</p>
</div>
<div class="paragraph">
<p>We can also leverage <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles">Spring Boot profiles</a> to keep this configuration separate.</p>
</div>
<div class="sect2">
<h3 id="solution-5"><a class="anchor" href="#solution-5"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-05-initial-fixture-script
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-5"><a class="anchor" href="#tasks-5"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>locate the <code>application.yml</code> configuration file (in the webapp module) and create this new file alongside it:</p>
<div class="listingblock">
<div class="title">application-dev.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">causeway:
  testing:
    fixtures:
      initial-script: domainapp.webapp.application.fixture.scenarios.DomainAppDemo</code></pre>
</div>
</div>
</li>
<li>
<p>modify the startup of your application to enable this profile, using this system prpoerty:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">-Dspring.profiles.active=dev</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We also need to make one small modification to the fixture script itself.
The initial fixtures are run with a built-in user called "\__system", that has no roles and therefore no permissions.
We either need to change the fixture script to run as a different user that does have the permissions (there&#8217;s a service called <a href="../../../refguide/latest/applib/index/services/sudo/SudoService.html" class="xref page">SudoService</a> that would let us do that), or, simpler, just temporarily switch off permission checks.
We&#8217;ll go with the second option:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate the <code>PetOwner_persona.Builder</code> class, and make this change:</p>
<div class="listingblock">
<div class="title">PetOwner_persona.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RequiredArgsConstructor
public enum PetOwner_persona /*...*/ {

    @Accessors(chain = true)
    public static class Builder extends BuilderScriptWithResult&lt;PetOwner&gt; {

        @Override
        protected PetOwner buildResult(final ExecutionContext ec) {

            val petOwner = petOwners.create(persona.name); <i class="conum" data-value="1"></i><b>(1)</b>

            // ...
        }
        // ...
    }
    // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Previously this was <code>wrap(petOwners).create(&#8230;&#8203;)</code>.
The <code>wrap(&#8230;&#8203;)</code> method uses the <a href="../../../refguide/latest/applib/index/services/wrapper/WrapperFactory.html" class="xref page">WrapperFactory</a> to wrap the domain object in a proxy, and the proxy enforces all the business rules, including visibility.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you now run the application you should now find that there are 10 <code>PetOwner</code> objects already created.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-6-update-home-page-to-show-PetOwners"><a class="anchor" href="#exercise-3-6-update-home-page-to-show-PetOwners"></a>Ex 3.6: Update Home Page to show PetOwners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every Causeway app can nominate a home page, basically a <a href="../../../userguide/latest/view-models.html" class="xref page">view model</a> that&#8217;s been annotated with <a href="../../../refguide/latest/applib/index/annotation/HomePage.html" class="xref page">@HomePage</a>.
Currently the home page for our app is the one we inherited from the starter app, showing a list of <code>SimpleObject</code>s.</p>
</div>
<div class="paragraph">
<p>In this exercise, we&#8217;ll refactor the home page view model to show a list of <code>PetOwner</code>s instead.</p>
</div>
<div class="sect2">
<h3 id="solution-6"><a class="anchor" href="#solution-6"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-06-update-home-page-to-show-pet-owners
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-6"><a class="anchor" href="#tasks-6"></a>Tasks</h3>
<div class="paragraph">
<p>Locate the <code>HomePageViewModel</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>inject <code>PetOwners</code> domain service (instead of <code>SimpleObjects</code>)</p>
</li>
<li>
<p>change the <code>title()</code> implementation</p>
</li>
<li>
<p>rename the collection from <code>getObjects()</code> to <code>getPetOwners()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The positioning of the collection is also specified in the corresponding layout file, and so that file also needs updating.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate the <code>HomePageViewModel.layout.xml</code> file, and update accordingly</p>
<div class="listingblock">
<div class="title">HomePageViewModel.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;bs3:col span="6" unreferencedCollections="true"&gt;
    &lt;bs3:row&gt;
        &lt;bs3:col span="12"&gt;
            &lt;cpt:collection id="petOwners" defaultView="table"/&gt;
        &lt;/bs3:col&gt;
    &lt;/bs3:row&gt;
&lt;/bs3:col&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default this will show all of the properties of <code>PetOwner</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/03-06/home-page-default-columns.png" alt="home page default columns">
</div>
</div>
<div class="paragraph">
<p>We can change this by creating a file <code>HomePageViewModel#petOwners.columnOrder.txt</code>, alongside the <code>HomePageViewModel</code>.</p>
</div>
<div class="listingblock">
<div class="title">HomePageViewModel#petOwners.columnOrder.txt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-txt hljs" data-lang="txt">name
telephoneNumber
emailAddress
#attachment
#lastVisit
#knownAs
#version</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
the action "Download .columnOrder.txt files (ZIP)" (available only when prototyping) provides an easy way to obtain this file; you can then update as required.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-7-modify-the-menu-action-that-creates-petowners"><a class="anchor" href="#exercise-3-7-modify-the-menu-action-that-creates-petowners"></a>Ex 3.7: Modify the menu action that creates PetOwners</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If we want to create a new <code>PetOwner</code> and specify additional details, at the moment it&#8217;s a two stage process: create the <code>PetOwner</code> (using <span class="menuseq"><b class="menu">PetOwners</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">create</b></span>), then set the additional details afterwards.</p>
</div>
<div class="paragraph">
<p>In this exercise we&#8217;ll simplify that workflow by allowing the additional details to optionally be specified during the create.</p>
</div>
<div class="sect2">
<h3 id="solution-7"><a class="anchor" href="#solution-7"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-07-modifies-PetOwners-create-action
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-7"><a class="anchor" href="#tasks-7"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>update <code>PetOwners#create()</code> method, to allow the additional details to optionally be specified:</p>
<div class="listingblock">
<div class="title">PetOwners.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(semantics = SemanticsOf.NON_IDEMPOTENT)
@ActionLayout(promptStyle = PromptStyle.DIALOG_SIDEBAR)
public PetOwner create(
        @Name final String name,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String knownAs,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String telephoneNumber,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String emailAddress) {
    final var petOwner = PetOwner.withName(name);
    petOwner.setKnownAs(knownAs);
    petOwner.setTelephoneNumber(telephoneNumber);
    petOwner.setEmailAddress(emailAddress);
    return repositoryService.persist(petOwner);
}</code></pre>
</div>
</div>
</li>
<li>
<p>also update <code>PetOwner_persona.Builder</code> fixture script, passing in <code>null</code> for the new parameters:</p>
<div class="listingblock">
<div class="title">PetOwner_persona.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">val petOwner = PetOwners.create(persona.name, null, null, null);</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Or, even better - pass in <code>knownAs</code> as the 2<sup>nd</sup> parameter, and remove the explicit setting of this value later in the fixture script)</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you run the app, confirm that only the <code>name</code> parameter is optional:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/03-07/new-parameters-are-optional.png" alt="new parameters are optional" width="80%">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-8-prompt-styles"><a class="anchor" href="#exercise-3-8-prompt-styles"></a>Ex 3.8: Prompt styles</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The framework provides many ways to customise the UI, either through the layout files or using the <code>@XxxLayout</code> annotations.
Default UI conventions can also be specified using the <code>application.yml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>In this exercise we&#8217;ll change the prompt style for both a service (menu) action, ie <span class="menuseq"><b class="menu">PetOwners</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">create</b></span>, and an object action, ie <code>PetOwner#updateName</code>.</p>
</div>
<div class="sect2">
<h3 id="solution-8"><a class="anchor" href="#solution-8"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-08-prompt-styles
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-8"><a class="anchor" href="#tasks-8"></a>Tasks</h3>
<div class="ulist">
<ul>
<li>
<p>Service (menu) actions are always shown in a dialog, of which there are two styles: modal prompt, or sidebar.
If not specified explicitly, they will default to dialog modal.</p>
<div class="paragraph">
<p>Therefore, remove the <code>@ActionLayout(promptStyle)</code> for <code>PetOwners#create</code></p>
</div>
<div class="listingblock">
<div class="title">PetOwners.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(semantics = SemanticsOf.NON_IDEMPOTENT)
// @ActionLayout(promptStyle = PromptStyle.DIALOG_SIDEBAR)
public PetOwner create( ... ) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm that the dialog is now shown as a modal prompt.</p>
</div>
</li>
<li>
<p>Object actions can be shown either inline or in a dialog, but default to inline.
If forced to use a dialog, then they default to a sidebar prompt rather than a modal prompt.</p>
<div class="paragraph">
<p>Remove the <code>@ActionLayout(promptStyle)</code> for <code>PetOwner#updateName</code>:</p>
</div>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action( ... )
@ActionLayout(
        ...
        // promptStyle = PromptStyle.INLINE,
        ...
)
public PetOwner updateName( ... ) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm that prompt is still inline.</p>
</div>
</li>
<li>
<p>Using a configuration property we can change the default for object actions to use a dialog rather than inline.
We&#8217;ll use the "dev" profile introduced earlier:</p>
<div class="listingblock">
<div class="title">application-dev.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">causeway:
  viewer:
    wicket:
      prompt-style: dialog</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember to activate this new profile (<code>-Dspring.profiles.active=dev</code>) and confirm that the <code>updateName</code> prompt now uses a sidebar dialog.</p>
</div>
</li>
<li>
<p>We can overide the default dialog style for both service and object actions using further configuration properties.</p>
<div class="paragraph">
<p>Switch the defaults so that service actions prefer to use a sidebar dialog, while object actions would use a modal dialog:</p>
</div>
<div class="listingblock">
<div class="title">application-dev.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">causeway:
  viewer:
    wicket:
      prompt-style: dialog
      dialog-mode: modal
      dialog-mode-for-menu: sidebar</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: use <code>@ActionLayout(promptStyle=&#8230;&#8203;)</code> to override these defaults.</p>
<div class="paragraph">
<p>Be aware that "inline" makes no sense/is not supported for service actions.</p>
</div>
</li>
<li>
<p>Finish off the exercises by setting up these defaults to retain the original behaviour:</p>
<div class="listingblock">
<div class="title">application-dev.yaml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">causeway:
  viewer:
    wicket:
      prompt-style: inline
      #dialog-mode: modal   # unused if prompt-style is inline
      dialog-mode-for-menu: sidebar</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-9-derived-days-since-last-visit-property"><a class="anchor" href="#exercise-3-9-derived-days-since-last-visit-property"></a>Ex 3.9: Derived 'days since last visit' property</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Not every property has to persisted, nor editable (indeed most properties are not editable).</p>
</div>
<div class="paragraph">
<p>For example, it might be useful to calculate the number of days since the pet owner last visited; perhaps for marketing purposes.</p>
</div>
<div class="paragraph">
<p>In this exercise we&#8217;ll see how easy it is to create such a derived property.</p>
</div>
<div class="sect2">
<h3 id="solution-9"><a class="anchor" href="#solution-9"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-09-derived-days-since-last-visit-property
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="tasks-9"><a class="anchor" href="#tasks-9"></a>Tasks</h3>
<div class="paragraph">
<p>Locate the <code>PetOwner</code> class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>inject an instance of <a href="../../../refguide/latest/applib/index/services/clock/ClockService.html" class="xref page">ClockService</a>:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
@Transient                  <i class="conum" data-value="1"></i><b>(1)</b>
ClockService clockService;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>instructs JPA that this field is not persisted
<div class="paragraph">
<p>Note that Apache Causeway allows services to be injected into entities (actually, into pretty much any domain object)</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>implement <code>getDaysSinceLastVisit()</code> method, calculating the number of days since "today".</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property
@PropertyLayout(fieldSetId = LayoutConstants.FieldSetId.DETAILS, sequence = "3.1")  <i class="conum" data-value="1"></i><b>(1)</b>
public long getDaysSinceLastVisit() {
    return getLastVisit() != null
            ? ChronoUnit.DAYS.between(getLastVisit(), clockService.getClock().nowAsLocalDate())
            : null;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>positioned just after the <code>lastVisit</code> property</td>
</tr>
</table>
</div>
</li>
<li>
<p>update <code>PetOwner.columnOrder.txt</code> to indicate whether this new property should be rendered in standalone tables (returned from finder actions):</p>
<div class="listingblock">
<div class="title">PetOwner.columnOrder.txt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">name
telephoneNumber
emailAddress
daysSinceLastVisit
#lastVisit
#knownAs
#attachment
#notes
#version</code></pre>
</div>
</div>
</li>
<li>
<p>similarly, update <code>HomePageViewModel#petOwners.columnOrder.txt</code> to indicate whether this new property should be rendered on the home page:</p>
<div class="listingblock">
<div class="title">HomePageViewModel#petOwners.columnOrder.txt</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">name
telephoneNumber
emailAddress
daysSinceLastVisit
#lastVisit
#knownAs
#attachment
#notes
#version</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-10-use-meta-annotations-to-reduce-duplication"><a class="anchor" href="#exercise-3-10-use-meta-annotations-to-reduce-duplication"></a>Ex 3.10: Use meta-annotations to reduce duplication</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is some duplication between <span class="menuseq"><b class="menu">PetOwners</b>&#160;<i class="fa fa-angle-right caret"></i> <b class="menuitem">create</b></span> action and the <code>PetOwner</code> class: both define <code>name</code> as a  parameter or property respectively, and they also share a number of other parameters/properties, <code>telephoneNumber</code>, <code>emailAddress</code> and <code>knownAs</code>.</p>
</div>
<div class="paragraph">
<p>With <code>name</code> you might have noticed that the <code>@Name</code> meta-annotation that came with the starter, and which centralizes the domain knowledge about what a <code>name</code> is.</p>
</div>
<div class="paragraph">
<p>In this exercise we&#8217;ll use the same approach, introducing a meta-annotation to centralize semantics for  <code>telephoneNumber</code>.
(We won&#8217;t do <code>emailAddress</code> or <code>knownAs</code> though - we&#8217;ll explore an even more powerful way to reduce duplication in a following exercise).</p>
</div>
<div class="sect2">
<h3 id="solution-10"><a class="anchor" href="#solution-10"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-10-use-meta-annotations-to-reduce-duplication
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task"><a class="anchor" href="#task"></a>Task</h3>
<div class="ulist">
<ul>
<li>
<p>Create a <code>@PhoneNumber</code> meta-annotation, defined to be an editable property:</p>
<div class="listingblock">
<div class="title">PhoneNumber.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(
        editing = Editing.ENABLED,
        maxLength = PhoneNumber.MAX_LEN,
        optionality = Optionality.OPTIONAL
)
@Parameter(
        maxLength = PhoneNumber.MAX_LEN,
        optionality = Optionality.OPTIONAL
)
@Target({ ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER, ElementType.ANNOTATION_TYPE })
@Retention(RetentionPolicy.RUNTIME)
public @interface PhoneNumber {

    int MAX_LEN = 40;
}</code></pre>
</div>
</div>
</li>
<li>
<p>update the <code>telephoneNumber</code> of <code>PetOwner</code> to use the meta-annotation:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@PhoneNumber                                                                        <i class="conum" data-value="1"></i><b>(1)</b>
@Column(length = PhoneNumber.MAX_LEN, nullable = true, name = "telephoneNumber")    <i class="conum" data-value="2"></i><b>(2)</b>
@Getter @Setter
@PropertyLayout(fieldSetId = "contact", sequence = "1.1")                           <i class="conum" data-value="3"></i><b>(3)</b>
private String telephoneNumber;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>updated to use meta-annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The JPA implementation used by Apache Causeway (EclipseLink) does not support meta-annotations, so the field must still be annotated with <code>@Column</code>.
We can at least use the <code>PhoneNumber.MAX_LEN</code> for the length.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Any annotations defined at the field level supplement or override those inherited from the meta-annotation.</td>
</tr>
</table>
</div>
</li>
<li>
<p>and update the <code>PetOwners#create()</code> action method also:</p>
<div class="listingblock">
<div class="title">PetOwners.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(semantics = SemanticsOf.NON_IDEMPOTENT)
// @ActionLayout(promptStyle = PromptStyle.DIALOG_SIDEBAR)
public PetOwner create(
        @Name final String name,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String knownAs,
        @PhoneNumber                        <i class="conum" data-value="1"></i><b>(1)</b>
        final String telephoneNumber,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String emailAddress) {
        // ...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>updated to use meta-annotation</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-11-validation"><a class="anchor" href="#exercise-3-11-validation"></a>Ex 3.11: Validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the moment there are no constraints for the format of <code>telePhoneNumber</code> properties.
We can fix this by adding rules to their respective meta-annotations.</p>
</div>
<div class="sect2">
<h3 id="solution-11"><a class="anchor" href="#solution-11"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-11-validation-rules-using-metaannotations
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task-2"><a class="anchor" href="#task-2"></a>Task</h3>
<div class="ulist">
<ul>
<li>
<p>Update the <code>@Property</code> and <code>@Parameter</code> annotations of the <code>@PhoneNumber</code> meta-annotation:</p>
<div class="listingblock">
<div class="title">PhoneNumber.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(
        editing = Editing.ENABLED,
        maxLength = PhoneNumber.MAX_LEN,
        optionality = Optionality.OPTIONAL,
        regexPattern = PhoneNumber.REGEX_PATTERN,                           <i class="conum" data-value="1"></i><b>(1)</b>
        regexPatternReplacement = PhoneNumber.REGEX_PATTERN_REPLACEMENT     <i class="conum" data-value="2"></i><b>(2)</b>
)
@Parameter(
        maxLength = PhoneNumber.MAX_LEN,
        optionality = Optionality.OPTIONAL,
        regexPattern = PhoneNumber.REGEX_PATTERN,                           <i class="conum" data-value="1"></i><b>(1)</b>
        regexPatternReplacement = PhoneNumber.REGEX_PATTERN_REPLACEMENT     <i class="conum" data-value="2"></i><b>(2)</b>
)
@Target({ ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER, ElementType.ANNOTATION_TYPE })
@Retention(RetentionPolicy.RUNTIME)
public @interface PhoneNumber {

    int MAX_LEN = 40;
    String REGEX_PATTERN = "[+]?[0-9 ]+";
    String REGEX_PATTERN_REPLACEMENT =
            "Specify only numbers and spaces, optionally prefixed with '+'.  " +
            "For example, '+353 1 555 1234', or '07123 456789'";

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>regex constraint</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>validation message if the constraint is not met</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Try out the application and check that these rules are applied.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-12-more-validation"><a class="anchor" href="#exercise-3-12-more-validation"></a>Ex 3.12: More validation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>updateName</code> action also has a validation rule, applied directly to the method:</p>
</div>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public String validate0UpdateName(String newName) {             <i class="conum" data-value="1"></i><b>(1)</b>
    for (char prohibitedCharacter : "&amp;%$!".toCharArray()) {
        if( newName.contains(""+prohibitedCharacter)) {
            return "Character '" + prohibitedCharacter + "' is not allowed.";
        }
    }
    return null;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <a href="../../../refguide/latest/applib-methods/prefixes.html#validate" class="xref page">validate&#8230;&#8203;()</a> supporting method is used to validate parameters; in this case the "0<sup>th</sup>" parameter of <code>updateName</code>.
More details on the validate supporting method can be found <a href="../../../refguide/latest/applib-methods/prefixes.html#validate" class="xref page">here</a>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this exercise we&#8217;ll move this constraint onto the <code>@Name</code> meta-annotation instead, using a <a href="../../../refguide/latest/applib/index/spec/Specification.html" class="xref page">Specification</a>.</p>
</div>
<div class="sect2">
<h3 id="solution-12"><a class="anchor" href="#solution-12"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-12-moves-validation-onto-metaannotation
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task-3"><a class="anchor" href="#task-3"></a>Task</h3>
<div class="ulist">
<ul>
<li>
<p>Update the <code>@Name</code> meta-annotation using a <a href="../../../refguide/latest/applib-classes/spec.html#specification" class="xref page">Specification</a>:</p>
<div class="listingblock">
<div class="title">Name.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Property(maxLength = Name.MAX_LEN, mustSatisfy = Name.Spec.class)      <i class="conum" data-value="1"></i><b>(1)</b>
@Parameter(maxLength = Name.MAX_LEN, mustSatisfy = Name.Spec.class)     <i class="conum" data-value="1"></i><b>(1)</b>
@ParameterLayout(named = "Name")
@Target({ ElementType.METHOD, ElementType.FIELD, ElementType.PARAMETER, ElementType.ANNOTATION_TYPE })
@Retention(RetentionPolicy.RUNTIME)
public @interface Name {

    int MAX_LEN = 40;
    String PROHIBITED_CHARACTERS = "&amp;%$!";

    class Spec extends AbstractSpecification&lt;String&gt; {                  <i class="conum" data-value="2"></i><b>(2)</b>
        @Override public String satisfiesSafely(String candidate) {
            for (char prohibitedCharacter : PROHIBITED_CHARACTERS.toCharArray()) {
                if( candidate.contains(""+prohibitedCharacter)) {
                    return "Character '" + prohibitedCharacter + "' is not allowed.";
                }
            }
            return null;
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>indicates that the property or parameter value must satisfy the specification below</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>defines the specification definition, where a non-null value is the reason why the specification is not satisfied.</td>
</tr>
</table>
</div>
</li>
<li>
<p>Remove the <code>validate0UpdateName</code> method and <code>PROHIBITED_CHARACTERS</code> constant from <code>PetOwner</code>.</p>
</li>
<li>
<p>update the <code>@ActionLayout#describedAs</code> annotation for "updateName" to use <code>Name.PROHIBITED_CHARACTERS</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Test the app once more.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
in making this refactoring we actually fixed a bug: there was no validation of the parameter when a new <code>PetOwner</code> was created; but now there is.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-13-scalar-custom-value-types"><a class="anchor" href="#exercise-3-13-scalar-custom-value-types"></a>Ex 3.13: Scalar custom value types</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We could use meta-annotations for the "emailAddress" property and parameter, but instead we&#8217;ll reduce duplication using an even more powerful technique, namely custom value types.
We&#8217;ll define a custom class <code>EmailAddress</code> with value semantics, allowing validation and any other behaviour to move onto the custom class itself.</p>
</div>
<div class="paragraph">
<p>Apache Causeway supports both scalar and composite value types.
For email address, we&#8217;ll use a single string, so it&#8217;s a scalar value type.</p>
</div>
<div class="sect2">
<h3 id="solution-13"><a class="anchor" href="#solution-13"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-13-scalar-custom-value-type-for-email-address
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task-4"><a class="anchor" href="#task-4"></a>Task</h3>
<div class="ulist">
<ul>
<li>
<p>Define the <code>EmailAddress</code> value type:</p>
<div class="listingblock">
<div class="title">EmailAddress.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@jakarta.persistence.Embeddable                                         <i class="conum" data-value="1"></i><b>(1)</b>
@org.apache.causeway.applib.annotation.Value                            <i class="conum" data-value="2"></i><b>(2)</b>
@lombok.EqualsAndHashCode                                               <i class="conum" data-value="3"></i><b>(3)</b>
public class EmailAddress implements Serializable {                     <i class="conum" data-value="4"></i><b>(4)</b>

    static final int MAX_LEN = 100;
    static final int TYPICAL_LEN = 30;
    static final Pattern REGEX =
        Pattern.compile("^[\\w-\\+]+(\\.[\\w]+)*@[\\w-]+(\\.[\\w]+)*(\\.[a-zA-Z]{2,})$");

    public static EmailAddress of(String value) {                       <i class="conum" data-value="5"></i><b>(5)</b>
        if (_Strings.isNullOrEmpty(value)) {
            return null;
        }
        if(!EmailAddress.REGEX.matcher(value).matches()) {
            throw new RuntimeException("Invalid email format");
        }

        final var ea = new EmailAddress();
        ea.value = value;
        return ea;
    }

    protected EmailAddress() {}                                         <i class="conum" data-value="6"></i><b>(6)</b>

    @Getter
    @Column( length = MAX_LEN, nullable = true, name = "emailAddress")  <i class="conum" data-value="1"></i><b>(1)</b>
    String value;                                                       <i class="conum" data-value="7"></i><b>(7)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Required JPA annotations</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Indicates to Causeway that this class is a value type (as opposed to an entity, view model or domain service)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Value types generally implement equals and hashCode</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Value types generally are serializable</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Validation moves to the factory method</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>no-arg constructor is required by JPA</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The single data attribute to be persisted</td>
</tr>
</table>
</div>
</li>
<li>
<p>Implement a "value semantics provider".
This tells Causeway how to interact with the value type</p>
<div class="listingblock">
<div class="title">EmailAddressValueSemantics.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named(PetOwnerModule.NAMESPACE + ".EmailAddressValueSemantics")
@Component                                                                  <i class="conum" data-value="1"></i><b>(1)</b>
public class EmailAddressValueSemantics
        extends ValueSemanticsAbstract&lt;EmailAddress&gt; {                      <i class="conum" data-value="2"></i><b>(2)</b>

    @Override
    public Class&lt;EmailAddress&gt; getCorrespondingClass() {
        return EmailAddress.class;
    }

    @Override
    public ValueType getSchemaValueType() {                                 <i class="conum" data-value="3"></i><b>(3)</b>
        return ValueType.STRING;
    }

    @Override
    public ValueDecomposition decompose(final EmailAddress value) {         <i class="conum" data-value="4"></i><b>(4)</b>
        return decomposeAsNullable(value, EmailAddress::getValue, ()-&gt;null);
    }

    @Override
    public EmailAddress compose(final ValueDecomposition decomposition) {   <i class="conum" data-value="4"></i><b>(4)</b>
        return composeFromNullable(
                decomposition, ValueWithTypeDto::getString, EmailAddress::of, ()-&gt;null);
    }

    @Override
    public DefaultsProvider&lt;EmailAddress&gt; getDefaultsProvider() {           <i class="conum" data-value="5"></i><b>(5)</b>
        return () -&gt; null;
    }

    @Override
    public Renderer&lt;EmailAddress&gt; getRenderer() {                           <i class="conum" data-value="6"></i><b>(6)</b>
        return (context, emailAddress) -&gt;  emailAddress == null ? null : emailAddress.getValue();
    }

    @Override
    public Parser&lt;EmailAddress&gt; getParser() {                               <i class="conum" data-value="7"></i><b>(7)</b>
        return new Parser&lt;&gt;() {

            @Override
            public String parseableTextRepresentation(Context context, EmailAddress emailAddress) {
                return renderTitle(emailAddress, EmailAddress::getValue);
            }

            @Override
            public EmailAddress parseTextRepresentation(Context context, String text) {
                return EmailAddress.of(text);
            }

            @Override
            public int typicalLength() {
                return EmailAddress.TYPICAL_LEN;
            }

            @Override
            public int maxLength() {
                return EmailAddress.MAX_LEN;
            }
        };
    }

    @Override
    public IdStringifier&lt;EmailAddress&gt; getIdStringifier() {                 <i class="conum" data-value="8"></i><b>(8)</b>
        return new IdStringifier.EntityAgnostic&lt;&gt;() {
            @Override
            public Class&lt;EmailAddress&gt; getCorrespondingClass() {
                return EmailAddressValueSemantics.this.getCorrespondingClass();
            }

            @Override
            public String enstring(@NonNull EmailAddress value) {
                return _Strings.base64UrlEncode(value.getValue());
            }

            @Override
            public EmailAddress destring(@NonNull String stringified) {
                return EmailAddress.of(_Strings.base64UrlDecode(stringified));
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defined as a Spring <code>@Component</code> so that the framework can discover and use this value semantics provider</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Typically inherit from <code>ValueSemanticsAbstract</code>, a convenience superclass</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>schemaValueType</code> in essence defines the widget that will be used to interact with the value</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>ValueDecomposition</code> is primarily used by the <a href="../../../vro/latest/about.html" class="xref page">REST API (Restful Objects)</a> to convert to/from JSON.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The <code>DefaultsProvider</code> provides an initial value, if any.
For some values there is often a reasonable default, eg <code>0</code> for a number, or <code>[0,0]</code> for a coordinate, or today&#8217;s date.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>The <code>Renderer</code> provides string and if required HTML representations of the value</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The <code>Parser</code> converts string representations into the value.
Note how this code delegates back to the <code>EmailAddress</code> value type itself</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>IdStringifier</code> returns a string representation of the value, in case it is used as an identifier of the object.
The returned string would appear in URLs or bookmarks, for example.</td>
</tr>
</table>
</div>
</li>
<li>
<p>update <code>PetOwner#emailAddress</code> to use the <code>EmailAddress</code> value type:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@jakarta.persistence.Embedded                                               <i class="conum" data-value="1"></i><b>(1)</b>
@Getter @Setter
@Property(editing = Editing.ENABLED, optionality = Optionality.OPTIONAL)    <i class="conum" data-value="2"></i><b>(2)</b>
@PropertyLayout(fieldSetId = "contact", sequence = "1.2")
private EmailAddress emailAddress;                                          <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>required JPA annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>need to explicitly indicate that this property is optional (previously it was inferred from <code>@Column(nullable=)</code>)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>change the type from <code>String</code> to <code>EmailAddress</code></td>
</tr>
</table>
</div>
</li>
<li>
<p>update <code>PetOwners#create</code> to use the <code>EmailAddress</code> value type:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action(semantics = SemanticsOf.NON_IDEMPOTENT)
// @ActionLayout(promptStyle = PromptStyle.DIALOG_SIDEBAR)
public PetOwner create(
        @Name final String name,
        @Parameter(maxLength = 40, optionality = Optionality.OPTIONAL)
        final String knownAs,
        @PhoneNumber
        final String telephoneNumber,
        @Parameter(optionality = Optionality.OPTIONAL)
        final EmailAddress emailAddress) {                  <i class="conum" data-value="1"></i><b>(1)</b>
    final var petOwner = PetOwner.withName(name);
    petOwner.setKnownAs(knownAs);
    petOwner.setTelephoneNumber(telephoneNumber);
    petOwner.setEmailAddress(emailAddress);
    return repositoryService.persist(petOwner);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Change the parameter' type from <code>String</code> to <code>EmailAddress</code></td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Run the application and try to enter an invalid email address; the logic in the value type should prevent this.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-14-use-layout-xml-file-for-ui-semantics"><a class="anchor" href="#exercise-3-14-use-layout-xml-file-for-ui-semantics"></a>Ex 3.14: Use layout xml file for UI semantics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>At the moment the associated <code>.layout.xml</code> file for <code>PetOwner</code> is used to define rows, columns and fieldsets, while the <a href="../../../refguide/latest/applib/index/annotation/PropertyLayout.html" class="xref page">@PropertyLayout</a> annotation is grouped to associate properties with those fieldsets.</p>
</div>
<div class="paragraph">
<p>If we prefer, we can specify this association within the <code>PetOwner.layout.xml</code> file instead.
And we can also do the same thing associating actions with properties or collections.
This has the benefit of being dynamic; we can move fields around in the layout without having to recompile/restart the application.</p>
</div>
<div class="sect2">
<h3 id="solution-14"><a class="anchor" href="#solution-14"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-14-use-layout-xml-for-ui-semantics
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task-5"><a class="anchor" href="#task-5"></a>Task</h3>
<div class="paragraph">
<p>Associate properties with fieldsets using <code>.layout.xml</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>associate <code>name</code> property with <code>identity</code> fieldset:</p>
<div class="ulist">
<ul>
<li>
<p>remove <code>@PropertyLayout</code> from <code>PetOwner</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Name
@Column(length = Name.MAX_LEN, nullable = false, name = "name")
@Getter @Setter @ToString.Include
// @PropertyLayout(fieldSetId = LayoutConstants.FieldSetId.IDENTITY, sequence = "1")
private String name;</code></pre>
</div>
</div>
</li>
<li>
<p>add to <code>PetOwner.layout.xml</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cpt:fieldSet name="Identity" id="identity"&gt;
    &lt;cpt:property id="name"/&gt;
&lt;/cpt:fieldSet&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>similarly for <code>knownAs</code></p>
</li>
<li>
<p>similarly for <code>telephoneNumber</code></p>
</li>
<li>
<p>similarly for <code>emailAddress</code></p>
</li>
<li>
<p>similarly for <code>notes</code></p>
</li>
<li>
<p>similarly for <code>lastVisit</code></p>
</li>
<li>
<p>similarly for <code>daysSinceLastVisit</code></p>
</li>
<li>
<p>similarly for <code>attachment</code></p>
</li>
<li>
<p>associate <code>version</code> property with <code>metadata</code> fieldset, and also explicitly specify the location of the two framework-provided properties that also reside in that fieldset:</p>
<div class="ulist">
<ul>
<li>
<p>change <code>`PetOwner#version</code> property to::</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Version
@Column(name = "version", nullable = false)
//@PropertyLayout(fieldSetId = "metadata", sequence = "999")    <i class="conum" data-value="1"></i><b>(1)</b>
@Property                                                       <i class="conum" data-value="2"></i><b>(2)</b>
@Getter @Setter
private long version;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@PropertyLayout</code> was removed&#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; but <code>@Property</code> has been added instead.
<div class="paragraph">
<p>This is because at least one of @Property` or <code>@PropertyLayout</code> must be present to identify the field as a property (at least so far as this application has been configured.
In fact, it is possible to configure the framework to be either less strict or more strict with respect to whether annotations are specified, see <a href="../../../refguide/latest/config/sections/causeway.core.meta-model.introspector.html#causeway.core.meta-model.introspector.policy" class="xref page">refguide:config:sections/causeway.core.meta-model.introspector.adoc#causeway.core.meta-model.introspector.policy</a>]).</p>
</div></td>
</tr>
</table>
</div>
</li>
<li>
<p>add to <code>PetOwner.layout.xml</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cpt:fieldSet name="Metadata" id="metadata"&gt;
    &lt;cpt:property id="logicalTypeName"/&gt;        <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;cpt:property id="objectIdentifier"/&gt;       <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;cpt:property id="version"/&gt;
&lt;/cpt:fieldSet&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>framework-provided properties.
If we want the <code>version</code> property to appear last in the fieldset, then we need to specify these other properties also.</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>associate the <code>updateName</code> action with the <code>name</code> property</p>
<div class="ulist">
<ul>
<li>
<p>remove from <code>PetOwner</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @Action( ... )
    @ActionLayout(
            // associateWith = "name",      <i class="conum" data-value="1"></i><b>(1)</b>
            ...
    )
    public PetOwner updateName(
            @Name final String name) { ... }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>deleted this line</td>
</tr>
</table>
</div>
</li>
<li>
<p>add to <code>PetOwner.layout.xml</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cpt:property id="name"&gt;
    &lt;cpt:action id="updateName"/&gt;
&lt;/cpt:property&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>similarly <code>updateAttachment</code> action</p>
<div class="ulist">
<ul>
<li>
<p>remove from <code>PetOwner</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action( ... )
// @ActionLayout(                               <i class="conum" data-value="1"></i><b>(1)</b>
//      associateWith = "attachment",           <i class="conum" data-value="1"></i><b>(1)</b>
//      position = ActionLayout.Position.PANEL  <i class="conum" data-value="1"></i><b>(1)</b>
// )                                            <i class="conum" data-value="1"></i><b>(1)</b>
public PetOwner updateAttachment( ... ) { ... }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>deleted lines</td>
</tr>
</table>
</div>
</li>
<li>
<p>add to <code>PetOwner.layout.xml</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cpt:property id="attachment"&gt;
    &lt;cpt:action id="updateAttachment" position="PANEL"/&gt;
&lt;/cpt:property&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>remove from <code>PetOwner</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Action( ... )
@ActionLayout(
    // fieldSetId = LayoutConstants.FieldSetId.IDENTITY,        <i class="conum" data-value="1"></i><b>(1)</b>
    // position = ActionLayout.Position.PANEL,                  <i class="conum" data-value="1"></i><b>(1)</b>
    describedAs = "Deletes this object from the persistent datastore"
)
public void delete() { ... }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>deleted lines</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>add to <code>PetOwner.layout.xml</code>:</p>
<div class="listingblock">
<div class="title">PetOwner.layout.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;cpt:fieldSet name="Identity" id="identity"&gt;
    &lt;cpt:action id="delete" position="PANEL"/&gt;  <i class="conum" data-value="1"></i><b>(1)</b>
    &lt;cpt:property id="name"&gt;
        &lt;cpt:action id="updateName"/&gt;
    &lt;/cpt:property&gt;
    ...
&lt;/cpt:fieldSet&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>added, <em>before</em> any of the <code>&lt;property&gt;</code>s</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whether you choose to use layout file only or a mixture of layout file and annotations is a matter of taste.
Notice that the <code>.layout.xml</code> files has elements with the "unreferencedProperties", "unreferencedCollections" or "unreferencedActions" (and is considered invalid if these are missing).
As you might expect, these tags indicate where to render properties, collections or actions whose placement has not been specified explicitly.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is an important principle of the <em>naked objects pattern</em> ; the domain object should always be rendered in some way or another.
The presence of UI semantics (<code>@XxxLayout</code> annotations or the <code>.layout.xml</code> files) merely influence how that rendering is performed.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exercise-3-15-update-icon-for-pet-owner"><a class="anchor" href="#exercise-3-15-update-icon-for-pet-owner"></a>Ex 3.15: Update icon for Pet Owner</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As we&#8217;ve learnt in previous exercises, every domain object has a title which allows the end-user to distinguish one object from another.
Every domain object also has an icon, which helps distinguish one domain object <em>type</em> from another.</p>
</div>
<div class="paragraph">
<p>The icon acts as the hyperlink from one domain object to another, for example from the home page to the <code>PetOwner</code> entity.
But choosing a good icon also improves the feedback cycle with your domain expert&#8217;s; similar to personas, it helps to create a connection between the domain experts concept of the "thing" and its representation in the app&#8217;s user interface.</p>
</div>
<div class="paragraph">
<p>In this exercise, we&#8217;ll replace the icon for <code>PetOwner</code>.</p>
</div>
<div class="sect2">
<h3 id="solution-15"><a class="anchor" href="#solution-15"></a>Solution</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout tags/3.2.0/03-15-change-pet-owner-icon-png
mvn clean install
mvn -pl webapp spring-boot:run -Dspring-boot.run.jvmArguments="-Dspring.profiles.active=dev"</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="task-6"><a class="anchor" href="#task-6"></a>Task</h3>
<div class="paragraph">
<p>The icon for <code>PetOwner</code> is defined in the <code>PetOwner.png</code>.
All we need to do is replace it with some other icon.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download a <code>.png</code> icon (it will be auto-scaled, but 32, 64 or 80 pixels is a good size).</p>
<div class="paragraph">
<p>There are lots of good resources, for example <a href="https://icon8.com" class="bare">https://icon8.com</a>.
Remember to provide appropriate accreditation if required.</p>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the icon in the solution does indeed use a free icon from icons8.com, namely <a href="https://icons8.com/icons/set/person&#8212;&#8203;icons8" class="bare">https://icons8.com/icons/set/person&#8212;&#8203;icons8</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright ¬© 2010~2024 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Causeway, and the Apache Causeway project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 4.0.0-SNAPSHOT.20260127-0328-be1559e1</p>
        </div>
    </div>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="../../../_/js/vendor/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'causeway-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
