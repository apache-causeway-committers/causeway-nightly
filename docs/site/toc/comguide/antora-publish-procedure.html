<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Publishing the Docs :: Apache Isis</title>
    <link rel="canonical" href="https://isis.apache.org/toc/comguide/antora-publish-procedure.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isis.apache.org">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="toc" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../about.html">Table of Contents</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">What is Apache Isis?</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/isis-in-pictures.html">Apache Isis in pictures</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/common-use-cases.html">Common Use Cases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/screencasts.html">Screencasts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../what-is-apache-isis/powered-by.html">Powered By</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Quick Start</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Starter Apps</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../helloworld/about.html">HelloWorld archetype</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../simpleapp/about.html">SimpleApp archetype</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Demos &amp; Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../demoapp/about.html">Demo App</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic (tutorial)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Guides</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../ug/about.html">User Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../rg/about.html">Reference Guide</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../testing/about.html">Testing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Components</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../vw/about.html">Wicket Viewer</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../vro/about.html">Restful Objects</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../odn/about.html">DataNucleus Object Store</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../security/about.html">Security Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../ext-secman/about.html">SecMan (extension)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../devguide/about.html">Developers' Guide</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../mavendeps/about.html">Maven mixins</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Mailing Lists</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../mailing-list/how-to-subscribe.html">How to subscribe</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Releases</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../downloads/how-to.html">Downloads</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../relnotes/about.html">Release Notes</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../mignotes/about.html">Migration Notes</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Other Resources</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="https://issues.apache.org/jira/secure/RapidBoard.jspa?rapidView=87">JIRA</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Internal</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Committers</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">Committers' Guide</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="about.html#cutting-a-release">Cutting a Release</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="about.html#verifying-releases">Verifying a Release</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Implementation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../archdesign/about.html">Architecture &amp; Design</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../runtime-services/about.html">Framework Internal Services</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../../smoketests/about.html">SmokeTest App</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Acknowledgements</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../more-thanks/more-thanks.html">With thanks</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Table of Contents</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Architecture & Design</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../archdesign/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Hello World</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../helloworld/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - SimpleApp</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../simpleapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions - SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ext-secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Fundamentals & Beyond</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../ug/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Guides - Reference Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../rg/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Maven Dependencies</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mavendeps/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../mignotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../relnotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Runtime Services</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../runtime-services/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SmokeTest App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../smoketests/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Table of Contents</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../about.html">Table of Contents</a></li>
    <li><a href="antora-publish-procedure.html">Publishing the Docs</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/hobrom/antora/isis/antora/components/toc/modules/comguide/pages/antora-publish-procedure.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Publishing the Docs</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Isis' documentation (meaning the website and the users' guide, the reference guide and this contributors' guide) is written using <a href="https://asciidoctor.org/">Asciidoctor</a> syntax, and organized to be published as an <a href="https:antora.org">Antora</a> website.</p>
</div>
<div class="paragraph">
<p>The website and guides are created by running build tools (documented below) which create the HTML version of the site and guides.
You can therefore easily check the documentation before raising a pull request (as a contributor) or publishing the site (if a committer).</p>
</div>
<div class="paragraph">
<p>For details of authoring/updating the documents and website, see the <a href="#">toc:devguide:asciidoc.adoc</a>.</p>
</div>
<div class="paragraph">
<p>Publishing is performed by copying the generated HTML to a different git repository (<a href="https://github.com/apache/isis-site.git">isis-site</a>).
This is synced by ASF infrastructure over to <a href="http://isis.apache.org">isis.apache.org</a>.
This can only be done by Apache Isis committers, and is discussed below.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="one-time-setup"><a class="anchor" href="#one-time-setup"></a>One-time setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The generated site is published by copying into the <code>content/</code> directory of the <a href="https://github.com/apache/isis-site.git">isis-site</a> git repo.
You therefore need to check this out this repo.</p>
</div>
<div class="paragraph">
<p>The procedure assumes that two git repos (for <a href="https://github.com/apache/isis">isis</a> itself on github, and for isis-site) are checked out into the same parent directory, eg:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/GITHUB/
  apache/
    isis/                       <i class="conum" data-value="1"></i><b>(1)</b>
      adocs
        documentation/
          README.adoc
          ...
    isis-site/                  <i class="conum" data-value="2"></i><b>(2)</b>
      content/                  <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>checkout of isis.git</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>checkout of isis-site.git</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>the published website</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>One oddity; ASF&#8217;s script to upload the documentation to the web server checks out from the 'asf-site' branch, NOT from the 'master' branch.
Therefore, in the <code>isis.git</code> repo site:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git checkout asf-site</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="preview"><a class="anchor" href="#preview"></a>Preview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To preview changes (ignoring PDFs), run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh preview-html.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will update the documentation and start a (Python) webserver so that the documents can be viewed.</p>
</div>
<div class="paragraph">
<p>If you want to also view the PDFs, use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh preview-pdf.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s generally little point in doing this, however.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="publishing-full-build"><a class="anchor" href="#publishing-full-build"></a>Publishing (full build)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>content</code> directory for the published website contains not only the "current version" of the docs, but also has an archive of older versions of the document from earlier releases:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>/GITHUB/
  apache/
    isis-site/
      content/                  <i class="conum" data-value="1"></i><b>(1)</b>
        index.html              <i class="conum" data-value="2"></i><b>(2)</b>
        *                       <i class="conum" data-value="3"></i><b>(3)</b>
        versions/
          current/              <i class="conum" data-value="4"></i><b>(4)</b>
          SNAPSHOT/             <i class="conum" data-value="5"></i><b>(5)</b>
          ...                   <i class="conum" data-value="6"></i><b>(6)</b>
          latest/               <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>the published website</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>home page.
This has a drop-down to access older versions of the documentation, but most links are through to the "current version"</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>documentation for the current release version</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>also holds documentation for the current release version</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>documentation for the next snapshot version, ie work-in-progress</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>other versions, by version number (eg <code>1.16.2</code>, <code>1.16.1</code>, etc)</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>not checked into git, this is a working directory that contains the results of the latest publication build.
This is an implementation detail actually, so this directory need not be considered further.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The earlier versions of the documentation are (obviously) not recreated when the documentation is published, only the current version is updated.</p>
</div>
<div class="paragraph">
<p>To publish the current version of the documents, switch to the  <code>adocs/documentation</code> directory of the main <code>isis-git.repo</code>.
Then run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh publish.sh "ISIS-nnnn: a custom commit message"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This does the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>deletes everything under <code>content</code> (except <code>content/versions</code>)</p>
</li>
<li>
<p>generates documentation and copies to <code>content/versions/SNAPSHOT</code></p>
<div class="paragraph">
<p>Including fixing up line endings, standardizing on unix-style LFs.</p>
</div>
</li>
<li>
<p>copies over current home page (<code>index.html</code>)</p>
</li>
<li>
<p>reinstates <code>content/*</code> with the contents of <code>content/versions/current</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In other words, the effect of running <code>publish.sh</code> is in essence to overwrite <code>content/versions/SNAPSHOT</code> and to overwrite <code>index.html</code>, but leave everything else as it is.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The version on the header of each generated document is hard-coded in the <code>adocs/template/document.html.erb</code> file.</p>
</div>
<div class="paragraph">
<p>This should therefore be updated whenever working on a new release.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="new-release"><a class="anchor" href="#new-release"></a>New release</h3>
<div class="paragraph">
<p>When a new release is published, we therefore need to do a little extra work:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>run <code>publish.sh</code> a first time</p>
<div class="paragraph">
<p>This will  update <code>content/versions/SNAPSHOT</code></p>
</div>
</li>
<li>
<p>delete <code>content/versions/current</code></p>
</li>
<li>
<p>rename <code>content/versions/SNAPSHOT</code> to <code>content/versions/current</code></p>
</li>
<li>
<p>run <code>publish.sh</code> a second time.</p>
<div class="paragraph">
<p>This has the effect of "promoting" <code>content/versions/current</code> to <code>content/*</code></p>
</div>
</li>
<li>
<p>(optionally) also copy <code>content/versions/current</code> to <code>content/versions/N.N.N</code></p>
<div class="paragraph">
<p>where <code>N.N.N</code> is the release number</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ensure in doing this that the dropdown for the home page correctly references the versions.</p>
</div>
<div class="paragraph">
<p>When ready, then stage, commit and push the changes (in the <code>isis-site.git</code> directory, of course):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">git commit -am "ISIS-nnnn: updating docs"
git push</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
