<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Test Support :: causeway</title>
    <meta name="generator" content="Antora 3.1.14">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
<link rel="home" href="../.." title="causeway">
  <link rel="next" href="spi-services.html" title="SPI Services">
  <link rel="prev" href="setup-and-configuration.html" title="Setup and Configuration">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
          <span class="icon">
            <img src="../../_/img/causeway-logo-no-words-65x48.png"></img>
          </span>
        <span class="navbar-title">causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../docs/latest/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../docs/latest/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Learning &amp; Tutorials</span>
            <a class="navbar-item" href="../../docs/latest/reference/about.html">Reference App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../docs/latest/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../docs/latest/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/about.html">User Guide</a>
            <a class="navbar-item" href="../../refguide/latest/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../testing/latest/about.html">Testing Guide</a>
            <a class="navbar-item" href="../../security/latest/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">For use in apps</span>
            <a class="navbar-item" href="../../valuetypes/latest/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../setupguide/latest/about.html">Setup Guide</a>
            <a class="navbar-item" href="../../conguide/latest/about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/bypass/about.html">Bypass</a>
            <a class="navbar-item" href="../../security/latest/simple/about.html">Simple</a>
            <a class="navbar-item" href="../../security/latest/shiro/about.html">Shiro</a>
            <a class="navbar-item" href="../../security/latest/spring/about.html">Spring</a>
            <a class="navbar-item" href="../../security/latest/keycloak/about.html">Keycloak</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/latest/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../gqlv/latest/about.html">GraphQL API</a>
            <a class="navbar-item" href="../../vro/latest/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../pjpa/latest/about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../pjdo/latest/about.html">JDO (DataNucleus)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Extensions</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/commandlog/about.html">Command Log</a>
            <a class="navbar-item" href="../../userguide/latest/docgen/about.html">Doc Gen</a>
            <a class="navbar-item" href="../../userguide/latest/executionlog/about.html">Execution Log</a>
            <a class="navbar-item" href="../../userguide/latest/executionoutbox/about.html">Execution Outbox</a>
            <a class="navbar-item" href="../../userguide/latest/executionrepublisher/about.html">Execution Republisher</a>
            <a class="navbar-item" href="../../userguide/latest/excel/about.html">Excel</a>
            <a class="navbar-item" href="../../userguide/latest/flyway/about.html">Flyway</a>
            <a class="navbar-item" href="../../userguide/latest/layoutloaders/about.html">Layout Loaders</a>
            <a class="navbar-item" href="../../userguide/latest/titlecache/about.html">Title Cache</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/secman/about.html">Secman</a>
            <a class="navbar-item" href="../../security/latest/audittrail/about.html">Audit Trail</a>
            <a class="navbar-item" href="../../security/latest/spring-oauth2/about.html">Spring OAuth2 Integration</a>
            <a class="navbar-item" href="../../security/latest/shiro-realm-ldap/about.html">LDAP Realm for Shiro</a>
            <a class="navbar-item" href="../../security/latest/sessionlog/about.html">Session Log</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Web UI (Wicket)</span>
            <a class="navbar-item" href="../../vw/latest/fullcalendar/about.html">Full Calendar</a>
            <a class="navbar-item" href="../../vw/latest/pdfjs/about.html">pdf.js</a>
            <a class="navbar-item" href="../../vw/latest/sse/about.html">Server Side Events</a>
            <a class="navbar-item" href="../../vw/latest/tabular/about.html">Tabular Download</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">REST API (Restful Objects)</span>
            <a class="navbar-item" href="../../vro/latest/cors/about.html">CORS</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../docs/latest/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../docs/latest/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/CAUSEWAY">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/causeway">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../docs/latest/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/latest/about.html">Release Notes</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../comguide/latest/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../tooling/latest/about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_causeway">SonarCloud.io</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Interim Builds</span>
            <a class="navbar-item" href="../../comguide/latest/nightly-builds.html">Nightly builds</a>
            <a class="navbar-item" href="../../comguide/latest/weekly-builds.html">Weekly builds</a>
            <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">Website Preview (not ASF hosted)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../core/latest/about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../regressiontests/latest/about.html">Regression Tests</a>
            <a class="navbar-item" href="../../incubator/latest/about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../more-thanks/latest/more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">License</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Causeway.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../docs/latest/about.html">
          <span class="icon">
            <img src="../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="gqlv" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-search hide-for-print">
  <input id="algolia-search-input" placeholder="Search"></span>
</div>
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="setup-and-configuration.html" title="Setup and Configuration"><span></span></a>
  <a class="page-next" rel="next"
     href="spi-services.html" title="SPI Services"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Setup and Configuration"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">GraphQL Viewer</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="setup-and-configuration.html">Setup and Configuration</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="testsupport.html">Test Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="spi-services.html">SPI Services</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="i18n.html">i18n Concerns</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">GraphQL Viewer</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../comguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version">
          <a href="../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions</span>
      <ul class="versions">
        <li class="version">
          <a href="../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">GraphQL Viewer</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">QueryDSL</span>
      <ul class="versions">
        <li class="version">
          <a href="../../querydsl/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version">
          <a href="../../tutorials/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">GraphQL Viewer</a></li>
    <li><a href="testsupport.html">Test Support</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/causeway/edit/main/viewers/graphql/adoc/modules/ROOT/pages/testsupport.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Test Support</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Because the <a href="about.html#rich-vs-simple-schemas" class="xref page">rich</a> schema exposes pretty much all the behaviour of the domain model, it&#8217;s possible to use GraphQL queries as a way to write end-to-end tests.
This works especially well with <a href="https://github.com/approvals/ApprovalTests.Java">approval tests</a>, which can be used to efficiently assert the contents of the returned response.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="print-schema"><a class="anchor" href="#print-schema"></a>Print Schema</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When writing tests, it can be useful to first generate the schema.
You can then register the schema with a dedicated editor; this can then provide code-completion.
Some IDEs (for example IntelliJ IDEA) also provide this capability.</p>
</div>
<div class="paragraph">
<p>Subclass the <code>PrintSchemaIntegTestAbstract</code> and optionally specify the API variant.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.springframework.test.context.DynamicPropertyRegistry;
import org.springframework.test.context.DynamicPropertySource;

import org.apache.causeway.viewer.graphql.viewer.testsupport.schema.PrintSchemaIntegTestAbstract;

import static org.apache.causeway.core.config.CausewayConfiguration.Viewer.Graphql.ApiVariant;

@Import({
        UniversityModule.class                                      <i class="conum" data-value="1"></i><b>(1)</b>
})
public class PrintSchemaIntegTest
    extends PrintSchemaIntegTestAbstract {                          <i class="conum" data-value="2"></i><b>(2)</b>

    @DynamicPropertySource
    static void apiVariant(DynamicPropertyRegistry registry) {      <i class="conum" data-value="3"></i><b>(3)</b>
        registry.add("causeway.viewer.graphql.api-variant",
            ApiVariant.QUERY_WITH_MUTATIONS_NON_SPEC_COMPLIANT::name);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specifies the domain module(s) to test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subclass from the superclass</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>optionally specify the API variant.
You could also use <code>application-test.properties</code> or <code>application-test.yml</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will then write out a <code>schema.gql</code> file into <code>src/test/resources</code> of the maven module containing the test class.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="integration-test-support"><a class="anchor" href="#integration-test-support"></a>Integration Test Support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>CausewayViewerGraphqlIntegTestAbstract</code> class is intended to be used as the base class for your integration tests.
It spins up an instance of the app (listening on a random port), and then allows you to submit queries and mutations against the backend.</p>
</div>
<div class="paragraph">
<p>Since most tests consist of a query and then checking a response, the superclass also provides some sophisticated support here.
All you need to do is to save your queries in the same package as your subclass.
These are automatically picked by the test class, submitted, and then the approval tests assertion library is used to compare the results.</p>
</div>
<div class="paragraph">
<p>The first time you run the tests, they will of course fail because you will be missing the "approved" responses.
Check that the received response is as expect, and then approve it.</p>
</div>
<div class="paragraph">
<p>To use it subclass it, use <code>@Import</code> to specify the modules to be tested, and then save queries or mutations as files in the same package.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="title">Calculator.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("calculator.Calculator")
@DomainService
@RequiredArgsConstructor(onConstructor_ = {@Inject})
public class Calculator {

    @Action(semantics = SemanticsOf.SAFE)
    public boolean and(boolean x, boolean y) {
        return x &amp; y;
    }

    @Action(semantics = SemanticsOf.SAFE)
    public String concat( String prefix, String suffix) {
        return prefix + suffix;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To test this service, we would use:</p>
</div>
<div class="listingblock">
<div class="title">Calculator_IntegTest.java</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.apache.causeway.viewer.graphql.viewer.testsupport.PrintSchemaIntegTestAbstract;

@Import({
        CalculatorModule.class                              <i class="conum" data-value="1"></i><b>(1)</b>
})
public class Calculator_IntegTest
    extends CausewayViewerGraphqlIntegTestAbstract {        <i class="conum" data-value="2"></i><b>(2)</b>

    protected Calculator_IntegTest() {
        super(Calculator_IntegTest.class);                  <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @Override
    @TestFactory
    public Iterable&lt;DynamicTest&gt; each() throws Exception {  <i class="conum" data-value="4"></i><b>(4)</b>
        return super.each();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>specifies the domain module(s) to test</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>subclass from the superclass</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>indicates which package to pick up the queries</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>dynamically generates tests for each query</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then include the following tests in the same package, using the naming convention:</p>
</div>
<div class="paragraph">
<p><em>class_name</em><code>.each.</code><em>anything_you_want</em><code>._.gql</code></p>
</div>
<div class="paragraph">
<p>The word "each" comes from the name of the overridden method.
If you want to change the "_.gql" suffix, you can pass an additional argument in the constructor.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to exhaustively test the <code>Calculator#and()</code> action:</p>
<div class="listingblock">
<div class="title">Calculator_IntegTest.each.and_1._.gql</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    university_calc_Calculator {
      and {
        invoke(x: true, y: true) {
          results
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Calculator_IntegTest.each.and_2._.gql</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    university_calc_Calculator {
      and {
        invoke(x: true, y: false) {
          results
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Calculator_IntegTest.each.and_3._.gql</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    university_calc_Calculator {
      and {
        invoke(x: false, y: true) {
          results
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Calculator_IntegTest.each.and_4._.gql</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    university_calc_Calculator {
      and {
        invoke(x: false, y: false) {
          results
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</li>
<li>
<p>or, to test the <code>concat</code> action:</p>
<div class="listingblock">
<div class="title">Calculator_IntegTest.each.and_1._.gql</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    university_calc_Calculator {
      concat {
        invoke(prefix: "Fizz", suffix: "Buzz") {
          results
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For further examples, take a look at the <a href="https://github.com/apache/causeway/tree/main/viewers/graphql/test/src/test/java/org/apache/causeway/viewer/graphql/viewer/test/e2e">tests for the GraphQL viewer itself</a>, which use this class extensively.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="scenario-tests"><a class="anchor" href="#scenario-tests"></a>Scenario Tests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The GraphQL viewer also supports what we call scenario tests.
This is an extension to the rich schema, to include a new field &#8220;Scenario&#8221; which in turn can have three further fields, &#8220;Given&#8221;, &#8220;When&#8221; and &#8220;Then&#8221;.
The scenario can also be named.</p>
</div>
<div class="paragraph">
<p>Moreover, scenario test enables introduces a "saveAs" capability (within the <a href="about.html#the-meta-fieldtype" class="xref page">meta</a> field) to tag objects and then use them at a later stage.</p>
</div>
<div class="paragraph">
<p>This is all probably most easily explained with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-graphql hljs" data-lang="graphql">{
  rich {
    Scenario(name: "Find department and change its name"){    <i class="conum" data-value="1"></i><b>(1)</b>
      Name                                                    <i class="conum" data-value="1"></i><b>(1)</b>

      Given {                                                 <i class="conum" data-value="2"></i><b>(2)</b>
        university_dept_Departments {
          findDepartmentByName {
            invoke(name: "Classics") {
              args {
                name
              }
              results {
                _meta {
                  saveAs(ref: "dept#1")                       <i class="conum" data-value="3"></i><b>(3)</b>
                }
              }
            }
          }
        }
      }

      When {                                                  <i class="conum" data-value="4"></i><b>(4)</b>
        university_dept_Department(
            object: {ref: "dept#1"}                           <i class="conum" data-value="5"></i><b>(5)</b>
        ) {
          name {
            get
          }
          changeName {
            invokeIdempotent(newName: "Ancient History") {
              args {
                newName                                       <i class="conum" data-value="6"></i><b>(6)</b>
              }
              results {                                       <i class="conum" data-value="7"></i><b>(7)</b>
                name {
                  get
                }
              }
            }
          }
        }
      }

      Then {
        university_dept_Department(object: {ref: "dept#1"}) {
          name {
            get                                               <i class="conum" data-value="8"></i><b>(8)</b>
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We name the scenario.
The <code>Name</code> field means that the scenario&#8217;s name will be printed out in the response.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Under the <code>Given</code> field, we set up or locate the objects that are to be interacted with within the scenario.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Having found an object, we save it with some meaningful name.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Under the <code>When</code> field, we interact with the object.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We use the tag from before to locate the object</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We request to print out the arguments</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The object is changed</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>We assert on the results</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will result in a response such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "data" : {
    "rich" : {
      "Scenario" : {
        "Name" : "Find department and change its name",
        "Given" : {
          "university_dept_Departments" : {
            "findDepartmentByName" : {
              "invoke" : {
                "args" : {
                  "name" : "Classics"
                },
                "results" : {
                  "_meta" : {
                    "saveAs" : "dept#1  "
                  }
                }
              }
            }
          }
        },
        "When" : {
          "university_dept_Department" : {
            "name": {
              "get": "Classics"
            },
            "changeName" : {
              "invokeIdempotent" : {
                "args" : {
                  "newName" : "Ancient History"
                },
                "results" : {
                  "name" : {
                    "get" : "Ancient History"
                  }
                }
              }
            }
          }
        },
        "Then" : {
          "university_dept_Department" : {
            "name" : {
              "get" : "Ancient History"
            }
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case you&#8217;ll notice that the <code>Then</code> field doesn&#8217;t actually show any additional assertions to those already in the <code>When</code> clause, so it could have been omitted.</p>
</div>
<div class="paragraph">
<p>Testing support is enabled with the <a href="../../refguide/latest/config/sections/causeway.viewer.graphql.html#causeway.viewer.graphql.schema.rich.enable-scenario-testing" class="xref page">causeway.viewer.graphql.schema.rich.enable-scenario-testing</a> configuration property.</p>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright Â© 2010~2024 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Causeway, and the Apache Causeway project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 3.5.0-SNAPSHOT.20251007-0250-e045730d</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="../../_/js/vendor/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'causeway-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
