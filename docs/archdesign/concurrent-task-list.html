<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Concurrent Task List :: Apache Isis</title>
    <link rel="canonical" href="https://isis.apache.org/archdesign/concurrent-task-list.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isis.apache.org">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="archdesign" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">Architecture &amp; Design</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="about.html">About</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="maven-modules.html">Maven Modules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="metamodel.html">MetaModel</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Architecture &amp; Design</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Architecture & Design</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Hello World</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../helloworld/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - SimpleApp</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../simpleapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions - SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../ext-secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Fundamentals & Beyond</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../ug/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Guides - Reference Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../rg/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Maven Dependencies</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../mavendeps/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../mignotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../relnotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Runtime Services</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../runtime-services/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SmokeTest App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../smoketests/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Table of Contents</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">Architecture & Design</a></li>
    <li><a href="concurrent-task-list.html">Concurrent Task List</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/hobrom/antora/isis/antora/components/archdesign/modules/ROOT/pages/concurrent-task-list.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Concurrent Task List</h1>
<div class="dlist">
<dl>
<dt class="hdlist1">Dan</dt>
<dd>
<p>I also saw you were doing some work on async background jobs, are you happy with the design ?</p>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>the 'wrapper' got an extension to also run actions asynchronous; thats cool but I&#8217;m missing a means to get hold of the Future object that is produced in the background, that would be really nice</p>
</dd>
<dt class="hdlist1">Dan</dt>
<dd>
<p>Perhaps a request scoped service could pull them together as they are created?</p>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>another thing is, I removed the ThreadPoolSupport in favour of a more convenient concept: ConcurrentTask and ConcurrentTaskList</p>
</dd>
<dt class="hdlist1">Dan</dt>
<dd>
<p>^ yes, that was what I noticed.</p>
<div class="paragraph">
<p>The TPS was for internal use to perform parallel introspection etc, so does ConcurrentTask list provide the same capability?
and does the wrapper use this new concept also?</p>
</div>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>Basically I&#8217;ve replaced all 'concurrent executors' with the common ForkJoinPool &#8230;&#8203; ForkJoinPool.commonPool();</p>
<div class="paragraph">
<p>this might or might not be the better default</p>
</div>
<div class="paragraph">
<p>ConcurrentTaskList however allows to provide a custom executor if needed. I believe the JDK does provide good ready to use executors, so that we don&#8217;t need to write our own.</p>
</div>
</dd>
<dt class="hdlist1">Dan</dt>
<dd>
<p>OK, good enough for me.</p>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>ConcurrentTaskList and its co-operator classes reside in the internal API section of the 'commons' module, however they don&#8217;t follow the _ prefixed scheme. I was in conflict with whether to move them up in the package hierarchy to make them also official usable by Isis coders. I decided 'not-yet' so we might want to add the prefixes.</p>
</dd>
<dt class="hdlist1">Dan</dt>
<dd>
<p>Yes, I&#8217;d prefer that : "_" to mean internal.  If we do decide to make them formal API, we can refactor our internal code that uses it</p>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>most simple usecase scenario &#8230;&#8203;</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">val taskList = ConcurrentTaskList.named("Isis Application Background Initialization Tasks")
.addRunnable("Configure WebJars",            this::configureWebJars)
.addRunnable("Configure WicketBootstrap",    this::configureWicketBootstrap)
.addRunnable("Configure WicketSelect2",      this::configureWicketSelect2);

taskList.submit(ConcurrentContext.sequential()); // runs these tasks within provided execution context

taskList.await(); // block current thread and wait for all tasks to complete</code></pre>
</div>
</div>
<div class="paragraph">
<p>taskList also provides access to all the tasks it contains, and one can check their individual stati; this is also easily extensible</p>
</div>
</dd>
<dt class="hdlist1">Andi</dt>
<dd>
<p>any exceptions that occur in individual tasks are stored in their corresponding ConcurrentTask object, along with execution time;</p>
<div class="paragraph">
<p>whether to log or not log a summary of the task list execution result is decided by a flag in the ConcurrentContext as provided to the submit method</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
I&#8217;ve recently learned, that with newer JDKs (unfortunately not in 8) one could emit flight recorder events to the JVM, such that you would see these events in eg. Java Mission Control. This would allow to record task execution timings directly to the JVM.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../_/js/site.js"></script>
<script async src="../_/js/vendor/highlight.js"></script>
  </body>
</html>
