<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nightly Deploys :: causeway</title>
    <meta name="generator" content="Antora 3.1.5">
    <link rel="stylesheet" href="../../_/css/site.css">
    <link rel="stylesheet" href="../../_/css/site-custom.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Raleway:300,400,500,700,800|Montserrat:300,400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css"/>
<link rel="home" href="../.." title="causeway">
  <link rel="next" href="weekly-builds.html" title="Weekly Builds">
  <link rel="prev" href="nightly-builds.html" title="Nightly Builds">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="../..">
          <span class="icon">
            <img src="../../_/img/causeway-logo-no-words-65x48.png"></img>
          </span>
        <span class="navbar-title">causeway</span>
      </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <a class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Quick Start</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Starter Apps</span>
            <a class="navbar-item" href="../../docs/latest/starters/helloworld.html">Hello World</a>
            <a class="navbar-item" href="../../docs/latest/starters/simpleapp.html">Simple App</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Learning &amp; Tutorials</span>
            <a class="navbar-item" href="../../docs/latest/reference/about.html">Reference App</a>
            <a class="navbar-item" href="https://danhaywood.gitlab.io/isis-petclinic-tutorial-docs/petclinic/1.16.2/intro.html">Petclinic</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Resources</span>
            <a class="navbar-item" href="../../docs/latest/resources/cheatsheet.html">Cheatsheet</a>
            <a class="navbar-item" href="../../docs/latest/resources/icons.html">Icons</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Guides</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/about.html">User Guide</a>
            <a class="navbar-item" href="../../refguide/latest/about.html">Reference Guide</a>
            <a class="navbar-item" href="../../testing/latest/about.html">Testing Guide</a>
            <a class="navbar-item" href="../../security/latest/about.html">Security Guide</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">For use in apps</span>
            <a class="navbar-item" href="../../valuetypes/latest/about.html">Value Types</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../setupguide/latest/about.html">Setup Guide</a>
            <a class="navbar-item" href="../../conguide/latest/about.html">Contributors' Guide</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Components</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/bypass/about.html">Bypass</a>
            <a class="navbar-item" href="../../security/latest/shiro/about.html">Shiro</a>
            <a class="navbar-item" href="../../security/latest/spring/about.html">Spring</a>
            <a class="navbar-item" href="../../security/latest/keycloak/about.html">Keycloak</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Viewers</span>
            <a class="navbar-item" href="../../vw/latest/about.html">Web UI (Wicket)</a>
            <a class="navbar-item" href="../../vro/latest/about.html">REST API (Restful Objects)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Persistence</span>
            <a class="navbar-item" href="../../pjpa/latest/about.html">JPA (EclipseLink)</a>
            <a class="navbar-item" href="../../pjdo/latest/about.html">JDO (DataNucleus)</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Extensions</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Core</span>
            <a class="navbar-item" href="../../userguide/latest/commandlog/about.html">Command Log</a>
            <a class="navbar-item" href="../../userguide/latest/docgen/about.html">Doc Gen</a>
            <a class="navbar-item" href="../../userguide/latest/executionlog/about.html">Execution Log</a>
            <a class="navbar-item" href="../../userguide/latest/executionoutbox/about.html">Execution Outbox</a>
            <a class="navbar-item" href="../../userguide/latest/executionrepublisher/about.html">Execution Republisher</a>
            <a class="navbar-item" href="../../userguide/latest/excel/about.html">Excel</a>
            <a class="navbar-item" href="../../userguide/latest/flyway/about.html">Flyway</a>
            <a class="navbar-item" href="../../userguide/latest/layoutloaders/about.html">Layout Loaders</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Security</span>
            <a class="navbar-item" href="../../security/latest/secman/about.html">Secman</a>
            <a class="navbar-item" href="../../security/latest/audittrail/about.html">Audit Trail</a>
            <a class="navbar-item" href="../../security/latest/spring-oauth2/about.html">Spring OAuth2 Integration</a>
            <a class="navbar-item" href="../../security/latest/shiro-realm-ldap/about.html">LDAP Realm for Shiro</a>
            <a class="navbar-item" href="../../security/latest/sessionlog/about.html">Session Log</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Web UI (Wicket)</span>
            <a class="navbar-item" href="../../vw/latest/fullcalendar/about.html">Full Calendar</a>
            <a class="navbar-item" href="../../vw/latest/pdfjs/about.html">pdf.js</a>
            <a class="navbar-item" href="../../vw/latest/sse/about.html">Server Side Events</a>
            <a class="navbar-item" href="../../vw/latest/tabular/about.html">Tabular Download</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">REST API (Restful Objects)</span>
            <a class="navbar-item" href="../../vro/latest/cors/about.html">CORS</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Support</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Contact</span>
            <a class="navbar-item" href="../../docs/latest/support/slack-channel.html">Slack</a>
            <a class="navbar-item" href="../../docs/latest/support/mailing-list.html">Mailing Lists</a>
            <a class="navbar-item" href="https://issues.apache.org/jira/browse/CAUSEWAY">JIRA</a>
            <a class="navbar-item" href="https://stackoverflow.com/questions/tagged/causeway">Stack Overflow</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Releases</span>
            <a class="navbar-item" href="../../docs/latest/downloads/how-to.html">Downloads</a>
            <a class="navbar-item" href="../../relnotes/latest/about.html">Release Notes</a>
            <hr class="navbar-divider"/>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Framework</a>
          <div class="navbar-dropdown">
            <span class="navbar-item navbar-heading">Process</span>
            <a class="navbar-item" href="../../comguide/latest/about.html">Committers' Guide</a>
            <a class="navbar-item" href="../../tooling/latest/about.html">Tooling</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Automated Analysis</span>
            <a class="navbar-item" href="https://sonarcloud.io/dashboard?id=apache_isis">SonarCloud.io</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Interim Builds</span>
            <a class="navbar-item" href="../../comguide/latest/nightly-builds.html">Nightly builds</a>
            <a class="navbar-item" href="../../comguide/latest/weekly-builds.html">Weekly builds</a>
            <a class="navbar-item" href="https://apache-causeway-committers.github.io/causeway-nightly">Website Preview (not ASF hosted)</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Development</span>
            <a class="navbar-item" href="../../core/latest/about.html">Internal Design Docs</a>
            <a class="navbar-item" href="../../regressiontests/latest/about.html">Regression Tests</a>
            <a class="navbar-item" href="../../incubator/latest/about.html">Incubator</a>
            <hr class="navbar-divider"/>
            <span class="navbar-item navbar-heading">Thanks</span>
            <a class="navbar-item" href="../../more-thanks/latest/more-thanks.html">Acknowledgements</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">ASF</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="http://www.apache.org/">Apache Homepage</a>
            <a class="navbar-item" href="https://www.apache.org/events/current-event">Events</a>
            <a class="navbar-item" href="https://www.apache.org/licenses/">Licenses</a>
            <a class="navbar-item" href="https://www.apache.org/security/">Security</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a>
            <a class="navbar-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a>
            <hr class="navbar-divider"/>
            <a class="navbar-item" href="https://whimsy.apache.org/board/minutes/Causeway.html">PMC board minutes</a>
          </div>
        </div>
        <a class="navbar-item" href="../../docs/latest/about.html">
          <span class="icon">
            <img src="../../_/img/home.png"></img>
          </span>
        </a>
      </div>
    </div>
  </nav>
</header>
<div class="body ">
<div class="nav-container" data-component="comguide" data-version="latest">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-search hide-for-print">
  <input id="algolia-search-input" placeholder="Search"></span>
</div>
<div class="nav-panel-pagination">
  <a class="page-previous" rel="prev" href="nightly-builds.html" title="Nightly Builds"><span></span></a>
  <a class="page-next" rel="next"
     href="weekly-builds.html" title="Weekly Builds"><span></span></a>
<!--
page.parent doesn't seem to be set...
  <a class="page-parent disabled" rel="prev" href="" title="Nightly Builds"><span></span></a>
-->
</div>
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="about.html">Committers&#x27; Guide</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Occasionally</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="merging-a-pull-request.html">Merging a Pull Request</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="applying-patches.html">Applying Patches</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="updating-the-website.html">Updating the Website</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Nightly</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nightly-builds.html">Nightly Builds</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="nightly-deploys.html">Nightly Deploys</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="weekly-builds.html">Weekly Builds</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Release</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="cutting-a-release.html">Cutting a Release</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="verifying-releases.html">Verifying Releases</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Post Release</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="post-release-successful.html">Post Release (Successful)</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="post-release-unsuccessful.html">Post Release (Unsuccessful)</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Appendices</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="key-generation.html">Key Generation</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="algolia-search.html">Algolia Search</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="release-process-prereqs.html">Release Process Prereqs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="policies.html">Policies</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="pmc-notes.html">PMC Notes</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Committers&#x27; Guide</span>
    <span class="version">latest</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title"> </span>
      <ul class="versions">
        <li class="version">
          <a href="../../docs/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Committers' Guide</span>
      <ul class="versions">
        <li class="version is-current">
          <a href="about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Contributors' Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../conguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Design Docs</span>
      <ul class="versions">
        <li class="version">
          <a href="../../core/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions</span>
      <ul class="versions">
        <li class="version">
          <a href="../../extensions/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Incubator Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../incubator/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JDO/DataNucleus</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjdo/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">JPA</span>
      <ul class="versions">
        <li class="version">
          <a href="../../pjpa/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Reference Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../refguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">regressiontests</span>
      <ul class="versions">
        <li class="version">
          <a href="../../regressiontests/latest/index.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version">
          <a href="../../relnotes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">REST API (Restful Objects Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vro/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../security/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Setup Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../setupguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../testing/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tooling</span>
      <ul class="versions">
        <li class="version">
          <a href="../../tooling/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Tutorials</span>
      <ul class="versions">
        <li class="version">
          <a href="../../tutorials/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">User Guide</span>
      <ul class="versions">
        <li class="version">
          <a href="../../userguide/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Value Types Catalog</span>
      <ul class="versions">
        <li class="version">
          <a href="../../valuetypes/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Web UI (Wicket Viewer)</span>
      <ul class="versions">
        <li class="version">
          <a href="../../vw/latest/about.html">latest</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main role="main">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../docs/latest/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="about.html">Committers' Guide</a></li>
    <li>Nightly</li>
    <li><a href="nightly-deploys.html">Nightly Deploys</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/apache/causeway/edit/master/antora/components/comguide/modules/ROOT/pages/nightly-deploys.adoc">Edit</a></div>
</div>
<article class="doc">
    <a name="section-top"></a>
<h1 class="page">Nightly Deploys</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This page describes how we deploy the <a href="../../docs/latest/starters/simpleapp.html" class="xref page">SimpleApp</a>, <a href="../../docs/latest/starters/helloworld.html" class="xref page">HelloWorld App</a> and the <a href="../../docs/latest/referenceapp/about.html" class="xref page">Reference App</a> each night, to a Azure App Container Apps (a PaaS based on top of k8s).</p>
</div>
<div class="paragraph">
<p>The actual CI jobs can be found in the <a href="https://github.com/apache-causeway-committers/causeway-nightly-deploys">apache-causeway-committers/causeway-nightly-deploys</a> repo.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="azure-container-apps"><a class="anchor" href="#azure-container-apps"></a>Azure Container Apps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Following <a href="https://learn.microsoft.com/en-gb/azure/container-apps/get-started?ocid=AID3042118&amp;tabs=bash">azure docs</a> for ACA</p>
</div>
<div class="sect2">
<h3 id="prereqs"><a class="anchor" href="#prereqs"></a>Prereqs</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">install Azure CLI</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="authenticate"><a class="anchor" href="#authenticate"></a>Authenticate</h3>
<div class="paragraph">
<p>Authenticate and prepare working environment</p>
</div>
<div class="ulist">
<ul>
<li>
<p>login</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az login</code></pre>
</div>
</div>
<div class="paragraph">
<p>Confirm using web browser.</p>
</div>
</li>
<li>
<p>add ACA extension</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az extension add --name containerapp --upgrade</code></pre>
</div>
</div>
<div class="paragraph">
<p>This takes a minute or two.</p>
</div>
</li>
<li>
<p>register the <code>Microsoft.OperationalInsights</code> provider for the Azure Monitor Log Analytics workspace</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az provider register --namespace Microsoft.OperationalInsights</code></pre>
</div>
</div>
<div class="paragraph">
<p>(as have not used it before).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="setup-the-resource-group-and-aca-environment"><a class="anchor" href="#setup-the-resource-group-and-aca-environment"></a>Setup the resource group and ACA environment</h3>
<div class="paragraph">
<p>In Azure, all resources live in resource groups.
We will use a single resource group.</p>
</div>
<div class="paragraph">
<p>One of the resources to be set up is an ACA environment, which creates a secure boundary around a group of container apps.
Container Apps deployed to the same environment are deployed in the same virtual network and write logs to the same Log Analytics workspace.
We will use a single ACA environment.</p>
</div>
<div class="paragraph">
<p>Create a resource group to organize the services related to the container apps.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set these environment variables:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">RESOURCE_GROUP="causeway-nightlies-rg"
LOCATION="uksouth"
CONTAINERAPPS_ENVIRONMENT="causeway-nightlies-aca-env"</code></pre>
</div>
</div>
</li>
<li>
<p>create the resource group</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az group create \
  --name $RESOURCE_GROUP \
  --location $LOCATION</code></pre>
</div>
</div>
<div class="paragraph">
<p>resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">{
  "id": "/subscriptions/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/resourceGroups/causeway-nightlies-rg",
  "location": "ukwest",
  "managedBy": null,
  "name": "causeway-nightlies-rg",
  "properties": {
    "provisioningState": "Succeeded"
  },
  "tags": null,
  "type": "Microsoft.Resources/resourceGroups"
}</code></pre>
</div>
</div>
</li>
<li>
<p>next, create the ACA environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp env create \
  --name $CONTAINERAPPS_ENVIRONMENT \
  --resource-group $RESOURCE_GROUP \
  --location $LOCATION</code></pre>
</div>
</div>
<div class="paragraph">
<p>resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">No Log Analytics workspace provided.
Generating a Log Analytics workspace with name "workspace-causewaynightliesrgT0WN"

Container Apps environment created. To deploy a container app, use: az containerapp create --help

{
  "id": "/subscriptions/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/resourceGroups/causeway-nightlies-rg/providers/Microsoft.App/managedEnvironments/causeway-nightlies-aca-env",
  "location": "uksouth",
  "name": "causeway-nightlies-aca-env",
  "properties": {
    "appLogsConfiguration": {
      "destination": "log-analytics",
      "logAnalyticsConfiguration": {
        "customerId": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
      }
    },
    "customDomainConfiguration": {
      "customDomainVerificationId": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
    },
    "defaultDomain": "graytree-90c75749.uksouth.azurecontainerapps.io",
    "provisioningState": "Succeeded",
    "staticIp": "20.108.221.167",
    "zoneRedundant": false
  },
  "resourceGroup": "causeway-nightlies-rg",
  "sku": {
    "name": "Consumption"
  },
  "systemData": {
    "createdAt": "2023-01-02T06:54:25.6911574",
    "createdBy": "dan@haywood-associates.co.uk",
    "createdByType": "User",
    "lastModifiedAt": "2023-01-02T06:54:25.6911574",
    "lastModifiedBy": "dan@haywood-associates.co.uk",
    "lastModifiedByType": "User"
  },
  "type": "Microsoft.App/managedEnvironments"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create-container-app"><a class="anchor" href="#create-container-app"></a>Create Container App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will create a container app manually.
Later, in the <a href="#automation">automation</a> section, we will simply update the container (replacing the image with a new one).</p>
</div>
<div class="paragraph">
<p>We&#8217;ll start with the <a href="https://hub.docker.com/repository/docker/apache/causeway-app-demo-jpa">apache/causeway-app-demo-jpa</a> Docker image:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>set further environment variables:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="demo-wicket-jpa"
IMAGE_NAME="apache/causeway-demo-jpa"
IMAGE_VERSION="2.0.0-M9.20221018-1911-d3980668"</code></pre>
</div>
</div>
</li>
<li>
<p>create the app</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
<div class="paragraph">
<p>resulting in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">Container app created. Access your app at https://demo-wicket-jpa.graytree-90c75749.uksouth.azurecontainerapps.io/</code></pre>
</div>
</div>
</li>
<li>
<p>Change scaling from default (1-10) to just a single instance.</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-08-31-58-018.png" alt="image 2023 01 03 08 31 58 018" width="600">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-lets-encrypt-for-ssl-certs"><a class="anchor" href="#use-lets-encrypt-for-ssl-certs"></a>Use Lets Encrypt for SSL Certs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>as per: <a href="https://dev.to/shibayan/how-to-quickly-setup-a-lets-encrypt-certificate-in-azure-container-apps-3nd7">this blog post</a> blog, the <a href="https://github.com/shibayan/containerapps-acmebot">shibayan/containerapps-acmebot</a> repo provides an Azure deployment that handles the LetsEncrypt certificates.</p>
</div>
<div class="paragraph">
<p>Following its <a href="https://github.com/shibayan/containerapps-acmebot/wiki/Getting-Started">Getting-Started</a> README:</p>
</div>
<div class="sect2">
<h3 id="dns-management"><a class="anchor" href="#dns-management"></a>DNS management</h3>
<div class="paragraph">
<p>Created DNS zone for <code>causeway.dev</code>, and then a child zone <code>apps.causeway.dev</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the intention is to change this to a more suitable domain.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="deploy-the-services"><a class="anchor" href="#deploy-the-services"></a>Deploy the Services</h3>
<div class="ulist">
<ul>
<li>
<p>from the <a href="https://github.com/shibayan/containerapps-acmebot/wiki/Getting-Started#1-deploy-acmebot">README</a>:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-17-58-33-718.png" alt="image 2023 01 03 17 58 33 718" width="600">
</div>
</div>
</li>
<li>
<p>add params:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-18-07-57-499.png" alt="image 2023 01 03 18 07 57 499" width="800">
</div>
</div>
<div class="paragraph">
<p>results in:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-18-10-33-567.png" alt="image 2023 01 03 18 10 33 567" width="800">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enable-app-service-authentication-access-control-iam"><a class="anchor" href="#enable-app-service-authentication-access-control-iam"></a>Enable App Service Authentication &amp; Access control (IAM)</h3>
<div class="paragraph">
<p>Continuing with the <a href="https://github.com/shibayan/containerapps-acmebot/wiki/Getting-Started#3-enable-app-service-authentication">README</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add an identity provider to the function app:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-18-16-01-614.png" alt="image 2023 01 03 18 16 01 614" width="800">
</div>
</div>
</li>
<li>
<p>add contributor role assignment:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-18-22-59-542.png" alt="image 2023 01 03 18 22 59 542" width="1000">
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="access-function-app"><a class="anchor" href="#access-function-app"></a>Access function app</h3>
<div class="paragraph">
<p>Continuing further with the <a href="https://github.com/shibayan/containerapps-acmebot/wiki/Getting-Started#5-access-to-function-app">README</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>locate the name of the function app (<code>func-acmebot-y3a6</code> above)</p>
</li>
<li>
<p>navigate to <a href="https://func-acmebot-y3a6.azurewebsites.net/add-certificate" class="bare">https://func-acmebot-y3a6.azurewebsites.net/add-certificate</a>, and grant permissions to access the site:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-03-18-27-32-832.png" alt="image 2023 01 03 18 27 32 832" width="300">
</div>
</div>
</li>
<li>
<p>complete dialog:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-04-06-23-41-099.png" alt="image 2023 01 04 06 23 41 099" width="600">
</div>
</div>
<div class="paragraph">
<p>and <code>Submit</code>.</p>
</div>
</li>
<li>
<p>The docs say "after a few tens of seconds, the certificate will be issued".
Indeed so:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-04-06-26-42-960.png" alt="image 2023 01 04 06 26 42 960" width="400">
</div>
</div>
<div class="paragraph">
<p>In the DNS zone, it creates this <code>TXT</code> record:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-04-06-29-02-083.png" alt="image 2023 01 04 06 29 02 083" width="600">
</div>
</div>
</li>
<li>
<p>Also create a <code>CNAME</code> for the app:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-04-06-25-56-926.png" alt="image 2023 01 04 06 25 56 926" width="400">
</div>
</div>
</li>
<li>
<p>Confirm that the app can be accessed:</p>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-04-06-31-36-293.png" alt="image 2023 01 04 06 31 36 293" width="800">
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-remaining-apps"><a class="anchor" href="#deploy-remaining-apps"></a>Deploy Remaining Apps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For each app, the steps are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Set common environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">RESOURCE_GROUP="causeway-nightlies-rg"
CONTAINERAPPS_ENVIRONMENT="causeway-nightlies-aca-env"</code></pre>
</div>
</div>
</li>
<li>
<p>Set app-specific environment variables</p>
</li>
<li>
<p>Create the container app</p>
</li>
<li>
<p>Manually configure scaling</p>
</li>
<li>
<p>Manually setup <code>CNAME</code> record in <code>apps.causeway.dev</code> DNS zone</p>
</li>
<li>
<p>Using the acmebot function app, <a href="https://func-acmebot-y3a6.azurewebsites.net/add-certificate">add the certificate</a> for the container app</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="demo-wicket-jpa"><a class="anchor" href="#demo-wicket-jpa"></a>demo-wicket-jpa</h3>
<div class="paragraph">
<p>Done previously</p>
</div>
</div>
<div class="sect2">
<h3 id="demo-wicket-jpa-snapshot"><a class="anchor" href="#demo-wicket-jpa-snapshot"></a>demo-wicket-jpa-snapshot</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="demo-wicket-jpa-snapshot"
IMAGE_NAME="apache/causeway-demo-jpa"
IMAGE_VERSION="latest"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>demo-wicket-jpa-snapshot.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="demo-wicket-jdo"><a class="anchor" href="#demo-wicket-jdo"></a>demo-wicket-jdo</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="demo-wicket-jdo"
IMAGE_NAME="apache/causeway-demo-jdo"
IMAGE_VERSION="2.0.0-M9.20221018-1911-d3980668"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>demo-wicket-jdo.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="demo-wicket-jdo-snapshot"><a class="anchor" href="#demo-wicket-jdo-snapshot"></a>demo-wicket-jdo-snapshot</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="demo-wicket-jdo-snapshot"
IMAGE_NAME="apache//causeway-demo-jdo"
IMAGE_VERSION="latest"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>demo-wicket-jdo-snapshot.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="simpleapp-jpa"><a class="anchor" href="#simpleapp-jpa"></a>simpleapp (jpa)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="simpleapp-jpa"
IMAGE_NAME="apache/causeway-app-simpleapp"
IMAGE_VERSION="jpa"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>simpleapp-jpa.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="simpleapp-jpa-snapshot"><a class="anchor" href="#simpleapp-jpa-snapshot"></a>simpleapp (jpa-SNAPSHOT)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="simpleapp-jpa-snapshot"
IMAGE_NAME="apache/causeway-app-simpleapp"
IMAGE_VERSION="jpa-SNAPSHOT"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>simpleapp-jpa-snapshot.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="simpleapp-jdo"><a class="anchor" href="#simpleapp-jdo"></a>simpleapp (jdo)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="simpleapp-jdo"
IMAGE_NAME="apache/causeway-app-simpleapp"
IMAGE_VERSION="jdo"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>simpleapp-jdo.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="simpleapp-jdo-snapshot"><a class="anchor" href="#simpleapp-jdo-snapshot"></a>simpleapp (jdo-SNAPSHOT)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="simpleapp-jdo-snapshot"
IMAGE_NAME="apache/causeway-app-simpleapp"
IMAGE_VERSION="jdo-SNAPSHOT"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>simpleapp-jdo.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="helloworld-jpa"><a class="anchor" href="#helloworld-jpa"></a>helloworld (jpa)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="helloworld-jpa"
IMAGE_NAME="apache/causeway-app-helloworld"
IMAGE_VERSION="jpa"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>helloworld-jpa.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="helloworld-jpa-snapshot"><a class="anchor" href="#helloworld-jpa-snapshot"></a>helloworld (jpa-SNAPSHOT)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="helloworld-jpa-snapshot"
IMAGE_NAME="apache/causeway-app-helloworld"
IMAGE_VERSION="jpa-SNAPSHOT"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>helloworld-jpa-snapshot.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="helloworld-jdo"><a class="anchor" href="#helloworld-jdo"></a>helloworld (jdo)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="helloworld-jdo"
IMAGE_NAME="apache/causeway-app-helloworld"
IMAGE_VERSION="jdo"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>helloworld-jdo.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="helloworld-jdo-snapshot"><a class="anchor" href="#helloworld-jdo-snapshot"></a>helloworld (jdo-SNAPSHOT)</h3>
<div class="paragraph">
<p>Steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Environment variables</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">APP_NAME="helloworld-jdo-snapshot"
IMAGE_NAME="apache/causeway-app-helloworld"
IMAGE_VERSION="jdo-SNAPSHOT"</code></pre>
</div>
</div>
</li>
<li>
<p>Deploy</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">az containerapp create \
  --name $APP_NAME \
  --resource-group $RESOURCE_GROUP \
  --environment $CONTAINERAPPS_ENVIRONMENT \
  --environment-variables PROTOTYPING=true \
  --image $IMAGE_NAME:$IMAGE_VERSION \
  --target-port 8080 \
  --ingress 'external' \
  --query properties.configuration.ingress.fqdn</code></pre>
</div>
</div>
</li>
<li>
<p>Manually Configure Scaling</p>
</li>
<li>
<p>Manually setup DNS</p>
<div class="paragraph">
<p>to <code>helloworld-jdo-snapshot.apps.causeway.dev</code></p>
</div>
</li>
<li>
<p>Register with LetsEncrypt Function App</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="automation"><a class="anchor" href="#automation"></a>Automation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With all of the applications created above, the nightly automation simply needs to update the apps with new images, using <code>az container revision copy</code>.
There is <strong><em>no need</em></strong> to create ACA environments etc from scratch.</p>
</div>
<div class="sect2">
<h3 id="prereqs-2"><a class="anchor" href="#prereqs-2"></a>Prereqs</h3>
<div class="paragraph">
<p>We require an Azure Service Principal for the CI/CD job to use.</p>
</div>
<div class="paragraph">
<p>Following <a href="https://dev.to/erudinsky/how-to-deploy-to-azure-with-gitlab-authentication-credentials-store-runner-config-yaml-pipeline-example-37bp">this blog post</a> and also <a href="https://learn.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli#password-based-authentication">MS docs</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#register-an-application-with-azure-ad-and-create-a-service-principal">register an application</a></p>
<div class="paragraph">
<p>My guess is that this is a 'deploy' application rather than the application being deployed.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/nightly-deploys/image-2023-01-05-11-44-09-855.png" alt="image 2023 01 05 11 44 09 855" width="800">
</div>
</div>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>lookup your subscriptionId</p>
</li>
<li>
<p>as per the MS doc:</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-powershell hljs" data-lang="powershell">az ad sp create-for-rbac --name CausewayNightliesDeployPrincipal --role Owner --scopes "/subscriptions/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
must use powershell here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>should result in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Found an existing application instance: (id) XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX. We will patch it.
Creating 'Owner' role assignment under scope '/subscriptions/XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX'
The output includes credentials that you must protect. Be sure that you do not include these credentials in your code or check the credentials into your source control. For more information, see https://aka.ms/azadsp-cli
{
  "appId": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX",
  "displayName": "CausewayNightliesDeployPrincipal",
  "password": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
  "tenant": "XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"
}</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ci-jobs"><a class="anchor" href="#ci-jobs"></a>CI Jobs</h3>
<div class="paragraph">
<p>The actual CI jobs can be found in the <a href="https://github.com/apache-causeway-committers/causeway-nightly-deploys">apache-causeway-committers/causeway-nightly-deploys</a> repo.</p>
</div>
<div class="paragraph">
<p>The main script consists of these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># ... derive $APPNAME
# ... derive $IMAGE

TIMESTAMP=$(date "+%Y%m%d-%H%M%S")
REVISION_SUFFIX="r${TIMESTAMP}"

az login --service-principal \
  --username "$AZ_APP_ID" \
  --password "$AZ_PASSWORD" \
  --tenant "$AZ_TENANT_ID"

az containerapp revision copy \
  --name "$APPNAME" \
  --resource-group "$RESOURCE_GROUP" \
  --image "$IMAGE" \
  --cpu "$CPU" \
  --memory "$MEMORY" \
  --revision-suffix "$REVISION_SUFFIX"</code></pre>
</div>
</div>
</div>
</div>
</div>
</article>
<aside class="article-aside toc hide-for-print" role="navigation">
    <p class="toc-title">On this page</p>
    <div id="article-toc"></div>
</aside>
</main>
</div>
<footer class="footer">
    <div class="content">
        <div class="copyright">
            <p>
                Copyright © 2010~2023 The Apache Software Foundation, licensed under the Apache License, v2.0.
                <br/>
                Apache, the Apache feather logo, Apache Causeway, and the Apache Causeway project logo are all trademarks of The Apache Software Foundation.
            </p>
        </div>
        <div class="revision">
            <p>Revision: 2.0.0-RC3.20231130-0222-987710d4</p>
        </div>
    </div>
</footer>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/jquery-3.4.1.min.js"></script>
<script src="../../_/js/vendor/jquery-ui-1.12.1.custom.widget-only.min.js"></script>
<script src="../../_/js/vendor/jquery.tocify.min.js"></script>

<script>
    $(function() {
        $("#article-toc").tocify( {
            showEffect: "slideDown",
            hashGenerator: "pretty",
            hideEffect: "slideUp",
            selectors: "h2, h3",
            scrollTo: 120,
            smoothScroll: true,
            theme: "jqueryui",
            highlightOnScroll: true
        } );
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script>
  function focusSearchInput () { document.querySelector('#algolia-search-input').focus() }
  var search = docsearch({
    appId: '5ISP5TFAEN',
    apiKey: '0fc51c28b4ad46e7318e96d4e97fab7c',
    indexName: 'causeway-apache-org',
    inputSelector: '#algolia-search-input',
    autocompleteOptions: { hint: false, keyboardShortcuts: ['s'] },
    debug: false,
  }).autocomplete
  search.on('autocomplete:closed', function () { search.autocomplete.setVal() })
  focusSearchInput()
  window.addEventListener('load', focusSearchInput);
</script>

<!--
  docsearch options:
  https://docsearch.algolia.com/docs/behavior/
-->
<!--
  https://www.algolia.com/doc/api-reference/api-parameters/
  algoliaOptions: { hitsPerPage: 6 },
-->
  </body>
</html>
