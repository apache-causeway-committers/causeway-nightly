<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker :: Apache Isis</title>
    <link rel="canonical" href="https://isis.apache.org/ug/btb/deployment/docker.html">
    <meta name="generator" content="Antora 2.0.0">
    <link rel="stylesheet" href="../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://isis.apache.org">Apache Isis</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="ug" data-version="master">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../about.html">Fundamentals &amp; Beyond</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../about.html">About</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../fun/about.html">Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/core-concepts.html">Core Concepts</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/building-blocks.html">Building Blocks</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/programming-model.html">Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/ui-hints.html">UI Hints</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/crud.html">CRUD</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/business-rules.html">Business Rules</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/drop-downs-and-defaults.html">Drop downs and Defaults</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../../fun/available-domain-services.html">Available Domain Services</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../about.html">Beyond the Basics</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../i18n.html">i18n</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../headless-access.html">Headless Access</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../hints-and-tips.html">Hints-n-Tips</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../programming-model.html">Programming Model</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../deployment.html">Deployment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../web-xml.html">web.xml</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Fundamentals &amp; Beyond</span>
    <span class="version">master</span>
  </div>
  <ul class="components">
    <li class="component">
      <span class="title">Architecture & Design</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../archdesign/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">DataNucleus ObjectStore</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../odn/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Demo</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../demoapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - Hello World</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../helloworld/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Example App - SimpleApp</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../simpleapp/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Extensions - SecMan</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ext-secman/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <span class="title">Fundamentals & Beyond</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Guides - Reference Guides</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../rg/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Maven Dependencies</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mavendeps/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Migration Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../mignotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Release Notes</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../relnotes/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Restful Objects Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vro/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Runtime Services</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../runtime-services/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Security</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../security/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">SmokeTest App</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../smoketests/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Table of Contents</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../toc/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Testing</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../testing/about.html">master</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <span class="title">Wicket Viewer</span>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../vw/about.html">master</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main>
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../toc/about.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../about.html">Fundamentals & Beyond</a></li>
    <li><a href="docker.html">Docker</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/hobrom/antora/isis/antora/components/userguide/modules/btb/pages/deployment/docker.adoc">Edit this Page</a></div>
  </div>
<article class="doc">
<h1 class="page">Docker</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>When running the application within a Docker container, the problem that must be solved is to override the
configuration properties baked into the war file, eg to point to the app to a different JDBC URL.</p>
</div>
<div class="paragraph">
<p>There are several options.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>All the options here rely on starting the Docker container with a set of arguments, some of which would very likely
be passwords for database connections etc.  As such these techniques are only suitable where the security of the
Docker host can be assured.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-an-overrides-properties"><a class="anchor" href="#using-an-overrides-properties"></a>Using an <code>overrides.properties</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In addition to loading the regular configuration properties from <code>WEB-INF</code> directory (described
<a href="../../../rg/cfg/configuration-files.html" class="page">here</a>), Apache Isis will also load the <code>overrides.properties</code> file.</p>
</div>
<div class="paragraph">
<p>This file is treated slightly differently than the other configuration files; it is loaded last, and any configuration
properties defined in it will <em>override</em> any configuration properties already read from other files (this includes
any properties specified via the command line).</p>
</div>
<div class="paragraph">
<p>While the regular configuration files are "baked into" the application WAR file, the <code>overrides.properties</code> file is
created dynamically as part of the Docker <code>ENTRYPOINT</code> script, eg as documented in the
<a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/">Dockerfile best practices</a>.</p>
</div>
<div class="paragraph">
<p>Thus, Docker can be supported as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>use <code>mvn</code> (as currently) to create a WAR file; set up with the <code>pom.xml</code> with the JDBC drivers of all DB servers that
you might want to connect to (hsqldb, sql server, postgresql etc)</p>
</li>
<li>
<p>in the <code>Dockerfile</code>, specify a base image containing Tomcat 8 + Java 8 (say)</p>
</li>
<li>
<p>also in the <code>Dockerfile</code>, arrange it such that the WAR file is "exploded" (there is no need to copy over the WAR file itself)</p>
</li>
<li>
<p>write a script that:</p>
<div class="ulist">
<ul>
<li>
<p>explodes the WAR file, copying it into the Tomcat&#8217;s <code>webapp</code> directory.  There is no need to copy
over the WAR file itself.</p>
</li>
<li>
<p>creates the <code>overrides.properties</code> file from any input arguments, placing it into the <code>WEB-INF</code> directory</p>
</li>
<li>
<p>sets all files to read-only</p>
</li>
</ul>
</div>
</li>
<li>
<p>use <code>ENTRYPOINT</code> (and probably also <code>CMD</code>) to invoke above script.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-system-properties"><a class="anchor" href="#using-system-properties"></a>Using system properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The servlet context initializer will search for any system properties called <code>isis.xxx</code>
 and if present will use them as overrides.</p>
</div>
<div class="paragraph">
<p>Thus, an alternative option for a Docker image is to bootstrap the servlet container (Tomcat, Jetty) with appropriate
system properties set up.  For example, with Tomcat this can be done by writing into the <code>conf/catalina.properties</code> file
(see for example <a href="http://stackoverflow.com/a/16566920">this stackoverflow</a> post).</p>
</div>
<div class="paragraph">
<p>The Docker&#8217;s <code>ENTRYPOINT</code> therefore just needs to parse the Docker container&#8217;s own command line arguments and use to
create this file.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-isis_opts"><a class="anchor" href="#using-isis_opts"></a>Using <code>$ISIS_OPTS</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The servlet context initializer will search for an environment variable called <code>$ISIS_OPTS</code>
 and if present will parse the content as a set of key/value pairs.  Each key/value pair is separated by "||".</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISIS_OPTS="isis.appManifest=domainapp.app.DomainAppAppManifestWithFixtures||isis.objects.editing=false"</code></pre>
</div>
</div>
<div class="paragraph">
<p>can be used to run with a different app manifest, and also to disable editing of properties.</p>
</div>
<div class="paragraph">
<p>To use a different separator, set the (optional) <code>$ISIS_OPTS_SEPARATOR</code> variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export ISIS_OPTS_SEPARATOR=";"
export ISIS_OPTS="isis.appManifest=domainapp.app.DomainAppAppManifestWithFixtures;isis.objects.editing=false"</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Docker&#8217;s <code>ENTRYPOINT</code> therefore just needs to parse the Docker container&#8217;s own command line arguments and use to
set this environment variable.</p>
</div>
</div>
</div>
</article>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
